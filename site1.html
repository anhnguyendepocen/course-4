<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>PLSC 31101: Introduction To Computational Tools And Techniques For Social Science</title>
  <meta name="description" content="This book contains course notes and other materials for PLSC 31101." />
  <meta name="generator" content="bookdown #bookdown:version# and GitBook 2.6.7" />

  <meta property="og:title" content="PLSC 31101: Introduction To Computational Tools And Techniques For Social Science" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://rochelleterman.github.io/plsc-31101/" />
  
  <meta property="og:description" content="This book contains course notes and other materials for PLSC 31101." />
  <meta name="github-repo" content="rochelleterman/plsc-31101" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="PLSC 31101: Introduction To Computational Tools And Techniques For Social Science" />
  
  <meta name="twitter:description" content="This book contains course notes and other materials for PLSC 31101." />
  

<meta name="author" content="Rochelle Terman" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<!--bookdown:link_prev-->
<!--bookdown:link_next-->
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>


<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



<!--bookdown:title:start-->
<div id="header">
<h1 class="title">PLSC 31101: Introduction To Computational Tools And Techniques For Social Science</h1>
<p class="author"><em>Rochelle Terman</em></p>
<p class="date"><em>Fall 2019</em></p>
</div>
<!--bookdown:title:end-->

<!--bookdown:toc:start-->
  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">
<!--bookdown:toc2:start-->
<ul>
<li><a href="#part-before-class">(PART) Before Class</a></li>
<li><a href="#syllabus"><span class="toc-section-number">1</span> Syllabus</a><ul>
<li><a href="#course-description"><span class="toc-section-number">1.1</span> Course Description</a></li>
<li><a href="#who-should-take-this-course"><span class="toc-section-number">1.2</span> Who should take this course</a></li>
<li><a href="#requirements-and-evaluation"><span class="toc-section-number">1.3</span> Requirements and Evaluation</a></li>
<li><a href="#activities-and-materials"><span class="toc-section-number">1.4</span> Activities and Materials</a></li>
<li><a href="#curriculum-outline-schedule"><span class="toc-section-number">1.5</span> Curriculum Outline / Schedule</a></li>
</ul></li>
<li><a href="#installation"><span class="toc-section-number">2</span> Installation</a><ul>
<li><a href="#r"><span class="toc-section-number">2.1</span> R</a></li>
<li><a href="#r-studio"><span class="toc-section-number">2.2</span> R Studio</a></li>
<li><a href="#r-packages"><span class="toc-section-number">2.3</span> R Packages</a></li>
<li><a href="#the-bash-shell"><span class="toc-section-number">2.4</span> The Bash Shell</a></li>
<li><a href="#git"><span class="toc-section-number">2.5</span> Git</a></li>
<li><a href="#other-helpful-tools"><span class="toc-section-number">2.6</span> Other helpful tools</a></li>
<li><a href="#testing-your-installation"><span class="toc-section-number">2.7</span> Testing your installation</a></li>
</ul></li>
<li><a href="#part-course-notes">(PART) Course Notes</a></li>
<li><a href="#introduction"><span class="toc-section-number">3</span> Introduction</a><ul>
<li><a href="#the-motivation"><span class="toc-section-number">3.1</span> The Motivation</a></li>
<li><a href="#about-this-class"><span class="toc-section-number">3.2</span> About This Class</a></li>
<li><a href="#learning-how-to-program"><span class="toc-section-number">3.3</span> Learning How to Program</a></li>
</ul></li>
<li><a href="#r-basics"><span class="toc-section-number">4</span> R Basics</a><ul>
<li><a href="#what-is-r"><span class="toc-section-number">4.1</span> What is R?</a></li>
<li><a href="#r-studio-1"><span class="toc-section-number">4.2</span> R Studio</a><ul>
<li><a href="#console"><span class="toc-section-number">4.2.1</span> Console</a></li>
<li><a href="#scripts"><span class="toc-section-number">4.2.2</span> Scripts</a></li>
<li><a href="#running-code"><span class="toc-section-number">4.2.3</span> Running code</a></li>
<li><a href="#comments"><span class="toc-section-number">4.2.4</span> Comments</a></li>
<li><a href="#diagnostics-and-errors"><span class="toc-section-number">4.2.5</span> Diagnostics and errors</a></li>
<li><a href="#r-environment"><span class="toc-section-number">4.2.6</span> R Environment</a></li>
</ul></li>
<li><a href="#r-markdown"><span class="toc-section-number">4.3</span> R Markdown</a><ul>
<li><a href="#yaml-header"><span class="toc-section-number">4.3.1</span> YAML header</a></li>
<li><a href="#markdown"><span class="toc-section-number">4.3.2</span> Markdown</a></li>
<li><a href="#code-chunks"><span class="toc-section-number">4.3.3</span> Code Chunks</a></li>
<li><a href="#knitting"><span class="toc-section-number">4.3.4</span> Knitting</a></li>
<li><a href="#cheatsheets-and-other-resources"><span class="toc-section-number">4.3.5</span> Cheatsheets and Other Resources</a></li>
<li><a href="#challenges"><span class="toc-section-number">4.3.6</span> Challenges</a></li>
</ul></li>
<li><a href="#r-packages-1"><span class="toc-section-number">4.4</span> R Packages</a><ul>
<li><a href="#installing-packages"><span class="toc-section-number">4.4.1</span> Installing Packages</a></li>
<li><a href="#loading-packages"><span class="toc-section-number">4.4.2</span> Loading Packages</a></li>
<li><a href="#challenges-1"><span class="toc-section-number">4.4.3</span> Challenges</a></li>
</ul></li>
</ul></li>
<li><a href="#r-syntax"><span class="toc-section-number">5</span> R Syntax</a><ul>
<li><a href="#variables"><span class="toc-section-number">5.1</span> Variables</a><ul>
<li><a href="#arithmetic"><span class="toc-section-number">5.1.1</span> Arithmetic</a></li>
<li><a href="#assigning-variables"><span class="toc-section-number">5.1.2</span> Assigning Variables</a></li>
<li><a href="#variable-names"><span class="toc-section-number">5.1.3</span> Variable Names</a></li>
<li><a href="#challenges-2"><span class="toc-section-number">5.1.4</span> Challenges</a></li>
</ul></li>
<li><a href="#functions"><span class="toc-section-number">5.2</span> Functions</a><ul>
<li><a href="#arguments"><span class="toc-section-number">5.2.1</span> Arguments</a></li>
<li><a href="#store-function-output"><span class="toc-section-number">5.2.2</span> Store Function Output</a></li>
<li><a href="#argument-restrictions-and-defaults"><span class="toc-section-number">5.2.3</span> Argument Restrictions and Defaults</a></li>
<li><a href="#documentation-and-help-files"><span class="toc-section-number">5.2.4</span> Documentation and Help Files</a></li>
<li><a href="#challenges-3"><span class="toc-section-number">5.2.5</span> Challenges</a></li>
</ul></li>
<li><a href="#data-types"><span class="toc-section-number">5.3</span> Data Types</a><ul>
<li><a href="#whats-that-type"><span class="toc-section-number">5.3.1</span> What’s that Type?</a></li>
<li><a href="#coercion"><span class="toc-section-number">5.3.2</span> Coercion</a></li>
<li><a href="#other-objects"><span class="toc-section-number">5.3.3</span> Other Objects</a></li>
<li><a href="#challenges-4"><span class="toc-section-number">5.3.4</span> Challenges</a></li>
</ul></li>
</ul></li>
<li><a href="#data-classes-and-structures"><span class="toc-section-number">6</span> Data Classes and Structures</a><ul>
<li><a href="#vectors"><span class="toc-section-number">6.1</span> Vectors</a><ul>
<li><a href="#creating-vectors"><span class="toc-section-number">6.1.1</span> Creating Vectors</a></li>
<li><a href="#naming-a-vector"><span class="toc-section-number">6.1.2</span> Naming a Vector</a></li>
<li><a href="#calculations-on-vectors"><span class="toc-section-number">6.1.3</span> Calculations on Vectors</a></li>
<li><a href="#types-of-vectors"><span class="toc-section-number">6.1.4</span> Types of Vectors</a></li>
<li><a href="#coercion-1"><span class="toc-section-number">6.1.5</span> Coercion</a></li>
<li><a href="#challenges-5"><span class="toc-section-number">6.1.6</span> Challenges</a></li>
</ul></li>
<li><a href="#lists"><span class="toc-section-number">6.2</span> Lists</a><ul>
<li><a href="#creating-lists"><span class="toc-section-number">6.2.1</span> Creating Lists</a></li>
<li><a href="#naming-lists"><span class="toc-section-number">6.2.2</span> Naming Lists</a></li>
<li><a href="#list-structure"><span class="toc-section-number">6.2.3</span> List Structure</a></li>
<li><a href="#challenges-6"><span class="toc-section-number">6.2.4</span> Challenges</a></li>
</ul></li>
<li><a href="#factors"><span class="toc-section-number">6.3</span> Factors</a><ul>
<li><a href="#creating-factors"><span class="toc-section-number">6.3.1</span> Creating Factors</a></li>
<li><a href="#summarizing-a-factor"><span class="toc-section-number">6.3.2</span> Summarizing a Factor</a></li>
<li><a href="#changing-factor-levels"><span class="toc-section-number">6.3.3</span> Changing Factor Levels</a></li>
<li><a href="#factors-are-integers"><span class="toc-section-number">6.3.4</span> Factors are Integers</a></li>
<li><a href="#challenges-7"><span class="toc-section-number">6.3.5</span> Challenges</a></li>
</ul></li>
<li><a href="#matrices"><span class="toc-section-number">6.4</span> Matrices</a><ul>
<li><a href="#creating-matrices"><span class="toc-section-number">6.4.1</span> Creating Matrices</a></li>
<li><a href="#matrix-dimensions"><span class="toc-section-number">6.4.2</span> Matrix Dimensions</a></li>
<li><a href="#matrix-names"><span class="toc-section-number">6.4.3</span> Matrix Names</a></li>
<li><a href="#challenge"><span class="toc-section-number">6.4.4</span> Challenge</a></li>
</ul></li>
<li><a href="#dataframes"><span class="toc-section-number">6.5</span> Dataframes</a><ul>
<li><a href="#creating-dataframes"><span class="toc-section-number">6.5.1</span> Creating Dataframes</a></li>
<li><a href="#the-structure-of-dataframes"><span class="toc-section-number">6.5.2</span> The Structure of Dataframes</a></li>
<li><a href="#naming-dataframes"><span class="toc-section-number">6.5.3</span> Naming Dataframes</a></li>
<li><a href="#coercing-dataframes"><span class="toc-section-number">6.5.4</span> Coercing Dataframes</a></li>
<li><a href="#challenges-8"><span class="toc-section-number">6.5.5</span> Challenges</a></li>
<li><a href="#quiz"><span class="toc-section-number">6.5.6</span> Quiz</a></li>
<li><a href="#data-structure-answers"><span class="toc-section-number">6.5.7</span> Answers</a></li>
</ul></li>
</ul></li>
<li><a href="#subsetting"><span class="toc-section-number">7</span> Subsetting</a><ul>
<li><a href="#subsetting-vectors"><span class="toc-section-number">7.1</span> Subsetting Vectors</a><ul>
<li><a href="#subsetting-types"><span class="toc-section-number">7.1.1</span> Subsetting Types</a></li>
<li><a href="#conditional-subsetting"><span class="toc-section-number">7.1.2</span> Conditional Subsetting</a></li>
<li><a href="#challenge-1"><span class="toc-section-number">7.1.3</span> Challenge</a></li>
</ul></li>
<li><a href="#subsetting-lists"><span class="toc-section-number">7.2</span> Subsetting Lists</a><ul>
<li><a href="#with"><span class="toc-section-number">7.2.1</span> With <code>[</code></a></li>
<li><a href="#with-1"><span class="toc-section-number">7.2.2</span> With <code>[[</code></a></li>
<li><a href="#with-2"><span class="toc-section-number">7.2.3</span> with <code>$</code></a></li>
<li><a href="#challenge-2"><span class="toc-section-number">7.2.4</span> Challenge</a></li>
</ul></li>
<li><a href="#subsetting-matrices"><span class="toc-section-number">7.3</span> Subsetting Matrices</a></li>
<li><a href="#subsetting-dataframes"><span class="toc-section-number">7.4</span> Subsetting Dataframes</a><ul>
<li><a href="#subsetting-names-and"><span class="toc-section-number">7.4.1</span> Subsetting Names and <code>$</code></a></li>
<li><a href="#conditional-subsetting-1"><span class="toc-section-number">7.4.2</span> Conditional Subsetting</a></li>
<li><a href="#list-like-and-matrix-like-subsetting"><span class="toc-section-number">7.4.3</span> List-Like and Matrix-Like Subsetting</a></li>
<li><a href="#challenges-9"><span class="toc-section-number">7.4.4</span> Challenges</a></li>
</ul></li>
<li><a href="#sub-assignment"><span class="toc-section-number">7.5</span> Sub-assignment</a><ul>
<li><a href="#basics-of-sub-assignment"><span class="toc-section-number">7.5.1</span> Basics of Sub-assignment</a></li>
<li><a href="#recycling"><span class="toc-section-number">7.5.2</span> Recycling</a></li>
<li><a href="#applications"><span class="toc-section-number">7.5.3</span> Applications</a></li>
</ul></li>
</ul></li>
<li><a href="#working-with-data"><span class="toc-section-number">8</span> Working with Data</a><ul>
<li><a href="#project-workflow"><span class="toc-section-number">8.1</span> Project Workflow</a><ul>
<li><a href="#store-analyses-in-scripts-not-workspaces."><span class="toc-section-number">8.1.1</span> Store Analyses in Scripts, Not Workspaces.</a></li>
<li><a href="#working-directories-and-paths"><span class="toc-section-number">8.1.2</span> Working Directories and Paths</a></li>
<li><a href="#r-projects"><span class="toc-section-number">8.1.3</span> R Projects</a></li>
<li><a href="#file-organization"><span class="toc-section-number">8.1.4</span> File Organization</a></li>
</ul></li>
<li><a href="#introduction-to-data"><span class="toc-section-number">8.2</span> Introduction to Data</a><ul>
<li><a href="#wheres-my-data"><span class="toc-section-number">8.2.1</span> Where’s my data?</a></li>
<li><a href="#data-storage"><span class="toc-section-number">8.2.2</span> Data Storage</a></li>
<li><a href="#tidy-data"><span class="toc-section-number">8.2.3</span> <code>tidy</code> Data</a></li>
<li><a href="#relational-data"><span class="toc-section-number">8.2.4</span> Relational data</a></li>
<li><a href="#keys"><span class="toc-section-number">8.2.5</span> Keys</a></li>
</ul></li>
<li><a href="#importing-and-exporting"><span class="toc-section-number">8.3</span> Importing and Exporting</a><ul>
<li><a href="#importing-data"><span class="toc-section-number">8.3.1</span> Importing Data</a></li>
<li><a href="#exporting-data"><span class="toc-section-number">8.3.2</span> Exporting Data</a></li>
</ul></li>
<li><a href="#exploring-data"><span class="toc-section-number">8.4</span> Exploring Data</a><ul>
<li><a href="#the-gapminder-dataset"><span class="toc-section-number">8.4.1</span> The Gapminder Dataset</a></li>
<li><a href="#structure-and-dimensions"><span class="toc-section-number">8.4.2</span> Structure and Dimensions</a></li>
<li><a href="#common-alterations"><span class="toc-section-number">8.4.3</span> Common Alterations</a></li>
<li><a href="#summary-statistics"><span class="toc-section-number">8.4.4</span> Summary statistics</a></li>
<li><a href="#review-of-subsetting"><span class="toc-section-number">8.4.5</span> Review of Subsetting</a></li>
<li><a href="#basic-plotting"><span class="toc-section-number">8.4.6</span> Basic Plotting</a></li>
<li><a href="#challenges-10"><span class="toc-section-number">8.4.7</span> Challenges</a></li>
</ul></li>
</ul></li>
<li><a href="#data-transformation"><span class="toc-section-number">9</span> Data Transformation</a><ul>
<li><a href="#introduction-1"><span class="toc-section-number">9.1</span> Introduction</a><ul>
<li><a href="#tidyverse"><span class="toc-section-number">9.1.1</span> <code>tidyverse</code></a></li>
<li><a href="#gapminder"><span class="toc-section-number">9.1.2</span> Gapminder</a></li>
<li><a href="#why-dplyr"><span class="toc-section-number">9.1.3</span> Why <code>dplyr</code>?</a></li>
</ul></li>
<li><a href="#dplyr-functions"><span class="toc-section-number">9.2</span> <code>dplyr</code> Functions</a><ul>
<li><a href="#select-columns-with-select"><span class="toc-section-number">9.2.1</span> Select Columns with <code>select</code></a></li>
<li><a href="#the-pipe"><span class="toc-section-number">9.2.2</span> The Pipe</a></li>
<li><a href="#filter-rows-with-filter"><span class="toc-section-number">9.2.3</span> Filter Rows with <code>filter</code></a></li>
<li><a href="#calculate-across-groups-with-group_by"><span class="toc-section-number">9.2.4</span> Calculate Across Groups with <code>group_by</code></a></li>
<li><a href="#summarize-across-groups-with-summarize"><span class="toc-section-number">9.2.5</span> Summarize Across Groups with <code>summarize</code></a></li>
<li><a href="#add-new-variables-with-mutate"><span class="toc-section-number">9.2.6</span> Add New Variables with <code>mutate</code></a></li>
<li><a href="#arrange-rows-with-arrange"><span class="toc-section-number">9.2.7</span> Arrange Rows with <code>arrange</code></a></li>
</ul></li>
<li><a href="#dplyr-and-non-standard-evaluation"><span class="toc-section-number">9.3</span> <code>dplyr</code> and “Non-Standard Evaluation”</a><ul>
<li><a href="#challenges-11"><span class="toc-section-number">9.3.1</span> Challenges</a></li>
</ul></li>
</ul></li>
<li><a href="#tidying-data"><span class="toc-section-number">10</span> Tidying Data</a><ul>
<li><a href="#wide-vs.long-formats"><span class="toc-section-number">10.1</span> Wide vs. Long Formats</a></li>
<li><a href="#tidying-the-gapminder-data"><span class="toc-section-number">10.2</span> Tidying the Gapminder Data</a></li>
<li><a href="#tidyr-functions"><span class="toc-section-number">10.3</span> <code>tidyr</code> Functions</a><ul>
<li><a href="#gather"><span class="toc-section-number">10.3.1</span> <code>gather</code></a></li>
<li><a href="#separate"><span class="toc-section-number">10.3.2</span> <code>separate</code></a></li>
<li><a href="#spread"><span class="toc-section-number">10.3.3</span> <code>spread</code></a></li>
</ul></li>
<li><a href="#more-tidyverse"><span class="toc-section-number">10.4</span> More <code>tidyverse</code></a></li>
<li><a href="#challenges-12"><span class="toc-section-number">10.5</span> Challenges</a></li>
</ul></li>
<li><a href="#relational-data-1"><span class="toc-section-number">11</span> Relational Data</a><ul>
<li><a href="#why-relational-data"><span class="toc-section-number">11.1</span> Why Relational Data</a></li>
<li><a href="#keys-1"><span class="toc-section-number">11.2</span> Keys</a></li>
<li><a href="#joins"><span class="toc-section-number">11.3</span> Joins</a></li>
<li><a href="#defining-keys"><span class="toc-section-number">11.4</span> Defining Keys</a></li>
<li><a href="#duplicate-keys"><span class="toc-section-number">11.5</span> Duplicate Keys</a></li>
</ul></li>
<li><a href="#plotting"><span class="toc-section-number">12</span> Plotting</a><ul>
<li><a href="#the-dataset"><span class="toc-section-number">12.1</span> The Dataset</a></li>
<li><a href="#r-base-graphics"><span class="toc-section-number">12.2</span> R Base Graphics</a><ul>
<li><a href="#scatter-and-line-plots"><span class="toc-section-number">12.2.1</span> Scatter and Line Plots</a></li>
<li><a href="#histograms-and-density-plots"><span class="toc-section-number">12.2.2</span> Histograms and Density Plots</a></li>
<li><a href="#labels"><span class="toc-section-number">12.2.3</span> Labels</a></li>
<li><a href="#axis-and-size-scaling"><span class="toc-section-number">12.2.4</span> Axis and Size Scaling</a></li>
<li><a href="#graphical-parameters"><span class="toc-section-number">12.2.5</span> Graphical Parameters</a></li>
<li><a href="#annotations-reference-lines-and-legends"><span class="toc-section-number">12.2.6</span> Annotations, Reference Lines, and Legends</a></li>
</ul></li>
<li><a href="#ggplot2"><span class="toc-section-number">12.3</span> ggplot2</a><ul>
<li><a href="#grammar"><span class="toc-section-number">12.3.1</span> Grammar</a></li>
<li><a href="#anatomy-of-aes"><span class="toc-section-number">12.3.2</span> Anatomy of <code>aes</code></a></li>
<li><a href="#layers"><span class="toc-section-number">12.3.3</span> Layers</a></li>
<li><a href="#labels-1"><span class="toc-section-number">12.3.4</span> Labels</a></li>
<li><a href="#transformations-and-stats"><span class="toc-section-number">12.3.5</span> Transformations and Stats</a></li>
<li><a href="#facets"><span class="toc-section-number">12.3.6</span> Facets</a></li>
<li><a href="#putting-everything-together"><span class="toc-section-number">12.3.7</span> Putting Everything Together</a></li>
</ul></li>
<li><a href="#saving-plots"><span class="toc-section-number">12.4</span> Saving plots</a></li>
</ul></li>
<li><a href="#statistical-inferences"><span class="toc-section-number">13</span> Statistical Inferences</a><ul>
<li><a href="#statistical-distributions"><span class="toc-section-number">13.1</span> Statistical Distributions</a><ul>
<li><a href="#sampling-and-simulation"><span class="toc-section-number">13.1.1</span> Sampling and Simulation</a></li>
<li><a href="#random-seeds"><span class="toc-section-number">13.1.2</span> Random Seeds</a></li>
<li><a href="#challenges-13"><span class="toc-section-number">13.1.3</span> Challenges</a></li>
</ul></li>
<li><a href="#inferences-and-regressions"><span class="toc-section-number">13.2</span> Inferences and regressions</a><ul>
<li><a href="#statistical-tests"><span class="toc-section-number">13.2.1</span> Statistical Tests</a></li>
<li><a href="#regressions-and-linear-models"><span class="toc-section-number">13.2.2</span> Regressions and Linear Models</a></li>
<li><a href="#regression-output"><span class="toc-section-number">13.2.3</span> Regression output</a></li>
<li><a href="#interactions"><span class="toc-section-number">13.2.4</span> Interactions</a></li>
<li><a href="#formatting-regression-tables"><span class="toc-section-number">13.2.5</span> Formatting Regression Tables</a></li>
<li><a href="#challenges-14"><span class="toc-section-number">13.2.6</span> Challenges</a></li>
</ul></li>
</ul></li>
<li><a href="#strings-and-regular-expressions"><span class="toc-section-number">14</span> Strings and Regular Expressions</a><ul>
<li><a href="#common-string-operations"><span class="toc-section-number">14.1</span> Common string operations</a><ul>
<li><a href="#concatinating-strings-with-paste"><span class="toc-section-number">14.1.1</span> Concatinating strings with <code>paste()</code></a></li>
<li><a href="#extracting-substrings"><span class="toc-section-number">14.1.2</span> Extracting substrings</a></li>
<li><a href="#replace-substrings-with-gsub"><span class="toc-section-number">14.1.3</span> Replace substrings with <code>gsub()</code></a></li>
</ul></li>
<li><a href="#regular-expressions"><span class="toc-section-number">14.2</span> Regular Expressions</a></li>
</ul></li>
<li><a href="#programming-in-r"><span class="toc-section-number">15</span> Programming in R</a><ul>
<li><a href="#conditional-flow"><span class="toc-section-number">15.1</span> Conditional Flow</a><ul>
<li><a href="#multiple-conditions"><span class="toc-section-number">15.1.1</span> Multiple conditions</a></li>
<li><a href="#complex-statements"><span class="toc-section-number">15.1.2</span> Complex statements</a></li>
<li><a href="#code-style"><span class="toc-section-number">15.1.3</span> Code style</a></li>
<li><a href="#if-vs.-if_else"><span class="toc-section-number">15.1.4</span> <code>if</code> vs. <code>if_else</code></a></li>
</ul></li>
<li><a href="#functions-1"><span class="toc-section-number">15.2</span> Functions</a><ul>
<li><a href="#why-write-functions"><span class="toc-section-number">15.2.1</span> Why write functions?</a></li>
<li><a href="#anatomy-of-a-function"><span class="toc-section-number">15.2.2</span> Anatomy of a function</a></li>
<li><a href="#writing-a-function"><span class="toc-section-number">15.2.3</span> Writing a function</a></li>
<li><a href="#using-a-function"><span class="toc-section-number">15.2.4</span> Using a function</a></li>
<li><a href="#variable-scope"><span class="toc-section-number">15.2.5</span> Variable Scope</a></li>
<li><a href="#arguments-1"><span class="toc-section-number">15.2.6</span> Arguments</a></li>
<li><a href="#challenges-15"><span class="toc-section-number">15.2.7</span> Challenges</a></li>
</ul></li>
<li><a href="#iteration"><span class="toc-section-number">15.3</span> Iteration</a><ul>
<li><a href="#vectorized-functions"><span class="toc-section-number">15.3.1</span> Vectorized functions</a></li>
<li><a href="#for-loops"><span class="toc-section-number">15.3.2</span> For-loops</a></li>
<li><a href="#functional-programming-and-map"><span class="toc-section-number">15.3.3</span> Functional Programming and <code>map</code></a></li>
<li><a href="#scoped-verbs"><span class="toc-section-number">15.3.4</span> Scoped verbs</a></li>
</ul></li>
</ul></li>
<li><a href="#collecting-data-from-the-web"><span class="toc-section-number">16</span> Collecting Data from the Web</a><ul>
<li><a href="#introduction-2"><span class="toc-section-number">16.1</span> Introduction</a></li>
<li><a href="#web-apis"><span class="toc-section-number">16.2</span> Web APIs</a><ul>
<li><a href="#some-basic-terminology"><span class="toc-section-number">16.2.1</span> Some Basic Terminology</a></li>
<li><a href="#how-do-get-requests-work"><span class="toc-section-number">16.2.2</span> How Do GET Requests Work?</a></li>
<li><a href="#finding-apis"><span class="toc-section-number">16.2.3</span> Finding APIs</a></li>
<li><a href="#getting-api-access"><span class="toc-section-number">16.2.4</span> Getting API Access</a></li>
<li><a href="#using-apis-in-r"><span class="toc-section-number">16.2.5</span> Using APIs in R</a></li>
</ul></li>
<li><a href="#collecting-twitter-data-with-rtweet"><span class="toc-section-number">16.3</span> Collecting Twitter Data with RTweet</a><ul>
<li><a href="#setting-up-rtweet"><span class="toc-section-number">16.3.1</span> Setting up <code>RTweet</code></a></li>
<li><a href="#uchicago-political-science-prof-tweets"><span class="toc-section-number">16.3.2</span> UChicago Political Science Prof Tweets</a></li>
<li><a href="#hashtags-and-text-strings"><span class="toc-section-number">16.3.3</span> Hashtags and Text Strings</a></li>
</ul></li>
<li><a href="#writing-api-queries"><span class="toc-section-number">16.4</span> Writing API Queries</a><ul>
<li><a href="#constructing-the-api-get-request"><span class="toc-section-number">16.4.1</span> Constructing the API GET Request</a></li>
<li><a href="#parsing-the-response"><span class="toc-section-number">16.4.2</span> Parsing the response</a></li>
<li><a href="#iteration-through-results-pager"><span class="toc-section-number">16.4.3</span> Iteration through results pager</a></li>
<li><a href="#visualizing-results"><span class="toc-section-number">16.4.4</span> Visualizing Results</a></li>
<li><a href="#more-resources-1"><span class="toc-section-number">16.4.5</span> More resources</a></li>
</ul></li>
<li><a href="#webscraping"><span class="toc-section-number">16.5</span> Webscraping</a><ul>
<li><a href="#whats-a-website"><span class="toc-section-number">16.5.1</span> What’s a website?</a></li>
<li><a href="#html"><span class="toc-section-number">16.5.2</span> HTML</a></li>
<li><a href="#css"><span class="toc-section-number">16.5.3</span> CSS</a></li>
<li><a href="#finding-elements-with-selector-gadget"><span class="toc-section-number">16.5.4</span> Finding Elements with Selector Gadget</a></li>
</ul></li>
<li><a href="#scraping-presidential-statements"><span class="toc-section-number">16.6</span> Scraping Presidential Statements</a><ul>
<li><a href="#using-rvest-to-read-html"><span class="toc-section-number">16.6.1</span> Using <code>RVest</code> to Read HTML</a></li>
<li><a href="#find-page-elements"><span class="toc-section-number">16.6.2</span> Find Page Elements</a></li>
<li><a href="#get-attributes-and-text-of-elements"><span class="toc-section-number">16.6.3</span> Get Attributes and Text of Elements</a></li>
<li><a href="#lets-do-this."><span class="toc-section-number">16.6.4</span> Let’s DO this.</a></li>
<li><a href="#challenge-1-make-a-function"><span class="toc-section-number">16.6.5</span> Challenge 1: Make a function</a></li>
</ul></li>
</ul></li>
<li><a href="#part-assignments-and-projects">(PART) Assignments and Projects</a></li>
<li><a href="#assignments-1"><span class="toc-section-number">17</span> Assignments</a><ul>
<li><a href="#assignment-1"><span class="toc-section-number">17.1</span> Assignment 1</a></li>
<li><a href="#assignment-2"><span class="toc-section-number">17.2</span> Assignment 2</a><ul>
<li><a href="#assignment-2-solutions"><span class="toc-section-number">17.2.1</span> Assignment 2 Solutions</a></li>
</ul></li>
<li><a href="#assignment-3"><span class="toc-section-number">17.3</span> Assignment 3</a><ul>
<li><a href="#assignment-3-solutions"><span class="toc-section-number">17.3.1</span> Assignment 3 Solutions</a></li>
</ul></li>
</ul></li>
</ul>
<!--bookdown:toc2:end-->
      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">PLSC 31101: Introduction To Computational Tools And Techniques For Social Science</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<!--bookdown:toc:end-->
<!--bookdown:body:start-->
<div id="part-before-class" class="section level1 unnumbered">
<h1>(PART) Before Class</h1>
</div>
<div id="syllabus" class="section level1">
<h1><span class="header-section-number">1</span> Syllabus</h1>
<ul>
<li><p>Instructor: <a href="http://rochelleterman.com/">Rochelle Terman</a>, <a href="mailto:rterman@uchicago.edu">rterman@uchicago.edu</a></p></li>
<li><p>TA: Pete Cuppernull, <a href="mailto:pcuppernull@uchicago.edu">pcuppernull@uchicago.edu</a></p></li>
<li><p>Time: Tuesdays and Thursdays, 12:30 pm – 1:50 pm</p></li>
<li><p>Place: Cobb Hall 303</p></li>
<li>Office hours:
<ul>
<li>Rochelle Terman: Tuesdays, 2:30-4:30, Pick Hall 411</li>
<li>Pete Cuppernull: Mondays, 2:00-4:00,</li>
</ul></li>
</ul>
<div id="course-description" class="section level2">
<h2><span class="header-section-number">1.1</span> Course Description</h2>
<p>The purpose of this course is to provide graduate students with the critical computing skills necessary to conduct research in quantitative / computational social science. This course is not an introduction to statistics, computer science, or specialized social science methods. Rather, the focus will be on practical skills necessary to be successful in further methods work. The first portion of the class introduces students to basic computer literacy, terminologies, and the R programming language. The second part of the course provides students the opportunity to use the skills they learned in part 1 towards practical applications such as webscraping, data collection through APIs, automated text analysis, etc. We will assume no prior experience with programming or computer science.</p>
<div id="objectives" class="section level4 unnumbered">
<h4>Objectives</h4>
<p>By the end of the course, students should be able to:</p>
<ul>
<li>Understand basic programming terminologies, structures, and conventions.</li>
<li>Write, execute, and debug R code.</li>
<li>Produce reproducible analyses using R Markdown.</li>
<li>Clean, transform, and wrangle data using the <code>tidyverse</code> packages.</li>
<li>Scrape data from websites and APIs.</li>
<li>Parse and analyze text documents.</li>
<li>Be familiar with the concepts and tools of a variety of computational social science applications.</li>
<li>Master basic Git and GitHub workflows</li>
<li>Learn independently and train themselves in a variety of computational applications and tasks through online documentation.</li>
</ul>
</div>
</div>
<div id="who-should-take-this-course" class="section level2">
<h2><span class="header-section-number">1.2</span> Who should take this course</h2>
<p>This course is designed for Political Science Graduate students, but any graduate student is welcome. We will not presume any prior programming or computer science experience.</p>
</div>
<div id="requirements-and-evaluation" class="section level2">
<h2><span class="header-section-number">1.3</span> Requirements and Evaluation</h2>
<div id="final-grades" class="section level4 unnumbered">
<h4>Final Grades</h4>
<p>This is a graded class based on the following:</p>
<ul>
<li>Completion of assigned homework (50%)</li>
<li>Participation (25%)</li>
<li>Final project (25%)</li>
</ul>
</div>
<div id="assignments" class="section level4 unnumbered">
<h4>Assignments</h4>
<p>Assignments will be assigned at the end of every Thursday session. They will be due one week later, unless otherwise noted. The assignments are intended to expand upon the lecture material and to help students develop the actual skills that will be useful for applied work. The assignments will be frequent but each of them should be fairly short.</p>
<p>You are encouraged to work in groups, but the work you turn in must be your own. Group submission of homework, or turning in copies of the same code or output, is not acceptable. While you are encouraged to use the internet to help you debug, but do not copy and paste large chunks of code that you do not understand. Remember, the only way you actually learn how to write code is to write code!</p>
<p>Portions of the homework in <code>R</code> should be completed using <a href="https://rmarkdown.rstudio.com/">R markdown</a>, a markup language for producing well-formatted documents with embedded R code and outputs. To submit your homework, knit the R Markdown file to HTML, and then submit the HTML file through Canvas.</p>
</div>
<div id="class-participation" class="section level4 unnumbered">
<h4>Class Participation</h4>
<p>The class participation portion of the grade can be satisfied in one or more of the following ways:</p>
<ul>
<li>attending the lectures</li>
<li>asking and answering questions in class</li>
<li>attending office hours</li>
<li>contributing to class discussion through the Canvas site, and/or</li>
<li>collaborating with the computing community, either by attending a workshop or meetup, submitting a pull request to a github repository (including the class repository), answering a question on StackExchange, or other involvement in the social computing / digital humanities community.</li>
</ul>
</div>
<div id="final-project" class="section level4 unnumbered">
<h4>Final Project</h4>
<p>Students have two options for class projects:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Data project</strong>: Use the tools we learned in class on your own data of interest. Collect and/or clean the data, perform some analysis, and visualize the results. Post your reproducible code on Github.</p></li>
<li><p><strong>Tool project</strong>: Create a tutorial on a tool we didn’t cover in class. Ideas include: bash, LaTex, pandoc, quanteda, tidytext, etc. Post it on github.</p></li>
</ol>
<p>Students are required to write a short proposal by <strong>November 7</strong> (no more than 2 paragraphs) in order to get approval / feedback from the instructors.</p>
<p>On <strong>December 10</strong> we will have a <strong>lightning talk session</strong> where students can present their projects in a maximum 5 minute talk.</p>
</div>
<div id="late-policy-and-incompletes" class="section level4 unnumbered">
<h4>Late Policy and Incompletes</h4>
<p>All deadlines are strict. Late assignments will be dropped a full letter grade for each 24 hours past the deadline. Exceptions will be made for students with a documented emergency or illness.</p>
<p>I will only consider granting incompletes to students under extreme personal/family duress.</p>
</div>
<div id="academic-integrity" class="section level4 unnumbered">
<h4>Academic Integrity</h4>
<p>I follow a zero-tolerance policy on all forms of academic dishonesty. All students are responsible for familiarizing themselves with, and following, university policies regarding proper student conduct. Being found guilty of academic dishonesty is a serious offense and may result in a failing grade for the assignment in question, and possibtire course.</p>
</div>
</div>
<div id="activities-and-materials" class="section level2">
<h2><span class="header-section-number">1.4</span> Activities and Materials</h2>
<div id="course-structure" class="section level4 unnumbered">
<h4>Course Structure</h4>
<p>Classes will follow a “workshop” style, combining lecture, demonstration, and coding exercises. We envision the class to be as interactive / hands on as possible, with students programming every session. <strong>You must bring a laptop to class.</strong></p>
<p>It is important that students <strong>complete the requisite reading</strong> before class. I anticipate spending 1/2 the class lecturing, and 1/2 practicing with code challenges.</p>
</div>
<div id="course-website" class="section level4 unnumbered">
<h4>Course Website</h4>
<p>All course notes will be posted on <a href="https://rochelleterman.github.io/plsc-31101/" class="uri">https://rochelleterman.github.io/plsc-31101/</a>, including class notes, code demonstrations, sample data, and assignments. Students will be assigned reading from these notes before every class.</p>
<p>Students are encouraged to submit pull requests to the <a href="https://github.com/rochelleterman/plsc-31101">website repository</a>, for example if they find a typo, or if they found a particularly helpful resource that would aid other students.</p>
<p>Students projects will also be shared on the course website.</p>
</div>
<div id="canvas" class="section level4 unnumbered">
<h4>Canvas</h4>
<p>We will use Canvas for communication (announcements and questions) and turning in assignments.</p>
<p>You should ask questions about class material and assignments through the Canvas website so that everyone can benefit from the discussion. We encourage you to respond to each other’s questions as well. Questions of a personal nature can be emailed to us directly.</p>
</div>
<div id="computer-requirements-and-software" class="section level4 unnumbered">
<h4>Computer Requirements and Software</h4>
<p>By the end of the first week, you should install the following software on your computer:</p>
<ul>
<li>Access to the UNIX command line (e.g., a Mac laptop, a Bash wrapper on Windows)</li>
<li>Git</li>
<li>R and RStudio (latest versions)</li>
</ul>
<p>This requires a computer that can handle all this software. Almost any Mac will do the job. Most Windows machines are fine too if they have enough space and memory.</p>
<p>See <a href="installation">Install Page</a> for more information. We will be having an <strong>InstallFest on Wednesday, Oct 2 from 10am to 12pm</strong>. for those students experiencing difficulties downloading and installing the requisite software.</p>
</div>
</div>
<div id="curriculum-outline-schedule" class="section level2">
<h2><span class="header-section-number">1.5</span> Curriculum Outline / Schedule</h2>
<ol style="list-style-type: decimal">
<li><strong>Oct 1</strong> - Introduction
<ul>
<li>course objectives, logistics, overview of programming and reproducible research.</li>
</ul></li>
<li><strong>Oct 3</strong> - R Tools
<ul>
<li>R Studio, R Markdown, packages, help.</li>
</ul></li>
<li><strong>Oct 8</strong> - R Syntax
<ul>
<li>basic syntax, variables, functions, data types.</li>
</ul></li>
<li><strong>Oct 10</strong> - Data Structures
<ul>
<li>vectors, lists, factors, matrices, data frames.</li>
</ul></li>
<li><strong>Oct 15</strong> - Indexing and Subsetting
<ul>
<li>subsetting formats, operators, boolean conditionals, sub-assignment, applications.</li>
</ul></li>
<li><strong>Oct 17</strong> - Introduction to Data
<ul>
<li>common terms, formats, tidy data, storage, import/export, exploratory data analysis.</li>
</ul></li>
<li><strong>Oct 22</strong> - Manipulating data with <code>dplyr</code>
<ul>
<li>importing data, subsetting, summarizing, and conducting calculations across groups, piping.</li>
</ul></li>
<li><strong>Oct 24</strong> - Tidying data with <code>tidyr</code>
<ul>
<li>tidy data principles, gather, spread, separate, unite</li>
</ul></li>
<li><strong>Oct 29</strong> - Merging and Linking Data
<ul>
<li>relational data, keys, joins, missing values.</li>
</ul></li>
<li><strong>Oct 31</strong> - Visualization
<ul>
<li>base plotting, ggplot, grammar of graphics, writing images.</li>
</ul></li>
<li><strong>Nov 5</strong> - Hypothesis testing and regressions
<ul>
<li>models, model objects, stargazer.</li>
</ul></li>
</ol>
<p>12, <strong>Nov 7</strong> - Strings and Regex</p>
<ol start="13" style="list-style-type: decimal">
<li><strong>Nov 12</strong> - R programming 1
<ul>
<li>conditional flow, functions.</li>
</ul></li>
<li><strong>Nov 14</strong> - R Programming 2
<ul>
<li>iterations, map.</li>
</ul></li>
<li><strong>Nov 19</strong> - Collecting data with APIs
<ul>
<li>requests, RESTful APIs, queries, API libraries.</li>
</ul></li>
<li><strong>Nov 21</strong> - Webscraping
<ul>
<li>HTML, CSS, In-Browser tools, scraping tools.</li>
</ul></li>
<li><strong>Nov 26</strong> - Text analysis 1
<ul>
<li>supervised vs. unsupervised learning, Vector-space models, topic models.</li>
</ul></li>
<li><strong>Nov 28</strong> - Text analysis 2
<ul>
<li>supervised vs. unsupervised learning, Vector-space models, topic models.</li>
</ul></li>
<li><p><strong>Dec 3</strong> - Git / Github</p></li>
<li><p><strong>Dec 5</strong> - TBD</p></li>
<li><p><strong>Dec 10, 1:30-3:30pm</strong> - Final project lightning talks</p></li>
</ol>
<!--chapter:end:index.Rmd-->
</div>
</div>
<div id="installation" class="section level1">
<h1><span class="header-section-number">2</span> Installation</h1>
<p>To participate in PLSC 31101, you will need access to the software described below.</p>
<p>Once you’ve installed all of the software below, test your installation by following the instructions at the bottom on this page.</p>
<div id="r" class="section level2">
<h2><span class="header-section-number">2.1</span> R</h2>
<p><a href="http://www.r-project.org/">R</a> is a programming language that is especially powerful for data exploration, visualization, and statistical analysis.</p>
<p>To download R, go to <a href="https://cran.r-project.org/">CRAN</a> (the <strong>C</strong>omprehensive <strong>R</strong> <strong>A</strong>rchive <strong>N</strong>etwork).</p>
<p>A new major version of R comes out once a year, and there are 2-3 minor releases each year. It’s a good idea to update regularly. Upgrading can be a bit of a hassle, especially for major versions, which require you to reinstall all your packages, but putting it off only makes it worse.</p>
</div>
<div id="r-studio" class="section level2">
<h2><span class="header-section-number">2.2</span> R Studio</h2>
<p>To interact with R, we use RStudio. Please install the latest desktop version of <a href="http://www.rstudio.com/ide/download/desktop">RStudio IDE</a>. We will not support RStudio cloud.</p>
</div>
<div id="r-packages" class="section level2">
<h2><span class="header-section-number">2.3</span> R Packages</h2>
<p>You’ll also need to install some R packages. An R package is a collection of functions, data, and documentation that extends the capabilities of base R. Using packages is key to the successful use of R.</p>
<p>Many of the packages that you will learn in this class are part of the so-called <code>tidyverse</code>. The packages in the <code>tidyverse</code> share a common philosophy of data and R programming, and are designed to work together naturally.</p>
<p>You can install the complete tidyverse with a single line of code in R Studio:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install.packages</span>(<span class="st">&quot;tidyverse&quot;</span>)</code></pre></div>
<p>On your own computer, type that line of code in the RStudio console, and then press enter to run it. R will download the packages from CRAN and install them on to your computer. If you have problems installing, make sure that you are connected to the internet, and that <a href="https://cloud.r-project.org/" class="uri">https://cloud.r-project.org/</a> isn’t blocked by your firewall or proxy.</p>
<p>We will also be requiring a few other important packages. Run the following line of code to download all of them at once:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install.packages</span>(<span class="st">&quot;rmarkdown&quot;</span>, <span class="st">&quot;knitr&quot;</span>, <span class="st">&quot;gapminder&quot;</span>, <span class="st">&quot;stargazer&quot;</span>, <span class="st">&quot;rtweet&quot;</span>, <span class="st">&quot;jsonlite&quot;</span>, <span class="st">&quot;httr&quot;</span>, <span class="st">&quot;rvest&quot;</span>)</code></pre></div>
</div>
<div id="the-bash-shell" class="section level2">
<h2><span class="header-section-number">2.4</span> The Bash Shell</h2>
<p>Bash is a commonly-used shell that gives you the power to do simple tasks more quickly.</p>
<div id="windows" class="section level4 unnumbered">
<h4>Windows</h4>
<p>Install Git for Windows by downloading and running the <a href="http://msysgit.github.io/">installer</a>. This will provide you with both Git and Bash in the Git Bash program. <strong>NOTE</strong>: on the ~6th step of installation, you will need to select the option “Use Windows’ default console window” rather than the default of “Use MinTTY” in order for nano to work correctly.</p>
<p>After the installer does its thing, it leaves the window open, so that you can play with the “Git Bash”.</p>
<p>Chances are that you want to have an easy way to restart that Git Bash. You can install shortcuts in the start menu, on the desktop or in the QuickStart bar by calling the script /share/msysGit/add-shortcut.tcl (call it without parameters to see a short help text).</p>
</div>
<div id="mac-os-x" class="section level4 unnumbered">
<h4>Mac OS X</h4>
<p>The default shell in all versions of Mac OS X is bash, so no need to install anything. You access bash from the Terminal (found in <code>/Applications/Utilities</code>). You may want to keep Terminal in your dock for this class.</p>
</div>
<div id="linux" class="section level4 unnumbered">
<h4>Linux</h4>
<p>The default shell is usually Bash, but if your machine is set up differently you can run it by opening a terminal and typing bash. There is no need to install anything.</p>
</div>
</div>
<div id="git" class="section level2">
<h2><span class="header-section-number">2.5</span> Git</h2>
<p>Git is a version control system that lets you track who made changes to what when and has options for easily updating a shared or public version of your code on github.com. You will need a supported web browser (current versions of Chrome, Firefox or Safari, or Internet Explorer version 9 or above).</p>
<div id="windows-1" class="section level4 unnumbered">
<h4>Windows</h4>
<p>Git should be installed on your computer as part of your Bash install (described above).</p>
</div>
<div id="mac-os-x-1" class="section level4 unnumbered">
<h4>Mac OS X</h4>
<p><strong>For OS X 10.9 and higher</strong>, install Git for Mac by downloading and running the most recent “mavericks” installer from <a href="http://sourceforge.net/projects/git-osx-installer/files/">this list</a>. After installing Git, there will not be anything in your <code>/Applications</code> folder, as Git is a command line program. <strong>For older versions of OS X (10.5-10.8)</strong> use the most recent available installer labelled “snow-leopard” available <a href="http://sourceforge.net/projects/git-osx-installer/files/">here</a>.</p>
</div>
<div id="linux-1" class="section level4 unnumbered">
<h4>Linux</h4>
<p>If Git is not already available on your machine you can try to install it via your distro’s package manager. For Debian/Ubuntu run sudo apt-get install git and for Fedora run sudo yum install git.</p>
</div>
</div>
<div id="other-helpful-tools" class="section level2">
<h2><span class="header-section-number">2.6</span> Other helpful tools</h2>
<p>While not required, I recommend you install the following tools:</p>
<ol style="list-style-type: decimal">
<li><p><a href="https://www.google.com/chrome/">Google Chrome</a> is an up-to-date web browser.</p></li>
<li><p><a href="https://www.sublimetext.com/3">Sublime Text</a> is a free, advanced text editor.</p></li>
</ol>
</div>
<div id="testing-your-installation" class="section level2">
<h2><span class="header-section-number">2.7</span> Testing your installation</h2>
<p>If you have trouble with installation, please come to the Installfest on <strong>Wed Oct 2, 10-12 in Pick 411</strong>.</p>
<p>Open a command line window (‘terminal’ or, on windows, ‘git bash’), and enter the following commands (without the $ sign):</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash">$ <span class="ex">R</span> --version
$ <span class="fu">git</span> --version</code></pre></div>
<p>If everything has been installed correctly, those commands <em>should</em> print output version information.</p>
<p><strong>NB</strong>: If you’re using git bash, the <code>R --version</code> command may not work. In this case, just make sure you can open up RStudio.</p>
<p>Software Carpentry maintains a list of common issues that occur during installation may be useful for our class here: <a href="https://github.com/swcarpentry/workshop-template/wiki/Configuration-Problems-and-Solutions">Configuration Problems and Solutions wiki page.</a></p>
<p>Credit: Thanks to <a href="http://software-carpentry.org/workshops/">Software Carpentry</a> for providing installation guidelines.</p>
<!--chapter:end:00-Pre-class/00-1_Installation.Rmd-->
</div>
</div>
<div id="part-course-notes" class="section level1 unnumbered">
<h1>(PART) Course Notes</h1>
</div>
<div id="introduction" class="section level1">
<h1><span class="header-section-number">3</span> Introduction</h1>
<div id="the-motivation" class="section level2">
<h2><span class="header-section-number">3.1</span> The Motivation</h2>
<p><strong>Here’s the dream:</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="cf">if</span> (knitr<span class="op">:::</span><span class="kw">is_latex_output</span>()) {
  knitr<span class="op">::</span><span class="kw">asis_output</span>(<span class="st">&#39;</span><span class="ch">\\</span><span class="st">url{....}&#39;</span>)
} <span class="cf">else</span> {
  knitr<span class="op">::</span><span class="kw">include_graphics</span>(<span class="st">&quot;img/tony_stark.gif&quot;</span>)
}

<span class="co">#knitr::include_graphics(path = &quot;img/tony_stark.gif&quot;)</span></code></pre></div>
<p><img src="img/tony_stark.gif" width="70%" style="display: block; margin: auto;" /></p>
<blockquote>
<p>Computers have revolutionized research, and that revolution is only beginning. Every day, social scientists and humanists all over the world use them to study things that are too big, too small, too fast, too slow, too expensive, too dangerous, or just too hard to study any other way.</p>
</blockquote>
<p><strong>Now here’s the reality</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#knitr::include_graphics(path = &quot;img/mulder.gif&quot;)</span></code></pre></div>
<blockquote>
<p>Every day, scholars all over the world waste time wrestling with computers. Tasks that should take a few moments take hours or days, and many things never work at all. When scholars try to get help, they are inundated with unhelpful information, and give up.</p>
</blockquote>
<p>This sorry state of affairs persists for three reasons:</p>
<ol style="list-style-type: decimal">
<li><p><strong>No room, no time.</strong> Everybody’s schedule is full —- there’s simply not space to add more about computing without dropping something else.</p></li>
<li><p><strong>The blind leading the blind.</strong> The infrastructure doesn’t exist to help scholars develop the skills they need. Senior researchers can’t teach the next generation how to do things that they don’t know how to do themselves.</p></li>
<li><p><strong>Autodidact Chauvinism.</strong> Since there are no classrooms, scholars are pressured to teach themselves. But self-learning is time consuming and nearly impossible without a base level of knowledge.</p></li>
</ol>
<p>Despite these challenges, there are great reasons to learn how to program:</p>
<p><strong>1. Practical Efficiency</strong></p>
<p>Even though it takes some time at first, learning how to program can save you an enormous amount of time doing basic tasks that you would otherwise do by hand, once you get the hang of it.</p>
<p><strong>2. New Tools</strong></p>
<p>Some things are impossible, or nearly impossible to do by hand. Computers open the door for new tools and methods, but many require programming skills.</p>
<p><strong>3. New Data</strong></p>
<p>The Internet is a wealth of data, waiting to be analyzed! Whether its collecting Twitter data, working with the Congress API, or scraping websites, programming knowledge is a must.</p>
<p><strong>4. Better Scholarship</strong></p>
<p>(Quality) programming can open the door to better transparency, reproducibility, and collaboration in the Social Sciences and the Humanities.</p>
<div id="goal-of-the-class-learn-to-learn" class="section level4 unnumbered">
<h4>Goal of the Class: Learn to Learn</h4>
<blockquote>
<p>The basic learning objective of this course is to leave here with the knowledge and skills required to learn on your own, whether that’s through programming documentation, StackExchange and other online fora, courses or D-Lab workshops.</p>
</blockquote>
<p>By the end of the course, students should be able to:</p>
<ul>
<li>Understand basic programming terminologies, structures, and conventions.</li>
<li>Write, execute, and debug R code.</li>
<li>Produce reproducible analyses using R Markdown.</li>
<li>Clean, transform, and wrangle data using the <code>tidyverse</code> packages.</li>
<li>Scrape data from websites and APIs.</li>
<li>Parse and analyze text documents.</li>
<li>Be familiar with the concepts and tools of a variety of computational social science applications.</li>
<li>Master basic Git and GitHub workflows</li>
<li><strong>Learn independently and train themselves in a variety of computational applications and tasks through online documentation.</strong></li>
</ul>
<p>This Course will not…</p>
<ul>
<li>teach you to be a professional programmer or software developer</li>
<li>teach you statistics, computer science, or specialized social science / digital humanities methods</li>
</ul>
</div>
<div id="why-not-just-take-a-computer-science-course" class="section level4 unnumbered">
<h4>Why not just take a Computer Science course?</h4>
<p>Computer science courses don’t anticipate the types of questions social scientists might ask, and therefore they - introduce many unnecessary concepts - do a poor job of explaining how computer programming tools might be used by social scientists - are too resource intensive for the average social scientist</p>
<p>Programming is not just use useful for computer scientists, methodologists, or people who work with “big data.”</p>
</div>
<div id="a-practical-example" class="section level4 unnumbered">
<h4>A Practical example</h4>
<p>To illustrate, here’s a practical example that comes out of my own research:</p>
</div>
<div id="task-1-by-hand" class="section level4 unnumbered">
<h4>Task 1 (by hand)</h4>
<p><strong>Topic</strong>: International Human Rights “Naming and Shaming”</p>
<p><strong>Question</strong>: Who Shames Whom on What?</p>
<p><strong>Data</strong>: UN Human Rights Committee’s Universal Periodic Review</p>
<p>From Antigua &amp; Barbuda 2011 review:</p>
<p><img src="img/upr-text.png" width="70%" style="display: block; margin: auto;" /></p>
<p><strong>The Task</strong>: Parse a bunch of reports (PDFs) into a dataset (CSV). Add metadata for issue, action, sentiment.</p>
<p><img src="img/upr-table.png" width="70%" style="display: block; margin: auto;" /></p>
<p>How much time will it take?</p>
<p><strong>By hand</strong>: 40,000 recommendations x 3 min per recommendation x 8-hour days x 5-day weeks = <strong>12 months</strong></p>
</div>
<div id="task-2-by-hand" class="section level4 unnumbered">
<h4>Task 2 (by hand)</h4>
<p>What if we wanted to extend this research?</p>
<p><strong>Question</strong>: How does UPR shaming compare to actual human rights abuses?</p>
<p><strong>Data</strong>: Amnesty International’s Urgent Actions</p>
<p><strong>Task</strong>: Collect all of Amnesty International’s Urgent Actions, add metadata for issue, country.</p>
<p><img src="img/amnesty.png" width="70%" style="display: block; margin: auto;" /></p>
<p>How much time will it take?</p>
<p><strong>By hand</strong>: 25,000 recommendations x 3 min per recommendation x 8-hour days x 5-day weeks <strong>= 7.5 months</strong></p>
</div>
<div id="tasks-1-2-with-a-computer" class="section level4 unnumbered">
<h4>Tasks 1 &amp; 2 (with a computer)</h4>
<p>With a computer, we can write a program that:</p>
<ol style="list-style-type: decimal">
<li>Parses recommendations into a CSV.</li>
<li>Codes recommendations by issue, action, sentiment using computational text analysis tools.</li>
<li>Uses webscraping to collect all of Amnesty International’s urgent actions.</li>
<li>Run simple regression models with R to correlate Amnesty reports with UPR shaming.</li>
</ol>
<p>Total time: 2 months</p>
<p><strong>Time Saved: 1.5 years</strong></p>
</div>
</div>
<div id="about-this-class" class="section level2">
<h2><span class="header-section-number">3.2</span> About This Class</h2>
<div id="about-me" class="section level4 unnumbered">
<h4>About Me</h4>
<p>My name is Rochelle Terman and I’m a faculty member in Political Science.</p>
<ul>
<li>A few years ago, I didn’t know how to program. Now I program almost every day.</li>
<li>I program mostly in Python and R. I have a special interest in text analysis and webscraping.</li>
<li>My substantive research is on international norms and human rights.</li>
<li>I won’t be able to answer all your questions.</li>
<li>No one will.</li>
<li>But especially me.</li>
</ul>
</div>
<div id="course-structure-1" class="section level4 unnumbered">
<h4>Course Structure</h4>
<p>The course is divided into two main sections:</p>
<p><strong>1. Skills</strong></p>
<p>Basic computer literacy, terminologies, and programming languages:</p>
<ul>
<li>Base R: objects and data structures.</li>
<li><code>tidyverse</code> for data analysis.</li>
<li>Modeling and visualization.</li>
<li>Key programming concepts (iteration, functions, conditional flow, etc).</li>
</ul>
<p>We’re using <code>R</code> because it’s the common programming language among Political Scientists. But if you understand the <em>concepts</em>, you should able to pick up Python and other languages pretty easily.</p>
<p><strong>2. Applications</strong></p>
<p>Use the skills they learned in part 1 towards practical applications:</p>
<ul>
<li>Webscraping.</li>
<li>APIs.</li>
<li>Computational Text Analysis.</li>
<li>Version control and communication.</li>
</ul>
<p>The goal is to <strong>introduce</strong> the students to a medley of common applications so that they can discover which avenue to pursue in their own research, and what such training would entail.</p>
</div>
<div id="class-activities" class="section level4 unnumbered">
<h4>Class Activities</h4>
<p>Classes will follow a “workshop” style, combining lecture, demonstration, and coding exercises. We envision the class to be as interactive / hands on as possible, with students programming every session. <strong>You must bring a laptop to class.</strong></p>
<p>It is important that students <strong>complete the requisite reading</strong> before class. I anticipate spending 1/2 the class lecturing, and 1/2 practicing with code challenges.</p>
</div>
<div id="course-websites" class="section level4 unnumbered">
<h4>Course Websites</h4>
<p>Class notes and other materials are available here: <a href="https://rochelleterman.github.io/plsc-31101/" class="uri">https://rochelleterman.github.io/plsc-31101/</a></p>
<p>We will also be using Canvas to distribute/accept assignments, and for discussion. Please use the discussion forums liberally.</p>
</div>
<div id="evaluation" class="section level4 unnumbered">
<h4>Evaluation</h4>
<p>This is a graded class based on the following: - Completion of assigned homework (50%) - Participation (25%) - Final project (25%)</p>
<p>If you want to audit, please let me know ASAP.</p>
<p><strong>Assignments</strong></p>
<ul>
<li>In general, assignments are assigned at the end of lecture, and due the following week.</li>
<li>Exceptions will be noted.</li>
<li>The first assignment is due next week, before class on Thursday Oct 10. It is on Canvas.</li>
<li>Turn in assignments on Canvas.</li>
<li>Work in groups, but submit your own.</li>
</ul>
<p><strong>Participation</strong></p>
<p>The class participation portion of the grade can be satisfied in one or more of the following ways:</p>
<ul>
<li>attending the lectures,</li>
<li>asking and answering questions in class,</li>
<li>attending office hours,</li>
<li>contributing to class discussion through the Canvas site,</li>
<li>collaborating with the computing community.</li>
</ul>
<p><strong>Final Project</strong></p>
<p>Students have two options for class projects:</p>
<ol style="list-style-type: decimal">
<li><p><em>Data project</em>: Using the tools we learned in class on your own data of interest.</p></li>
<li><p><em>Tutorial project</em>: Create a tutorial on a tool we didn’t cover in class.</p></li>
</ol>
<p>Both options require an R markdown file narrating the project.</p>
<p>Students are required to write a short proposal by <strong>November 7</strong> (no more than 2 paragraphs) in order to get approval / feedback from the instructors.</p>
<p>On <strong>December 10</strong> we will have a <strong>lightning talk session</strong> where students can present their projects in a maximum 5 minute talk.</p>
</div>
<div id="software" class="section level4 unnumbered">
<h4>Software</h4>
<ul>
<li>Installation instructions are onthe website.</li>
<li>Get started <strong>EARLY</strong>.</li>
<li>Then go to the Installfest to double check your installation.</li>
<li>If you have computer troubles, post the problem on the discussion forums, with as much detail as possible.</li>
</ul>
</div>
</div>
<div id="learning-how-to-program" class="section level2">
<h2><span class="header-section-number">3.3</span> Learning How to Program</h2>
<p>Before we talk about what it takes to learn how to program, let’s first review what programming is.</p>
<div id="what-is-programming" class="section level4 unnumbered">
<h4>What is Programming?</h4>
<p>A <em>program</em> is a sequence of instructions that specifies how to perform a computation. Most programs are written in a human-readable <em>programming language</em> (or “source code”) and then executed with the help of a <em>compiler</em> or <em>interpreter</em>.</p>
<p>A few basic instructions appear in just about every language:</p>
<ol style="list-style-type: decimal">
<li><strong>input</strong>: Get data from the keyboard, a file, the network, or some other device.</li>
<li><strong>output</strong>: Display data on the screen, save it in a file, send it over the network, etc.</li>
<li><strong>math</strong>: Perform basic mathematical operations like addition and multiplication.</li>
<li><strong>conditional execution</strong>: Only perform tasks if certain conditions are met.</li>
<li><strong>iteration</strong>: Do the same task over and over again on different inputs.</li>
</ol>
<p>That being said, programming languages differ from one another in the following ways:</p>
<ol style="list-style-type: decimal">
<li><strong>Syntax</strong>: whether to add a semicolon at the end of each line, etc.</li>
<li><strong>Usage</strong>: JavaScript is for building websites, R is for statistics, Python is general purpose, etc.</li>
<li><strong>Level</strong>: how close you are to the hardware. ‘C’ is often considered to be the lowest (or one of the lowest) level languages.</li>
<li><strong>Object-oriented:</strong> “objects” are data + functions. Some programming languages are object-oriented (e.g. Python) and some aren’t (e.g. C).</li>
<li><strong>Many more</strong>: Here’s a <a href="https://en.wikipedia.org/wiki/List_of_programming_languages_by_type">list</a> of all the types of programming languages out there.</li>
</ol>
</div>
<div id="what-language-should-you-learn" class="section level4 unnumbered">
<h4>What Language Should You Learn?</h4>
<p>Most programmers can program in more than one language. That’s because they know <em>how to program</em> generally, as opposed to “knowing” Python, R, Ruby, or whatever.</p>
<p>So what should your first programming language be? That is, what programming language should you use to learn <em>how to program</em>? At the end of the day, the answer depends on what you want to get out of programming. Many people recommend Python because it’s fun, easy, and multi-purpose. Here’s an <a href="http://lifehacker.com/which-programming-language-should-i-learn-first-1477153665">article</a> that can offer more advice.</p>
<p>In this class, we’ll be using R because it’s the most popular language in our disciplnary community (of Political Scientists.)</p>
<p>Regardless of what you choose, you will probably grow comfortable in one language while learning the basic concepts and skills that allow you to ‘hack’ your way into other languages. That’s because <strong>programming is an extendible skill.</strong></p>
<p>Thus “knowing how to program” means learning how to <em>think</em> like a programmer, not necessarily knowing all the language-specific commands off the top of your head. <strong>Don’t learn specific programming languages; learn how to program.</strong></p>
</div>
<div id="what-programming-is-really-like" class="section level4 unnumbered">
<h4>What Programming is Really Like</h4>
<p><img src="img/xkcd.png" width="70%" style="display: block; margin: auto;" /></p>
<p>Here’s the sad reality: When you’re programming, 80% or more of your time will be spent debugging, looking stuff up (like program-specific syntax, documentation for packages, useful functions, etc.), or testing. This does not just apply to beginner or intermediate programmers, although you will grow more “fluent” over time.</p>
<blockquote>
<p>Google software engineers write an average of 10-20 lines of code per day. <strong>The Lesson</strong>: Programming is a slow activity, especially in the beginning.</p>
</blockquote>
<p>If you’re a good programmer, you’re a good detective!</p>
</div>
<div id="how-to-learn" class="section level4 unnumbered">
<h4>How to Learn</h4>
<p>Here are some tips on how to learn computer programming:</p>
<ol style="list-style-type: decimal">
<li><p>Learning to program is 5% intelligence, 95% endurance.</p></li>
<li><p>Like learning to play an instrument or speak a foreign language, it takes practice, practice, practice.</p></li>
<li><p>Program a little bit every day.</p></li>
<li><p>Program with others. Do the problem sets in pairs or groups.</p></li>
<li><p>It’s better to type than to copy and paste.</p></li>
<li><p>Most “programming” is actually researching, experimenting, thinking.</p></li>
<li><p>Stay organized.</p></li>
</ol>
</div>
<div id="the-15-minute-rule" class="section level4 unnumbered">
<h4>The 15 minute rule</h4>
<blockquote class="twitter-tweet">
<p lang="en" dir="ltr">
15 min rule: when stuck, you HAVE to try on your own for 15 min; after 15 min, you HAVE to ask for help.- Brain AMA <a href="https://t.co/MS7FnjXoGH">pic.twitter.com/MS7FnjXoGH</a>
</p>
— Rachel Thomas (<span class="citation">(<span class="citeproc-not-found" data-reference-id="math_rachel"><strong>???</strong></span>)</span>) <a href="https://twitter.com/math_rachel/status/764931533383749632?ref_src=twsrc%5Etfw">August 14, 2016</a>
</blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
<p>We will follow the <strong>15 minute rule</strong> in this class. If you encounter a problem in your assignments, spend 15 minutes troubleshooting the problem on your own. After 15 minutes, if you still cannot solve the problem, <strong>ask for help</strong>.</p>
<p>(Hat tip to <a href="https://cfss.uchicago.edu/faq/asking-questions/">Computing for Social Sciences</a>)</p>
</div>
<div id="debugging" class="section level4 unnumbered">
<h4>Debugging</h4>
<p>Those first 15 minutes should be spent trying to debug your code. Here are some tips:</p>
<ul>
<li>Read the errors!</li>
<li>Read the documentation</li>
<li>Make it smaller</li>
<li>Figure out what changed</li>
<li>Check your syntax</li>
<li>Print statements are your friend</li>
</ul>
</div>
<div id="using-the-internet" class="section level4 unnumbered">
<h4>Using the Internet</h4>
<p>You should also make use of <a href="https://www.google.com">Google</a> and <a href="http://stackoverflow.com/">StackOverflow</a> to resolve the error. Here’s some tips for how to google errors:</p>
<ul>
<li>google: name-of-program + text in error message.</li>
<li>Remove user- and data-specific information first!</li>
<li>See if you can find examples that do and don’t produce the error. Try other people’s code, but don’t fall into the copy-paste trap.</li>
</ul>
</div>
<div id="asking-for-help" class="section level4 unnumbered">
<h4>Asking for Help</h4>
<p>We will use Canvas for class-related questions and discussion. You are highly encouraged to ask questions, and answer one another’s questions.</p>
<ol style="list-style-type: decimal">
<li>Include a brief, informative title.</li>
<li>Explain what you’re trying to do, and how it failed.</li>
<li>Include a reproducible example.</li>
</ol>
<p>Here are some helpful guidelines on how to properly ask programming questions:</p>
<ol style="list-style-type: decimal">
<li><a href="https://www.propublica.org/nerds/how-to-ask-programming-questions">“How to Ask Programming Questions,” ProPublica</a></li>
<li><a href="https://stackoverflow.com/help/how-to-ask">“How do I ask a good question?” StackOverflow</a></li>
<li><a href="https://cfss.uchicago.edu/faq/asking-questions/">“How to properly ask for help” Computing for Social Science</a></li>
</ol>
<!--chapter:end:01_Intro/01-Intro.Rmd-->
</div>
</div>
</div>
<div id="r-basics" class="section level1">
<h1><span class="header-section-number">4</span> R Basics</h1>
<p>This unit introduces you to the R programming language, and the tools we use to program in R. We will explore:</p>
<ol style="list-style-type: decimal">
<li><strong><a href="#what-is-r">What is R?</a></strong>, a brief introduction to the R language;</li>
<li><strong><a href="#r-studio-1">R Studio</a></strong>, a tour of the Interactive Development Environment RStudio;</li>
<li><strong><a href="#r-markdown">R Markdown</a></strong>, a type of R script file we’ll be working with in this class.</li>
<li><strong><a href="#r-packages-1">R Packages</a></strong>, extra tools and functionalities;</li>
</ol>
<div id="what-is-r" class="section level2">
<h2><span class="header-section-number">4.1</span> What is R?</h2>
<p>R is a versatile, open source programming and scripting language that’s useful both for statistics and data science. It’s inspired by the programming language <a href="https://en.wikipedia.org/wiki/S_(programming_language)"><code>S</code></a>. Some of its <strong>best features</strong> are:</p>
<ul>
<li><p>It’s free, open source, and available on every major platform. As a result, if you do your analysis in R, most people can easily replicate it.</p></li>
<li><p>It contains massive set of packages for statistical modelling, machine learning, visualisation, and importing and manipulating data. Over 14,000 packages are available as of August 2019. Whatever model or graphic you’re trying to do, chances are that someone has already tried to do it (and a package for it exists).</p></li>
<li><p>It’s designed for statistics and data analysis, but also general-purpose programming.</p></li>
<li><p>It’s an <a href="http://www.rstudio.com/ide/">Interactive Development Environment</a> tailored to the needs of interactive data analysis and statistical programming.</p></li>
<li><p>It has powerful tools for communicating your results. R packages make it easy to produce html or pdf <a href="http://yihui.name/knitr/">reports</a>, or create <a href="http://www.rstudio.com/shiny/">interactive websites</a>.</p></li>
<li><p>A large and growing community of peers.</p></li>
</ul>
<p>R also has a number of <strong>shortcomings</strong>:</p>
<ul>
<li><p>It has a steeper learning curve than SPSS or Stata.</p></li>
<li><p>R is not a particularly fast programming language, and poorly written R code can be terribly slow. R is also a profligate user of memory.</p></li>
<li><p>Much of the R code you’ll see in the wild is written in haste to solve a pressing problem. As a result, code is not very elegant, fast, or easy to understand. Most users do not revise their code to address these shortcomings.</p></li>
<li><p>Inconsistency is rife across contributed packages, even within base R. You are confronted with over 20 years of evolution every time you use R. Learning R can be tough because there are many special cases to remember.</p></li>
</ul>
<!--chapter:end:02-R-Tools/02-1-R-Basics.Rmd-->
</div>
<div id="r-studio-1" class="section level2">
<h2><span class="header-section-number">4.2</span> R Studio</h2>
<p>We can use R in a number of ways. For example, we can write R code in a plain text editor (like <code>textedit</code> or <code>notepad</code>), and then execute the sript using the shell (e.g. <code>terminal</code> in Mac).</p>
<p>But, this isn’t exactly ideal for several reasons. We can’t easily write and edit scripts as we go, it’s not very pretty, there are no debugging tools, etc. That’s why most people who use R (or Python, etc) use an “integrated development environment” or “interactive development environment” (IDE).</p>
<p>An IDE is a software application that provides comprehensive facilities to computer programmers for software development. An IDE normally consists of a source code editor, build automation tools and a debugger. Some of them come with package managers and other features, too.</p>
<p>The most popular IDE for R is <a href="https://www.rstudio.com/products/rstudio/">RStudio</a>. It includes a console, syntax-highlighting editor that supports direct code execution, as well as tools for plotting, history, debugging and workspace management. It’s also free and open-source. Yay!</p>
<div id="console" class="section level3">
<h3><span class="header-section-number">4.2.1</span> Console</h3>
<p>There are two main ways of interacting with R: using the <strong>console</strong> or by using the <strong>script editor</strong>.</p>
<p>The console window (in RStudio, the bottom left panel) is the place where R is waiting for you to tell it what to do, and where it will show the results of a command.</p>
<p>You can type commands directly into the console, but they will be forgotten when you close the session. Try it out now.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="op">&gt;</span><span class="st"> </span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span><span class="dv">2</span></code></pre></div>
<p>If R is ready to accept commands, the R console shows a <code>&gt;</code> prompt. If it receives a command (by typing, copy-pasting or sent from the script editor using <code>Ctrl-Enter</code>), R will try to execute it, and when ready, show the results and come back with a new <code>&gt;</code>-prompt to wait for new commands.</p>
<p>If R is still waiting for you to enter more data because it isn’t complete yet, the console will show a <code>+</code> prompt. It means that you haven’t finished entering a complete command. This happens when you have not ‘closed’ a parenthesis or quotation. If you’re in RStudio and this happens, click inside the console window and press <code>Esc</code>; this should help get you out of trouble.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="op">&gt;</span><span class="st"> &quot;This is an incomplete quote</span>
<span class="st">+</span></code></pre></div>
<div id="more-console-features" class="section level4 unnumbered">
<h4>More Console Features</h4>
<ol style="list-style-type: decimal">
<li><p>Retrieving previous commands: As you work with R you’ll often want to re-execute a command which you previously entered. Recall previous commands using the up and down arrow keys.</p></li>
<li><p>Console title bar: This screenshot illustrates a few additional capabilities provided by the Console title bar:</p>
<ul>
<li>Display of the current working directory.</li>
<li>The ability to interrupt R during a long computation.</li>
<li>Minimizing and maximizing the Console in relation to the Source pane (using the buttons at the top-right or by double-clicking the title bar).</li>
</ul></li>
</ol>
<p><img src="img/using_console_title_bar.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="scripts" class="section level3">
<h3><span class="header-section-number">4.2.2</span> Scripts</h3>
<p>It’s better practice to enter commands in the script editor, and save the script. This way, you have a complete record of what you did, you can easily show others how you did it and you can do it again later on if needed. Open it up either by clicking the <em>File</em> menu, and selecting <em>New File</em>, then R script, or using the keyboard shortcut Cmd/Ctrl + Shift + N. Now you’ll see four panes.</p>
<p><img src="img/4-panes.png" width="70%" style="display: block; margin: auto;" /></p>
<p>The script editor is a great place to put code you care about. Keep experimenting in the console, but once you have written code that works and does what you want, put it in the script editor.</p>
<p>RStudio will automatically save the contents of the editor when you quit RStudio, and will automatically load it when you re-open. Nevertheless, it’s a good idea to save your scripts regularly and to back them up.</p>
</div>
<div id="running-code" class="section level3">
<h3><span class="header-section-number">4.2.3</span> Running code</h3>
<p>While you certainly can copy-paste code you’d like to run from the editor into the console, this workflow is pretty inefficient. The key to using the script editor effectively is to memorize one of the most important keyboard shortcuts in RStudio: <strong><code>Cmd/Ctrl + Enter</code></strong>. This executes the current R expression from the script editor in the console.</p>
<p>For example, take the code below. If your cursor is somewhere on the first line, pressing <code>Cmd/Ctrl + Enter</code> will run the complete command that generates <code>dems</code>. It will also move the cursor to the next statement (beginning with <code>reps</code>). That makes it easy to run your complete script by repeatedly pressing <code>Cmd/Ctrl + Enter</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dems &lt;-<span class="st"> </span>(<span class="dv">55</span> <span class="op">+</span><span class="st"> </span><span class="dv">70</span>) <span class="op">*</span><span class="st"> </span><span class="fl">1.3</span>

reps &lt;-<span class="st"> </span>(<span class="dv">20</span> <span class="op">-</span><span class="st"> </span><span class="dv">1</span>) <span class="op">/</span><span class="st"> </span><span class="dv">2</span></code></pre></div>
<p>Instead of running expression-by-expression, you can also execute the complete script in one step: <code>Cmd/Ctrl + Shift + S</code>. Doing this regularly is a great way to check that you’ve captured all the important parts of your code in the script.</p>
</div>
<div id="comments" class="section level3">
<h3><span class="header-section-number">4.2.4</span> Comments</h3>
<p>Use <code>#</code> signs to add comments within your code chunks, and you are encouraged to regularly comment within your code. Anything to the right of a <code>#</code> is ignored by R. Each line of a comment needs to begin with a #.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># This is a comment.</span>
<span class="co"># This is another line of comments.</span></code></pre></div>
</div>
<div id="diagnostics-and-errors" class="section level3">
<h3><span class="header-section-number">4.2.5</span> Diagnostics and errors</h3>
<p>The script editor will also highlight syntax errors with a red squiggly line and a cross in the sidebar:</p>
<p><img src="img/rstudio-diagnostic.png" width="70%" style="display: block; margin: auto;" /></p>
<p>You can hover over the cross to see what the problem is:</p>
<p><img src="img/rstudio-diagnostic-tip.png" width="70%" style="display: block; margin: auto;" /></p>
<p>If you try to execute the code, you’ll see an error in the console.</p>
<p><img src="img/error.png" width="70%" style="display: block; margin: auto;" /></p>
<p>When errors happen, your code is haulted – meaning it’s never executed. Errors can be frustrating in R, but with practice you’ll be able to debug your code quickly.</p>
</div>
<div id="r-environment" class="section level3">
<h3><span class="header-section-number">4.2.6</span> R Environment</h3>
<p>Turn your attention to the upper right pane. This pane displays your “global environment”, and it contains the data objects you have saved in your current session. Notice that we have the two objects created earlier, <code>dems</code>, and <code>reps</code>, along with their values.</p>
<p>You can list all objects in your current environment by running:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ls</span>()
<span class="co">#&gt; [1] &quot;dems&quot; &quot;reps&quot;</span></code></pre></div>
<p>Sometimes we want to remove objects that we no longer need.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="dv">5</span>
<span class="kw">rm</span>(x)</code></pre></div>
<p>If you want to remove all objects from your current environment, you can run:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">rm</span>(<span class="dt">list =</span> <span class="kw">ls</span>())</code></pre></div>
<div id="acknowledgments" class="section level4 unnumbered">
<h4>Acknowledgments</h4>
<p>This page is in part derived from the following sources:</p>
<ol style="list-style-type: decimal">
<li><p><a href="https://support.rstudio.com/hc/en-us/articles/200484448">R Studio Support</a>.</p></li>
<li><p><a href="https://adv-r.hadley.nz/">Advanced R</a>, licensed under the <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International Public License</a></p></li>
<li><p><a href="https://r4ds.had.co.nz">R for Data Science</a> licensed under <a href="https://creativecommons.org/licenses/by-nc-nd/3.0/us/">Creative Commons Attribution-NonCommercial-NoDerivs 3.0</a></p></li>
</ol>
<!--chapter:end:02-R-Tools/02-2-R-Studio.Rmd-->
</div>
</div>
</div>
<div id="r-markdown" class="section level2">
<h2><span class="header-section-number">4.3</span> R Markdown</h2>
<p>Throughout this course, we’ll be using <a href="http://rmarkdown.rstudio.com%3E">R Markdown</a> for lecture notes and homework assignments. R Markdown documents combine executable code, results, and prose commentary into one document. Think of an R Markdown files as a modern day lab notebook, where you can capture not only what you did, but also what you were thinking.</p>
<p>The filename of an R Markdown document should end in <code>.Rmd</code> or <code>.rmd</code>. They can also be converted to an output format, like PDF, HTML, slideshows, Word files, and more.</p>
<p>R Markdown documents contain three important types of content:</p>
<ol style="list-style-type: decimal">
<li>An (optional) YAML header surrounded by <code>---</code>s.</li>
<li>Chunks of R code surrounded by <code>```</code>.</li>
<li>Text mixed with simple text formatting like <code># heading</code> and <code>_italics_</code>.</li>
</ol>
<div id="yaml-header" class="section level3">
<h3><span class="header-section-number">4.3.1</span> YAML header</h3>
<p>YAML stands for “yet another markup language”. R Markdown uses it to control many details of the output.</p>
<div class="sourceCode"><pre class="sourceCode md"><code class="sourceCode markdown">---
title: &quot;Homework 1&quot;
author: &quot;Rochelle Terman&quot;
date: &quot;Fall 2019&quot;
output: html_document
---</code></pre></div>
<p>In this example, we specified the document’s title, author, and date; we also specified that we want it to eventually convert it into an HTML document.</p>
</div>
<div id="markdown" class="section level3">
<h3><span class="header-section-number">4.3.2</span> Markdown</h3>
<p>Prose in <code>.Rmd</code> files is written in Markdown, a lightweight set of conventions for formatting plain text files. Markdown is designed to be easy to read and easy to write. It is also very easy to learn. The guide below shows how to use Pandoc’s Markdown, a slightly extended version of Markdown that R Markdown understands.</p>
<div class="sourceCode"><pre class="sourceCode md"><code class="sourceCode markdown">Text formatting 
------------------------------------------------------------

*italic*  or _italic_
**bold**   __bold__
<span class="bn">`code`</span>
superscript^2^ and subscript~2~

Headings
------------------------------------------------------------

<span class="fu"># 1st Level Header</span>

<span class="fu">## 2nd Level Header</span>

<span class="fu">### 3rd Level Header</span>

Lists
------------------------------------------------------------

* <span class="fl">  Bulleted list item 1</span>

* <span class="fl">  Item 2</span>

<span class="bn">    * Item 2a</span>

<span class="bn">    * Item 2b</span>

1. <span class="fl"> Numbered list item 1</span>

1. <span class="fl"> Item 2. The numbers are incremented automatically in the output.</span>

Links and images
------------------------------------------------------------

<span class="ot">&lt;http://example.com&gt;</span>

<span class="ot">[linked phrase](http://example.com)</span>

<span class="al">![optional caption text](path/to/img.png)</span>

Tables 
------------------------------------------------------------

First Header  | Second Header
------------- | -------------
Content Cell  | Content Cell
Content Cell  | Content Cell</code></pre></div>
<p>The best way to learn these is simply to try them out. It will take a few days, but soon they will become second nature, and you won’t need to think about them. If you forget, you can get to a handy reference sheet with Help &gt; Markdown Quick Reference.</p>
</div>
<div id="code-chunks" class="section level3">
<h3><span class="header-section-number">4.3.3</span> Code Chunks</h3>
<p>To run code inside an R Markdown document, you do it inside a “chunk”. Think of a chunk like a function. A chunk should be relatively self-contained, and focused around a single task.</p>
<p>Chunks begin with a header which consists of <code>```{r,</code> followed by an optional chunk name, followed by comma separated options, followed by <code>}</code>. Next comes your R code and the chunk end is indicated by a final <code>```.</code></p>
<p>You can continue to run the code using the keyboard shortcut that we learned earlier: <code>Cmd/Ctrl + Enter</code>. You can also run the entire chunk by clicking the Run icon (it looks like a play button at the top of the chunk), or by pressing <code>Cmd/Ctrl + Shift + Enter</code>.</p>
<p>RStudio executes the code and displays the results inline with the code:</p>
<div class="figure">
<img src="img/r-markdown.png" />

</div>
</div>
<div id="knitting" class="section level3">
<h3><span class="header-section-number">4.3.4</span> Knitting</h3>
<p>To produce a complete report containing all text, code, and results, click the “Knit” button at the top of the script editor (looks like a ball of yarn) or press <code>Cmd/Ctrl + Shift + K</code>. This will display the report in the viewer pane, and create a self-contained HTML file that you can share with others. The <code>.html</code> file is written in the same directory as your <code>.Rmd</code> file.</p>
</div>
<div id="cheatsheets-and-other-resources" class="section level3">
<h3><span class="header-section-number">4.3.5</span> Cheatsheets and Other Resources</h3>
<p>When working in RStudio, you can find an R Markdown cheatsheet by going to Help &gt; Cheatsheets &gt; R Markdown Cheat Sheet.</p>
<p>A helpful overview of R Markdown can also be found in <a href="https://r4ds.had.co.nz/r-markdown.html">R for Data Science</a></p>
<p>A deep dive into R Markdown can be found <a href="https://bookdown.org/yihui/rmarkdown/">here</a></p>
</div>
<div id="challenges" class="section level3">
<h3><span class="header-section-number">4.3.6</span> Challenges</h3>
<div id="challenge-1.-create-a-new-r-markdown-document-with-file-new-file-r-markdown-read-the-instructions.-practice-running-the-chunks.-verify-that-you-can-modify-the-code-re-run-it-and-see-modified-output." class="section level4 unnumbered">
<h4>Challenge 1. Create a new R Markdown document with <em>File &gt; New File &gt; R Markdown…</em> Read the instructions. Practice running the chunks. Verify that you can modify the code, re-run it, and see modified output.</h4>
</div>
<div id="challenge-2.-knit-the-document-into-an-html-file.-verify-that-you-can-modify-the-input-and-see-the-output-update." class="section level4 unnumbered">
<h4>Challenge 2. Knit the document into an html file. Verify that you can modify the input and see the output update.</h4>
</div>
<div id="acknowledgments-1" class="section level4 unnumbered">
<h4>Acknowledgments</h4>
<p>This page is in part derived from the following sources:</p>
<ol style="list-style-type: decimal">
<li><a href="https://r4ds.had.co.nz">R for Data Science</a> licensed under <a href="https://creativecommons.org/licenses/by-nc-nd/3.0/us/">Creative Commons Attribution-NonCommercial-NoDerivs 3.0</a></li>
</ol>
<!--chapter:end:02-R-Tools/02-3_R-Markdown.Rmd-->
</div>
</div>
</div>
<div id="r-packages-1" class="section level2">
<h2><span class="header-section-number">4.4</span> R Packages</h2>
<p>The best part about R are its user-contributed packages (also called “libraries”). A <em>library</em> is a collection of functions (and sometimes data) that can be used by other programers. A library’s contents are supposed to be related, but this isn’t always the case as there is no enforcement on the issue.</p>
<div id="installing-packages" class="section level3">
<h3><span class="header-section-number">4.4.1</span> Installing Packages</h3>
<p>Using packages requires two steps.</p>
<p>First, we download the package from one of the CRAN mirrors onto our computer. For this we use <code>install.packages(&quot;package-name&quot;)</code>. If you have not set a preferred CRAN mirror in your <code>options()</code>, a menu will pop up asking you to choose a location.</p>
<p>Let’s download the package <code>dplyr</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install.packages</span>(<span class="st">&quot;dplyr&quot;</span>)</code></pre></div>
<p>If you run into errors later in the course about a function or package not being found, run the <code>install.packages</code> function to make sure the package is actually installed.</p>
<p><strong>Important</strong>: Once we download the package, we never need to run <code>install.packages</code> again (unless we get a new computer.)</p>
</div>
<div id="loading-packages" class="section level3">
<h3><span class="header-section-number">4.4.2</span> Loading Packages</h3>
<p>Once we download the package, we need to load it into our session to use it. This is required at the beginning of each R session. This step is necessary because if we automatically loaded every package we have ever downloaded, our computer would fry.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(dplyr)</code></pre></div>
<p>The message tells you which functions from dplyr conflict with functions in base R (or from other packages you might have loaded).</p>
</div>
<div id="challenges-1" class="section level3">
<h3><span class="header-section-number">4.4.3</span> Challenges</h3>
<p>Let’s go ahead and download some core, important packages we’ll use for the rest of the course. Download and load the following packages:</p>
<ul>
<li>tidyverse</li>
<li>rmarkdown</li>
<li>knitr</li>
<li>gapminder</li>
<li>devtools</li>
</ul>
<div id="acknowledgments-2" class="section level4 unnumbered">
<h4>Acknowledgments</h4>
<p>This page is in part derived from the following sources:</p>
<ol style="list-style-type: decimal">
<li><p><a href="https://support.rstudio.com/hc/en-us/articles/200484448">R Studio Support</a>.</p></li>
<li><p><a href="https://adv-r.hadley.nz/">Advanced R</a>, licensed under the <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International Public License</a></p></li>
<li><p><a href="https://r4ds.had.co.nz">R for Data Science</a> licensed under <a href="https://creativecommons.org/licenses/by-nc-nd/3.0/us/">Creative Commons Attribution-NonCommercial-NoDerivs 3.0</a></p></li>
</ol>
<!--chapter:end:02-R-Tools/02-4_R-Packages.Rmd-->
</div>
</div>
</div>
</div>
<div id="r-syntax" class="section level1">
<h1><span class="header-section-number">5</span> R Syntax</h1>
<p>Frustration is natural when you start programming in R. R is a stickler for punctuation, and even one character out of place will cause it to complain. But while you should expect to be a little frustrated, take comfort in that it’s both typical and temporary: it happens to everyone, and the only way to get over it is to keep trying.</p>
<blockquote>
<p>To understand computations in R, two slogans are helpful: - Everything that exists is an object. - Everything that happens is a function call.</p>
</blockquote>
<blockquote>
<p><strong>John Chambers</strong></p>
</blockquote>
<div id="variables" class="section level2">
<h2><span class="header-section-number">5.1</span> Variables</h2>
<div id="arithmetic" class="section level3">
<h3><span class="header-section-number">5.1.1</span> Arithmetic</h3>
<p>In its most basic form, R can be used as a simple calculator. Consider the following arithmetic operators:</p>
<ul>
<li>Addition: <code>+</code></li>
<li>Subtraction: <code>-</code></li>
<li>Multiplication: <code>*</code></li>
<li>Division: <code>/</code></li>
<li>Exponentiation: <code>^</code></li>
<li>Modulo (remainder): <code>%%</code></li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="dv">1</span> <span class="op">/</span><span class="st"> </span><span class="dv">200</span> <span class="op">*</span><span class="st"> </span><span class="dv">30</span>
<span class="co">#&gt; [1] 0.15</span>
(<span class="dv">59</span> <span class="op">+</span><span class="st"> </span><span class="dv">73</span> <span class="op">+</span><span class="st"> </span><span class="dv">2</span>) <span class="op">/</span><span class="st"> </span><span class="dv">3</span>
<span class="co">#&gt; [1] 44.7</span>
<span class="dv">5</span> <span class="op">%%</span><span class="st"> </span><span class="dv">2</span>
<span class="co">#&gt; [1] 1</span></code></pre></div>
<p>But when we do this, none of our results are saved for later use.</p>
</div>
<div id="assigning-variables" class="section level3">
<h3><span class="header-section-number">5.1.2</span> Assigning Variables</h3>
<p>An essential part of programming is creating objects (or variables)<a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a> Variables are names for values.</p>
<p>A variable is created when a value is assigned to it. We do that with <code>&lt;-</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="dv">3</span></code></pre></div>
<p><code>&lt;-</code> is the called the <em>assignment operator.</em> It assigns values on the right to objects on the left, like this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">object_name &lt;-<span class="st"> </span>value</code></pre></div>
<p>So, after executing <code>x &lt;- 3</code>, the value of <code>x</code> is <code>3</code>. The arrow can be read as 3 goes into <code>x</code>.</p>
<p><em>Note:</em> Don’t use <code>=</code> for assignments. It will work in some contexts, but will cause confusion later.</p>
<p>We can use variables in calculations just as if they were values.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="dv">3</span>
x <span class="op">+</span><span class="st"> </span><span class="dv">5</span>
<span class="co">#&gt; [1] 8</span></code></pre></div>
<div id="inspect-objects-to-display-values." class="section level4 unnumbered">
<h4>Inspect objects to display values.</h4>
<p>In R, the contents of an object can be printed by simply executing the object name.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="dv">3</span>
x
<span class="co">#&gt; [1] 3</span></code></pre></div>
</div>
<div id="whitespace-makes-code-easier-to-read." class="section level4 unnumbered">
<h4>Whitespace makes code easier to read.</h4>
<p>Notice that we surrounded <code>&lt;-</code> with spaces. In <code>R</code>, white space is ignored (unlike Python). It is good practice to use spaces, because it makes code easier to read.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">experiment&lt;-<span class="st">&quot;current vs. voltage&quot;</span>   <span class="co"># this is bad</span>
experiment &lt;-<span class="st"> &quot;current vs. voltage&quot;</span> <span class="co"># this is better</span></code></pre></div>
</div>
</div>
<div id="variable-names" class="section level3">
<h3><span class="header-section-number">5.1.3</span> Variable Names</h3>
<p>Object names can only contain letters, numbers, <code>_</code> and <code>.</code>.</p>
<p>You want your object names to be descriptive. <code>x</code> is not a good variable name (sorry!). You’ll also need a convention for multiple words. I recommend <em>snake_case</em> where you separate lowercase words with <code>_</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">i_use_snake_case
otherPeopleUseCamelCase
some.people.use.periods
And_aFew.People_RENOUNCEconvention</code></pre></div>
<p>Let’s make an assignment using snake_case:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">r_rocks &lt;-<span class="st"> </span><span class="dv">2</span> <span class="op">^</span><span class="st"> </span><span class="dv">3</span></code></pre></div>
<p>And let’s try to inspect it:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">r_rock
<span class="co">#&gt; Error in eval(expr, envir, enclos): object &#39;r_rock&#39; not found</span>
R_rocks
<span class="co">#&gt; Error in eval(expr, envir, enclos): object &#39;R_rocks&#39; not found</span></code></pre></div>
<p>R is case-sensitive!</p>
<div id="use-the-tab-key-to-autocomplete." class="section level4 unnumbered">
<h4>Use the TAB key to autocomplete.</h4>
<p>Because typos are the absolute worst, we can use R Studio to help us type. Let’s inspect <code>r_rocks</code> using RStudio’s tab completion facility. Type “r_”, press TAB, add characters until you have a unique prefix, then press return.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">r_rocks
<span class="co">#&gt; [1] 8</span></code></pre></div>
</div>
</div>
<div id="challenges-2" class="section level3">
<h3><span class="header-section-number">5.1.4</span> Challenges</h3>
<div id="challenge-1-making-and-printing-variables." class="section level4 unnumbered">
<h4>Challenge 1: Making and Printing Variables.</h4>
<p>Make 3 variables: name (with your full name), city (where you were born) and year (when you were born.)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">name &lt;-<span class="st"> &quot;Pete&quot;</span>
city &lt;-<span class="st"> &quot;Syracuse&quot;</span>
year &lt;-<span class="st"> &quot;1992&quot;</span></code></pre></div>
</div>
<div id="challenge-2-swapping-values" class="section level4 unnumbered">
<h4>Challenge 2: Swapping Values</h4>
<p>Draw a table showing the values of the variables in this program after each statement is executed.</p>
<p>In simple terms, what do the last three lines of this program do?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">lowest =<span class="st"> </span><span class="fl">1.0</span>
highest =<span class="st"> </span><span class="fl">3.0</span>
temp =<span class="st"> </span>lowest
lowest =<span class="st"> </span>highest
highest =<span class="st"> </span>temp</code></pre></div>
<p>The last three lines set temp equal to the value of lowest (1.0), set lowest equal to the value of highest (3.0), and set highest equal to temp (1.0).</p>
</div>
<div id="challenge-3-predicting-values" class="section level4 unnumbered">
<h4>Challenge 3: Predicting Values</h4>
<p>What is the final value of <code>position</code> in the program below? Try to predict the value without running the program, then check your prediction.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">initial =<span class="st"> &quot;left&quot;</span>
position =<span class="st"> </span>initial
initial =<span class="st"> &quot;right&quot;</span></code></pre></div>
</div>
<div id="challenge-4-syntax" class="section level4 unnumbered">
<h4>Challenge 4: Syntax</h4>
<p>Why does the following code fail?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">age <span class="op">==</span><span class="st"> </span><span class="dv">31</span></code></pre></div>
<p>The object <code>age</code> has not been created yet.</p>
<p>and the following?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="dv">31</span> &lt;-<span class="st">  </span>age</code></pre></div>
<p>Object names cannot start with a number and “age” would have to be in quotations. In general, you would probably want to assign the number 31 to the object <code>age</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">age &lt;-<span class="st"> </span><span class="dv">31</span></code></pre></div>
<!--chapter:end:03-R-Syntax/03-1_R-Variables.Rmd-->
</div>
</div>
</div>
<div id="functions" class="section level2">
<h2><span class="header-section-number">5.2</span> Functions</h2>
<p>R has a large collection of built-in functions that helps us do things. When we use a function, we say we’re <em>calling</em> a function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">function_name</span>(<span class="dt">arg1 =</span> val1, <span class="dt">arg2 =</span> val2, ...)</code></pre></div>
<p>Here are some helpful built-in functions:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_var &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">5</span>)

<span class="kw">sum</span>(my_var)
<span class="co">#&gt; [1] 17</span>
<span class="kw">length</span>(my_var)
<span class="co">#&gt; [1] 5</span>
<span class="kw">min</span>(my_var)
<span class="co">#&gt; [1] 1</span>
<span class="kw">max</span>(my_var)
<span class="co">#&gt; [1] 5</span>
<span class="kw">unique</span>(my_var)
<span class="co">#&gt; [1] 1 5 2 4</span></code></pre></div>
<div id="arguments" class="section level3">
<h3><span class="header-section-number">5.2.1</span> Arguments</h3>
<p>An <em>argument</em> is a value that is <em>passed</em> into a function. Every function returns a <strong>result</strong>.</p>
<p>Let’s try using <code>seq()</code>, which makes regular sequences of numbers. While we’re at it, we’ll learn more helpful features of RStudio.</p>
<p>Type <code>se</code> and hit TAB. A popup shows you possible completions. Specify <code>seq()</code> by typing more (a “q”) to disambiguate, or by using ↑/↓ arrows to select. Notice the floating tooltip that pops up, reminding you of the function’s arguments and purpose.</p>
<p>Press TAB once more when you’ve selected the function you want. RStudio will add matching opening (<code>(</code>) and closing (<code>)</code>) parentheses for you. Type the arguments <code>1, 10</code> and hit return.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">seq</span>(<span class="dv">1</span>, <span class="dv">10</span>)
<span class="co">#&gt;  [1]  1  2  3  4  5  6  7  8  9 10</span></code></pre></div>
<p>How many arguments did we pass into the <code>seq</code> function?</p>
</div>
<div id="store-function-output" class="section level3">
<h3><span class="header-section-number">5.2.2</span> Store Function Output</h3>
<p>Notice, when we called the <code>seq</code> function, nothing changed in our environment. That’s because we didn’t save our results to an object. Let’s try it again by assigning a variable.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">y &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">1</span>, <span class="dv">10</span>)
y
<span class="co">#&gt;  [1]  1  2  3  4  5  6  7  8  9 10</span></code></pre></div>
</div>
<div id="argument-restrictions-and-defaults" class="section level3">
<h3><span class="header-section-number">5.2.3</span> Argument Restrictions and Defaults</h3>
<p>Let’s use another function, called <code>round</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">round</span>(<span class="fl">60.123</span>)
<span class="co">#&gt; [1] 60</span></code></pre></div>
<p><code>round</code> must be given at least one argument. And it must be given things that can be meaningful rounded.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">round</span>()
<span class="kw">round</span>(<span class="st">&#39;a&#39;</span>)</code></pre></div>
<p>Functions may have <strong>default</strong> values for some arguments.{-}</p>
<p>By default, <code>round</code> will round off any number to zero decimal places. But we can specify the number of decimal places we want.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">round</span>(<span class="fl">60.123</span>)
<span class="co">#&gt; [1] 60</span>
<span class="kw">round</span>(<span class="fl">60.123</span>, <span class="dt">digits =</span> <span class="dv">2</span>)
<span class="co">#&gt; [1] 60.1</span>
<span class="kw">round</span>(<span class="fl">60.123</span>, <span class="dv">2</span>)
<span class="co">#&gt; [1] 60.1</span></code></pre></div>
</div>
<div id="documentation-and-help-files" class="section level3">
<h3><span class="header-section-number">5.2.4</span> Documentation and Help Files</h3>
<p>How do we know what kinds of arguments to pass into a function? Every built-in function comes with _<strong>documentation</strong>.</p>
<ul>
<li><code>?</code> + object opens a help page for that specific object</li>
<li><code>??</code> + object searches help pages containing the name of the object</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">?mean
??mean</code></pre></div>
<p>All help files are structured the same way. The section <strong>Arguments</strong> tells us exactly what kind of information we can pass into a function. The <strong>Value</strong> section explains what the output of the function is. The <strong>Examples</strong> contain real examples of the function in use.</p>
</div>
<div id="challenges-3" class="section level3">
<h3><span class="header-section-number">5.2.5</span> Challenges</h3>
<div id="challenge-1-what-happens-when" class="section level4 unnumbered">
<h4>Challenge 1: What Happens When</h4>
<p>Explain, in simple terms, the order of operations in the following program: when does the addition happen, when does the subtraction happen, when is each function called, etc.</p>
<p>What is the final value of <code>radiance</code>?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">radiance =<span class="st"> </span><span class="fl">1.0</span>
radiance =<span class="st"> </span><span class="kw">max</span>(<span class="fl">2.1</span>, <span class="fl">2.0</span> <span class="op">+</span><span class="st"> </span><span class="kw">min</span>(radiance, <span class="fl">1.1</span> <span class="op">*</span><span class="st"> </span>radiance <span class="op">-</span><span class="st"> </span><span class="fl">0.5</span>))</code></pre></div>
<p>Order of operations: 1. radiance - 0.5 2. 1.1 * (radiance - 0.5) 3. Determine the minimum between Step 2 and radiance. 4. Add 2.0 to Step 3. 5. Find the maximum between Step 4 and 2.1 6. Assign the value of Step 5 to radiance.</p>
<p>Final value = 2.6</p>
</div>
<div id="challenge-2-why" class="section level4 unnumbered">
<h4>Challenge 2: Why?</h4>
<p>Run the following code.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rich =<span class="st"> &quot;gold&quot;</span>
poor =<span class="st"> &quot;tin&quot;</span>
<span class="kw">max</span>(rich, poor)</code></pre></div>
<p>Using the help files for <code>max</code>, explain why it returns the result it does.</p>
<p>Character strings are sorted lexicographically: since “tin” begins with a letter later in the alphabet than “gold”, it is seen as larger.</p>
<!--chapter:end:03-R-Syntax/03-2_R-Functions.Rmd-->
</div>
</div>
</div>
<div id="data-types" class="section level2">
<h2><span class="header-section-number">5.3</span> Data Types</h2>
<p>Every value in a program has a specific <strong>type</strong>. In R, those types are called “classes”, and there are 4 of them:</p>
<ul>
<li>character (text or “string”)</li>
<li>numeric (integer or decimal)</li>
<li>integer (just integer)</li>
<li>logical (TRUE or FALSE booleans)</li>
</ul>
<table>
<thead>
<tr class="header">
<th>Example</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>“a”, “swc”</td>
<td>character</td>
</tr>
<tr class="even">
<td>2, 15.5</td>
<td>numeric</td>
</tr>
<tr class="odd">
<td>2 (Must add a <code>L</code> at end to denote integer)</td>
<td>integer</td>
</tr>
<tr class="even">
<td><code>TRUE</code>, <code>FALSE</code></td>
<td>logical</td>
</tr>
</tbody>
</table>
<div id="whats-that-type" class="section level3">
<h3><span class="header-section-number">5.3.1</span> What’s that Type?</h3>
<p>R is dynamically typed, meaning that it “guesses” what class a value is.</p>
<p>Use the built-in function<code>class()</code> to find out what type a value has.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">class</span>(<span class="dv">3</span>)
<span class="co">#&gt; [1] &quot;numeric&quot;</span>
<span class="kw">class</span>(3L)
<span class="co">#&gt; [1] &quot;integer&quot;</span>
<span class="kw">class</span>(<span class="st">&quot;Three&quot;</span>)
<span class="co">#&gt; [1] &quot;character&quot;</span>
<span class="kw">class</span>(T)
<span class="co">#&gt; [1] &quot;logical&quot;</span></code></pre></div>
<p>This works on variables as well. But remember: the <em>value</em> has the type — the <em>variable</em> is just a label.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">three &lt;-<span class="st"> </span><span class="dv">3</span>
<span class="kw">class</span>(three)
<span class="co">#&gt; [1] &quot;numeric&quot;</span>

three &lt;-<span class="st"> &quot;three&quot;</span>
<span class="kw">class</span>(three)
<span class="co">#&gt; [1] &quot;character&quot;</span></code></pre></div>
<p>A value’s class determines what the program can do to it.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="dv">3</span> <span class="op">-</span><span class="st"> </span><span class="dv">1</span>
<span class="dv">3</span> <span class="op">-</span><span class="st"> &quot;1&quot;</span></code></pre></div>
</div>
<div id="coercion" class="section level3">
<h3><span class="header-section-number">5.3.2</span> Coercion</h3>
<p>We just learned we cannot subtract numbers and strings. Instead, use <code>as..</code> + name of class as functions to convert a value to that type.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="dv">3</span> <span class="op">-</span><span class="st"> </span><span class="kw">as.numeric</span>(<span class="st">&quot;1&quot;</span>)</code></pre></div>
<p>This is called <code>coercion</code>. Here’s another example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_var &lt;-<span class="st"> &quot;FALSE&quot;</span>
my_var
<span class="co">#&gt; [1] &quot;FALSE&quot;</span>
<span class="kw">as.logical</span>(my_var)
<span class="co">#&gt; [1] FALSE</span></code></pre></div>
<p>What difference did you notice?</p>
</div>
<div id="other-objects" class="section level3">
<h3><span class="header-section-number">5.3.3</span> Other Objects</h3>
<p>There are a few other “odd ball” types in R:</p>
<div id="na-are-missing-values" class="section level4 unnumbered">
<h4><code>NA</code> are missing values</h4>
<p>Missing values are specified with <code>NA</code>. <code>NA</code> will always be coerced to the correct type if used inside <code>c()</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="ot">NA</span>, <span class="dv">1</span>)
x
<span class="co">#&gt; [1] NA  1</span>
<span class="kw">typeof</span>(<span class="ot">NA</span>)
<span class="co">#&gt; [1] &quot;logical&quot;</span>
<span class="kw">typeof</span>(x)
<span class="co">#&gt; [1] &quot;double&quot;</span></code></pre></div>
</div>
<div id="inf-is-infinity." class="section level4 unnumbered">
<h4><code>Inf</code> is infinity.</h4>
<p>You can have either positive or negative infinity.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="dv">1</span><span class="op">/</span><span class="dv">0</span>
<span class="co">#&gt; [1] Inf</span>
<span class="dv">1</span><span class="op">/</span><span class="ot">Inf</span>
<span class="co">#&gt; [1] 0</span></code></pre></div>
</div>
<div id="nan-means-not-a-number.-its-an-undefined-value." class="section level4 unnumbered">
<h4><code>NaN</code> means “Not a number”. It’s an undefined value.</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="dv">0</span><span class="op">/</span><span class="dv">0</span>
<span class="co">#&gt; [1] NaN</span></code></pre></div>
</div>
</div>
<div id="challenges-4" class="section level3">
<h3><span class="header-section-number">5.3.4</span> Challenges</h3>
<div id="challenge-1-making-and-coercing-variables" class="section level4 unnumbered">
<h4>Challenge 1: Making and Coercing Variables</h4>
<ol style="list-style-type: decimal">
<li>Make a variable <code>year</code> and assign it as the year you were born.</li>
<li>Coerce that variable to a string, and assign it to a new variable <code>year_string</code>.</li>
<li>Someone in your class says they were born in 2001. Really? Really. Find out what your age difference is, using only <code>year_string</code></li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">year &lt;-<span class="st"> </span><span class="dv">1992</span>
year_string &lt;-<span class="st"> </span><span class="kw">as.character</span>(year)
<span class="dv">2001</span> <span class="op">-</span><span class="st"> </span><span class="kw">as.numeric</span>(year_string)
<span class="co">#&gt; [1] 9</span></code></pre></div>
</div>
<div id="challenge-2-fix-the-code" class="section level4 unnumbered">
<h4>Challenge 2: Fix the Code</h4>
<p>Change the following code to make the output TRUE.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">val_<span class="dv">1</span> =<span class="st"> </span>F
val_<span class="dv">2</span> =<span class="st"> &quot;F&quot;</span>

<span class="kw">class</span>(val_<span class="dv">1</span>) <span class="op">==</span><span class="st"> </span><span class="kw">class</span>(val_<span class="dv">2</span>)
<span class="co">#&gt; [1] FALSE</span></code></pre></div>
<p>Solution:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">val_<span class="dv">1</span> =<span class="st"> </span>F
val_<span class="dv">2</span> =<span class="st"> &quot;F&quot;</span>

<span class="kw">class</span>(<span class="kw">as.character</span>(val_<span class="dv">1</span>)) <span class="op">==</span><span class="st"> </span><span class="kw">class</span>(val_<span class="dv">2</span>)
<span class="co">#&gt; [1] TRUE</span></code></pre></div>
<!--chapter:end:03-R-Syntax/03-3_R-Types.Rmd-->
</div>
</div>
</div>
</div>
<div id="data-classes-and-structures" class="section level1">
<h1><span class="header-section-number">6</span> Data Classes and Structures</h1>
<p>To make the best use of the R language, you’ll need a strong understanding of basic data structures, and how to operate on them.</p>
<p>This is <strong>critical</strong> to understand because these are the objects you will manipulate on a day-to-day basis in R. But they are not always as easy to work with as they seem at the outset. Dealing with object types and conversions is one of the most common sources of frustration for beginners.</p>
<p>R’s base data structures can be organised by their dimensionality (1d, 2d, or nd) and whether they’re homogeneous (all contents must be of the same type) or heterogeneous (the contents can be of different types). This gives rise to the five data types most often used in data analysis:</p>
<table>
<thead>
<tr class="header">
<th></th>
<th>Homogeneous</th>
<th>Heterogeneous</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1d</td>
<td>Atomic vector</td>
<td>List</td>
</tr>
<tr class="even">
<td>2d</td>
<td>Matrix</td>
<td>Dataframe</td>
</tr>
<tr class="odd">
<td>nd</td>
<td>Array</td>
<td></td>
</tr>
</tbody>
</table>
<p>Each data structure has its own specifications and behavior. In the rest of this chapter, we will cover the types of data objects that exist in R and their attributes.</p>
<ol style="list-style-type: decimal">
<li><a href="#vectors">Vectors</a></li>
<li><a href="#lists">Lists</a></li>
<li><a href="#factors">Factors</a></li>
<li><a href="#matrices">Matrices</a></li>
<li><a href="#dataframes">Dataframes</a></li>
</ol>
<!--chapter:end:04_R-Objects/04-0_Intro.Rmd-->
<div id="vectors" class="section level2">
<h2><span class="header-section-number">6.1</span> Vectors</h2>
<p>Let’s start with one-dimensional (1d) objects. There are two kinds:</p>
<ol style="list-style-type: decimal">
<li><strong>Atomic vectors</strong> - also called, simply, <strong>vectors</strong>.</li>
<li><strong>Lists</strong>: Lists are distinct from atomic vectors because lists can contain other lists.</li>
</ol>
<p>We’ll discuss <strong>atomic vectors</strong> first.</p>
<div id="creating-vectors" class="section level3">
<h3><span class="header-section-number">6.1.1</span> Creating Vectors</h3>
<p>Vectors are 1-dimensional chains of values. We call each value an <em>element</em> of a vector.</p>
<p>Atomic vectors are usually created with <code>c()</code>, which is short for ‘combine’:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)
x
<span class="co">#&gt; [1] 1 2 3</span>
<span class="kw">length</span>(x)
<span class="co">#&gt; [1] 3</span></code></pre></div>
<p>We can also add elements to the end of a vector by passing the original vector into the <code>c</code> function, like so:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">z &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Beyonce&quot;</span>, <span class="st">&quot;Kelly&quot;</span>, <span class="st">&quot;Michelle&quot;</span>, <span class="st">&quot;LeToya&quot;</span>)
z &lt;-<span class="st"> </span><span class="kw">c</span>(z, <span class="st">&quot;Farrah&quot;</span>)
z
<span class="co">#&gt; [1] &quot;Beyonce&quot;  &quot;Kelly&quot;    &quot;Michelle&quot; &quot;LeToya&quot;   &quot;Farrah&quot;</span></code></pre></div>
<p>Notice that vectors are always flat, even if you nest <code>c()</code>’s:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># these are equivalent</span>
<span class="kw">c</span>(<span class="dv">1</span>, <span class="kw">c</span>(<span class="dv">2</span>, <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">4</span>)))
<span class="co">#&gt; [1] 1 2 3 4</span>
<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>)
<span class="co">#&gt; [1] 1 2 3 4</span></code></pre></div>
</div>
<div id="naming-a-vector" class="section level3">
<h3><span class="header-section-number">6.1.2</span> Naming a Vector</h3>
<p>We can also attach names to our vector. This helps us understand what each element refers to.</p>
<p>You can give a name to the elements of a vector with the <code>names()</code> function. Have a look at this example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">days_month &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">31</span>, <span class="dv">28</span>, <span class="dv">31</span>, <span class="dv">30</span>, <span class="dv">31</span>, <span class="dv">30</span>, <span class="dv">31</span>, <span class="dv">31</span>, <span class="dv">30</span>, <span class="dv">31</span>, <span class="dv">30</span>, <span class="dv">31</span>)
<span class="kw">names</span>(days_month) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Jan&quot;</span>, <span class="st">&quot;Feb&quot;</span>, <span class="st">&quot;Mar&quot;</span>, <span class="st">&quot;Apr&quot;</span>, <span class="st">&quot;May&quot;</span>, <span class="st">&quot;Jun&quot;</span>, <span class="st">&quot;Jul&quot;</span>, <span class="st">&quot;Aug&quot;</span>, <span class="st">&quot;Sep&quot;</span>, <span class="st">&quot;Oct&quot;</span>, <span class="st">&quot;Nov&quot;</span>, <span class="st">&quot;Dec&quot;</span>)

days_month
<span class="co">#&gt; Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec </span>
<span class="co">#&gt;  31  28  31  30  31  30  31  31  30  31  30  31</span></code></pre></div>
<p>You can name a vector when you create it:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">some_vector &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">name =</span> <span class="st">&quot;Rochelle Terman&quot;</span>, <span class="dt">profession =</span> <span class="st">&quot;Professor Extraordinaire&quot;</span>)
some_vector
<span class="co">#&gt;                       name                 profession </span>
<span class="co">#&gt;          &quot;Rochelle Terman&quot; &quot;Professor Extraordinaire&quot;</span></code></pre></div>
<p>Notice that in the first case, we surrounded each name with quotation marks. But we don’t have to do this when creating a named vector.</p>
<p>Names don’t have to be unique, and not all values need to have a name associated. However, names are most useful for subsetting, described in the next chapter. When subsetting, it is most useful when the names are unique.</p>
</div>
<div id="calculations-on-vectors" class="section level3">
<h3><span class="header-section-number">6.1.3</span> Calculations on Vectors</h3>
<p>One of the most powerful things about vectors is that we can perform arithmetic calculations on them.</p>
<p>For example, we can sum up all the values in a numerical vector using <strong>sum</strong>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">a &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="op">-</span><span class="dv">2</span>, <span class="dv">3</span>)
<span class="kw">sum</span>(a)
<span class="co">#&gt; [1] 2</span></code></pre></div>
<p>We can also sum two vectors. It is important to know that if you <strong>sum</strong> two vectors in R, it takes the element-wise sum. For example, the following three statements are completely equivalent:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>) <span class="op">+</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>)
<span class="kw">c</span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">4</span>, <span class="dv">2</span> <span class="op">+</span><span class="st"> </span><span class="dv">5</span>, <span class="dv">3</span> <span class="op">+</span><span class="st"> </span><span class="dv">6</span>)
<span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">9</span>)</code></pre></div>
</div>
<div id="types-of-vectors" class="section level3">
<h3><span class="header-section-number">6.1.4</span> Types of Vectors</h3>
<p>So there are there are four common types of vectors, depending on the class: * <code>logical</code> * <code>integer</code> * <code>numeric</code> (same as <code>double</code>) * <code>character</code>.</p>
<div id="logical-vectors" class="section level4 unnumbered">
<h4>Logical Vectors</h4>
<p>Logical vectors take on one of three possible values:</p>
<ol style="list-style-type: decimal">
<li><code>TRUE</code></li>
<li><code>FALSE</code></li>
<li><code>NA</code> (missing value)</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">c</span>(<span class="ot">TRUE</span>, <span class="ot">TRUE</span>, <span class="ot">FALSE</span>, <span class="ot">NA</span>)
<span class="co">#&gt; [1]  TRUE  TRUE FALSE    NA</span></code></pre></div>
</div>
<div id="numeric-vectors" class="section level4 unnumbered">
<h4>Numeric Vectors</h4>
<p>Numeric vectors contain numbers. They can be stored as <em>integers</em> (whole numbers) or <em>doubles</em> (numbers with decimal points). In practice, you rarely need to concern yourself with this difference, but just know that they are different but related things.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">335</span>)
<span class="co">#&gt; [1]   1   2 335</span>
<span class="kw">c</span>(<span class="fl">4.2</span>, <span class="dv">4</span>, <span class="dv">6</span>, <span class="fl">53.2</span>)
<span class="co">#&gt; [1]  4.2  4.0  6.0 53.2</span></code></pre></div>
</div>
<div id="character-vectors" class="section level4 unnumbered">
<h4>Character Vectors</h4>
<p>Character vectors contain character (or ‘string’) values. Note that each value has to be surrounded by quotation marks <em>before</em> the comma.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">c</span>(<span class="st">&quot;Beyonce&quot;</span>, <span class="st">&quot;Kelly&quot;</span>, <span class="st">&quot;Michelle&quot;</span>, <span class="st">&quot;LeToya&quot;</span>)
<span class="co">#&gt; [1] &quot;Beyonce&quot;  &quot;Kelly&quot;    &quot;Michelle&quot; &quot;LeToya&quot;</span></code></pre></div>
</div>
</div>
<div id="coercion-1" class="section level3">
<h3><span class="header-section-number">6.1.5</span> Coercion</h3>
<p>We can change or convert a vector’s type using <code>as....</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">num_var &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="fl">2.5</span>, <span class="fl">4.5</span>)
<span class="kw">class</span>(num_var)
<span class="co">#&gt; [1] &quot;numeric&quot;</span>
<span class="kw">as.character</span>(num_var)
<span class="co">#&gt; [1] &quot;1&quot;   &quot;2.5&quot; &quot;4.5&quot;</span></code></pre></div>
<p>Remember that all elements of a vector must be the same type. So when you attempt to combine different types, they will be <strong>coerced</strong> to the most “flexible” type.</p>
<p>For example, combining a character and an integer yields a character:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="dv">1</span>)
<span class="co">#&gt; [1] &quot;a&quot; &quot;1&quot;</span></code></pre></div>
<p>Guess what the following do without running them first:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">c</span>(<span class="fl">1.7</span>, <span class="st">&quot;a&quot;</span>) 
<span class="kw">c</span>(<span class="ot">TRUE</span>, <span class="dv">2</span>) 
<span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="ot">TRUE</span>) </code></pre></div>
<div id="true-1-and-false-0." class="section level4 unnumbered">
<h4>TRUE == 1 and FALSE == 0.</h4>
<p>Notice that when a logical vector is coerced to an integer or double, <code>TRUE</code> becomes 1 and <code>FALSE</code> becomes 0. This is very useful in conjunction with <code>sum()</code> and <code>mean()</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="ot">FALSE</span>, <span class="ot">FALSE</span>, <span class="ot">TRUE</span>)
<span class="kw">as.numeric</span>(x)
<span class="co">#&gt; [1] 0 0 1</span>

<span class="co"># Total number of TRUEs</span>
<span class="kw">sum</span>(x)
<span class="co">#&gt; [1] 1</span>

<span class="co"># Proportion that are TRUE</span>
<span class="kw">mean</span>(x)
<span class="co">#&gt; [1] 0.333</span></code></pre></div>
</div>
<div id="coercion-often-happens-automatically." class="section level4 unnumbered">
<h4>Coercion often happens automatically.</h4>
<p>This is called <em>implicit coercion</em>. Most mathematical functions (<code>+</code>, <code>log</code>, <code>abs</code>, etc.) will coerce to a double or integer, and most logical operations (<code>&amp;</code>, <code>|</code>, <code>any</code>, etc) will coerce to a logical. You will usually get a warning message if the coercion might lose information.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="dv">1</span> <span class="op">&lt;</span><span class="st"> &quot;2&quot;</span>
<span class="co">#&gt; [1] TRUE</span>
<span class="st">&quot;1&quot;</span> <span class="op">&gt;</span><span class="st"> </span><span class="dv">2</span>
<span class="co">#&gt; [1] FALSE</span></code></pre></div>
<p>Sometimes coercions, especially nonsensical ones, won’t work.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>)
<span class="kw">as.numeric</span>(x)
<span class="co">#&gt; Warning: NAs introduced by coercion</span>
<span class="co">#&gt; [1] NA NA NA</span>
<span class="kw">as.logical</span>(x)
<span class="co">#&gt; [1] NA NA NA</span></code></pre></div>
</div>
</div>
<div id="challenges-5" class="section level3">
<h3><span class="header-section-number">6.1.6</span> Challenges</h3>
<div id="challenge-1-create-and-examine-your-vector" class="section level4 unnumbered">
<h4>Challenge 1: Create and examine your vector</h4>
<p>Create a character vector called <code>fruit</code> that contain 4 of your favorite fruits. Then evaluate its structure using the commands below.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="co"># First create your fruit vector </span>
<span class="co"># YOUR CODE HERE</span>


<span class="co"># Examine your vector</span>
<span class="kw">length</span>(fruit)
<span class="kw">class</span>(fruit)
<span class="kw">str</span>(fruit)</code></pre></div>
</div>
<div id="challenge-2-coercion" class="section level4 unnumbered">
<h4>Challenge 2: Coercion</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="co"># 1. Create a vector of a sequence of numbers between 1 to 10.</span>

<span class="co"># 2. Coerce that vector into a character vector</span>

<span class="co"># 3. Add the element &quot;11&quot; to the end of the vector</span>

<span class="co"># 4. Coerce it back to a numeric vector.</span></code></pre></div>
<p>Solution:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 1. Create a vector of a sequence of numbers between 1 to 10.</span>
numbers &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>)
<span class="co"># 2. Coerce that vector into a character vector</span>
numbers_char &lt;-<span class="st"> </span><span class="kw">as.character</span>(numbers)
<span class="co"># 3. Add the element &quot;11&quot; to the end of the vector</span>
numbers_char &lt;-<span class="st"> </span><span class="kw">c</span>(numbers_char, <span class="dv">11</span>)
<span class="co"># 4. Coerce it back to a numeric vector.</span>
numbers_num &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(numbers_char)</code></pre></div>
</div>
<div id="challenge-3-calculations-on-vectors" class="section level4 unnumbered">
<h4>Challenge 3: Calculations on Vectors</h4>
<p>Create a vector of the numbers 11-20, and multiply it by the original vector from Challenge 2.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">numbers2 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">11</span><span class="op">:</span><span class="dv">20</span>)
numbers <span class="op">*</span><span class="st"> </span>numbers2
<span class="co">#&gt;  [1]  11  24  39  56  75  96 119 144 171 200</span></code></pre></div>
<!--chapter:end:04_R-Objects/04-1_Vectors.Rmd-->
</div>
</div>
</div>
<div id="lists" class="section level2">
<h2><span class="header-section-number">6.2</span> Lists</h2>
<p>Lists are different from vectors because their elements can be of <strong>any type</strong>. Lists are sometimes called recursive vectors, because a list can contain other lists. This makes them fundamentally different from vectors.</p>
<div id="creating-lists" class="section level3">
<h3><span class="header-section-number">6.2.1</span> Creating Lists</h3>
<p>You construct lists by using <code>list()</code> instead of <code>c()</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dv">1</span>, <span class="st">&quot;a&quot;</span>, <span class="ot">TRUE</span>, <span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>))
x
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt; [1] 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[2]]</span>
<span class="co">#&gt; [1] &quot;a&quot;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[3]]</span>
<span class="co">#&gt; [1] TRUE</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[4]]</span>
<span class="co">#&gt; [1] 4 5 6</span></code></pre></div>
</div>
<div id="naming-lists" class="section level3">
<h3><span class="header-section-number">6.2.2</span> Naming Lists</h3>
<p>As with vectors, we can attach names to each element on our list:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_list &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">name1 =</span> elem1, 
                <span class="dt">name2 =</span> elem2)</code></pre></div>
<p>This creates a list with components that are named <code>name1</code>, <code>name2</code>, and so on. If you want to name your lists after you’ve created them, you can use the <code>names()</code> function as you did with vectors. The following commands are fully equivalent to the assignment above:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_list &lt;-<span class="st"> </span><span class="kw">list</span>(elem1, elem2)
<span class="kw">names</span>(my_list) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;name1&quot;</span>, <span class="st">&quot;name2&quot;</span>)</code></pre></div>
</div>
<div id="list-structure" class="section level3">
<h3><span class="header-section-number">6.2.3</span> List Structure</h3>
<p>A very useful tool for working with lists is <code>str()</code> because it focuses on reviewing the structure of a list, not the contents.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">a =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>),
          <span class="dt">b =</span> <span class="kw">c</span>(<span class="st">&quot;Hello&quot;</span>, <span class="st">&quot;there&quot;</span>),
          <span class="dt">c =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>)
<span class="kw">str</span>(x)
<span class="co">#&gt; List of 3</span>
<span class="co">#&gt;  $ a: num [1:3] 1 2 3</span>
<span class="co">#&gt;  $ b: chr [1:2] &quot;Hello&quot; &quot;there&quot;</span>
<span class="co">#&gt;  $ c: int [1:10] 1 2 3 4 5 6 7 8 9 10</span></code></pre></div>
<p>A list does not print to the console like a vector. Instead, each element of the list starts on a new line.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x.vec &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>)
x.list &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>)
x.vec
<span class="co">#&gt; [1] 1 2 3</span>
x.list
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt; [1] 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[2]]</span>
<span class="co">#&gt; [1] 2</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[3]]</span>
<span class="co">#&gt; [1] 3</span></code></pre></div>
<p>Lists are used to build up many of the more complicated data structures in R. For example, both data frames and linear models objects (as produced by <code>lm()</code>) are lists:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(mtcars)
<span class="co">#&gt;                    mpg cyl disp  hp drat   wt qsec vs am gear carb</span>
<span class="co">#&gt; Mazda RX4         21.0   6  160 110 3.90 2.62 16.5  0  1    4    4</span>
<span class="co">#&gt; Mazda RX4 Wag     21.0   6  160 110 3.90 2.88 17.0  0  1    4    4</span>
<span class="co">#&gt; Datsun 710        22.8   4  108  93 3.85 2.32 18.6  1  1    4    1</span>
<span class="co">#&gt; Hornet 4 Drive    21.4   6  258 110 3.08 3.21 19.4  1  0    3    1</span>
<span class="co">#&gt; Hornet Sportabout 18.7   8  360 175 3.15 3.44 17.0  0  0    3    2</span>
<span class="co">#&gt; Valiant           18.1   6  225 105 2.76 3.46 20.2  1  0    3    1</span>
<span class="kw">is.list</span>(mtcars)
<span class="co">#&gt; [1] TRUE</span>
mod &lt;-<span class="st"> </span><span class="kw">lm</span>(mpg <span class="op">~</span><span class="st"> </span>wt, <span class="dt">data =</span> mtcars)
<span class="kw">is.list</span>(mod)
<span class="co">#&gt; [1] TRUE</span></code></pre></div>
<p>You could say that a list is some kind super data type: you can store practically any piece of information in it!</p>
<p>For this reason, lists are extremely useful inside functions. You can “staple” together lots of different kinds of results into a single object that a function can return.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mod &lt;-<span class="st"> </span><span class="kw">lm</span>(mpg <span class="op">~</span><span class="st"> </span>wt, <span class="dt">data =</span> mtcars)
<span class="kw">str</span>(mod)
<span class="co">#&gt; List of 12</span>
<span class="co">#&gt;  $ coefficients : Named num [1:2] 37.29 -5.34</span>
<span class="co">#&gt;   ..- attr(*, &quot;names&quot;)= chr [1:2] &quot;(Intercept)&quot; &quot;wt&quot;</span>
<span class="co">#&gt;  $ residuals    : Named num [1:32] -2.28 -0.92 -2.09 1.3 -0.2 ...</span>
<span class="co">#&gt;   ..- attr(*, &quot;names&quot;)= chr [1:32] &quot;Mazda RX4&quot; &quot;Mazda RX4 Wag&quot; &quot;Datsun 710&quot; &quot;Hornet 4 Drive&quot; ...</span>
<span class="co">#&gt;  $ effects      : Named num [1:32] -113.65 -29.116 -1.661 1.631 0.111 ...</span>
<span class="co">#&gt;   ..- attr(*, &quot;names&quot;)= chr [1:32] &quot;(Intercept)&quot; &quot;wt&quot; &quot;&quot; &quot;&quot; ...</span>
<span class="co">#&gt;  $ rank         : int 2</span>
<span class="co">#&gt;  $ fitted.values: Named num [1:32] 23.3 21.9 24.9 20.1 18.9 ...</span>
<span class="co">#&gt;   ..- attr(*, &quot;names&quot;)= chr [1:32] &quot;Mazda RX4&quot; &quot;Mazda RX4 Wag&quot; &quot;Datsun 710&quot; &quot;Hornet 4 Drive&quot; ...</span>
<span class="co">#&gt;  $ assign       : int [1:2] 0 1</span>
<span class="co">#&gt;  $ qr           :List of 5</span>
<span class="co">#&gt;   ..$ qr   : num [1:32, 1:2] -5.657 0.177 0.177 0.177 0.177 ...</span>
<span class="co">#&gt;   .. ..- attr(*, &quot;dimnames&quot;)=List of 2</span>
<span class="co">#&gt;   .. .. ..$ : chr [1:32] &quot;Mazda RX4&quot; &quot;Mazda RX4 Wag&quot; &quot;Datsun 710&quot; &quot;Hornet 4 Drive&quot; ...</span>
<span class="co">#&gt;   .. .. ..$ : chr [1:2] &quot;(Intercept)&quot; &quot;wt&quot;</span>
<span class="co">#&gt;   .. ..- attr(*, &quot;assign&quot;)= int [1:2] 0 1</span>
<span class="co">#&gt;   ..$ qraux: num [1:2] 1.18 1.05</span>
<span class="co">#&gt;   ..$ pivot: int [1:2] 1 2</span>
<span class="co">#&gt;   ..$ tol  : num 1e-07</span>
<span class="co">#&gt;   ..$ rank : int 2</span>
<span class="co">#&gt;   ..- attr(*, &quot;class&quot;)= chr &quot;qr&quot;</span>
<span class="co">#&gt;  $ df.residual  : int 30</span>
<span class="co">#&gt;  $ xlevels      : Named list()</span>
<span class="co">#&gt;  $ call         : language lm(formula = mpg ~ wt, data = mtcars)</span>
<span class="co">#&gt;  $ terms        :Classes &#39;terms&#39;, &#39;formula&#39;  language mpg ~ wt</span>
<span class="co">#&gt;   .. ..- attr(*, &quot;variables&quot;)= language list(mpg, wt)</span>
<span class="co">#&gt;   .. ..- attr(*, &quot;factors&quot;)= int [1:2, 1] 0 1</span>
<span class="co">#&gt;   .. .. ..- attr(*, &quot;dimnames&quot;)=List of 2</span>
<span class="co">#&gt;   .. .. .. ..$ : chr [1:2] &quot;mpg&quot; &quot;wt&quot;</span>
<span class="co">#&gt;   .. .. .. ..$ : chr &quot;wt&quot;</span>
<span class="co">#&gt;   .. ..- attr(*, &quot;term.labels&quot;)= chr &quot;wt&quot;</span>
<span class="co">#&gt;   .. ..- attr(*, &quot;order&quot;)= int 1</span>
<span class="co">#&gt;   .. ..- attr(*, &quot;intercept&quot;)= int 1</span>
<span class="co">#&gt;   .. ..- attr(*, &quot;response&quot;)= int 1</span>
<span class="co">#&gt;   .. ..- attr(*, &quot;.Environment&quot;)=&lt;environment: R_GlobalEnv&gt; </span>
<span class="co">#&gt;   .. ..- attr(*, &quot;predvars&quot;)= language list(mpg, wt)</span>
<span class="co">#&gt;   .. ..- attr(*, &quot;dataClasses&quot;)= Named chr [1:2] &quot;numeric&quot; &quot;numeric&quot;</span>
<span class="co">#&gt;   .. .. ..- attr(*, &quot;names&quot;)= chr [1:2] &quot;mpg&quot; &quot;wt&quot;</span>
<span class="co">#&gt;  $ model        :&#39;data.frame&#39;:   32 obs. of  2 variables:</span>
<span class="co">#&gt;   ..$ mpg: num [1:32] 21 21 22.8 21.4 18.7 18.1 14.3 24.4 22.8 19.2 ...</span>
<span class="co">#&gt;   ..$ wt : num [1:32] 2.62 2.88 2.32 3.21 3.44 ...</span>
<span class="co">#&gt;   ..- attr(*, &quot;terms&quot;)=Classes &#39;terms&#39;, &#39;formula&#39;  language mpg ~ wt</span>
<span class="co">#&gt;   .. .. ..- attr(*, &quot;variables&quot;)= language list(mpg, wt)</span>
<span class="co">#&gt;   .. .. ..- attr(*, &quot;factors&quot;)= int [1:2, 1] 0 1</span>
<span class="co">#&gt;   .. .. .. ..- attr(*, &quot;dimnames&quot;)=List of 2</span>
<span class="co">#&gt;   .. .. .. .. ..$ : chr [1:2] &quot;mpg&quot; &quot;wt&quot;</span>
<span class="co">#&gt;   .. .. .. .. ..$ : chr &quot;wt&quot;</span>
<span class="co">#&gt;   .. .. ..- attr(*, &quot;term.labels&quot;)= chr &quot;wt&quot;</span>
<span class="co">#&gt;   .. .. ..- attr(*, &quot;order&quot;)= int 1</span>
<span class="co">#&gt;   .. .. ..- attr(*, &quot;intercept&quot;)= int 1</span>
<span class="co">#&gt;   .. .. ..- attr(*, &quot;response&quot;)= int 1</span>
<span class="co">#&gt;   .. .. ..- attr(*, &quot;.Environment&quot;)=&lt;environment: R_GlobalEnv&gt; </span>
<span class="co">#&gt;   .. .. ..- attr(*, &quot;predvars&quot;)= language list(mpg, wt)</span>
<span class="co">#&gt;   .. .. ..- attr(*, &quot;dataClasses&quot;)= Named chr [1:2] &quot;numeric&quot; &quot;numeric&quot;</span>
<span class="co">#&gt;   .. .. .. ..- attr(*, &quot;names&quot;)= chr [1:2] &quot;mpg&quot; &quot;wt&quot;</span>
<span class="co">#&gt;  - attr(*, &quot;class&quot;)= chr &quot;lm&quot;</span></code></pre></div>
</div>
<div id="challenges-6" class="section level3">
<h3><span class="header-section-number">6.2.4</span> Challenges</h3>
<div id="challenge-1.-what-are-the-four-basic-types-of-atomic-vectors-how-does-a-list-differ-from-an-atomic-vector" class="section level4 unnumbered">
<h4>Challenge 1. What are the four basic types of atomic vectors? How does a list differ from an atomic vector?</h4>
<p>Logical, integer, numeric, character. A list can contains elements of multiple classes, while all the elements of a vector must be of the same class.</p>
</div>
<div id="challenge-2.-why-is-1-1-true-why-is--1-false-true-why-is-one-2-false" class="section level4 unnumbered">
<h4>Challenge 2. Why is <code>1 == &quot;1&quot;</code> true? Why is <code>-1 &lt; FALSE</code> true? Why is <code>&quot;one&quot; &lt; 2</code> false?</h4>
<p>Vectors are coerced to their most flexible type. So, <code>1 == &quot;1&quot;</code> evaluates both as characters, and so they are equal. FALSE coerces to 0, which is greater than -1.</p>
</div>
<div id="challenge-3.-create-three-vectors-and-combine-them-into-a-list.-assign-them-names." class="section level4 unnumbered">
<h4>Challenge 3. Create three vectors and combine them into a list. Assign them names.</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">v1 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Saturday&quot;</span>, <span class="st">&quot;Sunday&quot;</span>)
v2 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">76</span>, <span class="dv">58</span>)
v3 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="ot">TRUE</span>, <span class="ot">FALSE</span>)

weekend &lt;-<span class="st"> </span><span class="kw">list</span>(v1, v2, v3)
<span class="kw">names</span>(weekend) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Day&quot;</span>, <span class="st">&quot;High Temp&quot;</span>, <span class="st">&quot;Will I go to the lake?&quot;</span>)</code></pre></div>
</div>
<div id="challenge-4.-if-x-is-a-list-what-is-the-class-of-x1-how-about-x1" class="section level4 unnumbered">
<h4>Challenge 4. If <code>x</code> is a list, what is the class of <code>x[1]</code>? How about <code>x[[1]]</code>?</h4>
<!--chapter:end:04_R-Objects/04-2_Lists.Rmd-->
</div>
</div>
</div>
<div id="factors" class="section level2">
<h2><span class="header-section-number">6.3</span> Factors</h2>
<p>Factors are special vectors that represent <em>categorical</em> data: variables that have a fixed and known set of possible values. Think: Democrat, Republican, Independent; Male, Female, Other; etc.</p>
<p>It is important that R knows whether it is dealing with a continuous or a categorical variable, as the statistical models you will develop in the future treat both types differently.</p>
<p>Historically, factors were much easier to work with than characters. As a result, many of the functions in base R automatically convert characters to factors. This means that factors often pop up in places where they’re not actually helpful.</p>
<div id="creating-factors" class="section level3">
<h3><span class="header-section-number">6.3.1</span> Creating Factors</h3>
<p>To create factors in R, you use the function <code>factor()</code>. The first thing that you have to do is create a vector that contains all the observations that belong to a limited number of categories. For example, <code>party_vector</code> contains the partyID of 5 different individuals:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">party_vector &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Rep&quot;</span>, <span class="st">&quot;Rep&quot;</span>, <span class="st">&quot;Dem&quot;</span>, <span class="st">&quot;Rep&quot;</span>, <span class="st">&quot;Dem&quot;</span>)</code></pre></div>
<p>It is clear that there are two categories, or in R-terms <strong>factor levels</strong>, at work here: <code>Dem</code> and <code>Rep</code>.</p>
<p>The function <code>factor()</code> will encode the vector as a factor:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">party_factor &lt;-<span class="st"> </span><span class="kw">factor</span>(party_vector)
party_vector
<span class="co">#&gt; [1] &quot;Rep&quot; &quot;Rep&quot; &quot;Dem&quot; &quot;Rep&quot; &quot;Dem&quot;</span>
party_factor
<span class="co">#&gt; [1] Rep Rep Dem Rep Dem</span>
<span class="co">#&gt; Levels: Dem Rep</span></code></pre></div>
</div>
<div id="summarizing-a-factor" class="section level3">
<h3><span class="header-section-number">6.3.2</span> Summarizing a Factor</h3>
<p>One of your favorite functions in R will be <code>summary()</code>. This will give you a quick overview of the contents of a variable. Let’s compare using <code>summary()</code> on both the character vector and the factor:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(party_vector)
<span class="kw">summary</span>(party_factor)</code></pre></div>
</div>
<div id="changing-factor-levels" class="section level3">
<h3><span class="header-section-number">6.3.3</span> Changing Factor Levels</h3>
<p>When you create the factor, the factor levels are set to specific values. We can access those values with the <code>levels()</code> function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">levels</span>(party_factor)
<span class="co">#&gt; [1] &quot;Dem&quot; &quot;Rep&quot;</span></code></pre></div>
<p>Any values <em>not</em> in the set of levels will be silently converted to <code>NA</code>. Let’s say we want to add an Independent to our sample:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">party_factor[<span class="dv">5</span>] &lt;-<span class="st"> &quot;Ind&quot;</span>
<span class="co">#&gt; Warning in `[&lt;-.factor`(`*tmp*`, 5, value = &quot;Ind&quot;): invalid factor level,</span>
<span class="co">#&gt; NA generated</span>
party_factor
<span class="co">#&gt; [1] Rep  Rep  Dem  Rep  &lt;NA&gt;</span>
<span class="co">#&gt; Levels: Dem Rep</span></code></pre></div>
<p>We first need to add “Ind” to our factor levels. This will allow us to add Independents to our sample:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">levels</span>(party_factor)
<span class="co">#&gt; [1] &quot;Dem&quot; &quot;Rep&quot;</span>
<span class="kw">levels</span>(party_factor) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Dem&quot;</span>, <span class="st">&quot;Rep&quot;</span>, <span class="st">&quot;Ind&quot;</span>)

party_factor[<span class="dv">5</span>] &lt;-<span class="st"> &quot;Ind&quot;</span>
party_factor
<span class="co">#&gt; [1] Rep Rep Dem Rep Ind</span>
<span class="co">#&gt; Levels: Dem Rep Ind</span></code></pre></div>
</div>
<div id="factors-are-integers" class="section level3">
<h3><span class="header-section-number">6.3.4</span> Factors are Integers</h3>
<p>Factors are pretty much integers that have labels on them. Underneath, it’s really numbers (1, 2, 3…).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(party_factor)
<span class="co">#&gt;  Factor w/ 3 levels &quot;Dem&quot;,&quot;Rep&quot;,&quot;Ind&quot;: 2 2 1 2 3</span></code></pre></div>
<p>They are better than using simple integer labels because factors are self-describing. For example, <code>democrat</code> and <code>republican</code> are more descriptive than <code>1</code>s and <code>2</code>s.</p>
<p>However, <strong>factors are NOT characters!!</strong></p>
<p>While factors look (and often behave) like character vectors, they are actually integers. Be careful when treating them like strings.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;a&quot;</span>)
x &lt;-<span class="st"> </span><span class="kw">as.factor</span>(x)
<span class="kw">c</span>(x, <span class="st">&quot;c&quot;</span>)
<span class="co">#&gt; [1] &quot;1&quot; &quot;2&quot; &quot;2&quot; &quot;1&quot; &quot;c&quot;</span></code></pre></div>
<p>For this reason, it’s usually best to explicitly <strong>convert</strong> factors to character vectors if you need string-like behaviour.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;a&quot;</span>)
x &lt;-<span class="st"> </span><span class="kw">as.factor</span>(x)
x &lt;-<span class="st"> </span><span class="kw">as.character</span>(x)
<span class="kw">c</span>(x, <span class="st">&quot;c&#39;&quot;</span>)
<span class="co">#&gt; [1] &quot;a&quot;  &quot;b&quot;  &quot;b&quot;  &quot;a&quot;  &quot;c&#39;&quot;</span></code></pre></div>
</div>
<div id="challenges-7" class="section level3">
<h3><span class="header-section-number">6.3.5</span> Challenges</h3>
<div id="challenge-1.-what-happens-to-a-factor-when-you-modify-its-levels" class="section level4 unnumbered">
<h4>Challenge 1. What happens to a factor when you modify its levels?</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">f1 &lt;-<span class="st"> </span><span class="kw">factor</span>(letters)
<span class="kw">levels</span>(f1) &lt;-<span class="st"> </span><span class="kw">rev</span>(<span class="kw">levels</span>(f1))
f1
<span class="co">#&gt;  [1] z y x w v u t s r q p o n m l k j i h g f e d c b a</span>
<span class="co">#&gt; Levels: z y x w v u t s r q p o n m l k j i h g f e d c b a</span></code></pre></div>
<p>The vector is ordered in reverse, but the factor assignments per letter stay the same.</p>
</div>
<div id="challenge-2.-what-does-this-code-do-how-do-f2-and-f3-differ-from-f1" class="section level4 unnumbered">
<h4>Challenge 2. What does this code do? How do <code>f2</code> and <code>f3</code> differ from <code>f1</code>?</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">f2 &lt;-<span class="st"> </span><span class="kw">rev</span>(<span class="kw">factor</span>(letters))
f3 &lt;-<span class="st"> </span><span class="kw">factor</span>(letters, <span class="dt">levels =</span> <span class="kw">rev</span>(letters))</code></pre></div>
<p>f2 reverses the vector and assigns the factors in the same order is f1 – z is assigned to a, etc, by reversing the order of the vector.</p>
<p>f3 similarly assigns z to a, etc, but does so by reversing the order of the factor levels.</p>
<!--chapter:end:04_R-Objects/04-3_Factors.Rmd-->
</div>
</div>
</div>
<div id="matrices" class="section level2">
<h2><span class="header-section-number">6.4</span> Matrices</h2>
<p>Matrices are 2-d vectors. That is, they are a collection of elements of the same data type (numeric, character, or logical), arranged into a fixed number of rows and columns.</p>
<p>By definition, if you want to combine different types of data (one column numbers, another column characters), you want a <strong>dataframe</strong>, not a matrix.</p>
<div id="creating-matrices" class="section level3">
<h3><span class="header-section-number">6.4.1</span> Creating Matrices</h3>
<p>We can create a matrix using the <code>matrix()</code> function. In this function, we assign dimensions to a vector, like this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">m &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">6</span>, <span class="dt">nrow =</span> <span class="dv">2</span>, <span class="dt">ncol =</span> <span class="dv">3</span>)
m
<span class="co">#&gt;      [,1] [,2] [,3]</span>
<span class="co">#&gt; [1,]    1    3    5</span>
<span class="co">#&gt; [2,]    2    4    6</span></code></pre></div>
<p>Notice that matrices fill column-wise. We can change this using the <code>byrow</code> argument:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">m &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">6</span>, <span class="dt">byrow =</span> T, <span class="dt">nrow =</span> <span class="dv">2</span>, <span class="dt">ncol =</span> <span class="dv">3</span>)
m
<span class="co">#&gt;      [,1] [,2] [,3]</span>
<span class="co">#&gt; [1,]    1    2    3</span>
<span class="co">#&gt; [2,]    4    5    6</span></code></pre></div>
<p>Another way to create matrices is to bind columns or rows using <code>cbind()</code> and <code>rbind()</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">3</span>
y &lt;-<span class="st"> </span><span class="dv">10</span><span class="op">:</span><span class="dv">12</span>
<span class="kw">cbind</span>(x, y)
<span class="co">#&gt;      x  y</span>
<span class="co">#&gt; [1,] 1 10</span>
<span class="co">#&gt; [2,] 2 11</span>
<span class="co">#&gt; [3,] 3 12</span>
<span class="co"># or </span>
<span class="kw">rbind</span>(x, y)
<span class="co">#&gt;   [,1] [,2] [,3]</span>
<span class="co">#&gt; x    1    2    3</span>
<span class="co">#&gt; y   10   11   12</span></code></pre></div>
</div>
<div id="matrix-dimensions" class="section level3">
<h3><span class="header-section-number">6.4.2</span> Matrix Dimensions</h3>
<p>Use <code>dim()</code> to find out how many rows or columns are in a matrix (or dataframe)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dim</span>(m)
<span class="co">#&gt; [1] 2 3</span></code></pre></div>
<p>We can transpose a matrix (or dataframe) with <code>t()</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">m &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">6</span>, <span class="dt">nrow =</span> <span class="dv">2</span>, <span class="dt">ncol =</span> <span class="dv">3</span>)
m
<span class="co">#&gt;      [,1] [,2] [,3]</span>
<span class="co">#&gt; [1,]    1    3    5</span>
<span class="co">#&gt; [2,]    2    4    6</span>
<span class="kw">t</span>(m)
<span class="co">#&gt;      [,1] [,2]</span>
<span class="co">#&gt; [1,]    1    2</span>
<span class="co">#&gt; [2,]    3    4</span>
<span class="co">#&gt; [3,]    5    6</span></code></pre></div>
</div>
<div id="matrix-names" class="section level3">
<h3><span class="header-section-number">6.4.3</span> Matrix Names</h3>
<p>Just like vectors or lists, we can give matrices names that describe the rows and columns</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">m &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">6</span>, <span class="dt">nrow =</span> <span class="dv">2</span>, <span class="dt">ncol =</span> <span class="dv">3</span>)

<span class="kw">rownames</span>(m) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;row1&quot;</span>, <span class="st">&quot;row2&quot;</span>)
<span class="kw">colnames</span>(m) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;C&quot;</span>)

m
<span class="co">#&gt;      A B C</span>
<span class="co">#&gt; row1 1 3 5</span>
<span class="co">#&gt; row2 2 4 6</span></code></pre></div>
</div>
<div id="challenge" class="section level3">
<h3><span class="header-section-number">6.4.4</span> Challenge</h3>
<p>Take a look at the vector I’ve created about box office sales for the first three Harry Potter movies:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Box office sales (in millions!)</span>
philosophers_stone &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">66.1</span>, <span class="fl">317.6</span>, <span class="fl">657.2</span>)
chamber_secrets &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">54.7</span>, <span class="fl">261.9</span>, <span class="fl">616.9</span>)
prisoner_azkaban &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">45.6</span>, <span class="fl">249.5</span>, <span class="fl">547.1</span>)

<span class="co"># Vectors region and titles, used for naming</span>
region &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;UK&quot;</span>, <span class="st">&quot;US&quot;</span>, <span class="st">&quot;Other&quot;</span>)
titles &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Philosopher&#39;s Stone&quot;</span>, <span class="st">&quot;Chamber of Secrets&quot;</span>, <span class="st">&quot;Prisoner of Azkaban&quot;</span>)</code></pre></div>
<p>Your challenge is to:</p>
<ol style="list-style-type: decimal">
<li>Combine the first three vectors into a matrix</li>
<li>Add names for the matrix’s rows (<code>titles</code>) and columns (<code>region</code>)</li>
<li>Use <code>rowSums()</code> to find the total Worldwide Box Office sales for each movie.</li>
</ol>
<p>Solution</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">movie_matrix &lt;-<span class="st"> </span><span class="kw">rbind</span>(philosophers_stone, chamber_secrets, prisoner_azkaban)
<span class="kw">rownames</span>(movie_matrix) &lt;-<span class="st"> </span>titles
<span class="kw">colnames</span>(movie_matrix) &lt;-<span class="st"> </span>region
<span class="kw">rowSums</span>(movie_matrix)
<span class="co">#&gt; Philosopher&#39;s Stone  Chamber of Secrets Prisoner of Azkaban </span>
<span class="co">#&gt;                1041                 934                 842</span></code></pre></div>
<!--chapter:end:04_R-Objects/04-4_Matrices.Rmd-->
</div>
</div>
<div id="dataframes" class="section level2">
<h2><span class="header-section-number">6.5</span> Dataframes</h2>
<p>A dataframe is a very important data type in R. It’s pretty much the <em>de facto</em> data structure for most tabular data and it’s also what we use for statistics.</p>
<p>Let’s say we’re working with the following survey data:</p>
<ul>
<li>‘Are you married?’ or ‘yes/no’ questions (logical`)</li>
<li>‘How old are you?’ (<code>numeric</code>)</li>
<li>‘What is your opinion on Trump?’ or other ‘open-ended’ questions (<code>character</code>)</li>
<li>…</li>
</ul>
<p>A matrix won’t work here because the dataset contains different data types.</p>
<p>A dataframe is a 2-dimentional data structure containing heterogeneous data types. Each column is a variable of a dataset, and the rows are observations.</p>
<blockquote>
<p>NB: You might have heard of “tibbles,” used in the <code>tidyverse</code> suite of packages. Tibbles are like dataframes 2.0, tweaking some of the behavior of dataframes to make life easier for data anlysis. For now, just think of tibbles and dataframes as the same thing and don’t worry about the difference.</p>
</blockquote>
<div id="creating-dataframes" class="section level3">
<h3><span class="header-section-number">6.5.1</span> Creating Dataframes</h3>
<p>R contains a number of built-in datasets that are stored as dataframes. For example, the <code>mtcars</code> dataset contains information on automobile design and performance for 32 automobiles:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">class</span>(mtcars)
<span class="co">#&gt; [1] &quot;data.frame&quot;</span>
<span class="kw">head</span>(mtcars)
<span class="co">#&gt;                    mpg cyl disp  hp drat   wt qsec vs am gear carb</span>
<span class="co">#&gt; Mazda RX4         21.0   6  160 110 3.90 2.62 16.5  0  1    4    4</span>
<span class="co">#&gt; Mazda RX4 Wag     21.0   6  160 110 3.90 2.88 17.0  0  1    4    4</span>
<span class="co">#&gt; Datsun 710        22.8   4  108  93 3.85 2.32 18.6  1  1    4    1</span>
<span class="co">#&gt; Hornet 4 Drive    21.4   6  258 110 3.08 3.21 19.4  1  0    3    1</span>
<span class="co">#&gt; Hornet Sportabout 18.7   8  360 175 3.15 3.44 17.0  0  0    3    2</span>
<span class="co">#&gt; Valiant           18.1   6  225 105 2.76 3.46 20.2  1  0    3    1</span></code></pre></div>
<p>We also create dataframes when we import data through <code>read.csv</code> or other data file input. We’ll talk more about importing data later in the class.</p>
<p>We can create a dataframe from scratch using <code>data.frame()</code>. This function takes vectors as input:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Definition of vectors</span>
name &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Mercury&quot;</span>, <span class="st">&quot;Venus&quot;</span>, <span class="st">&quot;Earth&quot;</span>, <span class="st">&quot;Mars&quot;</span>, <span class="st">&quot;Jupiter&quot;</span>, <span class="st">&quot;Saturn&quot;</span>, <span class="st">&quot;Uranus&quot;</span>, <span class="st">&quot;Neptune&quot;</span>)
type &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Terrestrial planet&quot;</span>, <span class="st">&quot;Terrestrial planet&quot;</span>, <span class="st">&quot;Terrestrial planet&quot;</span>, <span class="st">&quot;Terrestrial planet&quot;</span>, <span class="st">&quot;Gas giant&quot;</span>, <span class="st">&quot;Gas giant&quot;</span>, <span class="st">&quot;Gas giant&quot;</span>, <span class="st">&quot;Gas giant&quot;</span>)
diameter &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.382</span>, <span class="fl">0.949</span>, <span class="dv">1</span>, <span class="fl">0.532</span>, <span class="fl">11.209</span>, <span class="fl">9.449</span>, <span class="fl">4.007</span>, <span class="fl">3.883</span>)
rings &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="ot">FALSE</span>, <span class="ot">FALSE</span>, <span class="ot">FALSE</span>, <span class="ot">FALSE</span>, <span class="ot">TRUE</span>, <span class="ot">TRUE</span>, <span class="ot">TRUE</span>, <span class="ot">TRUE</span>)

planets &lt;-<span class="st"> </span><span class="kw">data.frame</span>(name, type, diameter, rings)
planets
<span class="co">#&gt;      name               type diameter rings</span>
<span class="co">#&gt; 1 Mercury Terrestrial planet    0.382 FALSE</span>
<span class="co">#&gt; 2   Venus Terrestrial planet    0.949 FALSE</span>
<span class="co">#&gt; 3   Earth Terrestrial planet    1.000 FALSE</span>
<span class="co">#&gt; 4    Mars Terrestrial planet    0.532 FALSE</span>
<span class="co">#&gt; 5 Jupiter          Gas giant   11.209  TRUE</span>
<span class="co">#&gt; 6  Saturn          Gas giant    9.449  TRUE</span>
<span class="co">#&gt; 7  Uranus          Gas giant    4.007  TRUE</span>
<span class="co">#&gt; 8 Neptune          Gas giant    3.883  TRUE</span></code></pre></div>
<p>Beware: <code>data.frame()</code>’s default behaviour turns strings into factors. Use <code>stringAsFactors = FALSE</code> to suppress this behaviour as needed:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">planets &lt;-<span class="st"> </span><span class="kw">data.frame</span>(name, type, diameter, rings, <span class="dt">stringsAsFactors =</span> F)
planets
<span class="co">#&gt;      name               type diameter rings</span>
<span class="co">#&gt; 1 Mercury Terrestrial planet    0.382 FALSE</span>
<span class="co">#&gt; 2   Venus Terrestrial planet    0.949 FALSE</span>
<span class="co">#&gt; 3   Earth Terrestrial planet    1.000 FALSE</span>
<span class="co">#&gt; 4    Mars Terrestrial planet    0.532 FALSE</span>
<span class="co">#&gt; 5 Jupiter          Gas giant   11.209  TRUE</span>
<span class="co">#&gt; 6  Saturn          Gas giant    9.449  TRUE</span>
<span class="co">#&gt; 7  Uranus          Gas giant    4.007  TRUE</span>
<span class="co">#&gt; 8 Neptune          Gas giant    3.883  TRUE</span></code></pre></div>
</div>
<div id="the-structure-of-dataframes" class="section level3">
<h3><span class="header-section-number">6.5.2</span> The Structure of Dataframes</h3>
<p>Under the hood, a dataframe is a list of equal-length vectors. This makes it a 2-dimensional structure, so it shares properties of both the matrix and the list.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">vec1 &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">3</span>
vec2 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>)
df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(vec1, vec2)

<span class="kw">str</span>(df)
<span class="co">#&gt; &#39;data.frame&#39;:    3 obs. of  2 variables:</span>
<span class="co">#&gt;  $ vec1: int  1 2 3</span>
<span class="co">#&gt;  $ vec2: Factor w/ 3 levels &quot;a&quot;,&quot;b&quot;,&quot;c&quot;: 1 2 3</span></code></pre></div>
<p>The <code>length()</code> of a dataframe is the length of the underlying list and so is the same as <code>ncol()</code>; <code>nrow()</code> gives the number of rows.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">vec1 &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">3</span>
vec2 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>)
df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(vec1, vec2)

<span class="co"># these two are equivalent - number of columns</span>
<span class="kw">length</span>(df)
<span class="co">#&gt; [1] 2</span>
<span class="kw">ncol</span>(df)
<span class="co">#&gt; [1] 2</span>

<span class="co"># get number of rows</span>
<span class="kw">nrow</span>(df)
<span class="co">#&gt; [1] 3</span>

<span class="co"># get number of both columns and rows</span>
<span class="kw">dim</span>(df)
<span class="co">#&gt; [1] 3 2</span></code></pre></div>
</div>
<div id="naming-dataframes" class="section level3">
<h3><span class="header-section-number">6.5.3</span> Naming Dataframes</h3>
<p>Like matrices, dataframes have <code>colnames()</code>, and <code>rownames()</code>. However, since dataframes are really lists (of vectors) under the hood <code>names()</code> and <code>colnames()</code> are the same thing.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">vec1 &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">3</span>
vec2 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>)
df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(vec1, vec2)

<span class="co"># these two are equivalent</span>
<span class="kw">names</span>(df)
<span class="co">#&gt; [1] &quot;vec1&quot; &quot;vec2&quot;</span>
<span class="kw">colnames</span>(df)
<span class="co">#&gt; [1] &quot;vec1&quot; &quot;vec2&quot;</span>

<span class="co"># change the colnames</span>
<span class="kw">colnames</span>(df) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Number&quot;</span>, <span class="st">&quot;Character&quot;</span>)
df
<span class="co">#&gt;   Number Character</span>
<span class="co">#&gt; 1      1         a</span>
<span class="co">#&gt; 2      2         b</span>
<span class="co">#&gt; 3      3         c</span>

<span class="kw">names</span>(df) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Number&quot;</span>, <span class="st">&quot;Character&quot;</span>)
df
<span class="co">#&gt;   Number Character</span>
<span class="co">#&gt; 1      1         a</span>
<span class="co">#&gt; 2      2         b</span>
<span class="co">#&gt; 3      3         c</span>

<span class="co"># change the rownames</span>
<span class="kw">rownames</span>(df) 
<span class="co">#&gt; [1] &quot;1&quot; &quot;2&quot; &quot;3&quot;</span>
<span class="kw">rownames</span>(df) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;donut&quot;</span>, <span class="st">&quot;pickle&quot;</span>, <span class="st">&quot;pretzel&quot;</span>)
df
<span class="co">#&gt;         Number Character</span>
<span class="co">#&gt; donut        1         a</span>
<span class="co">#&gt; pickle       2         b</span>
<span class="co">#&gt; pretzel      3         c</span></code></pre></div>
</div>
<div id="coercing-dataframes" class="section level3">
<h3><span class="header-section-number">6.5.4</span> Coercing Dataframes</h3>
<p>Coerce an object to a dataframe with <code>as.data.frame()</code>:</p>
<ul>
<li><p>A vector will create a one-column dataframe.</p></li>
<li><p>A list will create one column for each element; it’s an error if they’re not all the same length.</p></li>
<li><p>A matrix will create a data frame with the same number of columns and rows as the matrix.</p></li>
</ul>
</div>
<div id="challenges-8" class="section level3">
<h3><span class="header-section-number">6.5.5</span> Challenges</h3>
<div id="challenge-1.-create-a-3x2-data-frame-called-basket.-the-first-column-should-contain-the-names-of-3-fruits.-the-second-column-should-contain-the-price-of-those-fruits." class="section level4 unnumbered">
<h4>Challenge 1. Create a 3x2 data frame called <code>basket</code>. The first column should contain the names of 3 fruits. The second column should contain the price of those fruits.</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
fruit =<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;apples&quot;</span>, <span class="st">&quot;orange&quot;</span>, <span class="st">&quot;bananas&quot;</span>)
price =<span class="st"> </span><span class="kw">c</span>(.<span class="dv">89</span>, .<span class="dv">99</span>, <span class="fl">1.00</span>)

basket &lt;-<span class="st"> </span><span class="kw">data.frame</span>(_____, ______) <span class="co"># add your vectors here</span>
<span class="kw">class</span>(basket)

<span class="kw">data.frame</span>(<span class="dt">fruit =</span> <span class="kw">c</span>(<span class="st">&quot;apples&quot;</span>, <span class="st">&quot;orange&quot;</span>, <span class="st">&quot;bananas&quot;</span>), <span class="dt">price =</span> <span class="kw">c</span>(.<span class="dv">89</span>, .<span class="dv">99</span>, <span class="fl">1.00</span>))

basket

<span class="kw">names</span>(basket)
<span class="kw">colnames</span>(basket)</code></pre></div>
</div>
<div id="challenge-2.-now-give-your-dataframe-appropriate-column-and-row-names." class="section level4 unnumbered">
<h4>Challenge 2. Now give your dataframe appropriate column and row names.</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span>(basket) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;name&quot;</span>, <span class="st">&quot;price&quot;</span>)
<span class="kw">names</span>(basket)</code></pre></div>
</div>
<div id="challenge-3.-add-a-third-column-called-color-that-tells-me-what-color-each-fruit-is." class="section level4 unnumbered">
<h4>Challenge 3. Add a third column called <code>color</code>, that tells me what color each fruit is.</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
color =<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;_______&quot;</span>, <span class="st">&quot;_______&quot;</span>, <span class="st">&quot;_______&quot;</span>)

<span class="kw">data.frame</span>(basket, color)

<span class="kw">cbind</span>(basket, color)</code></pre></div>
</div>
</div>
<div id="quiz" class="section level3">
<h3><span class="header-section-number">6.5.6</span> Quiz</h3>
<p>You can check your answers in <a href="#data-structure-answers">answers</a>.</p>
<ol style="list-style-type: decimal">
<li><p>How is a list different from an vector?</p></li>
<li><p>What are the four common types of vectors?</p></li>
<li><p>What are names? How do you get them and set them?</p></li>
<li><p>How is a matrix different from a data frame?</p></li>
</ol>
</div>
<div id="data-structure-answers" class="section level3">
<h3><span class="header-section-number">6.5.7</span> Answers</h3>
<ol style="list-style-type: decimal">
<li><p>The elements of a list can be any type (even a list); the elements of an atomic vector are all of the same type.</p></li>
<li><p>The four common types of vector are logical, integer, double (sometimes called numeric), and character.</p></li>
<li><p>Names allow you to attach labels to values. You can get and set individual names with <code>names(x)</code> and <code>names(x) &lt;- c(&quot;x&quot;, &quot;y&quot;, ...)</code>.</p></li>
<li><p>Every element of a matrix must be the same type; in a data frame, the different columns can have different types.</p></li>
</ol>
<!--chapter:end:04_R-Objects/04-5_Data-frames.Rmd-->
</div>
</div>
</div>
<div id="subsetting" class="section level1">
<h1><span class="header-section-number">7</span> Subsetting</h1>
<p>When working with data, you’ll need to subset objects early and often. Luckily, R’s subsetting operators are powerful and fast. Mastery of subsetting allows you to succinctly express complex operations in a way that few other languages can match. Subsetting is hard to learn because you need to master a number of interrelated concepts:</p>
<ul>
<li><p>The three subsetting operators: <code>[</code>, <code>[[</code>, and <code>$</code>.</p></li>
<li><p>The four types of subsetting.</p></li>
<li><p>The important differences in behaviour for different objects (e.g., vectors, lists, factors, matrices, and data frames).</p></li>
<li><p>The use of subsetting in conjunction with assignment.</p></li>
</ul>
<p>This unit helps you master subsetting by starting with the simplest type of subsetting: subsetting an atomic vector with <code>[</code>. It then gradually extends your knowledge, first to more complicated data types (like dataframes and lists), and then to the other subsetting operators, <code>[[</code> and <code>$</code>. You’ll then learn how subsetting and assignment can be combined to modify parts of an object, and, finally, you’ll see a large number of useful applications.</p>
<div id="subsetting-vectors" class="section level2">
<h2><span class="header-section-number">7.1</span> Subsetting Vectors</h2>
<p>It’s easiest to learn how subsetting works for vectors, and then how it generalises to higher dimensions and other more complicated objects. We’ll start with <code>[</code>, the most commonly used operator.</p>
<div id="subsetting-types" class="section level3">
<h3><span class="header-section-number">7.1.1</span> Subsetting Types</h3>
<p>Let’s explore the different types of subsetting with a simple vector, <code>x</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">2.1</span>, <span class="fl">4.2</span>, <span class="fl">3.3</span>, <span class="fl">5.4</span>)</code></pre></div>
<p>Note that the number after the decimal point gives the original position in the vector.</p>
<p>There are four things you can use to subset a vector:</p>
<div id="positive-integers-return-elements-at-the-specified-positions" class="section level4 unnumbered">
<h4>1. <strong>Positive integers</strong> return elements at the specified positions:</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">2.1</span>, <span class="fl">4.2</span>, <span class="fl">3.3</span>, <span class="fl">5.4</span>))
<span class="co">#&gt; [1] 2.1 4.2 3.3 5.4</span>
x[<span class="dv">1</span>]
<span class="co">#&gt; [1] 2.1</span></code></pre></div>
<p>We can also index multiple values by passing a vector of integers:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">2.1</span>, <span class="fl">4.2</span>, <span class="fl">3.3</span>, <span class="fl">5.4</span>))
<span class="co">#&gt; [1] 2.1 4.2 3.3 5.4</span>
x[<span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">1</span>)]
<span class="co">#&gt; [1] 3.3 2.1</span>

<span class="co"># Duplicated indices yield duplicated values</span>
x[<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>)]
<span class="co">#&gt; [1] 2.1 2.1</span></code></pre></div>
<p>Note that you <em>have</em> to use <code>c</code> inside the <code>[</code> for this to work!</p>
<p>More examples:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># `order(x)` gives the index positions of smallest to largest values.</span>
(x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">2.1</span>, <span class="fl">4.2</span>, <span class="fl">3.3</span>, <span class="fl">5.4</span>))
<span class="co">#&gt; [1] 2.1 4.2 3.3 5.4</span>
<span class="kw">order</span>(x)
<span class="co">#&gt; [1] 1 3 2 4</span>

<span class="co"># use this to order values.</span>
x[<span class="kw">order</span>(x)]
<span class="co">#&gt; [1] 2.1 3.3 4.2 5.4</span>
x[<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">4</span>)]
<span class="co">#&gt; [1] 2.1 3.3 4.2 5.4</span></code></pre></div>
</div>
<div id="negative-integers-omit-elements-at-the-specified-positions" class="section level4 unnumbered">
<h4>2. <strong>Negative integers</strong> omit elements at the specified positions:</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">2.1</span>, <span class="fl">4.2</span>, <span class="fl">3.3</span>, <span class="fl">5.4</span>)
x[<span class="op">-</span><span class="dv">1</span>]
<span class="co">#&gt; [1] 4.2 3.3 5.4</span>
x[<span class="op">-</span><span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">1</span>)]
<span class="co">#&gt; [1] 4.2 5.4</span></code></pre></div>
<p>You can’t mix positive and negative integers in a single subset:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">2.1</span>, <span class="fl">4.2</span>, <span class="fl">3.3</span>, <span class="fl">5.4</span>)
x[<span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">2</span>)]
<span class="co">#&gt; Error in x[c(-1, 2)]: only 0&#39;s may be mixed with negative subscripts</span></code></pre></div>
</div>
<div id="character-vectors-return-elements-with-matching-names.-this-only-works-if-the-vector-is-named." class="section level4 unnumbered">
<h4>3. <strong>Character vectors</strong> return elements with matching names. This only works if the vector is named.</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">2.1</span>, <span class="fl">4.2</span>, <span class="fl">3.3</span>, <span class="fl">5.4</span>)

<span class="co"># apply names</span>
<span class="kw">names</span>(x) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>, <span class="st">&quot;d&quot;</span>)

<span class="co"># subset using names</span>
x[<span class="kw">c</span>(<span class="st">&quot;d&quot;</span>, <span class="st">&quot;c&quot;</span>, <span class="st">&quot;a&quot;</span>)]
<span class="co">#&gt;   d   c   a </span>
<span class="co">#&gt; 5.4 3.3 2.1</span>

<span class="co"># Like integer indices, you can repeat indices</span>
x[<span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;a&quot;</span>, <span class="st">&quot;a&quot;</span>)]
<span class="co">#&gt;   a   a   a </span>
<span class="co">#&gt; 2.1 2.1 2.1</span>

<span class="co"># Careful! Names are always matched exactly</span>
x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">abc =</span> <span class="dv">1</span>, <span class="dt">def =</span> <span class="dv">2</span>)
x[<span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;d&quot;</span>)]
<span class="co">#&gt; &lt;NA&gt; &lt;NA&gt; </span>
<span class="co">#&gt;   NA   NA</span></code></pre></div>
</div>
<div id="logical-vectors-select-elements-where-the-corresponding-logical-value-is-true." class="section level4 unnumbered">
<h4>4. <strong>Logical vectors</strong> select elements where the corresponding logical value is <code>TRUE</code>.</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">2.1</span>, <span class="fl">4.2</span>, <span class="fl">3.3</span>, <span class="fl">5.4</span>)
x[<span class="kw">c</span>(<span class="ot">TRUE</span>, <span class="ot">TRUE</span>, <span class="ot">FALSE</span>, <span class="ot">FALSE</span>)]
<span class="co">#&gt; [1] 2.1 4.2</span></code></pre></div>
</div>
</div>
<div id="conditional-subsetting" class="section level3">
<h3><span class="header-section-number">7.1.2</span> Conditional Subsetting</h3>
<p>Logical subsetting is the most useful type of subsetting, because you use it to subset based on <strong>conditional</strong> or <strong>comparative</strong> statements.</p>
<p>The (logical) comparison operators known to R are:</p>
<ul>
<li><code>&lt;</code> for less than</li>
<li><code>&gt;</code> for greater than</li>
<li><code>&lt;=</code> for less than or equal to</li>
<li><code>&gt;=</code> for greater than or equal to</li>
<li><code>==</code> for equal to each other</li>
<li><code>!=</code> not equal to each other</li>
</ul>
<p>The nice thing about R is that you can use these comparison operators also on vectors. For example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">2.1</span>, <span class="fl">4.2</span>, <span class="fl">3.3</span>, <span class="fl">5.4</span>)
x <span class="op">&gt;</span><span class="st"> </span><span class="dv">3</span>
<span class="co">#&gt; [1] FALSE  TRUE  TRUE  TRUE</span></code></pre></div>
<p>This command tests for every element of the vector if the condition stated by the comparison operator is <code>TRUE</code> or <code>FALSE</code>. And it returns a logical vector!</p>
<p>We can now pass this statement between the square brackets that follow <code>x</code> to subset only those items that match <code>TRUE</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x[x <span class="op">&gt;</span><span class="st"> </span><span class="dv">3</span>]
<span class="co">#&gt; [1] 4.2 3.3 5.4</span></code></pre></div>
<p>You can combine conditional statements with <code>&amp;</code> (and), <code>|</code> (or), and <code>!</code> (not)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">2.1</span>, <span class="fl">4.2</span>, <span class="fl">3.3</span>, <span class="fl">5.4</span>)

<span class="co"># combing two conditional statements with &amp;</span>
x <span class="op">&gt;</span><span class="st"> </span><span class="dv">3</span> <span class="op">&amp;</span><span class="st"> </span>x <span class="op">&lt;</span><span class="st"> </span><span class="dv">5</span>
<span class="co">#&gt; [1] FALSE  TRUE  TRUE FALSE</span>
x[x <span class="op">&gt;</span><span class="st"> </span><span class="dv">3</span> <span class="op">&amp;</span><span class="st"> </span>x <span class="op">&lt;</span><span class="st"> </span><span class="dv">5</span>]
<span class="co">#&gt; [1] 4.2 3.3</span>

<span class="co"># combing two conditional statements with |</span>
x <span class="op">&lt;</span><span class="st"> </span><span class="dv">3</span> <span class="op">|</span><span class="st"> </span>x <span class="op">&gt;</span><span class="st"> </span><span class="dv">5</span> 
<span class="co">#&gt; [1]  TRUE FALSE FALSE  TRUE</span>
x[x <span class="op">&lt;</span><span class="st"> </span><span class="dv">3</span> <span class="op">|</span><span class="st"> </span>x <span class="op">&gt;</span><span class="st"> </span><span class="dv">5</span>]
<span class="co">#&gt; [1] 2.1 5.4</span>

<span class="co"># combining conditional statements with !</span>
<span class="op">!</span>x <span class="op">&gt;</span><span class="st"> </span><span class="dv">5</span> 
<span class="co">#&gt; [1]  TRUE  TRUE  TRUE FALSE</span>
x[<span class="op">!</span>x <span class="op">&gt;</span><span class="st"> </span><span class="dv">5</span>]
<span class="co">#&gt; [1] 2.1 4.2 3.3</span></code></pre></div>
<p>Another way to generate implicit conditional statements is using the <code>%in%</code> operator, which tests whether an item is in a set:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">2.1</span>, <span class="fl">4.2</span>, <span class="fl">3.3</span>, <span class="fl">5.4</span>)

<span class="co"># generate implicit logical vectors through the %in% operator</span>
x <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="fl">3.3</span>, <span class="fl">4.2</span>)
<span class="co">#&gt; [1] FALSE  TRUE  TRUE FALSE</span>
x[x <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="fl">3.3</span>, <span class="fl">4.2</span>)]
<span class="co">#&gt; [1] 4.2 3.3</span></code></pre></div>
</div>
<div id="challenge-1" class="section level3">
<h3><span class="header-section-number">7.1.3</span> Challenge</h3>
<p>Subset <code>country.vector</code> below to return every value EXCEPT “Canada” and “Brazil” {-}</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">country.vector&lt;-<span class="kw">c</span>(<span class="st">&quot;Afghanistan&quot;</span>, <span class="st">&quot;Canada&quot;</span>, <span class="st">&quot;Sierra Leone&quot;</span>, <span class="st">&quot;Denmark&quot;</span>, <span class="st">&quot;Japan&quot;</span>, <span class="st">&quot;Brazil&quot;</span>)

<span class="co"># Do it using positive integers</span>

<span class="co"># Do it using negative integers</span>

<span class="co"># Do it using a logical vector</span>

<span class="co"># Do it using a conditional statement (and an implicit logical vector)</span></code></pre></div>
<p>Solution:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">country.vector&lt;-<span class="kw">c</span>(<span class="st">&quot;Afghanistan&quot;</span>, <span class="st">&quot;Canada&quot;</span>, <span class="st">&quot;Sierra Leone&quot;</span>, <span class="st">&quot;Denmark&quot;</span>, <span class="st">&quot;Japan&quot;</span>, <span class="st">&quot;Brazil&quot;</span>)

<span class="co"># Do it using positive integers</span>
country.vector[<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>)]

<span class="co"># Do it using negative integers</span>
country.vector[<span class="op">-</span><span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">6</span>)]

<span class="co"># Do it using a logical vector</span>
country.vector[<span class="kw">c</span>(<span class="ot">TRUE</span>, <span class="ot">FALSE</span>, <span class="ot">TRUE</span>, <span class="ot">TRUE</span>, <span class="ot">TRUE</span>, <span class="ot">FALSE</span>)]

<span class="co"># Do it using a conditional statement (and an implicit logical vector)</span>
country.vector[<span class="op">!</span>country.vector <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Canada&quot;</span>, <span class="st">&quot;Brazil&quot;</span>)]</code></pre></div>
<!--chapter:end:05_Subsetting/05-1_Substetting-Types.Rmd-->
</div>
</div>
<div id="subsetting-lists" class="section level2">
<h2><span class="header-section-number">7.2</span> Subsetting Lists</h2>
<p>Subsetting a list works in the same way as subsetting an atomic vector. However, there’s one important difference: <code>[</code> will always return a list. <code>[[</code> and <code>$</code>, as described below, let you pull out the components of the list.</p>
<p>Let’s illustrate with the following list <code>my_list</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_list &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">a =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="dt">b =</span> <span class="st">&quot;a string&quot;</span>, <span class="dt">c =</span> pi, <span class="dt">d =</span> <span class="kw">list</span>(<span class="op">-</span><span class="dv">1</span>, <span class="op">-</span><span class="dv">5</span>))</code></pre></div>
<div id="with" class="section level3">
<h3><span class="header-section-number">7.2.1</span> With <code>[</code></h3>
<p><code>[</code> extracts a sub-list where the result will always be a list. Like with vectors, you can subset with a logical, integer, or character vector.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_list[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>]
<span class="co">#&gt; $a</span>
<span class="co">#&gt; [1] 1 2 3</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $b</span>
<span class="co">#&gt; [1] &quot;a string&quot;</span>
<span class="kw">str</span>(my_list[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>])
<span class="co">#&gt; List of 2</span>
<span class="co">#&gt;  $ a: int [1:3] 1 2 3</span>
<span class="co">#&gt;  $ b: chr &quot;a string&quot;</span>

my_list[<span class="dv">4</span>]
<span class="co">#&gt; $d</span>
<span class="co">#&gt; $d[[1]]</span>
<span class="co">#&gt; [1] -1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $d[[2]]</span>
<span class="co">#&gt; [1] -5</span>
<span class="kw">str</span>(my_list[<span class="dv">4</span>])
<span class="co">#&gt; List of 1</span>
<span class="co">#&gt;  $ d:List of 2</span>
<span class="co">#&gt;   ..$ : num -1</span>
<span class="co">#&gt;   ..$ : num -5</span>

my_list[<span class="st">&quot;a&quot;</span>]
<span class="co">#&gt; $a</span>
<span class="co">#&gt; [1] 1 2 3</span>
<span class="kw">str</span>(my_list[<span class="st">&quot;a&quot;</span>])
<span class="co">#&gt; List of 1</span>
<span class="co">#&gt;  $ a: int [1:3] 1 2 3</span></code></pre></div>
</div>
<div id="with-1" class="section level3">
<h3><span class="header-section-number">7.2.2</span> With <code>[[</code></h3>
<p><code>[[</code> extracts a single <em>component</em> from a list. In other words, it removes that hierarchy and returns whatever object is stored inside.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_list[[<span class="dv">1</span>]]
<span class="co">#&gt; [1] 1 2 3</span>
<span class="kw">str</span>(my_list[[<span class="dv">1</span>]])
<span class="co">#&gt;  int [1:3] 1 2 3</span>

<span class="co"># compare to</span>
my_list[<span class="dv">1</span>]
<span class="co">#&gt; $a</span>
<span class="co">#&gt; [1] 1 2 3</span>
<span class="kw">str</span>(my_list[<span class="dv">1</span>])
<span class="co">#&gt; List of 1</span>
<span class="co">#&gt;  $ a: int [1:3] 1 2 3</span></code></pre></div>
<p>The distinction between <code>[</code> and <code>[[</code> is really important for lists, because <code>[[</code> drills down into the list while <code>[</code> returns a new, smaller list.</p>
<blockquote>
<p>“If list <code>x</code> is a train carrying objects, then <code>x[[5]]</code> is the object in car 5; <code>x[4:6]</code> is a train of cars 4-6.”</p>
<p>— <span class="citation">(<span class="citeproc-not-found" data-reference-id="RLangTip"><strong>???</strong></span>)</span></p>
</blockquote>
</div>
<div id="with-2" class="section level3">
<h3><span class="header-section-number">7.2.3</span> with <code>$</code></h3>
<p><code>$</code> is a shorthand for extracting named elements of a list. It works similarly to <code>[[</code> except that you don’t need to use quotes.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_list<span class="op">$</span>a
<span class="co">#&gt; [1] 1 2 3</span>

<span class="co"># same as</span>
my_list[[<span class="st">&quot;a&quot;</span>]]
<span class="co">#&gt; [1] 1 2 3</span></code></pre></div>
<p>The <code>$</code> operator becomes especially helpful when applied to dataframes, explained more below.</p>
</div>
<div id="challenge-2" class="section level3">
<h3><span class="header-section-number">7.2.4</span> Challenge</h3>
<p>Take a look at the linear model below:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mod &lt;-<span class="st"> </span><span class="kw">lm</span>(mpg <span class="op">~</span><span class="st"> </span>wt, <span class="dt">data =</span> mtcars)
<span class="kw">summary</span>(mod)
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; lm(formula = mpg ~ wt, data = mtcars)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Residuals:</span>
<span class="co">#&gt;    Min     1Q Median     3Q    Max </span>
<span class="co">#&gt; -4.543 -2.365 -0.125  1.410  6.873 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients:</span>
<span class="co">#&gt;             Estimate Std. Error t value Pr(&gt;|t|)    </span>
<span class="co">#&gt; (Intercept)   37.285      1.878   19.86  &lt; 2e-16 ***</span>
<span class="co">#&gt; wt            -5.344      0.559   -9.56  1.3e-10 ***</span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Residual standard error: 3.05 on 30 degrees of freedom</span>
<span class="co">#&gt; Multiple R-squared:  0.753,  Adjusted R-squared:  0.745 </span>
<span class="co">#&gt; F-statistic: 91.4 on 1 and 30 DF,  p-value: 1.29e-10</span></code></pre></div>
<p>Extract the R squared from the model summary.</p>
<p>Solution:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mod.sum &lt;-<span class="st"> </span><span class="kw">summary</span>(mod)
mod.sum<span class="op">$</span>r.squared
<span class="co">#&gt; [1] 0.753</span></code></pre></div>
</div>
</div>
<div id="subsetting-matrices" class="section level2">
<h2><span class="header-section-number">7.3</span> Subsetting Matrices</h2>
<p>Similar to vectors, you can use the square brackets <code>[ ]</code> to select one or multiple elements from a matrix. But whereas vectors have one dimension, matrices have two dimensions. We therefore have to use two subsetting vectors – one for rows to select, another for columns – separated by a comma.</p>
<p>Check out the following matrix:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">a &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">9</span>, <span class="dt">nrow =</span> <span class="dv">3</span>)
<span class="kw">colnames</span>(a) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;C&quot;</span>)
a
<span class="co">#&gt;      A B C</span>
<span class="co">#&gt; [1,] 1 4 7</span>
<span class="co">#&gt; [2,] 2 5 8</span>
<span class="co">#&gt; [3,] 3 6 9</span></code></pre></div>
<p>We can subset this matrix by passing two subsetting vectors: one to select rows, another to select columns:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># selects the value at the first row and second column</span>
a[<span class="dv">1</span>, <span class="dv">2</span>] 
<span class="co">#&gt; B </span>
<span class="co">#&gt; 4</span>

<span class="co"># selects first row, and the first and third columns</span>
a[<span class="dv">1</span>, <span class="op">-</span><span class="dv">2</span>] 
<span class="co">#&gt; A C </span>
<span class="co">#&gt; 1 7</span>

<span class="co"># selects first two rows, and the first and third columns</span>
a[<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>)] 
<span class="co">#&gt;      A C</span>
<span class="co">#&gt; [1,] 1 7</span>
<span class="co">#&gt; [2,] 2 8</span></code></pre></div>
<p>Blank subsetting is also useful because it lets you keep all rows or all columns.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">a[<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), ] <span class="co"># selects first two rows and all columns</span>
<span class="co">#&gt;      A B C</span>
<span class="co">#&gt; [1,] 1 4 7</span>
<span class="co">#&gt; [2,] 2 5 8</span></code></pre></div>
<!--chapter:end:05_Subsetting/05-2_Lists-Matrices.Rmd-->
</div>
<div id="subsetting-dataframes" class="section level2">
<h2><span class="header-section-number">7.4</span> Subsetting Dataframes</h2>
<p>Data from data frames can be addressed like matrices, using two vectors separated by a comma.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Definition of vectors</span>
name &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Mercury&quot;</span>, <span class="st">&quot;Venus&quot;</span>, <span class="st">&quot;Earth&quot;</span>, <span class="st">&quot;Mars&quot;</span>, <span class="st">&quot;Jupiter&quot;</span>, <span class="st">&quot;Saturn&quot;</span>, <span class="st">&quot;Uranus&quot;</span>, <span class="st">&quot;Neptune&quot;</span>)
type &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Terrestrial planet&quot;</span>, <span class="st">&quot;Terrestrial planet&quot;</span>, <span class="st">&quot;Terrestrial planet&quot;</span>, <span class="st">&quot;Terrestrial planet&quot;</span>, <span class="st">&quot;Gas giant&quot;</span>, <span class="st">&quot;Gas giant&quot;</span>, <span class="st">&quot;Gas giant&quot;</span>, <span class="st">&quot;Gas giant&quot;</span>)
diameter &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.382</span>, <span class="fl">0.949</span>, <span class="dv">1</span>, <span class="fl">0.532</span>, <span class="fl">11.209</span>, <span class="fl">9.449</span>, <span class="fl">4.007</span>, <span class="fl">3.883</span>)
rings &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="ot">FALSE</span>, <span class="ot">FALSE</span>, <span class="ot">FALSE</span>, <span class="ot">FALSE</span>, <span class="ot">TRUE</span>, <span class="ot">TRUE</span>, <span class="ot">TRUE</span>, <span class="ot">TRUE</span>)

planets &lt;-<span class="st"> </span><span class="kw">data.frame</span>(name, type, diameter, rings, <span class="dt">stringsAsFactors =</span> F)
planets
<span class="co">#&gt;      name               type diameter rings</span>
<span class="co">#&gt; 1 Mercury Terrestrial planet    0.382 FALSE</span>
<span class="co">#&gt; 2   Venus Terrestrial planet    0.949 FALSE</span>
<span class="co">#&gt; 3   Earth Terrestrial planet    1.000 FALSE</span>
<span class="co">#&gt; 4    Mars Terrestrial planet    0.532 FALSE</span>
<span class="co">#&gt; 5 Jupiter          Gas giant   11.209  TRUE</span>
<span class="co">#&gt; 6  Saturn          Gas giant    9.449  TRUE</span>
<span class="co">#&gt; 7  Uranus          Gas giant    4.007  TRUE</span>
<span class="co">#&gt; 8 Neptune          Gas giant    3.883  TRUE</span></code></pre></div>
<p>Let’s try some subsetting now.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Print out diameter of Mercury (row 1, column 3)</span>
planets[<span class="dv">1</span>, <span class="dv">3</span>]
<span class="co">#&gt; [1] 0.382</span>

<span class="co"># Print out data for Mars (entire fourth row)</span>
planets[<span class="dv">4</span>, ]
<span class="co">#&gt;   name               type diameter rings</span>
<span class="co">#&gt; 4 Mars Terrestrial planet    0.532 FALSE</span>

<span class="co"># Print first two rows of the first two columns</span>
planets[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>]
<span class="co">#&gt;      name               type</span>
<span class="co">#&gt; 1 Mercury Terrestrial planet</span>
<span class="co">#&gt; 2   Venus Terrestrial planet</span></code></pre></div>
<div id="subsetting-names-and" class="section level3">
<h3><span class="header-section-number">7.4.1</span> Subsetting Names and <code>$</code></h3>
<p>Instead of using numerics to select elements of a data frame, you can also use the variable names to select columns of a data frame.</p>
<p>Suppose you want to select the first three elements of the type column. One way to do this is</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">planets[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="dv">2</span>]
<span class="co">#&gt; [1] &quot;Terrestrial planet&quot; &quot;Terrestrial planet&quot; &quot;Terrestrial planet&quot;</span></code></pre></div>
<p>A possible disadvantage of this approach is that you have to know (or look up) the column number of type, which gets hard if you have a lot of variables. It is often easier to just make use of the variable name:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">planets[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="st">&quot;type&quot;</span>]
<span class="co">#&gt; [1] &quot;Terrestrial planet&quot; &quot;Terrestrial planet&quot; &quot;Terrestrial planet&quot;</span></code></pre></div>
<p>You will often want to select an entire column, namely one specific variable from a data frame. If you want to select all elements of the variable “diameter”, for example, both of these will do the trick:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">planets[,<span class="dv">3</span>]
<span class="co">#&gt; [1]  0.382  0.949  1.000  0.532 11.209  9.449  4.007  3.883</span>
planets[,<span class="st">&quot;diameter&quot;</span>]
<span class="co">#&gt; [1]  0.382  0.949  1.000  0.532 11.209  9.449  4.007  3.883</span></code></pre></div>
<p>However, there is a short-cut. If your columns have names, you can use the <code>$</code> sign:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">planets<span class="op">$</span>diameter
<span class="co">#&gt; [1]  0.382  0.949  1.000  0.532 11.209  9.449  4.007  3.883</span></code></pre></div>
<p>Remember that datasets are really lists of vectors (one vector per column). Just as <code>list$name</code> selects the <code>name</code> element from the list, <code>df$name</code> selects the <code>name</code> column (vector) from the dataframe.</p>
</div>
<div id="conditional-subsetting-1" class="section level3">
<h3><span class="header-section-number">7.4.2</span> Conditional Subsetting</h3>
<p>What if we want to subset the dataset based on some condition? Let’s say we want to extract all the planets with a diameter greater than 3? We could inspect the dataset and record all the observations that fit that description, but that’s tedious and error prone.</p>
<p>There’s a better way! We can combine two powerful subsetting tools: the <code>$</code> operator and conditional subsetting.</p>
<p>First, we extract the <code>diameter</code> column.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">diameters &lt;-<span class="st"> </span>planets<span class="op">$</span>diameter</code></pre></div>
<p>Then, we find the elements that are greater than 3.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">diameters <span class="op">&gt;</span><span class="st"> </span><span class="dv">3</span>
<span class="co">#&gt; [1] FALSE FALSE FALSE FALSE  TRUE  TRUE  TRUE  TRUE</span></code></pre></div>
<p>It’s a boolean vector! We can now use this inside <code>[ , ]</code> to extract all plantes with <code>diameter &gt; 3</code>.</p>
<p>Think: Are we subsettings row or columns here?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">planets[diameters <span class="op">&gt;</span><span class="st"> </span><span class="dv">3</span>, ]
<span class="co">#&gt;      name      type diameter rings</span>
<span class="co">#&gt; 5 Jupiter Gas giant    11.21  TRUE</span>
<span class="co">#&gt; 6  Saturn Gas giant     9.45  TRUE</span>
<span class="co">#&gt; 7  Uranus Gas giant     4.01  TRUE</span>
<span class="co">#&gt; 8 Neptune Gas giant     3.88  TRUE</span>

<span class="co"># same as</span>
<span class="co"># planets[planets$diameter &gt; 3, ]</span></code></pre></div>
<p>Because it allows you to easily combine conditions from multiple columns, logical subsetting is probably the most commonly used technique for extracting rows out of a data frame.</p>
</div>
<div id="list-like-and-matrix-like-subsetting" class="section level3">
<h3><span class="header-section-number">7.4.3</span> List-Like and Matrix-Like Subsetting</h3>
<p>Data frames possess the characteristics of both lists and matrices: if you subset with a single vector, they behave like lists, and return only the columns.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x =</span> <span class="dv">4</span><span class="op">:</span><span class="dv">6</span>, <span class="dt">y =</span> <span class="dv">3</span><span class="op">:</span><span class="dv">1</span>, <span class="dt">z =</span> letters[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>])

<span class="co"># Like a list:</span>
df[<span class="kw">c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;z&quot;</span>)]
<span class="co">#&gt;   x z</span>
<span class="co">#&gt; 1 4 a</span>
<span class="co">#&gt; 2 5 b</span>
<span class="co">#&gt; 3 6 c</span>

<span class="co"># Like a matrix</span>
df[, <span class="kw">c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;z&quot;</span>)]
<span class="co">#&gt;   x z</span>
<span class="co">#&gt; 1 4 a</span>
<span class="co">#&gt; 2 5 b</span>
<span class="co">#&gt; 3 6 c</span></code></pre></div>
<p>But there’s an important difference when you select a single column: matrix subsetting simplifies by default, list subsetting does not.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x =</span> <span class="dv">4</span><span class="op">:</span><span class="dv">6</span>, <span class="dt">y =</span> <span class="dv">3</span><span class="op">:</span><span class="dv">1</span>, <span class="dt">z =</span> letters[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>])

<span class="co"># like a list</span>
df[<span class="st">&quot;x&quot;</span>]
<span class="co">#&gt;   x</span>
<span class="co">#&gt; 1 4</span>
<span class="co">#&gt; 2 5</span>
<span class="co">#&gt; 3 6</span>
<span class="kw">class</span>(df[<span class="st">&quot;x&quot;</span>])
<span class="co">#&gt; [1] &quot;data.frame&quot;</span>

<span class="co"># like a matrix</span>
df[, <span class="st">&quot;x&quot;</span>]
<span class="co">#&gt; [1] 4 5 6</span>
<span class="kw">class</span>(df[, <span class="st">&quot;x&quot;</span>])
<span class="co">#&gt; [1] &quot;integer&quot;</span></code></pre></div>
</div>
<div id="challenges-9" class="section level3">
<h3><span class="header-section-number">7.4.4</span> Challenges</h3>
<div id="challenge-1.-fix-each-of-the-following-common-data-frame-subsetting-errors" class="section level4 unnumbered">
<h4>Challenge 1. Fix each of the following common data frame subsetting errors:</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># check out what we&#39;re dealing with</span>
mtcars

<span class="co"># fix</span>
mtcars[mtcars<span class="op">$</span>cyl =<span class="st"> </span><span class="dv">4</span>, ]
mtcars[<span class="op">-</span><span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, ]
mtcars[mtcars<span class="op">$</span>cyl <span class="op">&lt;=</span><span class="st"> </span><span class="dv">5</span>]
mtcars[mtcars<span class="op">$</span>cyl <span class="op">==</span><span class="st"> </span><span class="dv">4</span> <span class="op">|</span><span class="st"> </span><span class="dv">6</span>, ]</code></pre></div>
<p>Solution:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mtcars[mtcars<span class="op">$</span>cyl <span class="op">==</span><span class="st"> </span><span class="dv">4</span>, ]
<span class="co">#&gt;                 mpg cyl  disp  hp drat   wt qsec vs am gear carb</span>
<span class="co">#&gt; Datsun 710     22.8   4 108.0  93 3.85 2.32 18.6  1  1    4    1</span>
<span class="co">#&gt; Merc 240D      24.4   4 146.7  62 3.69 3.19 20.0  1  0    4    2</span>
<span class="co">#&gt; Merc 230       22.8   4 140.8  95 3.92 3.15 22.9  1  0    4    2</span>
<span class="co">#&gt; Fiat 128       32.4   4  78.7  66 4.08 2.20 19.5  1  1    4    1</span>
<span class="co">#&gt; Honda Civic    30.4   4  75.7  52 4.93 1.61 18.5  1  1    4    2</span>
<span class="co">#&gt; Toyota Corolla 33.9   4  71.1  65 4.22 1.83 19.9  1  1    4    1</span>
<span class="co">#&gt; Toyota Corona  21.5   4 120.1  97 3.70 2.46 20.0  1  0    3    1</span>
<span class="co">#&gt; Fiat X1-9      27.3   4  79.0  66 4.08 1.94 18.9  1  1    4    1</span>
<span class="co">#&gt; Porsche 914-2  26.0   4 120.3  91 4.43 2.14 16.7  0  1    5    2</span>
<span class="co">#&gt; Lotus Europa   30.4   4  95.1 113 3.77 1.51 16.9  1  1    5    2</span>
<span class="co">#&gt; Volvo 142E     21.4   4 121.0 109 4.11 2.78 18.6  1  1    4    2</span>
mtcars[<span class="op">-</span><span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>), ]
<span class="co">#&gt;                      mpg cyl  disp  hp drat   wt qsec vs am gear carb</span>
<span class="co">#&gt; Hornet Sportabout   18.7   8 360.0 175 3.15 3.44 17.0  0  0    3    2</span>
<span class="co">#&gt; Valiant             18.1   6 225.0 105 2.76 3.46 20.2  1  0    3    1</span>
<span class="co">#&gt; Duster 360          14.3   8 360.0 245 3.21 3.57 15.8  0  0    3    4</span>
<span class="co">#&gt; Merc 240D           24.4   4 146.7  62 3.69 3.19 20.0  1  0    4    2</span>
<span class="co">#&gt; Merc 230            22.8   4 140.8  95 3.92 3.15 22.9  1  0    4    2</span>
<span class="co">#&gt; Merc 280            19.2   6 167.6 123 3.92 3.44 18.3  1  0    4    4</span>
<span class="co">#&gt; Merc 280C           17.8   6 167.6 123 3.92 3.44 18.9  1  0    4    4</span>
<span class="co">#&gt; Merc 450SE          16.4   8 275.8 180 3.07 4.07 17.4  0  0    3    3</span>
<span class="co">#&gt; Merc 450SL          17.3   8 275.8 180 3.07 3.73 17.6  0  0    3    3</span>
<span class="co">#&gt; Merc 450SLC         15.2   8 275.8 180 3.07 3.78 18.0  0  0    3    3</span>
<span class="co">#&gt; Cadillac Fleetwood  10.4   8 472.0 205 2.93 5.25 18.0  0  0    3    4</span>
<span class="co">#&gt; Lincoln Continental 10.4   8 460.0 215 3.00 5.42 17.8  0  0    3    4</span>
<span class="co">#&gt; Chrysler Imperial   14.7   8 440.0 230 3.23 5.34 17.4  0  0    3    4</span>
<span class="co">#&gt; Fiat 128            32.4   4  78.7  66 4.08 2.20 19.5  1  1    4    1</span>
<span class="co">#&gt; Honda Civic         30.4   4  75.7  52 4.93 1.61 18.5  1  1    4    2</span>
<span class="co">#&gt; Toyota Corolla      33.9   4  71.1  65 4.22 1.83 19.9  1  1    4    1</span>
<span class="co">#&gt; Toyota Corona       21.5   4 120.1  97 3.70 2.46 20.0  1  0    3    1</span>
<span class="co">#&gt; Dodge Challenger    15.5   8 318.0 150 2.76 3.52 16.9  0  0    3    2</span>
<span class="co">#&gt; AMC Javelin         15.2   8 304.0 150 3.15 3.44 17.3  0  0    3    2</span>
<span class="co">#&gt; Camaro Z28          13.3   8 350.0 245 3.73 3.84 15.4  0  0    3    4</span>
<span class="co">#&gt; Pontiac Firebird    19.2   8 400.0 175 3.08 3.85 17.1  0  0    3    2</span>
<span class="co">#&gt; Fiat X1-9           27.3   4  79.0  66 4.08 1.94 18.9  1  1    4    1</span>
<span class="co">#&gt; Porsche 914-2       26.0   4 120.3  91 4.43 2.14 16.7  0  1    5    2</span>
<span class="co">#&gt; Lotus Europa        30.4   4  95.1 113 3.77 1.51 16.9  1  1    5    2</span>
<span class="co">#&gt; Ford Pantera L      15.8   8 351.0 264 4.22 3.17 14.5  0  1    5    4</span>
<span class="co">#&gt; Ferrari Dino        19.7   6 145.0 175 3.62 2.77 15.5  0  1    5    6</span>
<span class="co">#&gt; Maserati Bora       15.0   8 301.0 335 3.54 3.57 14.6  0  1    5    8</span>
<span class="co">#&gt; Volvo 142E          21.4   4 121.0 109 4.11 2.78 18.6  1  1    4    2</span>
mtcars[mtcars<span class="op">$</span>cyl <span class="op">&lt;=</span><span class="st"> </span><span class="dv">5</span>,]
<span class="co">#&gt;                 mpg cyl  disp  hp drat   wt qsec vs am gear carb</span>
<span class="co">#&gt; Datsun 710     22.8   4 108.0  93 3.85 2.32 18.6  1  1    4    1</span>
<span class="co">#&gt; Merc 240D      24.4   4 146.7  62 3.69 3.19 20.0  1  0    4    2</span>
<span class="co">#&gt; Merc 230       22.8   4 140.8  95 3.92 3.15 22.9  1  0    4    2</span>
<span class="co">#&gt; Fiat 128       32.4   4  78.7  66 4.08 2.20 19.5  1  1    4    1</span>
<span class="co">#&gt; Honda Civic    30.4   4  75.7  52 4.93 1.61 18.5  1  1    4    2</span>
<span class="co">#&gt; Toyota Corolla 33.9   4  71.1  65 4.22 1.83 19.9  1  1    4    1</span>
<span class="co">#&gt; Toyota Corona  21.5   4 120.1  97 3.70 2.46 20.0  1  0    3    1</span>
<span class="co">#&gt; Fiat X1-9      27.3   4  79.0  66 4.08 1.94 18.9  1  1    4    1</span>
<span class="co">#&gt; Porsche 914-2  26.0   4 120.3  91 4.43 2.14 16.7  0  1    5    2</span>
<span class="co">#&gt; Lotus Europa   30.4   4  95.1 113 3.77 1.51 16.9  1  1    5    2</span>
<span class="co">#&gt; Volvo 142E     21.4   4 121.0 109 4.11 2.78 18.6  1  1    4    2</span>
mtcars[mtcars<span class="op">$</span>cyl <span class="op">==</span><span class="st"> </span><span class="dv">4</span> <span class="op">|</span><span class="st"> </span>mtcars<span class="op">$</span>cyl <span class="op">==</span><span class="st"> </span><span class="dv">6</span>, ]
<span class="co">#&gt;                 mpg cyl  disp  hp drat   wt qsec vs am gear carb</span>
<span class="co">#&gt; Mazda RX4      21.0   6 160.0 110 3.90 2.62 16.5  0  1    4    4</span>
<span class="co">#&gt; Mazda RX4 Wag  21.0   6 160.0 110 3.90 2.88 17.0  0  1    4    4</span>
<span class="co">#&gt; Datsun 710     22.8   4 108.0  93 3.85 2.32 18.6  1  1    4    1</span>
<span class="co">#&gt; Hornet 4 Drive 21.4   6 258.0 110 3.08 3.21 19.4  1  0    3    1</span>
<span class="co">#&gt; Valiant        18.1   6 225.0 105 2.76 3.46 20.2  1  0    3    1</span>
<span class="co">#&gt; Merc 240D      24.4   4 146.7  62 3.69 3.19 20.0  1  0    4    2</span>
<span class="co">#&gt; Merc 230       22.8   4 140.8  95 3.92 3.15 22.9  1  0    4    2</span>
<span class="co">#&gt; Merc 280       19.2   6 167.6 123 3.92 3.44 18.3  1  0    4    4</span>
<span class="co">#&gt; Merc 280C      17.8   6 167.6 123 3.92 3.44 18.9  1  0    4    4</span>
<span class="co">#&gt; Fiat 128       32.4   4  78.7  66 4.08 2.20 19.5  1  1    4    1</span>
<span class="co">#&gt; Honda Civic    30.4   4  75.7  52 4.93 1.61 18.5  1  1    4    2</span>
<span class="co">#&gt; Toyota Corolla 33.9   4  71.1  65 4.22 1.83 19.9  1  1    4    1</span>
<span class="co">#&gt; Toyota Corona  21.5   4 120.1  97 3.70 2.46 20.0  1  0    3    1</span>
<span class="co">#&gt; Fiat X1-9      27.3   4  79.0  66 4.08 1.94 18.9  1  1    4    1</span>
<span class="co">#&gt; Porsche 914-2  26.0   4 120.3  91 4.43 2.14 16.7  0  1    5    2</span>
<span class="co">#&gt; Lotus Europa   30.4   4  95.1 113 3.77 1.51 16.9  1  1    5    2</span>
<span class="co">#&gt; Ferrari Dino   19.7   6 145.0 175 3.62 2.77 15.5  0  1    5    6</span>
<span class="co">#&gt; Volvo 142E     21.4   4 121.0 109 4.11 2.78 18.6  1  1    4    2</span></code></pre></div>
</div>
<div id="challenge-2.-why-does-mtcars120-return-an-error-how-does-it-differ-from-the-similar-mtcars120" class="section level4 unnumbered">
<h4>Challenge 2. Why does <code>mtcars[1:20]</code> return an error? How does it differ from the similar <code>mtcars[1:20, ]</code>?</h4>
<!--chapter:end:05_Subsetting/05-3_Dataframes.Rmd-->
</div>
</div>
</div>
<div id="sub-assignment" class="section level2">
<h2><span class="header-section-number">7.5</span> Sub-assignment</h2>
<div id="basics-of-sub-assignment" class="section level3">
<h3><span class="header-section-number">7.5.1</span> Basics of Sub-assignment</h3>
<p>All subsetting operators can be combined with assignment to modify selected values of the input vector.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">5</span>
x[<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>)] &lt;-<span class="st"> </span><span class="dv">2</span><span class="op">:</span><span class="dv">3</span>
x
<span class="co">#&gt; [1] 2 3 3 4 5</span></code></pre></div>
<p>This is especially useful when conditionally modifying vectors. For example, let’s say we wanted to replace all values less than 3 with NA.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">5</span>
x[x <span class="op">&lt;</span><span class="st"> </span><span class="dv">3</span>] &lt;-<span class="st"> </span><span class="ot">NA</span>
x
<span class="co">#&gt; [1] NA NA  3  4  5</span></code></pre></div>
<p>This also works on dataframes. Let’s say we wanted to modify our <code>planets</code> dataframe.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Definition of vectors</span>
name &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Mercury&quot;</span>, <span class="st">&quot;Venus&quot;</span>, <span class="st">&quot;Earth&quot;</span>, <span class="st">&quot;Mars&quot;</span>, <span class="st">&quot;Jupiter&quot;</span>, <span class="st">&quot;Saturn&quot;</span>, <span class="st">&quot;Uranus&quot;</span>, <span class="st">&quot;Neptune&quot;</span>)
type &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Terrestrial planet&quot;</span>, <span class="st">&quot;Terrestrial planet&quot;</span>, <span class="st">&quot;Terrestrial planet&quot;</span>, <span class="st">&quot;Terrestrial planet&quot;</span>, <span class="st">&quot;Gas giant&quot;</span>, <span class="st">&quot;Gas giant&quot;</span>, <span class="st">&quot;Gas giant&quot;</span>, <span class="st">&quot;Gas giant&quot;</span>)
diameter &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.382</span>, <span class="fl">0.949</span>, <span class="dv">1</span>, <span class="fl">0.532</span>, <span class="fl">11.209</span>, <span class="fl">9.449</span>, <span class="fl">4.007</span>, <span class="fl">3.883</span>)
rings &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="ot">FALSE</span>, <span class="ot">FALSE</span>, <span class="ot">FALSE</span>, <span class="ot">FALSE</span>, <span class="ot">TRUE</span>, <span class="ot">TRUE</span>, <span class="ot">TRUE</span>, <span class="ot">TRUE</span>)

planets &lt;-<span class="st"> </span><span class="kw">data.frame</span>(name, type, diameter, rings, <span class="dt">stringsAsFactors =</span> F)
planets
<span class="co">#&gt;      name               type diameter rings</span>
<span class="co">#&gt; 1 Mercury Terrestrial planet    0.382 FALSE</span>
<span class="co">#&gt; 2   Venus Terrestrial planet    0.949 FALSE</span>
<span class="co">#&gt; 3   Earth Terrestrial planet    1.000 FALSE</span>
<span class="co">#&gt; 4    Mars Terrestrial planet    0.532 FALSE</span>
<span class="co">#&gt; 5 Jupiter          Gas giant   11.209  TRUE</span>
<span class="co">#&gt; 6  Saturn          Gas giant    9.449  TRUE</span>
<span class="co">#&gt; 7  Uranus          Gas giant    4.007  TRUE</span>
<span class="co">#&gt; 8 Neptune          Gas giant    3.883  TRUE</span></code></pre></div>
<p>Let’s say we want to replace the term “Terrestrial planet” with “TP”. First we need to subset <code>type</code> for those elements:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">planets<span class="op">$</span>type <span class="op">==</span><span class="st"> &quot;Terrestrial planet&quot;</span>
<span class="co">#&gt; [1]  TRUE  TRUE  TRUE  TRUE FALSE FALSE FALSE FALSE</span></code></pre></div>
<p>Now we can re-assign the values of <code>type</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">planets<span class="op">$</span>type[planets<span class="op">$</span>type <span class="op">==</span><span class="st"> &quot;Terrestrial planet&quot;</span>]
<span class="co">#&gt; [1] &quot;Terrestrial planet&quot; &quot;Terrestrial planet&quot; &quot;Terrestrial planet&quot;</span>
<span class="co">#&gt; [4] &quot;Terrestrial planet&quot;</span>
planets<span class="op">$</span>type[planets<span class="op">$</span>type <span class="op">==</span><span class="st"> &quot;Terrestrial planet&quot;</span>] &lt;-<span class="st"> &quot;TP&quot;</span>
planets
<span class="co">#&gt;      name      type diameter rings</span>
<span class="co">#&gt; 1 Mercury        TP    0.382 FALSE</span>
<span class="co">#&gt; 2   Venus        TP    0.949 FALSE</span>
<span class="co">#&gt; 3   Earth        TP    1.000 FALSE</span>
<span class="co">#&gt; 4    Mars        TP    0.532 FALSE</span>
<span class="co">#&gt; 5 Jupiter Gas giant   11.209  TRUE</span>
<span class="co">#&gt; 6  Saturn Gas giant    9.449  TRUE</span>
<span class="co">#&gt; 7  Uranus Gas giant    4.007  TRUE</span>
<span class="co">#&gt; 8 Neptune Gas giant    3.883  TRUE</span></code></pre></div>
</div>
<div id="recycling" class="section level3">
<h3><span class="header-section-number">7.5.2</span> Recycling</h3>
<p>When applying an operation to two vectors that requires them to be the same length, R automatically recycles, or repeats, the shorter one, until it is long enough to match the longer one.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x =</span> <span class="dv">4</span><span class="op">:</span><span class="dv">7</span>, <span class="dt">y =</span> letters[<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>])

<span class="co"># r recycles values</span>
df<span class="op">$</span>x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>)
df
<span class="co">#&gt;   x y</span>
<span class="co">#&gt; 1 1 a</span>
<span class="co">#&gt; 2 2 b</span>
<span class="co">#&gt; 3 1 c</span>
<span class="co">#&gt; 4 2 d</span>

<span class="co"># sometimes this is helpful if you want to replace an entire vector to one value.</span>
df<span class="op">$</span>x &lt;-<span class="st"> </span>df<span class="op">$</span>x <span class="op">+</span><span class="st"> </span><span class="dv">3</span>
df
<span class="co">#&gt;   x y</span>
<span class="co">#&gt; 1 4 a</span>
<span class="co">#&gt; 2 5 b</span>
<span class="co">#&gt; 3 4 c</span>
<span class="co">#&gt; 4 5 d</span></code></pre></div>
</div>
<div id="applications" class="section level3">
<h3><span class="header-section-number">7.5.3</span> Applications</h3>
<p>The basic principles described above give rise to a wide variety of useful applications. Some of the most important applications are described below. Many of these basic techniques are wrapped up into more concise functions (e.g., <code>subset()</code>, <code>merge()</code>, <code>plyr::arrange()</code>), but it is useful to understand how they are implemented with basic subsetting. This will allow you to adapt to new situations that are not dealt with by existing functions.</p>
<div id="ordering-columns" class="section level4 unnumbered">
<h4>Ordering Columns</h4>
<p>Consider we have this data frame:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(
  <span class="dt">Country =</span> <span class="kw">c</span>(<span class="st">&quot;Iraq&quot;</span>, <span class="st">&quot;China&quot;</span>, <span class="st">&quot;Mexico&quot;</span>, <span class="st">&quot;Russia&quot;</span>, <span class="st">&quot;United Kingdom&quot;</span>),
  <span class="dt">Region =</span> <span class="kw">c</span>(<span class="st">&quot;Middle East&quot;</span>, <span class="st">&quot;Asia&quot;</span>, <span class="st">&quot;North America&quot;</span>, <span class="st">&quot;Eastern Europe&quot;</span>, <span class="st">&quot;Western Europe&quot;</span>),
  <span class="dt">Language =</span> <span class="kw">c</span>(<span class="st">&quot;Arabic&quot;</span>, <span class="st">&quot;Mandarin&quot;</span>, <span class="st">&quot;Spanish&quot;</span>, <span class="st">&quot;Russian&quot;</span>, <span class="st">&quot;English&quot;</span>)
)
df
<span class="co">#&gt;          Country         Region Language</span>
<span class="co">#&gt; 1           Iraq    Middle East   Arabic</span>
<span class="co">#&gt; 2          China           Asia Mandarin</span>
<span class="co">#&gt; 3         Mexico  North America  Spanish</span>
<span class="co">#&gt; 4         Russia Eastern Europe  Russian</span>
<span class="co">#&gt; 5 United Kingdom Western Europe  English</span></code></pre></div>
<p>What if we wanted to reorder the columns so that <code>Region</code> is first? We can do so using subsetting with the names (or number) of the columns:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(
  <span class="dt">Country =</span> <span class="kw">c</span>(<span class="st">&quot;Iraq&quot;</span>, <span class="st">&quot;China&quot;</span>, <span class="st">&quot;Mexico&quot;</span>, <span class="st">&quot;Russia&quot;</span>, <span class="st">&quot;United Kingdom&quot;</span>),
  <span class="dt">Region =</span> <span class="kw">c</span>(<span class="st">&quot;Middle East&quot;</span>, <span class="st">&quot;Asia&quot;</span>, <span class="st">&quot;North America&quot;</span>, <span class="st">&quot;Eastern Europe&quot;</span>, <span class="st">&quot;Western Europe&quot;</span>),
  <span class="dt">Language =</span> <span class="kw">c</span>(<span class="st">&quot;Arabic&quot;</span>, <span class="st">&quot;Mandarin&quot;</span>, <span class="st">&quot;Spanish&quot;</span>, <span class="st">&quot;Russian&quot;</span>, <span class="st">&quot;English&quot;</span>)
)

<span class="co"># reorder columns using names</span>
<span class="kw">names</span>(df)
<span class="co">#&gt; [1] &quot;Country&quot;  &quot;Region&quot;   &quot;Language&quot;</span>
df1 &lt;-<span class="st"> </span>df[, <span class="kw">c</span>(<span class="st">&quot;Region&quot;</span>, <span class="st">&quot;Country&quot;</span>, <span class="st">&quot;Language&quot;</span>)]
df1
<span class="co">#&gt;           Region        Country Language</span>
<span class="co">#&gt; 1    Middle East           Iraq   Arabic</span>
<span class="co">#&gt; 2           Asia          China Mandarin</span>
<span class="co">#&gt; 3  North America         Mexico  Spanish</span>
<span class="co">#&gt; 4 Eastern Europe         Russia  Russian</span>
<span class="co">#&gt; 5 Western Europe United Kingdom  English</span>

<span class="co"># reorder columns using indices</span>
<span class="kw">names</span>(df)
<span class="co">#&gt; [1] &quot;Country&quot;  &quot;Region&quot;   &quot;Language&quot;</span>
df1 &lt;-<span class="st"> </span>df[, <span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">3</span>)]
df1
<span class="co">#&gt;           Region        Country Language</span>
<span class="co">#&gt; 1    Middle East           Iraq   Arabic</span>
<span class="co">#&gt; 2           Asia          China Mandarin</span>
<span class="co">#&gt; 3  North America         Mexico  Spanish</span>
<span class="co">#&gt; 4 Eastern Europe         Russia  Russian</span>
<span class="co">#&gt; 5 Western Europe United Kingdom  English</span></code></pre></div>
<p>One helpul function is the <code>order</code> function. It takes a vector as input and returns an integer vector describing how the subsetted vector should be ordered:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>, <span class="st">&quot;a&quot;</span>)
<span class="kw">order</span>(x)
<span class="co">#&gt; [1] 3 1 2</span>
x[<span class="kw">order</span>(x)]
<span class="co">#&gt; [1] &quot;a&quot; &quot;b&quot; &quot;c&quot;</span></code></pre></div>
<p>Knowing this, we can use <code>order</code> to reorder our columns by alphabetical order.</p>
</div>
<div id="removing-or-keeping-columns-from-data-frames." class="section level4 unnumbered">
<h4>Removing (or keeping) columns from data frames.</h4>
<p>There are two ways to remove columns from a data frame. You can set individual columns to <code>NULL</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(
  <span class="dt">Country =</span> <span class="kw">c</span>(<span class="st">&quot;Iraq&quot;</span>, <span class="st">&quot;China&quot;</span>, <span class="st">&quot;Mexico&quot;</span>, <span class="st">&quot;Russia&quot;</span>, <span class="st">&quot;United Kingdom&quot;</span>),
  <span class="dt">Region =</span> <span class="kw">c</span>(<span class="st">&quot;Middle East&quot;</span>, <span class="st">&quot;Asia&quot;</span>, <span class="st">&quot;North America&quot;</span>, <span class="st">&quot;Eastern Europe&quot;</span>, <span class="st">&quot;Western Europe&quot;</span>),
  <span class="dt">Language =</span> <span class="kw">c</span>(<span class="st">&quot;Arabic&quot;</span>, <span class="st">&quot;Mandarin&quot;</span>, <span class="st">&quot;Spanish&quot;</span>, <span class="st">&quot;Russian&quot;</span>, <span class="st">&quot;English&quot;</span>)
)

df<span class="op">$</span>Language &lt;-<span class="st"> </span><span class="ot">NULL</span></code></pre></div>
<p>Or you can subset to return only the columns you want:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(
  <span class="dt">Country =</span> <span class="kw">c</span>(<span class="st">&quot;Iraq&quot;</span>, <span class="st">&quot;China&quot;</span>, <span class="st">&quot;Mexico&quot;</span>, <span class="st">&quot;Russia&quot;</span>, <span class="st">&quot;United Kingdom&quot;</span>),
  <span class="dt">Region =</span> <span class="kw">c</span>(<span class="st">&quot;Middle East&quot;</span>, <span class="st">&quot;Asia&quot;</span>, <span class="st">&quot;North America&quot;</span>, <span class="st">&quot;Eastern Europe&quot;</span>, <span class="st">&quot;Western Europe&quot;</span>),
  <span class="dt">Language =</span> <span class="kw">c</span>(<span class="st">&quot;Arabic&quot;</span>, <span class="st">&quot;Mandarin&quot;</span>, <span class="st">&quot;Spanish&quot;</span>, <span class="st">&quot;Russian&quot;</span>, <span class="st">&quot;English&quot;</span>)
)

df1 &lt;-<span class="st"> </span>df[, <span class="kw">c</span>(<span class="st">&quot;Country&quot;</span>, <span class="st">&quot;Region&quot;</span>)]
df1
<span class="co">#&gt;          Country         Region</span>
<span class="co">#&gt; 1           Iraq    Middle East</span>
<span class="co">#&gt; 2          China           Asia</span>
<span class="co">#&gt; 3         Mexico  North America</span>
<span class="co">#&gt; 4         Russia Eastern Europe</span>
<span class="co">#&gt; 5 United Kingdom Western Europe</span>

<span class="co"># using negative integers</span>
df2 &lt;-<span class="st"> </span>df[, <span class="op">-</span><span class="dv">3</span>]
df2
<span class="co">#&gt;          Country         Region</span>
<span class="co">#&gt; 1           Iraq    Middle East</span>
<span class="co">#&gt; 2          China           Asia</span>
<span class="co">#&gt; 3         Mexico  North America</span>
<span class="co">#&gt; 4         Russia Eastern Europe</span>
<span class="co">#&gt; 5 United Kingdom Western Europe</span></code></pre></div>
<!--chapter:end:05_Subsetting/05-4_Subassignment.Rmd-->
</div>
</div>
</div>
</div>
<div id="working-with-data" class="section level1">
<h1><span class="header-section-number">8</span> Working with Data</h1>
<p>Insert some introduction here.</p>
<div id="project-workflow" class="section level2">
<h2><span class="header-section-number">8.1</span> Project Workflow</h2>
<p>One day…</p>
<ul>
<li>you will need to quit R, go do something else, and return to your analysis the next day.</li>
<li>you will be working on multiple projects simultaneously, and you’ll want to keep them separate.</li>
<li>you will need to bring data from the outside world into R, and send numerical results and figures from R back out into the world.</li>
</ul>
<p>This unit teaches these topics.</p>
<div id="store-analyses-in-scripts-not-workspaces." class="section level3">
<h3><span class="header-section-number">8.1.1</span> Store Analyses in Scripts, Not Workspaces.</h3>
<p>R Studio automatically preserves your workspace (environment and command history) when you quit R, and re-loads it the next session. I recommend you turn this behavior off.</p>
<div class="figure">
<img src="img/rstudio-workspace.png" />

</div>
<p>This will cause you some short-term pain, because now when you restart RStudio, it will not remember the results of the code that you ran last time. But this short-term pain will save you long-term agony, because it forces you to capture all important interactions in your scripts.</p>
</div>
<div id="working-directories-and-paths" class="section level3">
<h3><span class="header-section-number">8.1.2</span> Working Directories and Paths</h3>
<p>Like many programming languages, R has a powerful notion of the <strong>working directory</strong>. This is where R looks for files that you ask it to load, and where it will put any files that you ask it to save.</p>
<p>RStudio shows your current working directory at the top of the console. You can print this out in R code by running <code>getwd()</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">getwd</span>()
<span class="co">#&gt; [1] &quot;/Users/rochelleterman/Desktop/plsc-31101&quot;</span></code></pre></div>
<p>I do not recommend it, but you can set the working directory from within R:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">setwd</span>(<span class="st">&quot;/path/to/my/CoolProject&quot;</span>)</code></pre></div>
<p>The command above prints out a <strong>path</strong> to your working directory. Think of a path as an address. Paths are incredibly important in programming, but can be a little tricky. Let’s go into a bit more detail.</p>
<div id="absolute-paths" class="section level4 unnumbered">
<h4>Absolute Paths</h4>
<p>Absolute paths are paths that point to the same place regardless of your current working directory. They always start with the <strong>root directory</strong> that holds everything else on your computer.</p>
<ul>
<li>In Windows, absolute paths start with a drive letter (e.g. <code>C:</code>) or two backslashes (e.g. <code>\\servername</code>).</li>
<li>In Mac/Linux they start with a slash <code>/</code>. This is the leading slash in <code>/users/rterman</code>.</li>
</ul>
<p>Inside the root directory are several other directories, which we call <strong>subdirectories</strong>. We know that the directory <code>/home/rterman</code> is stored inside <code>/home</code> because <code>/home</code> is the first part of its name. Similarly, we know that <code>/home</code> is stored inside the root directory <code>/</code> because its name begins with <code>/</code>.</p>
<blockquote>
<p>Notice that there are two meanings for the <code>/</code> character. When it appears at the front of a file or directory name, &gt; it refers to the root directory. When it appears <em>inside</em> a name, &gt; it’s just a separator.</p>
</blockquote>
</div>
<div id="maclinux-vs.windows" class="section level4 unnumbered">
<h4>Mac/Linux vs. Windows</h4>
<p>There are two basic styles of paths: Mac/Linux and Windows. The main difference is how you separate the components of the path. Mac and Linux use slashes (e.g. <code>plots/diamonds.pdf</code>) and Windows uses backslashes (e.g. <code>plots\diamonds.pdf</code>).</p>
<p>R can work with either type, no matter what platform you’re currently using. Unfortunately, backslashes mean something special to R, and to get a single backslash in the path, you need to type two backslashes! That makes life frustrating, so I recommend always using the Linux/Mac style with forward slashes.</p>
</div>
<div id="home-directory" class="section level4 unnumbered">
<h4>Home Directory</h4>
<p>Sometimes you’ll see a <code>~</code> character in a path. * In Mac/Linux, the <code>~</code> is a convenient shortcut to your <strong>home directory</strong> (<code>/users/rterman</code>). * Windows doesn’t really have the notion of a home directory, so it usually points to your documents directory (<code>C:\Documents</code> and <code>Settings\rterman</code>)</p>
</div>
<div id="absolute-vs.relative-paths" class="section level4 unnumbered">
<h4>Absolute vs. Relative Paths</h4>
<p>You should try not to use absolute paths in your scripts, because they hinder sharing: no one else will have exactly the same directory configuration as you. Another way to direct R to something is to give it a <strong>relative path</strong>.</p>
<p>Relative paths point to something relative to where you are, rather than from the root of the file system. For example, if your current working directory is <code>/home/rterman</code>, then the relative path <code>data/un.csv</code> directs to the full absolute path: <code>/home/rterman/data/un.csv</code></p>
</div>
</div>
<div id="r-projects" class="section level3">
<h3><span class="header-section-number">8.1.3</span> R Projects</h3>
<p>As a beginning R user, it’s OK to let your home directory, documents directory, or any other weird directory on your computer be R’s working directory.</p>
<p>But from this point forward, you should be organizing your projects into dedicated subdirectories, containing all the files associated with a project — input data, R scripts, results, figures.</p>
<p>This is such a common practice that RStudio has built-in support for this via <strong>projects</strong>.</p>
<p>Let’s make a project together. Click <code>File &gt; New Project</code>, then:</p>
<p>~<a href="rstudio-project-1.png"></a></p>
<p>Think carefully about which subdirectory you put the project in. If you don’t store it somewhere sensible, it will be hard to find in the future!</p>
<p>Once this process is complete, you’ll get a new RStudio project. Check that the “home” directory of your project is the current working directory:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">getwd</span>()
<span class="co">#&gt; [1] &quot;/Users/rochelleterman/Desktop/plsc-31101&quot;</span></code></pre></div>
<p>Now whenever you refer to a file with a relative path, it will look for it there.</p>
<p>Go ahead and create a new R script and save it inside the project folder.</p>
<p>Quit RStudio. Inspect the folder associated with your project — notice the .Rproj file. Double-click that file to re-open the project. Notice you get back to where you left off: it’s the same working directory and command history, and all the files you were working on are still open. Because you followed my instructions above, you will, however, have a completely fresh environment, guaranteeing that you’re starting with a clean slate.</p>
</div>
<div id="file-organization" class="section level3">
<h3><span class="header-section-number">8.1.4</span> File Organization</h3>
<p>You should be saving all your files associated with your project in one directory. Here’s a basic organization structure that I recommend:</p>
<div class="sourceCode"><pre class="sourceCode md"><code class="sourceCode markdown">~~~
masters_thesis:
  masters_thesis.Rproj
  01_Clean.R
  02_Model.R
  03_Visualizations.R
  Data/
<span class="bn">    raw/</span>
<span class="bn">      un-raw.csv</span>
<span class="bn">      worldbank-raw.csv</span>
<span class="bn">    cleaned/</span>
<span class="bn">      country-year.csv</span>
  Results:
<span class="bn">    regressions</span>
<span class="bn">      h1.txt</span>
<span class="bn">      h2.txt</span>
<span class="bn">    figures</span>
<span class="bn">      bivariate.pdf</span>
<span class="bn">      bar_plot.pdf</span>
~~~</code></pre></div>
<p>Here are some important tips:</p>
<ul>
<li>read raw data from the <code>Data</code> subdirectory. Don’t ever change or overwrite the raw data!</li>
<li>export cleaned and altered data into a separate directory.</li>
<li>write separate scripts for each stage in the research pipeline. Keep scripts short and focused on one main purpose. If a script gets too long, that might be a sign you need to split it up.</li>
<li>write scripts that reproduce your results and figures, and write them in the <code>Results</code> subdirectory.</li>
</ul>
<div id="acknowledgements" class="section level4 unnumbered">
<h4>Acknowledgements</h4>
<p>This page is in part derived from the following sources:</p>
<ol style="list-style-type: decimal">
<li><a href="https://r4ds.had.co.nz">R for Data Science</a> licensed under <a href="https://creativecommons.org/licenses/by-nc-nd/3.0/us/">Creative Commons Attribution-NonCommercial-NoDerivs 3.0</a></li>
</ol>
</div>
<div id="more-resources" class="section level4 unnumbered">
<h4>More Resources</h4>
<ul>
<li><a href="https://web.stanford.edu/~gentzkow/research/CodeAndData.pdf">Gentzkow, Matthew and Jesse M. Shapiro. 2014. Code and Data for the Social Sciences: A Practitioner’s Guide.</a></li>
</ul>
<!--chapter:end:06_Data-Basics/06-0_Workflow.Rmd-->
</div>
</div>
</div>
<div id="introduction-to-data" class="section level2">
<h2><span class="header-section-number">8.2</span> Introduction to Data</h2>
<p>The upcoming weeks will be focused on using R for data cleaning and analysis. Let’s first get on the same page with some terms:</p>
<ul>
<li><p>A <strong>variable</strong> is a quantity, quality, or property that you can measure.</p></li>
<li><p>An <strong>observation</strong> is a set of measurements for the same unit. An observation will contain several values, each associated with a different variable. I’ll sometimes refer to an observation as a <strong>data point</strong> or an <strong>element</strong>.</p></li>
<li><p>A <strong>value</strong> is the state of a variable for a particular observation.</p></li>
<li><p><strong>Tabular data</strong> is a set of values, each associated with a variable and an observation. Tabular data has rows (observations) and columns (variables). Also called <strong>rectangular</strong> data or <strong>spreadsheets</strong>.</p></li>
</ul>
<div class="figure">
<img src="img/tidy-1.png" />

</div>
<div id="wheres-my-data" class="section level3">
<h3><span class="header-section-number">8.2.1</span> Where’s my data?</h3>
<p>To start, you first need to know where your data lives. Sometimes, the data is stored as a file on your computer, e.g. csv, Excel, SPSS, or some other file type. When the data is on your computer, we say the data is stored <strong>locally</strong>.</p>
<p>Data can also be stored externally on the Internet, in a package, or obtained through other sources. For example, some R packages contain datasets. The <code>nycflights13</code> package contains information on flights that departed NYC in 2013.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># not run</span>
<span class="co"># install.packages(&quot;nycflights13&quot;)</span>
<span class="kw">library</span>(nycflights13)
<span class="kw">data</span>(flights)
<span class="kw">names</span>(flights)
<span class="co">#&gt;  [1] &quot;year&quot;           &quot;month&quot;          &quot;day&quot;            &quot;dep_time&quot;      </span>
<span class="co">#&gt;  [5] &quot;sched_dep_time&quot; &quot;dep_delay&quot;      &quot;arr_time&quot;       &quot;sched_arr_time&quot;</span>
<span class="co">#&gt;  [9] &quot;arr_delay&quot;      &quot;carrier&quot;        &quot;flight&quot;         &quot;tailnum&quot;       </span>
<span class="co">#&gt; [13] &quot;origin&quot;         &quot;dest&quot;           &quot;air_time&quot;       &quot;distance&quot;      </span>
<span class="co">#&gt; [17] &quot;hour&quot;           &quot;minute&quot;         &quot;time_hour&quot;</span>
<span class="kw">rm</span>(flights)
<span class="co"># </span></code></pre></div>
<p>Later in this course, we’ll discuss how to obtain data from web APIs and websites. For now, the rest of the unit discusses data that is stored <strong>locally</strong>.</p>
</div>
<div id="data-storage" class="section level3">
<h3><span class="header-section-number">8.2.2</span> Data Storage</h3>
<p>Ideally, your data should be stored in a certain file format. I recommend a <code>csv</code> (comma separated value) file, which formats spreadsheet (rectangular) data in a plain-text format. <code>csv</code> files are plain-text, and can be read into almost any statistical software program, including R. Try to avoid Excel files if you can.</p>
<p>Here are some other tips:</p>
<ul>
<li>When working with spreadsheets, the first row is usually reserved for the header, while the first column is used to identify the sampling unit (<strong>unique identifier</strong>, see below.)</li>
<li>Avoid file names and variable names with blank spaces. This can cause errors when reading in data.</li>
<li>If you want to concatenate words, insert a <code>.</code> or <code>_</code> in between to words instead of a space;</li>
<li>Short names are prefered over longer names;</li>
<li>Try to avoid using names that contain symbols such as <code>?</code>, <code>$</code>,<code>%</code>, <code>^</code>, <code>&amp;</code>, <code>*</code>, <code>(</code>, <code>)</code>, <code>-</code>, <code>#</code>, <code>?</code>, <code>,</code>, <code>&lt;</code>, <code>&gt;</code>, <code>/</code>, <code>|</code>, <code>\</code>, <code>[</code> ,<code>]</code>,<code>{</code>, and <code>}</code>;</li>
<li>make sure that any missing values in your data set are indicated with <code>NA</code> or blank fields (don’t use 99 or 77)..</li>
</ul>
</div>
<div id="tidy-data" class="section level3">
<h3><span class="header-section-number">8.2.3</span> <code>tidy</code> Data</h3>
<p>Datasets in the wild can often be messy. For example, check out the following data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">messy &lt;-<span class="st"> </span><span class="kw">data.frame</span>(
  <span class="dt">county =</span> <span class="kw">c</span>(<span class="dv">36037</span>, <span class="dv">36038</span>, <span class="dv">36039</span>, <span class="dv">36040</span>, <span class="ot">NA</span> , <span class="dv">37001</span>, <span class="dv">37002</span>, <span class="dv">37003</span>),
  <span class="dt">state =</span> <span class="kw">c</span>(<span class="st">&#39;NY&#39;</span>, <span class="st">&#39;NY&#39;</span>, <span class="st">&#39;NY&#39;</span>, <span class="ot">NA</span>, <span class="ot">NA</span>, <span class="st">&#39;VA&#39;</span>, <span class="st">&#39;VA&#39;</span>, <span class="st">&#39;VA&#39;</span>),
  <span class="dt">cnty_pop =</span> <span class="kw">c</span>(<span class="dv">3817735</span>, <span class="dv">422999</span>, <span class="dv">324920</span>, <span class="dv">143432</span>, <span class="ot">NA</span>, <span class="dv">3228290</span>, <span class="dv">449499</span>, <span class="dv">383888</span>),
  <span class="dt">state_pop =</span> <span class="kw">c</span>(<span class="dv">43320903</span>, <span class="dv">43320903</span>, <span class="ot">NA</span>, <span class="dv">43320903</span>, <span class="dv">43320903</span>, <span class="dv">7173000</span>, <span class="dv">7173000</span>, <span class="dv">7173000</span>),
  <span class="dt">region =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">4</span>)
)
messy
<span class="co">#&gt;   county state cnty_pop state_pop region</span>
<span class="co">#&gt; 1  36037    NY  3817735  43320903      1</span>
<span class="co">#&gt; 2  36038    NY   422999  43320903      1</span>
<span class="co">#&gt; 3  36039    NY   324920        NA      1</span>
<span class="co">#&gt; 4  36040  &lt;NA&gt;   143432  43320903      1</span>
<span class="co">#&gt; 5     NA  &lt;NA&gt;       NA  43320903      1</span>
<span class="co">#&gt; 6  37001    VA  3228290   7173000      3</span>
<span class="co">#&gt; 7  37002    VA   449499   7173000      3</span>
<span class="co">#&gt; 8  37003    VA   383888   7173000      4</span></code></pre></div>
<p>What a mess! How can the population of the state of New York be 43 million for one county but “missing” for another? If this is a dataset of counties, what does it mean when the “county” field is missing? If region is something like Census region, how can two counties in the same state be in different regions? And why is it that all the counties whose codes start with 36 are in New York except for one, where the state is unknown?</p>
<p>The goal should be to put our data in a tidy format. The two most important properties of tidy data are:</p>
<ol style="list-style-type: decimal">
<li>Each variable forms a column.</li>
<li>Each observation forms a row.</li>
<li>Each type of observational unit forms a table.</li>
</ol>
<p>If we follow these principles, our data should look like:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">counties &lt;-<span class="st"> </span><span class="kw">data.frame</span>(
  <span class="dt">county =</span> <span class="kw">c</span>(<span class="dv">36037</span>, <span class="dv">36038</span>, <span class="dv">36039</span>, <span class="dv">36040</span>, <span class="dv">37001</span>, <span class="dv">37002</span>, <span class="dv">37003</span>),
  <span class="dt">state =</span> <span class="kw">c</span>(<span class="st">&#39;NY&#39;</span>, <span class="st">&#39;NY&#39;</span>, <span class="st">&#39;NY&#39;</span>, <span class="st">&#39;NY&#39;</span>, <span class="st">&#39;VA&#39;</span>, <span class="st">&#39;VA&#39;</span>, <span class="st">&#39;VA&#39;</span>),
  <span class="dt">population =</span> <span class="kw">c</span>(<span class="dv">3817735</span>, <span class="dv">422999</span>, <span class="dv">324920</span>, <span class="dv">143432</span>, <span class="dv">3228290</span>, <span class="dv">449499</span>, <span class="dv">383888</span>)
)
counties
<span class="co">#&gt;   county state population</span>
<span class="co">#&gt; 1  36037    NY    3817735</span>
<span class="co">#&gt; 2  36038    NY     422999</span>
<span class="co">#&gt; 3  36039    NY     324920</span>
<span class="co">#&gt; 4  36040    NY     143432</span>
<span class="co">#&gt; 5  37001    VA    3228290</span>
<span class="co">#&gt; 6  37002    VA     449499</span>
<span class="co">#&gt; 7  37003    VA     383888</span>

states &lt;-<span class="st"> </span><span class="kw">data.frame</span>(
  <span class="dt">state =</span> <span class="kw">c</span>(<span class="st">&quot;NY&quot;</span>, <span class="st">&quot;VA&quot;</span>),
  <span class="dt">population =</span> <span class="kw">c</span>(<span class="dv">43320903</span>, <span class="dv">7173000</span>),
  <span class="dt">region =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>)
)
states
<span class="co">#&gt;   state population region</span>
<span class="co">#&gt; 1    NY   43320903      1</span>
<span class="co">#&gt; 2    VA    7173000      3</span></code></pre></div>
<p>Now the ambiguity is gone. Every county has a population and a state. Every state has a population and a region. There are no missing states, no missing counties, and no conflicting definitions. The database is self-documenting. In fact, the database is now so clear that we can forget about names like county_pop and state_pop and just stick to “population.” Anyone would know which entity’s population you mean.</p>
<p>We’ll talk more about tidying data in later units.</p>
</div>
<div id="relational-data" class="section level3">
<h3><span class="header-section-number">8.2.4</span> Relational data</h3>
<p>Collectively, multiple tables of data are called <strong>relational data</strong> because it is the relations, not just the individual datasets, that are important. Note that when we say relational database here, we are referring to how the data are structured, not to the use of any fancy software.</p>
<p>The main principle of relational data is that each table is structured around the same observational unit.</p>
<ul>
<li>counties contains data on counties.</li>
<li>states contains data on states</li>
</ul>
<p>County population is a property of a county, so it lives in the county table. State population is a property of a state, so it cannot live in the county table. If we had panel data on counties, we would need separate tables for things that vary at the county level (like state) and things that vary at the county-year level (like population).</p>
</div>
<div id="keys" class="section level3">
<h3><span class="header-section-number">8.2.5</span> Keys</h3>
<p>The variables that connect each pair of tables are called <strong>keys</strong>. A key is a variable (or set of variables) that uniquely identifies an observation. It is also called a <em>unique identifier</em>.</p>
<ul>
<li>Keys are complete. They never take on missing values.</li>
<li>Keys are unique. They are never duplicated across rows of a table.</li>
</ul>
<p>In simple cases, a single variable is sufficient to identify an observation. In the example above, each county is identified with <strong>county</strong> (a numeric identifier); each state is identified with <strong>state</strong> (a two-letter string).</p>
<p>There are two types of keys:</p>
<ul>
<li><p>A <strong>primary key</strong> uniquely identifies an observation in its own table. For example, <code>counties$county</code> is a primary key because it uniquely identifies each county in the counties table.</p></li>
<li><p>A <strong>foreign key</strong> uniquely identifies an observation in another table. For example, <code>counties$state</code> is a foreign key because it appears in the counties table where it matches each county to a unique state.</p></li>
</ul>
<p>A primary key and the corresponding foreign key in another table form a <strong>relation</strong>.</p>
<p>Sometimes a table doesn’t have an explicit primary key: each row is an observation, but no combination of variables reliably identifies it. If a table lacks a primary key, it’s useful to add one.</p>
<div id="acknowledgements-1" class="section level4 unnumbered">
<h4>Acknowledgements</h4>
<p>This page is in part derived from the following sources:</p>
<ol style="list-style-type: decimal">
<li><p><a href="https://r4ds.had.co.nz">R for Data Science</a> licensed under <a href="https://creativecommons.org/licenses/by-nc-nd/3.0/us/">Creative Commons Attribution-NonCommercial-NoDerivs 3.0</a></p></li>
<li><p><a href="https://web.stanford.edu/~gentzkow/research/CodeAndData.pdf">Gentzkow, Matthew and Jesse M. Shapiro. 2014. Code and Data for the Social Sciences: A Practitioner’s Guide.</a></p></li>
</ol>
<!--chapter:end:06_Data-Basics/06-1_Datasets.Rmd-->
</div>
</div>
</div>
<div id="importing-and-exporting" class="section level2">
<h2><span class="header-section-number">8.3</span> Importing and Exporting</h2>
<div id="importing-data" class="section level3">
<h3><span class="header-section-number">8.3.1</span> Importing Data</h3>
<div id="find-paths-first" class="section level4 unnumbered">
<h4>Find Paths First</h4>
<p>In order to import (or read) data into R, you first have to know where it is, and how to find it.</p>
<p>First, remember that you’ll need to know the <em>current working directory</em> so that you know where R is looking for files. If you’re using R Projects, that working directory will be the top-level directory of the project.</p>
<p>Second, you’ll need to know where the data file is, relative to your working directory. If it’s stored in the <code>Data/raw/</code> folder, the relative path to your file will be <code>Data/raw/file-name.csv</code></p>
</div>
<div id="reading-tabular-data" class="section level4 unnumbered">
<h4>Reading Tabular Data</h4>
<p>The workhorse for reading into a data frame is <em>read.table()</em>, which allows any separator (CSV, tab-delimited, etc.). <em>read.csv()</em> is a special case of <em>read.table()</em> for CSV files.</p>
<p>The basic formula is:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Basic CSV read: Import data with header row, values separated by &quot;,&quot;, decimals as &quot;.&quot;</span>
mydataset &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="dt">file=</span><span class="st">&quot;  &quot;</span>, <span class="dt">stringsAsFactors=</span>)</code></pre></div>
<p>Here’s a practical example, using the polityVI dataset:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#import polity</span>
polity &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/polity.csv&quot;</span>, <span class="dt">stringsAsFactors =</span> F)
polity[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>]
<span class="co">#&gt;     cyear ccode scode     country year</span>
<span class="co">#&gt; 1 7001800   700   AFG Afghanistan 1800</span>
<span class="co">#&gt; 2 7001801   700   AFG Afghanistan 1801</span>
<span class="co">#&gt; 3 7001802   700   AFG Afghanistan 1802</span>
<span class="co">#&gt; 4 7001803   700   AFG Afghanistan 1803</span>
<span class="co">#&gt; 5 7001804   700   AFG Afghanistan 1804</span></code></pre></div>
<p>We use <code>stringsAsFactors = F</code> in order to treat text columns as character vectors, not as factors. If we don’t set this, the default is that all non-numerical columns will be encoded as factors. This behavior usually makes poor sense, and is due to historical reasons. At one point in time, factors were faster than character vectors, so R’s <code>read.table()</code> set the default to read in text as factors.</p>
<p><code>read.table()</code> has a number of other options:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># For importing tabular data with maximum customizeability</span>
mydataset &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="dt">file=</span>, <span class="dt">header=</span>, <span class="dt">sep=</span>, <span class="dt">quote=</span>, <span class="dt">dec=</span>, <span class="dt">fill=</span>, <span class="dt">stringsAsFactors=</span>)</code></pre></div>
</div>
<div id="reading-excel-files" class="section level4 unnumbered">
<h4>Reading Excel Files</h4>
<p>Don’t use Microsoft Excel files (.xls or .xlsx). But if you must:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Make sure you have installed the tidyverse suite (only necessary one time)</span>
<span class="co"># install.packages(&quot;tidyverse&quot;) # Not Run</span>

<span class="co"># Load the &quot;readxl&quot; package (necessary every new R session)</span>
<span class="kw">library</span>(readxl)</code></pre></div>
<p><code>read_excel()</code> reads both <code>xls</code> and <code>xlsx</code> files and detects the format from the extension.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Basic call</span>
mydataset &lt;-<span class="st"> </span><span class="kw">read_excel</span>(<span class="dt">path =</span> , <span class="dt">sheet =</span> <span class="st">&quot;)</span></code></pre></div>
<p>Here’s a real example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Example with .xlsx (single sheet)</span>
air &lt;-<span class="st"> </span><span class="kw">read_excel</span>(<span class="st">&quot;data/airline_small.xlsx&quot;</span>, <span class="dt">sheet =</span> <span class="dv">1</span>) 
air[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>]
<span class="co">#&gt; # A tibble: 5 x 5</span>
<span class="co">#&gt;    Year Month DayofMonth DayOfWeek DepTime</span>
<span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt;      &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;  </span>
<span class="co">#&gt; 1  2005    11         22         2 1700   </span>
<span class="co">#&gt; 2  2008     1         31         4 2216   </span>
<span class="co">#&gt; 3  2005     7         17         7 905    </span>
<span class="co">#&gt; 4  2008     9         23         2 859    </span>
<span class="co">#&gt; 5  2005     3          5         6 827</span></code></pre></div>
</div>
<div id="reading-stata-.dta-files" class="section level4 unnumbered">
<h4>Reading Stata (.dta) Files</h4>
<p>There are many ways to read <code>.dta</code> files into R. I recommend using <code>haven</code> because it is part of the <code>tidyverse.</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(haven)
air.dta &lt;-<span class="st"> </span><span class="kw">read_dta</span>(<span class="st">&quot;data/airline_small.dta&quot;</span>) 
air[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>]
<span class="co">#&gt; # A tibble: 5 x 5</span>
<span class="co">#&gt;    Year Month DayofMonth DayOfWeek DepTime</span>
<span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt;      &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;  </span>
<span class="co">#&gt; 1  2005    11         22         2 1700   </span>
<span class="co">#&gt; 2  2008     1         31         4 2216   </span>
<span class="co">#&gt; 3  2005     7         17         7 905    </span>
<span class="co">#&gt; 4  2008     9         23         2 859    </span>
<span class="co">#&gt; 5  2005     3          5         6 827</span></code></pre></div>
</div>
<div id="for-really-big-data" class="section level4 unnumbered">
<h4>For Really Big Data</h4>
<p>If you have really big data, <code>read.csv()</code> will be too slow. In these cases, check out the following options:</p>
<ol style="list-style-type: decimal">
<li><code>read_csv()</code> in the <code>readr</code> package is a faster, more helpful drop-in replacement for <code>read.csv()</code> that plays well with tidyverse packages (discussed in future lessons).</li>
<li>the <code>data.table</code> package is great for reading and manipulating large datasets (orders of gigabytes or 10s of gigabytes)</li>
</ol>
</div>
</div>
<div id="exporting-data" class="section level3">
<h3><span class="header-section-number">8.3.2</span> Exporting Data</h3>
<p>You should never go from raw data to results in one script. Typically, you’ll want to import raw data, clean it, and then export that cleaned dataset onto your computer. That cleaned dataset will then be imported into another script for analysis, in a modular fashion.</p>
<p>To export (or write) data from R onto your computer, you can create individual <code>.csv</code> files, or export many data objects into an <code>.RData</code> object.</p>
<div id="writing-a-csv-spreadsheet" class="section level4 unnumbered">
<h4>Writing a <code>csv</code> Spreadsheet</h4>
<p>To export an individual dataframe as a spreadsheet, use <code>write.csv()</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Basic call</span>
<span class="kw">write.csv</span>(<span class="dt">x =</span> , <span class="dt">file =</span> , <span class="dt">row.names =</span> , <span class="dt">col.names =</span>)</code></pre></div>
<p>Let’s write the <code>air</code> dataset as a csv.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Basic call</span>
<span class="kw">write.csv</span>(air, <span class="st">&quot;data/airlines.csv&quot;</span>, <span class="dt">row.names =</span> F)</code></pre></div>
</div>
<div id="packaging-data-into-.rdata" class="section level4 unnumbered">
<h4>Packaging Data into .RData</h4>
<p>Sometimes, it’s helpful to write several dataframes at once, to be used in later analysis. To do so, we use the <code>save()</code> function to create one file containing many R data objects.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Basic call</span>
<span class="kw">save</span>(..., <span class="dt">file =</span> )</code></pre></div>
<p>Here’s how we can write both <code>air</code> and <code>polity</code> into one file.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">save</span>(air, polity, <span class="dt">file =</span> <span class="st">&quot;data/datasets.RData&quot;</span>)</code></pre></div>
<p>We can then read these datasets back into R using <code>load()</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># clear environment</span>
<span class="kw">rm</span>(<span class="dt">list=</span><span class="kw">ls</span>())

<span class="co"># load datasets</span>
<span class="kw">load</span>(<span class="st">&quot;data/datasets.RData&quot;</span>)</code></pre></div>
<!--chapter:end:06_Data-Basics/06-2_Import-Export.Rmd-->
</div>
</div>
</div>
<div id="exploring-data" class="section level2">
<h2><span class="header-section-number">8.4</span> Exploring Data</h2>
<div id="the-gapminder-dataset" class="section level3">
<h3><span class="header-section-number">8.4.1</span> The Gapminder Dataset</h3>
<p>This lesson discusses how to perform basic exploratory data analysis.</p>
<p>For this unit, we’ll be working with the “Gapminder” dataset, which is an excerpt of the data available at Gapminder.org. For each of 142 countries, the data provides values for life expectancy, GDP per capita, and population, every five years, from 1952 to 2007.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gap &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/gapminder.csv&quot;</span>, <span class="dt">stringsAsFactors =</span> F)</code></pre></div>
</div>
<div id="structure-and-dimensions" class="section level3">
<h3><span class="header-section-number">8.4.2</span> Structure and Dimensions</h3>
<p>The first things we want to know about a dataset are its dimensions and basic structure. For instance, we can look at the number of rows and columns:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># get number of rows and columns:</span>
<span class="kw">dim</span>(gap)
<span class="co">#&gt; [1] 1704    6</span></code></pre></div>
<p>We might also want to see the names of the columns:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># see column names</span>
<span class="kw">names</span>(gap)
<span class="co">#&gt; [1] &quot;country&quot;   &quot;year&quot;      &quot;pop&quot;       &quot;continent&quot; &quot;lifeExp&quot;   &quot;gdpPercap&quot;</span></code></pre></div>
<p>The <code>str</code> function is helpful to see an overview of the data’s structure:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># see structure of data</span>
<span class="kw">str</span>(gap)
<span class="co">#&gt; &#39;data.frame&#39;:    1704 obs. of  6 variables:</span>
<span class="co">#&gt;  $ country  : chr  &quot;Afghanistan&quot; &quot;Afghanistan&quot; &quot;Afghanistan&quot; &quot;Afghanistan&quot; ...</span>
<span class="co">#&gt;  $ year     : int  1952 1957 1962 1967 1972 1977 1982 1987 1992 1997 ...</span>
<span class="co">#&gt;  $ pop      : num  8425333 9240934 10267083 11537966 13079460 ...</span>
<span class="co">#&gt;  $ continent: chr  &quot;Asia&quot; &quot;Asia&quot; &quot;Asia&quot; &quot;Asia&quot; ...</span>
<span class="co">#&gt;  $ lifeExp  : num  28.8 30.3 32 34 36.1 ...</span>
<span class="co">#&gt;  $ gdpPercap: num  779 821 853 836 740 ...</span></code></pre></div>
<p>Finally, I encourage you to actually peak at the data itself. The <code>head</code> function displays the first 6 rows of any dataframe.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(gap)
<span class="co">#&gt;       country year      pop continent lifeExp gdpPercap</span>
<span class="co">#&gt; 1 Afghanistan 1952  8425333      Asia    28.8       779</span>
<span class="co">#&gt; 2 Afghanistan 1957  9240934      Asia    30.3       821</span>
<span class="co">#&gt; 3 Afghanistan 1962 10267083      Asia    32.0       853</span>
<span class="co">#&gt; 4 Afghanistan 1967 11537966      Asia    34.0       836</span>
<span class="co">#&gt; 5 Afghanistan 1972 13079460      Asia    36.1       740</span>
<span class="co">#&gt; 6 Afghanistan 1977 14880372      Asia    38.4       786</span></code></pre></div>
</div>
<div id="common-alterations" class="section level3">
<h3><span class="header-section-number">8.4.3</span> Common Alterations</h3>
<p>There are some very common alterations researchers make on their data: changing column names, assigning NA values, and changing column types.</p>
<p>Note that we will cover how to perform these functions using the <code>tidyverse</code> later in the course. However, these lines are very common, so it’s good to know how they work:</p>
<ol style="list-style-type: decimal">
<li>change column names</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span>(gap)
<span class="co">#&gt; [1] &quot;country&quot;   &quot;year&quot;      &quot;pop&quot;       &quot;continent&quot; &quot;lifeExp&quot;   &quot;gdpPercap&quot;</span>
<span class="kw">names</span>(gap) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;country&quot;</span>, <span class="st">&quot;year&quot;</span>, <span class="st">&quot;pop&quot;</span>, <span class="st">&quot;continent&quot;</span>, <span class="st">&quot;life.exp&quot;</span>, <span class="st">&quot;gdp.percap&quot;</span>)
<span class="kw">str</span>(gap)
<span class="co">#&gt; &#39;data.frame&#39;:    1704 obs. of  6 variables:</span>
<span class="co">#&gt;  $ country   : chr  &quot;Afghanistan&quot; &quot;Afghanistan&quot; &quot;Afghanistan&quot; &quot;Afghanistan&quot; ...</span>
<span class="co">#&gt;  $ year      : int  1952 1957 1962 1967 1972 1977 1982 1987 1992 1997 ...</span>
<span class="co">#&gt;  $ pop       : num  8425333 9240934 10267083 11537966 13079460 ...</span>
<span class="co">#&gt;  $ continent : chr  &quot;Asia&quot; &quot;Asia&quot; &quot;Asia&quot; &quot;Asia&quot; ...</span>
<span class="co">#&gt;  $ life.exp  : num  28.8 30.3 32 34 36.1 ...</span>
<span class="co">#&gt;  $ gdp.percap: num  779 821 853 836 740 ...</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Change some values to <code>NA</code></li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gap<span class="op">$</span>life.exp[gap<span class="op">$</span>life.exp <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span> ] &lt;-<span class="st"> </span><span class="ot">NA</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Coerce columns to a specific type. For instance, let’s change <code>continent</code> from character to factor.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(gap<span class="op">$</span>continent)
<span class="co">#&gt;    Length     Class      Mode </span>
<span class="co">#&gt;      1704 character character</span>
gap<span class="op">$</span>continent &lt;-<span class="st"> </span><span class="kw">as.factor</span>(gap<span class="op">$</span>continent)
<span class="kw">summary</span>(gap<span class="op">$</span>continent)
<span class="co">#&gt;   Africa Americas     Asia   Europe  Oceania </span>
<span class="co">#&gt;      624      300      396      360       24</span></code></pre></div>
</div>
<div id="summary-statistics" class="section level3">
<h3><span class="header-section-number">8.4.4</span> Summary statistics</h3>
<p>We can get quick summary statistics using <code>summary</code>. Passing the entire dataframe will summarize all columns:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(gap)
<span class="co">#&gt;    country               year           pop              continent  </span>
<span class="co">#&gt;  Length:1704        Min.   :1952   Min.   :6.00e+04   Africa  :624  </span>
<span class="co">#&gt;  Class :character   1st Qu.:1966   1st Qu.:2.79e+06   Americas:300  </span>
<span class="co">#&gt;  Mode  :character   Median :1980   Median :7.02e+06   Asia    :396  </span>
<span class="co">#&gt;                     Mean   :1980   Mean   :2.96e+07   Europe  :360  </span>
<span class="co">#&gt;                     3rd Qu.:1993   3rd Qu.:1.96e+07   Oceania : 24  </span>
<span class="co">#&gt;                     Max.   :2007   Max.   :1.32e+09                 </span>
<span class="co">#&gt;     life.exp      gdp.percap    </span>
<span class="co">#&gt;  Min.   :23.6   Min.   :   241  </span>
<span class="co">#&gt;  1st Qu.:48.2   1st Qu.:  1202  </span>
<span class="co">#&gt;  Median :60.7   Median :  3532  </span>
<span class="co">#&gt;  Mean   :59.5   Mean   :  7215  </span>
<span class="co">#&gt;  3rd Qu.:70.8   3rd Qu.:  9325  </span>
<span class="co">#&gt;  Max.   :82.6   Max.   :113523</span></code></pre></div>
<p>Passing a column with summarize that particular column:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(gap<span class="op">$</span>year)
<span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span>
<span class="co">#&gt;    1952    1966    1980    1980    1993    2007</span></code></pre></div>
<p>Sometimes we need to do some basic checking for the number of observations or types of observations in our dataset. To do this quickly and easily, <code>table()</code> is our friend.</p>
<p>Let’s look at the number of observations first by region, and then by both region and year.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">table</span>(gap<span class="op">$</span>continent)
<span class="co">#&gt; </span>
<span class="co">#&gt;   Africa Americas     Asia   Europe  Oceania </span>
<span class="co">#&gt;      624      300      396      360       24</span>

<span class="kw">table</span>(gap<span class="op">$</span>continent, gap<span class="op">$</span>year)
<span class="co">#&gt;           </span>
<span class="co">#&gt;            1952 1957 1962 1967 1972 1977 1982 1987 1992 1997 2002 2007</span>
<span class="co">#&gt;   Africa     52   52   52   52   52   52   52   52   52   52   52   52</span>
<span class="co">#&gt;   Americas   25   25   25   25   25   25   25   25   25   25   25   25</span>
<span class="co">#&gt;   Asia       33   33   33   33   33   33   33   33   33   33   33   33</span>
<span class="co">#&gt;   Europe     30   30   30   30   30   30   30   30   30   30   30   30</span>
<span class="co">#&gt;   Oceania     2    2    2    2    2    2    2    2    2    2    2    2</span></code></pre></div>
<p>We can even divide by the total number of rows to get proportion, percent, etc.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">table</span>(gap<span class="op">$</span>continent)<span class="op">/</span><span class="kw">nrow</span>(gap)
<span class="co">#&gt; </span>
<span class="co">#&gt;   Africa Americas     Asia   Europe  Oceania </span>
<span class="co">#&gt;   0.3662   0.1761   0.2324   0.2113   0.0141</span>
<span class="kw">table</span>(gap<span class="op">$</span>continent)<span class="op">/</span><span class="kw">nrow</span>(gap)<span class="op">*</span><span class="dv">100</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   Africa Americas     Asia   Europe  Oceania </span>
<span class="co">#&gt;    36.62    17.61    23.24    21.13     1.41</span></code></pre></div>
</div>
<div id="review-of-subsetting" class="section level3">
<h3><span class="header-section-number">8.4.5</span> Review of Subsetting</h3>
<p>We learned about subsetting in the previous lesson. Let’s do a quick review here:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Extract first 10 rows</span>
gap[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, ]
<span class="co">#&gt;        country year      pop continent life.exp gdp.percap</span>
<span class="co">#&gt; 1  Afghanistan 1952  8425333      Asia     28.8        779</span>
<span class="co">#&gt; 2  Afghanistan 1957  9240934      Asia     30.3        821</span>
<span class="co">#&gt; 3  Afghanistan 1962 10267083      Asia     32.0        853</span>
<span class="co">#&gt; 4  Afghanistan 1967 11537966      Asia     34.0        836</span>
<span class="co">#&gt; 5  Afghanistan 1972 13079460      Asia     36.1        740</span>
<span class="co">#&gt; 6  Afghanistan 1977 14880372      Asia     38.4        786</span>
<span class="co">#&gt; 7  Afghanistan 1982 12881816      Asia     39.9        978</span>
<span class="co">#&gt; 8  Afghanistan 1987 13867957      Asia     40.8        852</span>
<span class="co">#&gt; 9  Afghanistan 1992 16317921      Asia     41.7        649</span>
<span class="co">#&gt; 10 Afghanistan 1997 22227415      Asia     41.8        635</span>

<span class="co"># Extract county year for first 10 rows</span>
gap[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="kw">c</span>(<span class="st">&quot;country&quot;</span>, <span class="st">&quot;year&quot;</span>)]
<span class="co">#&gt;        country year</span>
<span class="co">#&gt; 1  Afghanistan 1952</span>
<span class="co">#&gt; 2  Afghanistan 1957</span>
<span class="co">#&gt; 3  Afghanistan 1962</span>
<span class="co">#&gt; 4  Afghanistan 1967</span>
<span class="co">#&gt; 5  Afghanistan 1972</span>
<span class="co">#&gt; 6  Afghanistan 1977</span>
<span class="co">#&gt; 7  Afghanistan 1982</span>
<span class="co">#&gt; 8  Afghanistan 1987</span>
<span class="co">#&gt; 9  Afghanistan 1992</span>
<span class="co">#&gt; 10 Afghanistan 1997</span>

<span class="co"># Extract observations in Africa</span>
africa &lt;-<span class="st"> </span>gap[gap<span class="op">$</span>continent<span class="op">==</span><span class="st">&quot;Africa&quot;</span>,]

<span class="co"># Find average life expectancy for observations in Africa</span>
<span class="kw">mean</span>(gap<span class="op">$</span>life.exp[gap<span class="op">$</span>continent<span class="op">==</span><span class="st">&quot;Africa&quot;</span>])
<span class="co">#&gt; [1] 48.9</span>
<span class="kw">mean</span>(africa<span class="op">$</span>life.exp)
<span class="co">#&gt; [1] 48.9</span></code></pre></div>
</div>
<div id="basic-plotting" class="section level3">
<h3><span class="header-section-number">8.4.6</span> Basic Plotting</h3>
<p>We’ll go into plotting in greater detail soon, but let’s touch on two common graphs. First, a scatterplot:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(gap<span class="op">$</span>life.exp <span class="op">~</span><span class="st"> </span>gap<span class="op">$</span>gdp.percap)</code></pre></div>
<p><img src="site1_files/figure-html/unnamed-chunk-223-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>Finally, let’s quickly take a look at a histogram of the variable <code>nyt.count</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">hist</span>(gap<span class="op">$</span>life.exp, <span class="dt">breaks =</span> <span class="dv">100</span>)</code></pre></div>
<p><img src="site1_files/figure-html/unnamed-chunk-224-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<div id="challenges-10" class="section level3">
<h3><span class="header-section-number">8.4.7</span> Challenges</h3>
<div id="challenge-1.-read-the-polity-dataset." class="section level4 unnumbered">
<h4>Challenge 1. Read the <code>polity</code> dataset.</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">polity &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/polity.csv&quot;</span>, <span class="dt">stringsAsFactors =</span> F)</code></pre></div>
</div>
<div id="challenge-2.-report-the-number-and-names-of-each-variable-in-the-dataset." class="section level4 unnumbered">
<h4>Challenge 2. Report the number and names of each variable in the dataset.</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dim</span>(polity)
<span class="co">#&gt; [1] 16727    36</span>
<span class="kw">names</span>(polity)
<span class="co">#&gt;  [1] &quot;cyear&quot;    &quot;ccode&quot;    &quot;scode&quot;    &quot;country&quot;  &quot;year&quot;     &quot;flag&quot;    </span>
<span class="co">#&gt;  [7] &quot;fragment&quot; &quot;democ&quot;    &quot;autoc&quot;    &quot;polity&quot;   &quot;polity2&quot;  &quot;durable&quot; </span>
<span class="co">#&gt; [13] &quot;xrreg&quot;    &quot;xrcomp&quot;   &quot;xropen&quot;   &quot;xconst&quot;   &quot;parreg&quot;   &quot;parcomp&quot; </span>
<span class="co">#&gt; [19] &quot;exrec&quot;    &quot;exconst&quot;  &quot;polcomp&quot;  &quot;prior&quot;    &quot;emonth&quot;   &quot;eday&quot;    </span>
<span class="co">#&gt; [25] &quot;eyear&quot;    &quot;eprec&quot;    &quot;interim&quot;  &quot;bmonth&quot;   &quot;bday&quot;     &quot;byear&quot;   </span>
<span class="co">#&gt; [31] &quot;bprec&quot;    &quot;post&quot;     &quot;change&quot;   &quot;d4&quot;       &quot;sf&quot;       &quot;regtrans&quot;</span></code></pre></div>
</div>
<div id="challenge-3.-extract-the-5th-row-from-the-polity-dataset." class="section level4 unnumbered">
<h4>Challenge 3. Extract the 5th row from the polity dataset.</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">polity[<span class="dv">5</span>, ]
<span class="co">#&gt;     cyear ccode scode     country year flag fragment democ autoc polity</span>
<span class="co">#&gt; 5 7001804   700   AFG Afghanistan 1804    0       NA     1     7     -6</span>
<span class="co">#&gt;   polity2 durable xrreg xrcomp xropen xconst parreg parcomp exrec exconst</span>
<span class="co">#&gt; 5      -6      NA     3      1      1      1      3       3     1       1</span>
<span class="co">#&gt;   polcomp prior emonth eday eyear eprec interim bmonth bday byear bprec</span>
<span class="co">#&gt; 5       6    NA     NA   NA    NA    NA      NA     NA   NA    NA    NA</span>
<span class="co">#&gt;   post change d4 sf regtrans</span>
<span class="co">#&gt; 5   NA     NA NA NA       NA</span></code></pre></div>
</div>
<div id="challenge-4.-extract-the-last-row-from-the-polity-dataset." class="section level4 unnumbered">
<h4>Challenge 4. Extract the last row from the polity dataset.</h4>
</div>
<div id="challenge-5.-count-the-percentage-of-observations-with-a-value-of-polity2-greater-than-8-in-the-gapminder-dataset." class="section level4 unnumbered">
<h4>Challenge 5. Count the percentage of observations with a value of <code>polity2</code> greater than 8 in the gapminder dataset.</h4>
<p>(Hint: if using sum(), read the help file..)</p>
</div>
<div id="challenge-6.-set-all-of-the-values-of-democ-and-autac-columns-less-than--10-to-na." class="section level4 unnumbered">
<h4>Challenge 6. Set all of the values of <code>democ</code> and <code>autac</code> columns less than -10 to NA.</h4>
<p>(Hint: You should first copy the <code>polity</code> object and work on the copy so that the original dataset is unchanged (or just read the data into R again afterwards to get a clean copy)</p>
<!--chapter:end:06_Data-Basics/06-3_Data-Basics.Rmd-->
</div>
</div>
</div>
</div>
<div id="data-transformation" class="section level1">
<h1><span class="header-section-number">9</span> Data Transformation</h1>
<div id="introduction-1" class="section level2">
<h2><span class="header-section-number">9.1</span> Introduction</h2>
<div id="tidyverse" class="section level3">
<h3><span class="header-section-number">9.1.1</span> <code>tidyverse</code></h3>
<blockquote>
<p>It is often said that 80% of data analysis is spent on the process of cleaning and preparing the data. (Dasu and Johnson, 2003)</p>
</blockquote>
<p>For most applied researchers, data preparation usually involves 3 main steps.</p>
<ol style="list-style-type: decimal">
<li><strong><em>Transforming</em></strong> data frames, e.g. filtering, summarizing, and conducting calculations across groups.</li>
<li><strong><em>Tidying</em></strong> data into the appropriate format.</li>
<li><strong><em>Merging</em></strong> or linking several datasets to create a bigger dataset.</li>
</ol>
<p>The <a href="https://www.tidyverse.org/"><code>tidyverse</code></a> is a suite of packages designed specifically to help with these steps. These are by no means the only packages out there for data wrangling, but they are increasingly popular for their readable, straightforward syntax and sensible default behaviors.</p>
<p>In this chapter, we’re going to focus on how to use the <code>dplyr</code> package for data transformation tasks.</p>
</div>
<div id="gapminder" class="section level3">
<h3><span class="header-section-number">9.1.2</span> Gapminder</h3>
<p>For this unit, we’ll be working with the “Gapminder” dataset again.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gap &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/gapminder-FiveYearData.csv&quot;</span>, <span class="dt">stringsAsFactors =</span> <span class="ot">TRUE</span>)
<span class="kw">kable</span>(<span class="kw">head</span>(gap))</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:left;">
country
</th>
<th style="text-align:right;">
year
</th>
<th style="text-align:right;">
pop
</th>
<th style="text-align:left;">
continent
</th>
<th style="text-align:right;">
lifeExp
</th>
<th style="text-align:right;">
gdpPercap
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:right;">
1952
</td>
<td style="text-align:right;">
8425333
</td>
<td style="text-align:left;">
Asia
</td>
<td style="text-align:right;">
28.8
</td>
<td style="text-align:right;">
779
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:right;">
1957
</td>
<td style="text-align:right;">
9240934
</td>
<td style="text-align:left;">
Asia
</td>
<td style="text-align:right;">
30.3
</td>
<td style="text-align:right;">
821
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:right;">
1962
</td>
<td style="text-align:right;">
10267083
</td>
<td style="text-align:left;">
Asia
</td>
<td style="text-align:right;">
32.0
</td>
<td style="text-align:right;">
853
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:right;">
1967
</td>
<td style="text-align:right;">
11537966
</td>
<td style="text-align:left;">
Asia
</td>
<td style="text-align:right;">
34.0
</td>
<td style="text-align:right;">
836
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:right;">
1972
</td>
<td style="text-align:right;">
13079460
</td>
<td style="text-align:left;">
Asia
</td>
<td style="text-align:right;">
36.1
</td>
<td style="text-align:right;">
740
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:right;">
1977
</td>
<td style="text-align:right;">
14880372
</td>
<td style="text-align:left;">
Asia
</td>
<td style="text-align:right;">
38.4
</td>
<td style="text-align:right;">
786
</td>
</tr>
</tbody>
</table>
</div>
<div id="why-dplyr" class="section level3">
<h3><span class="header-section-number">9.1.3</span> Why <code>dplyr</code>?</h3>
<p>So far, you’ve seen the basics of manipulating data frames, e.g. subsetting and basic calculations. For instance, we can use base R functions to calculate summary statistics across groups of observations, e.g., the mean GDP per capita within each region:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mean</span>(gap[gap<span class="op">$</span>continent <span class="op">==</span><span class="st"> &quot;Africa&quot;</span>, <span class="st">&quot;gdpPercap&quot;</span>])
<span class="co">#&gt; [1] 2194</span>
<span class="kw">mean</span>(gap[gap<span class="op">$</span>continent <span class="op">==</span><span class="st"> &quot;Americas&quot;</span>, <span class="st">&quot;gdpPercap&quot;</span>])
<span class="co">#&gt; [1] 7136</span>
<span class="kw">mean</span>(gap[gap<span class="op">$</span>continent <span class="op">==</span><span class="st"> &quot;Asia&quot;</span>, <span class="st">&quot;gdpPercap&quot;</span>])
<span class="co">#&gt; [1] 7902</span></code></pre></div>
<p>But this isn’t ideal because it involves a fair bit of repetition. Repeating yourself will cost you time, both now and later, and potentially introduce some nasty bugs.</p>
<p>Luckily, the <a href="https://cran.r-project.org/web/packages/dplyr/dplyr.pdf"><code>dplyr</code></a> package provides a number of very useful functions for manipulating dataframes. These functions will save you time by reducing repetition. As an added bonus, you might even find the <code>dplyr</code> grammar easier to read.</p>
<p>Here, we’re going to cover 6 of the most commonly used <code>dplyr</code> functions. We’ll also cover pipes (<code>%&gt;%</code>), which are used to combine them.</p>
<ol style="list-style-type: decimal">
<li><code>select()</code></li>
<li><code>filter()</code></li>
<li><code>group_by()</code></li>
<li><code>summarize()</code></li>
<li><code>mutate()</code></li>
<li><code>arrange()</code></li>
</ol>
<p>If you have have not installed this package earlier, please do so now:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># not run</span>
<span class="co"># install.packages(&#39;dplyr&#39;)</span></code></pre></div>
<p>Now let’s load the package:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(dplyr)</code></pre></div>
</div>
</div>
<div id="dplyr-functions" class="section level2">
<h2><span class="header-section-number">9.2</span> <code>dplyr</code> Functions</h2>
<div id="select-columns-with-select" class="section level3">
<h3><span class="header-section-number">9.2.1</span> Select Columns with <code>select</code></h3>
<p>Imagine that we just received the gapminder dataset, but are only interested in a few variables in it. We could use the <code>select()</code> function to keep only the variables we select.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">year_country_gdp &lt;-<span class="st"> </span><span class="kw">select</span>(gap, year, country, gdpPercap)
<span class="kw">kable</span>(<span class="kw">head</span>(year_country_gdp))</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:right;">
year
</th>
<th style="text-align:left;">
country
</th>
<th style="text-align:right;">
gdpPercap
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1952
</td>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:right;">
779
</td>
</tr>
<tr>
<td style="text-align:right;">
1957
</td>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:right;">
821
</td>
</tr>
<tr>
<td style="text-align:right;">
1962
</td>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:right;">
853
</td>
</tr>
<tr>
<td style="text-align:right;">
1967
</td>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:right;">
836
</td>
</tr>
<tr>
<td style="text-align:right;">
1972
</td>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:right;">
740
</td>
</tr>
<tr>
<td style="text-align:right;">
1977
</td>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:right;">
786
</td>
</tr>
</tbody>
</table>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">knitr<span class="op">::</span><span class="kw">include_graphics</span>(<span class="dt">path =</span> <span class="st">&quot;img/dplyr-fig1.png&quot;</span>)</code></pre></div>
<p><img src="img/dplyr-fig1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>If we open up <code>year_country_gdp</code>, we’ll see that it only contains the year, country and gdpPercap. This is equivalent to the base R subsetting function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">year_country_gdp_base &lt;-<span class="st"> </span>gap[,<span class="kw">c</span>(<span class="st">&quot;year&quot;</span>, <span class="st">&quot;country&quot;</span>, <span class="st">&quot;gdpPercap&quot;</span>)]
<span class="kw">kable</span>(<span class="kw">head</span>(year_country_gdp))</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:right;">
year
</th>
<th style="text-align:left;">
country
</th>
<th style="text-align:right;">
gdpPercap
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1952
</td>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:right;">
779
</td>
</tr>
<tr>
<td style="text-align:right;">
1957
</td>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:right;">
821
</td>
</tr>
<tr>
<td style="text-align:right;">
1962
</td>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:right;">
853
</td>
</tr>
<tr>
<td style="text-align:right;">
1967
</td>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:right;">
836
</td>
</tr>
<tr>
<td style="text-align:right;">
1972
</td>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:right;">
740
</td>
</tr>
<tr>
<td style="text-align:right;">
1977
</td>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:right;">
786
</td>
</tr>
</tbody>
</table>
<p>But, as we will see, <code>dplyr</code> makes for much more readible, efficient code because of its <em>pipe</em> operator.</p>
</div>
<div id="the-pipe" class="section level3">
<h3><span class="header-section-number">9.2.2</span> The Pipe</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">knitr<span class="op">::</span><span class="kw">include_graphics</span>(<span class="dt">path =</span> <span class="st">&quot;img/pipe.jpg&quot;</span>)</code></pre></div>
<p><img src="img/pipe.jpg" width="70%" style="display: block; margin: auto;" /></p>
<p>Above, we used what’s called ‘normal’ grammar, but the strengths of <code>dplyr</code> lie in combining several functions using <em>pipes</em>. Since the pipes grammar is unlike anything we’ve seen in R before, let’s repeat what we’ve done above using pipes.</p>
<p>In typical base R code, a simple operation might be written like:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># NOT run</span>
cupcakes &lt;-<span class="st"> </span><span class="kw">bake</span>(<span class="kw">pour</span>(<span class="kw">mix</span>(ingredients)))</code></pre></div>
<p>A computer has no trouble understanding this and your cupcakes will be made just fine, but a person has to read right to left to understand the order of operations - the opposite of how most western languages are read - making it harder to understand what is being done!</p>
<p>To be more readable without pipes, we might break up this code into intermediate objects:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## NOT run
batter &lt;-<span class="st"> </span><span class="kw">mix</span>(ingredients)
muffin_tin &lt;-<span class="st"> </span><span class="kw">pour</span>(batter)
cupcakes &lt;-<span class="st"> </span><span class="kw">bake</span>(muffin_tin)</code></pre></div>
<p>But, this can clutter our environment with a lot of variables that aren’t very useful to us. Plus, these variables are often are named very similar things (e.g. step, step1, step2…) which can lead to confusion and the creation of hard-to-track-down bugs.</p>
<div id="enter-the-pipe" class="section level4 unnumbered">
<h4>Enter the Pipe…</h4>
<p>The <em>pipe</em> makes it easier to read code by laying out operations from left to right – each line can be read like a line of a recipe for the perfect data frame!</p>
<p>Pipes take the input on the left side of the <code>%&gt;%</code> symbol and pass it in as the first argument to the function on the right side.</p>
<p>With pipes, our cupcake example might be written like:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## NOT run
cupcakes &lt;-<span class="st"> </span>ingredients <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mix</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">pour</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">bake</span>()</code></pre></div>
</div>
<div id="tips-for-piping" class="section level4 unnumbered">
<h4>Tips for Piping</h4>
<ol style="list-style-type: decimal">
<li><p>Remember that you don’t assign anything within the pipes – that is, you should not use &lt;- inside the piped operation. Only use this at the beginning of your code if you want to save the output.</p></li>
<li><p>Remember to add the pipe <code>%&gt;%</code> at the end of each line involved in the piped operation. A good rule of thumb: since RStudio will automatically indent lines of code that are part of a piped operation, if the line isn’t indented, it probably hasn’t been added to the pipe. If you have an error in a piped operation, always check to make sure the pipe is connected as you expect.</p></li>
<li><p>In RStudio, the hotkey for the pipe is Ctrl + Shift + M.</p></li>
</ol>
</div>
<div id="select-pipe" class="section level4 unnumbered">
<h4><code>select</code> &amp; Pipe (<code>%&gt;%</code>)</h4>
<p>Since the pipe grammar is unlike anything we’ve seen in R before, let’s repeat what we did above with the gapminder dataset using pipes:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">year_country_gdp &lt;-<span class="st"> </span>gap <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(year, country, gdpPercap)</code></pre></div>
<p>Let’s walk through it step by step.</p>
<p>First, we summon the gapminder data frame and pass it on to the next step using the pipe symbol <code>%&gt;%</code>.</p>
<p>The second step is the <code>select()</code> function. In this case, we don’t specify which data object we use in the call to <code>select()</code> since we’ve piped it in from the previous line.</p>
<p><strong>Fun Fact</strong>: There is a good chance you have encountered pipes before in the shell. In R, a pipe symbol is <code>%&gt;%</code> while in the shell it is <code>|.</code> But the concept is the same!</p>
</div>
</div>
<div id="filter-rows-with-filter" class="section level3">
<h3><span class="header-section-number">9.2.3</span> Filter Rows with <code>filter</code></h3>
<p>Now let’s say we’re only interested in African countries. We can combine <code>select</code> and <code>filter</code> to select only the observations where <code>continent</code> is <code>Africa</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">year_country_gdp_africa &lt;-<span class="st"> </span>gap <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">filter</span>(continent <span class="op">==</span><span class="st"> &quot;Africa&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">select</span>(year, country, gdpPercap)</code></pre></div>
<p>As with last time, first we pass the gapminder dataframe to the <code>filter()</code> function, then we pass the filtered version of the gapminder dataframe to the <code>select()</code> function.</p>
<p>To clarify, both the <code>select</code> and <code>filter</code> functions subset the data frame. The difference is that <code>select</code> extracts certain columns, while <code>filter</code> extracts certain rows.</p>
<p><strong>Note:</strong> The order of operations is very important in this case. If we used <code>select</code> first, filter would not be able to find the variable <code>continent</code> since we would have removed it in the previous step.</p>
</div>
<div id="calculate-across-groups-with-group_by" class="section level3">
<h3><span class="header-section-number">9.2.4</span> Calculate Across Groups with <code>group_by</code></h3>
<p>A common task you’ll encounter when working with data is running calculations on different groups within the data. For instance, what if we wanted to calculate the mean GDP per capita for each continent?</p>
<p>In base R, you would have to run the <code>mean()</code> function for each subset of data:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mean</span>(gap<span class="op">$</span>gdpPercap[gap<span class="op">$</span>continent <span class="op">==</span><span class="st"> &quot;Africa&quot;</span>])
<span class="co">#&gt; [1] 2194</span>
<span class="kw">mean</span>(gap<span class="op">$</span>gdpPercap[gap<span class="op">$</span>continent <span class="op">==</span><span class="st"> &quot;Americas&quot;</span>])
<span class="co">#&gt; [1] 7136</span>
<span class="kw">mean</span>(gap<span class="op">$</span>gdpPercap[gap<span class="op">$</span>continent <span class="op">==</span><span class="st"> &quot;Asia&quot;</span>])
<span class="co">#&gt; [1] 7902</span>
<span class="kw">mean</span>(gap<span class="op">$</span>gdpPercap[gap<span class="op">$</span>continent <span class="op">==</span><span class="st"> &quot;Europe&quot;</span>])
<span class="co">#&gt; [1] 14469</span>
<span class="kw">mean</span>(gap<span class="op">$</span>gdpPercap[gap<span class="op">$</span>continent <span class="op">==</span><span class="st"> &quot;Oceania&quot;</span>])
<span class="co">#&gt; [1] 18622</span></code></pre></div>
<p>That’s a lot of repetition! To make matters worse, what if we wanted to add these values to our original data frame as a new column? We would have to write something like this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gap<span class="op">$</span>mean.continent.GDP &lt;-<span class="st"> </span><span class="ot">NA</span>
gap<span class="op">$</span>mean.continent.GDP[gap<span class="op">$</span>continent <span class="op">==</span><span class="st"> &quot;Africa&quot;</span>] &lt;-<span class="st"> </span><span class="kw">mean</span>(gap<span class="op">$</span>gdpPercap[gap<span class="op">$</span>continent <span class="op">==</span><span class="st"> &quot;Africa&quot;</span>])
gap<span class="op">$</span>mean.continent.GDP[gap<span class="op">$</span>continent <span class="op">==</span><span class="st"> &quot;Americas&quot;</span>] &lt;-<span class="st"> </span><span class="kw">mean</span>(gap<span class="op">$</span>gdpPercap[gap<span class="op">$</span>continent <span class="op">==</span><span class="st"> &quot;Americas&quot;</span>])
gap<span class="op">$</span>mean.continent.GDP[gap<span class="op">$</span>continent <span class="op">==</span><span class="st"> &quot;Asia&quot;</span>] &lt;-<span class="st"> </span><span class="kw">mean</span>(gap<span class="op">$</span>gdpPercap[gap<span class="op">$</span>continent <span class="op">==</span><span class="st"> &quot;Asia&quot;</span>])
gap<span class="op">$</span>mean.continent.GDP[gap<span class="op">$</span>continent <span class="op">==</span><span class="st"> &quot;Europe&quot;</span>] &lt;-<span class="st"> </span><span class="kw">mean</span>(gap<span class="op">$</span>gdpPercap[gap<span class="op">$</span>continent <span class="op">==</span><span class="st"> &quot;Europe&quot;</span>])
gap<span class="op">$</span>mean.continent.GDP[gap<span class="op">$</span>continent <span class="op">==</span><span class="st"> &quot;Oceania&quot;</span>] &lt;-<span class="st"> </span><span class="kw">mean</span>(gap<span class="op">$</span>gdpPercap[gap<span class="op">$</span>continent <span class="op">==</span><span class="st"> &quot;Oceania&quot;</span>])</code></pre></div>
<p>You can see how this can get pretty tedious, especially if we want to calculate more complicated or refined statistics. We could use loops or apply functions, but these can be difficult, slow, and error-prone.</p>
<div id="split-apply-combine" class="section level4 unnumbered">
<h4>split-apply-combine</h4>
<p>The abstract problem we’re encountering here is know as “split-apply-combine”:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">knitr<span class="op">::</span><span class="kw">include_graphics</span>(<span class="dt">path =</span> <span class="st">&quot;img/splitapply.png&quot;</span>)</code></pre></div>
<p><img src="img/splitapply.png" width="70%" style="display: block; margin: auto;" /></p>
<p>We want to <em>split</em> our data into groups (in this case continents), <em>apply</em> some calculations on that group, then <em>combine</em> the results together afterwards.</p>
<p>Luckily, <code>dplyr</code> offers a much cleaner, straight-forward solution to this problem.</p>
<p>First, let’s remove the column we just made.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gap &lt;-<span class="st"> </span>gap <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span>mean.continent.GDP) <span class="co"># drop a column with - </span>
<span class="co"># OR</span>
gap<span class="op">$</span>mean.continent.GDP &lt;-<span class="st"> </span><span class="ot">NULL</span></code></pre></div>
</div>
<div id="group_by" class="section level4">
<h4><span class="header-section-number">9.2.4.1</span> <code class="unnumbered">group_by</code></h4>
<p>We’ve already seen how <code>filter()</code> can help us select observations that meet certain criteria (in the above: <code>continent == &quot;Africa&quot;</code>). More helpful, however, is the <code>group_by()</code> function, which will essentially use every unique criteria that we could have used in <code>filter()</code>.</p>
<p>A <code>grouped_df</code> can be thought of as a <code>list</code> where each item in the <code>list</code> is a <code>data.frame</code> which contains only the rows that correspond to a particular value for <code>continent</code> (at least in the example above).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">knitr<span class="op">::</span><span class="kw">include_graphics</span>(<span class="dt">path =</span> <span class="st">&quot;img/dplyr-fig2.png&quot;</span>)</code></pre></div>
<p><img src="img/dplyr-fig2.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="summarize-across-groups-with-summarize" class="section level3">
<h3><span class="header-section-number">9.2.5</span> Summarize Across Groups with <code>summarize</code></h3>
<p><code>group_by()</code> on its own is not particularly interesting. It’s much more exciting used in conjunction with the <code>summarize()</code> function.</p>
<p>This will allow us to create new variable(s) by applying transformations to variables in each of our groups (continent-specific data frames).</p>
<p>In other words, using the <code>group_by()</code> function, we split our original data frame into multiple pieces, to which we then apply summary functions (e.g. <code>mean()</code> or <code>sd()</code>) within <code>summarize()</code>.</p>
<p>The output is a new data frame reduced in size, with one row per group.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gdp_bycontinents &lt;-<span class="st"> </span>gap <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">group_by</span>(continent) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">summarize</span>(<span class="dt">mean_gdpPercap =</span> <span class="kw">mean</span>(gdpPercap))
<span class="kw">kable</span>(<span class="kw">head</span>(gdp_bycontinents))</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:left;">
continent
</th>
<th style="text-align:right;">
mean_gdpPercap
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Africa
</td>
<td style="text-align:right;">
2194
</td>
</tr>
<tr>
<td style="text-align:left;">
Americas
</td>
<td style="text-align:right;">
7136
</td>
</tr>
<tr>
<td style="text-align:left;">
Asia
</td>
<td style="text-align:right;">
7902
</td>
</tr>
<tr>
<td style="text-align:left;">
Europe
</td>
<td style="text-align:right;">
14469
</td>
</tr>
<tr>
<td style="text-align:left;">
Oceania
</td>
<td style="text-align:right;">
18622
</td>
</tr>
</tbody>
</table>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">knitr<span class="op">::</span><span class="kw">include_graphics</span>(<span class="dt">path =</span> <span class="st">&quot;img/dplyr-fig3.png&quot;</span>)</code></pre></div>
<p><img src="img/dplyr-fig3.png" width="70%" style="display: block; margin: auto;" /></p>
<p>That allowed us to calculate the mean gdpPercap for each continent.</p>
<p>But it gets even better – the function <code>group_by()</code> allows us to group by multiple variables. Let’s group by <code>year</code> and <code>continent</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gdp_bycontinents_byyear &lt;-<span class="st"> </span>gap <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">group_by</span>(continent, year) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">summarize</span>(<span class="dt">mean_gdpPercap =</span> <span class="kw">mean</span>(gdpPercap))
<span class="kw">kable</span>(<span class="kw">head</span>(gdp_bycontinents_byyear))</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:left;">
continent
</th>
<th style="text-align:right;">
year
</th>
<th style="text-align:right;">
mean_gdpPercap
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Africa
</td>
<td style="text-align:right;">
1952
</td>
<td style="text-align:right;">
1253
</td>
</tr>
<tr>
<td style="text-align:left;">
Africa
</td>
<td style="text-align:right;">
1957
</td>
<td style="text-align:right;">
1385
</td>
</tr>
<tr>
<td style="text-align:left;">
Africa
</td>
<td style="text-align:right;">
1962
</td>
<td style="text-align:right;">
1598
</td>
</tr>
<tr>
<td style="text-align:left;">
Africa
</td>
<td style="text-align:right;">
1967
</td>
<td style="text-align:right;">
2050
</td>
</tr>
<tr>
<td style="text-align:left;">
Africa
</td>
<td style="text-align:right;">
1972
</td>
<td style="text-align:right;">
2340
</td>
</tr>
<tr>
<td style="text-align:left;">
Africa
</td>
<td style="text-align:right;">
1977
</td>
<td style="text-align:right;">
2586
</td>
</tr>
</tbody>
</table>
<p>That is already quite powerful, but it gets even better! You’re not limited to defining 1 new variable in <code>summarize()</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gdp_pop_bycontinents_byyear &lt;-<span class="st"> </span>gap <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">group_by</span>(continent, year) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">summarize</span>(<span class="dt">mean_gdpPercap =</span> <span class="kw">mean</span>(gdpPercap),
              <span class="dt">sd_gdpPercap =</span> <span class="kw">sd</span>(gdpPercap),
              <span class="dt">mean_pop =</span> <span class="kw">mean</span>(pop),
              <span class="dt">sd_pop =</span> <span class="kw">sd</span>(pop))
<span class="kw">kable</span>(<span class="kw">head</span>(gdp_pop_bycontinents_byyear))</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:left;">
continent
</th>
<th style="text-align:right;">
year
</th>
<th style="text-align:right;">
mean_gdpPercap
</th>
<th style="text-align:right;">
sd_gdpPercap
</th>
<th style="text-align:right;">
mean_pop
</th>
<th style="text-align:right;">
sd_pop
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Africa
</td>
<td style="text-align:right;">
1952
</td>
<td style="text-align:right;">
1253
</td>
<td style="text-align:right;">
983
</td>
<td style="text-align:right;">
4570010
</td>
<td style="text-align:right;">
6317450
</td>
</tr>
<tr>
<td style="text-align:left;">
Africa
</td>
<td style="text-align:right;">
1957
</td>
<td style="text-align:right;">
1385
</td>
<td style="text-align:right;">
1135
</td>
<td style="text-align:right;">
5093033
</td>
<td style="text-align:right;">
7076042
</td>
</tr>
<tr>
<td style="text-align:left;">
Africa
</td>
<td style="text-align:right;">
1962
</td>
<td style="text-align:right;">
1598
</td>
<td style="text-align:right;">
1462
</td>
<td style="text-align:right;">
5702247
</td>
<td style="text-align:right;">
7957545
</td>
</tr>
<tr>
<td style="text-align:left;">
Africa
</td>
<td style="text-align:right;">
1967
</td>
<td style="text-align:right;">
2050
</td>
<td style="text-align:right;">
2848
</td>
<td style="text-align:right;">
6447875
</td>
<td style="text-align:right;">
8985505
</td>
</tr>
<tr>
<td style="text-align:left;">
Africa
</td>
<td style="text-align:right;">
1972
</td>
<td style="text-align:right;">
2340
</td>
<td style="text-align:right;">
3287
</td>
<td style="text-align:right;">
7305376
</td>
<td style="text-align:right;">
10130833
</td>
</tr>
<tr>
<td style="text-align:left;">
Africa
</td>
<td style="text-align:right;">
1977
</td>
<td style="text-align:right;">
2586
</td>
<td style="text-align:right;">
4142
</td>
<td style="text-align:right;">
8328097
</td>
<td style="text-align:right;">
11585184
</td>
</tr>
</tbody>
</table>
</div>
<div id="add-new-variables-with-mutate" class="section level3">
<h3><span class="header-section-number">9.2.6</span> Add New Variables with <code>mutate</code></h3>
<p>What if we wanted to add these values to our original data frame instead of creating a new object?</p>
<p>For this, we can use the <code>mutate()</code> function, which is similar to <code>summarize()</code> except that it creates new variables in the same dataframe that you pass into it.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gapminder_with_extra_vars &lt;-<span class="st"> </span>gap <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">group_by</span>(continent, year) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">mean_gdpPercap =</span> <span class="kw">mean</span>(gdpPercap),
              <span class="dt">sd_gdpPercap =</span> <span class="kw">sd</span>(gdpPercap),
              <span class="dt">mean_pop =</span> <span class="kw">mean</span>(pop),
              <span class="dt">sd_pop =</span> <span class="kw">sd</span>(pop))
<span class="kw">kable</span>(<span class="kw">head</span>(gapminder_with_extra_vars))</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:left;">
country
</th>
<th style="text-align:right;">
year
</th>
<th style="text-align:right;">
pop
</th>
<th style="text-align:left;">
continent
</th>
<th style="text-align:right;">
lifeExp
</th>
<th style="text-align:right;">
gdpPercap
</th>
<th style="text-align:right;">
mean_gdpPercap
</th>
<th style="text-align:right;">
sd_gdpPercap
</th>
<th style="text-align:right;">
mean_pop
</th>
<th style="text-align:right;">
sd_pop
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:right;">
1952
</td>
<td style="text-align:right;">
8425333
</td>
<td style="text-align:left;">
Asia
</td>
<td style="text-align:right;">
28.8
</td>
<td style="text-align:right;">
779
</td>
<td style="text-align:right;">
5195
</td>
<td style="text-align:right;">
18635
</td>
<td style="text-align:right;">
42283556
</td>
<td style="text-align:right;">
1.13e+08
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:right;">
1957
</td>
<td style="text-align:right;">
9240934
</td>
<td style="text-align:left;">
Asia
</td>
<td style="text-align:right;">
30.3
</td>
<td style="text-align:right;">
821
</td>
<td style="text-align:right;">
5788
</td>
<td style="text-align:right;">
19507
</td>
<td style="text-align:right;">
47356988
</td>
<td style="text-align:right;">
1.28e+08
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:right;">
1962
</td>
<td style="text-align:right;">
10267083
</td>
<td style="text-align:left;">
Asia
</td>
<td style="text-align:right;">
32.0
</td>
<td style="text-align:right;">
853
</td>
<td style="text-align:right;">
5729
</td>
<td style="text-align:right;">
16416
</td>
<td style="text-align:right;">
51404763
</td>
<td style="text-align:right;">
1.36e+08
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:right;">
1967
</td>
<td style="text-align:right;">
11537966
</td>
<td style="text-align:left;">
Asia
</td>
<td style="text-align:right;">
34.0
</td>
<td style="text-align:right;">
836
</td>
<td style="text-align:right;">
5971
</td>
<td style="text-align:right;">
14063
</td>
<td style="text-align:right;">
57747361
</td>
<td style="text-align:right;">
1.53e+08
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:right;">
1972
</td>
<td style="text-align:right;">
13079460
</td>
<td style="text-align:left;">
Asia
</td>
<td style="text-align:right;">
36.1
</td>
<td style="text-align:right;">
740
</td>
<td style="text-align:right;">
8187
</td>
<td style="text-align:right;">
19088
</td>
<td style="text-align:right;">
65180977
</td>
<td style="text-align:right;">
1.74e+08
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:right;">
1977
</td>
<td style="text-align:right;">
14880372
</td>
<td style="text-align:left;">
Asia
</td>
<td style="text-align:right;">
38.4
</td>
<td style="text-align:right;">
786
</td>
<td style="text-align:right;">
7791
</td>
<td style="text-align:right;">
11816
</td>
<td style="text-align:right;">
72257987
</td>
<td style="text-align:right;">
1.92e+08
</td>
</tr>
</tbody>
</table>
<p>We can use also use <code>mutate()</code> to create new variables prior to (or even after) summarizing the information.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gdp_pop_bycontinents_byyear &lt;-<span class="st"> </span>gap <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">gdp_billion =</span> gdpPercap<span class="op">*</span>pop<span class="op">/</span><span class="dv">10</span><span class="op">^</span><span class="dv">9</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">group_by</span>(continent, year) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">summarize</span>(<span class="dt">mean_gdpPercap =</span> <span class="kw">mean</span>(gdpPercap),
              <span class="dt">sd_gdpPercap =</span> <span class="kw">sd</span>(gdpPercap),
              <span class="dt">mean_pop =</span> <span class="kw">mean</span>(pop),
              <span class="dt">sd_pop =</span> <span class="kw">sd</span>(pop),
              <span class="dt">mean_gdp_billion =</span> <span class="kw">mean</span>(gdp_billion),
              <span class="dt">sd_gdp_billion =</span> <span class="kw">sd</span>(gdp_billion))
<span class="kw">kable</span>(<span class="kw">head</span>(gdp_pop_bycontinents_byyear))</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:left;">
continent
</th>
<th style="text-align:right;">
year
</th>
<th style="text-align:right;">
mean_gdpPercap
</th>
<th style="text-align:right;">
sd_gdpPercap
</th>
<th style="text-align:right;">
mean_pop
</th>
<th style="text-align:right;">
sd_pop
</th>
<th style="text-align:right;">
mean_gdp_billion
</th>
<th style="text-align:right;">
sd_gdp_billion
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Africa
</td>
<td style="text-align:right;">
1952
</td>
<td style="text-align:right;">
1253
</td>
<td style="text-align:right;">
983
</td>
<td style="text-align:right;">
4570010
</td>
<td style="text-align:right;">
6317450
</td>
<td style="text-align:right;">
5.99
</td>
<td style="text-align:right;">
11.4
</td>
</tr>
<tr>
<td style="text-align:left;">
Africa
</td>
<td style="text-align:right;">
1957
</td>
<td style="text-align:right;">
1385
</td>
<td style="text-align:right;">
1135
</td>
<td style="text-align:right;">
5093033
</td>
<td style="text-align:right;">
7076042
</td>
<td style="text-align:right;">
7.36
</td>
<td style="text-align:right;">
14.5
</td>
</tr>
<tr>
<td style="text-align:left;">
Africa
</td>
<td style="text-align:right;">
1962
</td>
<td style="text-align:right;">
1598
</td>
<td style="text-align:right;">
1462
</td>
<td style="text-align:right;">
5702247
</td>
<td style="text-align:right;">
7957545
</td>
<td style="text-align:right;">
8.79
</td>
<td style="text-align:right;">
17.2
</td>
</tr>
<tr>
<td style="text-align:left;">
Africa
</td>
<td style="text-align:right;">
1967
</td>
<td style="text-align:right;">
2050
</td>
<td style="text-align:right;">
2848
</td>
<td style="text-align:right;">
6447875
</td>
<td style="text-align:right;">
8985505
</td>
<td style="text-align:right;">
11.44
</td>
<td style="text-align:right;">
23.2
</td>
</tr>
<tr>
<td style="text-align:left;">
Africa
</td>
<td style="text-align:right;">
1972
</td>
<td style="text-align:right;">
2340
</td>
<td style="text-align:right;">
3287
</td>
<td style="text-align:right;">
7305376
</td>
<td style="text-align:right;">
10130833
</td>
<td style="text-align:right;">
15.07
</td>
<td style="text-align:right;">
30.4
</td>
</tr>
<tr>
<td style="text-align:left;">
Africa
</td>
<td style="text-align:right;">
1977
</td>
<td style="text-align:right;">
2586
</td>
<td style="text-align:right;">
4142
</td>
<td style="text-align:right;">
8328097
</td>
<td style="text-align:right;">
11585184
</td>
<td style="text-align:right;">
18.70
</td>
<td style="text-align:right;">
38.1
</td>
</tr>
</tbody>
</table>
<div id="mutate-vs.-summarize" class="section level4 unnumbered">
<h4><code>mutate</code> vs. <code>summarize</code></h4>
<p>It can be confusing to decide whether to use <code>mutate</code> or <code>summarize</code>. The key distinction is whether you want the output to have one row for each group or one row for each row in the original data frame:</p>
<ul>
<li><code>mutate</code>: creates new columns with as many rows as the original data frame</li>
<li><code>summarize</code>: creates a data frame with as many rows as groups</li>
</ul>
<p>Note that if you use an aggregation function such as <code>mean()</code> within <code>mutate()</code> without using <code>group_by()</code>, you’ll simply do the summary over all the rows of the input data frame.</p>
<p>And if you use an aggregation function such as <code>mean()</code> within <code>summarize()</code> without using <code>group_by()</code>, you’ll simply create an output data frame with one row (i.e., the whole input data frame is a single group).</p>
</div>
</div>
<div id="arrange-rows-with-arrange" class="section level3">
<h3><span class="header-section-number">9.2.7</span> Arrange Rows with <code>arrange</code></h3>
<p>As a last step, let’s say we want to sort the rows in our data frame according to values in a certain column. We can use the <code>arrange()</code> function to do this. For instance, let’s organize our rows by <code>year</code> (recent first), and then by <code>continent</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gapminder_with_extra_vars &lt;-<span class="st"> </span>gap <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">group_by</span>(continent, year) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">mean_gdpPercap =</span> <span class="kw">mean</span>(gdpPercap),
              <span class="dt">sd_gdpPercap =</span> <span class="kw">sd</span>(gdpPercap),
              <span class="dt">mean_pop =</span> <span class="kw">mean</span>(pop),
              <span class="dt">sd_pop =</span> <span class="kw">sd</span>(pop)) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">arrange</span>(<span class="kw">desc</span>(year), continent)
<span class="kw">kable</span>(<span class="kw">head</span>(gapminder_with_extra_vars))</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:left;">
country
</th>
<th style="text-align:right;">
year
</th>
<th style="text-align:right;">
pop
</th>
<th style="text-align:left;">
continent
</th>
<th style="text-align:right;">
lifeExp
</th>
<th style="text-align:right;">
gdpPercap
</th>
<th style="text-align:right;">
mean_gdpPercap
</th>
<th style="text-align:right;">
sd_gdpPercap
</th>
<th style="text-align:right;">
mean_pop
</th>
<th style="text-align:right;">
sd_pop
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Algeria
</td>
<td style="text-align:right;">
2007
</td>
<td style="text-align:right;">
33333216
</td>
<td style="text-align:left;">
Africa
</td>
<td style="text-align:right;">
72.3
</td>
<td style="text-align:right;">
6223
</td>
<td style="text-align:right;">
3089
</td>
<td style="text-align:right;">
3618
</td>
<td style="text-align:right;">
17875763
</td>
<td style="text-align:right;">
24917726
</td>
</tr>
<tr>
<td style="text-align:left;">
Angola
</td>
<td style="text-align:right;">
2007
</td>
<td style="text-align:right;">
12420476
</td>
<td style="text-align:left;">
Africa
</td>
<td style="text-align:right;">
42.7
</td>
<td style="text-align:right;">
4797
</td>
<td style="text-align:right;">
3089
</td>
<td style="text-align:right;">
3618
</td>
<td style="text-align:right;">
17875763
</td>
<td style="text-align:right;">
24917726
</td>
</tr>
<tr>
<td style="text-align:left;">
Benin
</td>
<td style="text-align:right;">
2007
</td>
<td style="text-align:right;">
8078314
</td>
<td style="text-align:left;">
Africa
</td>
<td style="text-align:right;">
56.7
</td>
<td style="text-align:right;">
1441
</td>
<td style="text-align:right;">
3089
</td>
<td style="text-align:right;">
3618
</td>
<td style="text-align:right;">
17875763
</td>
<td style="text-align:right;">
24917726
</td>
</tr>
<tr>
<td style="text-align:left;">
Botswana
</td>
<td style="text-align:right;">
2007
</td>
<td style="text-align:right;">
1639131
</td>
<td style="text-align:left;">
Africa
</td>
<td style="text-align:right;">
50.7
</td>
<td style="text-align:right;">
12570
</td>
<td style="text-align:right;">
3089
</td>
<td style="text-align:right;">
3618
</td>
<td style="text-align:right;">
17875763
</td>
<td style="text-align:right;">
24917726
</td>
</tr>
<tr>
<td style="text-align:left;">
Burkina Faso
</td>
<td style="text-align:right;">
2007
</td>
<td style="text-align:right;">
14326203
</td>
<td style="text-align:left;">
Africa
</td>
<td style="text-align:right;">
52.3
</td>
<td style="text-align:right;">
1217
</td>
<td style="text-align:right;">
3089
</td>
<td style="text-align:right;">
3618
</td>
<td style="text-align:right;">
17875763
</td>
<td style="text-align:right;">
24917726
</td>
</tr>
<tr>
<td style="text-align:left;">
Burundi
</td>
<td style="text-align:right;">
2007
</td>
<td style="text-align:right;">
8390505
</td>
<td style="text-align:left;">
Africa
</td>
<td style="text-align:right;">
49.6
</td>
<td style="text-align:right;">
430
</td>
<td style="text-align:right;">
3089
</td>
<td style="text-align:right;">
3618
</td>
<td style="text-align:right;">
17875763
</td>
<td style="text-align:right;">
24917726
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="dplyr-and-non-standard-evaluation" class="section level2">
<h2><span class="header-section-number">9.3</span> <code>dplyr</code> and “Non-Standard Evaluation”</h2>
<p>You may run across the term “non-standard evaluation”. The use of data frame variables without quotes around them is an example of this.</p>
<p>Why is this strange?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gap <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(continent, year) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">tail</span>()</code></pre></div>
<p>Compare it to:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gap[ , <span class="kw">c</span>(<span class="st">&#39;continent&#39;</span>, <span class="st">&#39;year&#39;</span>)]
gap[ , continent]</code></pre></div>
<p>Because <code>continent</code> and <code>year</code> are not variables our current environment, <code>dplyr</code> does some fancy stuff behind the scenes to save us from typing the quotes.</p>
<p>This is fine if you have a data analysis workflow, but if you want to write a function that, for example, selects an arbitrary set of columns, you’ll run into trouble.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## here&#39;s a helper function that computes the mean of a variable, stratifying by a grouping variable
grouped_mean &lt;-<span class="st"> </span><span class="cf">function</span>(data, group_var, summary_var) {
  data <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">group_by</span>(group_var) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">summarise</span>(<span class="dt">mean =</span> <span class="kw">mean</span>(summary_var))
}
gap <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">grouped_mean</span>(continent, lifeExp)
gap <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">grouped_mean</span>(<span class="st">&#39;continent&#39;</span>, <span class="st">&#39;lifeExp&#39;</span>)</code></pre></div>
<p>See the <code>rlang</code> or <code>seplyr</code> packages for how one can deal with this problem in this context of using functions.</p>
<div id="challenges-11" class="section level3">
<h3><span class="header-section-number">9.3.1</span> Challenges</h3>
<div id="challenge-1.-use-dplyr-to-create-a-data-frame-containing-the-median-lifeexp-for-each-continent." class="section level4 unnumbered">
<h4>Challenge 1. Use <code>dplyr</code> to create a data frame containing the median <code>lifeExp</code> for each continent.</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gap <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(continent) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">median_lifeexp =</span> <span class="kw">median</span>(lifeExp))
<span class="co">#&gt; # A tibble: 5 x 2</span>
<span class="co">#&gt;   continent median_lifeexp</span>
<span class="co">#&gt;   &lt;fct&gt;              &lt;dbl&gt;</span>
<span class="co">#&gt; 1 Africa              47.8</span>
<span class="co">#&gt; 2 Americas            67.0</span>
<span class="co">#&gt; 3 Asia                61.8</span>
<span class="co">#&gt; 4 Europe              72.2</span>
<span class="co">#&gt; 5 Oceania             73.7</span></code></pre></div>
</div>
<div id="challenge-2.-use-dplyr-to-add-a-column-to-the-gapminder-dataset-that-contains-the-total-population-of-the-continent-of-each-observation-in-a-given-year.-for-example-if-the-first-observation-is-afghanistan-in-1952-the-new-column-would-contain-the-population-of-asia-in-1952." class="section level4 unnumbered">
<h4>Challenge 2. Use <code>dplyr</code> to add a column to the gapminder dataset that contains the total population of the continent of each observation in a given year. For example, if the first observation is Afghanistan in 1952, the new column would contain the population of Asia in 1952.</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gap <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(continent, year) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">continent_pop =</span> <span class="kw">sum</span>(pop))
<span class="co">#&gt; # A tibble: 1,704 x 7</span>
<span class="co">#&gt; # Groups:   continent, year [60]</span>
<span class="co">#&gt;   country      year      pop continent lifeExp gdpPercap continent_pop</span>
<span class="co">#&gt;   &lt;fct&gt;       &lt;int&gt;    &lt;dbl&gt; &lt;fct&gt;       &lt;dbl&gt;     &lt;dbl&gt;         &lt;dbl&gt;</span>
<span class="co">#&gt; 1 Afghanistan  1952  8425333 Asia         28.8      779.   1395357352.</span>
<span class="co">#&gt; 2 Afghanistan  1957  9240934 Asia         30.3      821.   1562780599 </span>
<span class="co">#&gt; 3 Afghanistan  1962 10267083 Asia         32.0      853.   1696357182 </span>
<span class="co">#&gt; 4 Afghanistan  1967 11537966 Asia         34.0      836.   1905662900 </span>
<span class="co">#&gt; 5 Afghanistan  1972 13079460 Asia         36.1      740.   2150972248 </span>
<span class="co">#&gt; 6 Afghanistan  1977 14880372 Asia         38.4      786.   2384513556 </span>
<span class="co">#&gt; # … with 1,698 more rows</span></code></pre></div>
</div>
<div id="challenge-3.-use-dplyr-to-a-add-a-column-called-gdppercap_diff-that-contains-the-difference-between-the-observations-gdppercap-and-the-mean-gdppercap-of-the-continent-in-that-year-b-arrange-the-dataframe-by-the-column-you-just-created-in-descending-order-so-that-the-relatively-richest-country-years-are-listed-first." class="section level4 unnumbered">
<h4>Challenge 3. Use <code>dplyr</code> to: (a) add a column called <code>gdpPercap_diff</code> that contains the difference between the observation’s <code>gdpPercap</code> and the mean <code>gdpPercap</code> of the continent in that year, (b) arrange the dataframe by the column you just created, in descending order (so that the relatively richest country-years are listed first).</h4>
<p><strong>hint</strong>: You might have to <code>ungroup()</code> before you <code>arrange()</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gap <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(continent, year) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">mean_gdpPercap =</span> <span class="kw">mean</span>(gdpPercap)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">gdpPercap_diff =</span> gdpPercap <span class="op">-</span><span class="st"> </span>mean_gdpPercap) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>mean_gdpPercap) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(gdpPercap_diff))
<span class="co">#&gt; # A tibble: 1,704 x 7</span>
<span class="co">#&gt;   country  year     pop continent lifeExp gdpPercap gdpPercap_diff</span>
<span class="co">#&gt;   &lt;fct&gt;   &lt;int&gt;   &lt;dbl&gt; &lt;fct&gt;       &lt;dbl&gt;     &lt;dbl&gt;          &lt;dbl&gt;</span>
<span class="co">#&gt; 1 Kuwait   1957  212846 Asia         58.0   113523.        107735.</span>
<span class="co">#&gt; 2 Kuwait   1952  160000 Asia         55.6   108382.        103187.</span>
<span class="co">#&gt; 3 Kuwait   1972  841934 Asia         67.7   109348.        101160.</span>
<span class="co">#&gt; 4 Kuwait   1962  358266 Asia         60.5    95458.         89729.</span>
<span class="co">#&gt; 5 Kuwait   1967  575003 Asia         64.6    80895.         74924.</span>
<span class="co">#&gt; 6 Kuwait   1977 1140357 Asia         69.3    59265.         51474.</span>
<span class="co">#&gt; # … with 1,698 more rows</span></code></pre></div>
</div>
<div id="acknowledgments-3" class="section level4 unnumbered">
<h4>Acknowledgments</h4>
<p>Some of these materials in this module were adapted from:</p>
<ul>
<li><a href="http://swcarpentry.github.io/r-novice-gapminder/">Software Carpentry</a>)</li>
<li><a href="https://github.com/berkeley-scf/r-bootcamp-fall-2019">R bootcamp at UC Berkeley</a></li>
</ul>
<!--chapter:end:07-dplyr/07-1_dplyr.Rmd-->
</div>
</div>
</div>
</div>
<div id="tidying-data" class="section level1">
<h1><span class="header-section-number">10</span> Tidying Data</h1>
<p>Even before we conduct analysis or calculations, we need to put our data into the correct format. The goal here is to rearrange a messy dataset into one that is <strong>tidy</strong>.</p>
<p>The two most important properties of tidy data are:</p>
<ol style="list-style-type: decimal">
<li>Each column is a variable.</li>
<li>Each row is an observation.</li>
</ol>
<p>Tidy data is easier to work with because you have a consistent way of referring to variables (as column names) and observations (as row indices). The data then becomes easier to manipulate, visualize, and model.</p>
<p>For more on the concept of <em>tidy</em> data, read Hadley Wickham’s paper <a href="http://vita.had.co.nz/papers/tidy-data.html">here</a></p>
<div id="wide-vs.long-formats" class="section level2">
<h2><span class="header-section-number">10.1</span> Wide vs. Long Formats</h2>
<blockquote>
<p>“Tidy datasets are all alike but every messy dataset is messy in its own way.” – Hadley Wickham</p>
</blockquote>
<p>Tabular datasets can be arranged in many ways. For instance, consider the data below. Each data set displays information on heart rates observed in individuals across 3 different time periods. But the data are organized differently in each table.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wide &lt;-<span class="st"> </span><span class="kw">data.frame</span>(
  <span class="dt">name =</span> <span class="kw">c</span>(<span class="st">&quot;Wilbur&quot;</span>, <span class="st">&quot;Petunia&quot;</span>, <span class="st">&quot;Gregory&quot;</span>),
  <span class="dt">time1 =</span> <span class="kw">c</span>(<span class="dv">67</span>, <span class="dv">80</span>, <span class="dv">64</span>),
  <span class="dt">time2 =</span> <span class="kw">c</span>(<span class="dv">56</span>, <span class="dv">90</span>, <span class="dv">50</span>),
  <span class="dt">time3 =</span> <span class="kw">c</span>(<span class="dv">70</span>, <span class="dv">67</span>, <span class="dv">101</span>)
)
<span class="kw">kable</span>(wide)</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:left;">
name
</th>
<th style="text-align:right;">
time1
</th>
<th style="text-align:right;">
time2
</th>
<th style="text-align:right;">
time3
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Wilbur
</td>
<td style="text-align:right;">
67
</td>
<td style="text-align:right;">
56
</td>
<td style="text-align:right;">
70
</td>
</tr>
<tr>
<td style="text-align:left;">
Petunia
</td>
<td style="text-align:right;">
80
</td>
<td style="text-align:right;">
90
</td>
<td style="text-align:right;">
67
</td>
</tr>
<tr>
<td style="text-align:left;">
Gregory
</td>
<td style="text-align:right;">
64
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
101
</td>
</tr>
</tbody>
</table>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
long &lt;-<span class="st"> </span><span class="kw">data.frame</span>(
  <span class="dt">name =</span> <span class="kw">c</span>(<span class="st">&quot;Wilbur&quot;</span>, <span class="st">&quot;Petunia&quot;</span>, <span class="st">&quot;Gregory&quot;</span>, <span class="st">&quot;Wilbur&quot;</span>, <span class="st">&quot;Petunia&quot;</span>, <span class="st">&quot;Gregory&quot;</span>, <span class="st">&quot;Wilbur&quot;</span>, <span class="st">&quot;Petunia&quot;</span>, <span class="st">&quot;Gregory&quot;</span>),
  <span class="dt">time =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">3</span>),
  <span class="dt">heartrate =</span> <span class="kw">c</span>(<span class="dv">67</span>, <span class="dv">80</span>, <span class="dv">64</span>, <span class="dv">56</span>, <span class="dv">90</span>, <span class="dv">50</span>, <span class="dv">70</span>, <span class="dv">67</span>, <span class="dv">10</span>)
)
<span class="kw">kable</span>(long)</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:left;">
name
</th>
<th style="text-align:right;">
time
</th>
<th style="text-align:right;">
heartrate
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Wilbur
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
67
</td>
</tr>
<tr>
<td style="text-align:left;">
Petunia
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
80
</td>
</tr>
<tr>
<td style="text-align:left;">
Gregory
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
64
</td>
</tr>
<tr>
<td style="text-align:left;">
Wilbur
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
56
</td>
</tr>
<tr>
<td style="text-align:left;">
Petunia
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
90
</td>
</tr>
<tr>
<td style="text-align:left;">
Gregory
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
50
</td>
</tr>
<tr>
<td style="text-align:left;">
Wilbur
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
70
</td>
</tr>
<tr>
<td style="text-align:left;">
Petunia
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
67
</td>
</tr>
<tr>
<td style="text-align:left;">
Gregory
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
10
</td>
</tr>
</tbody>
</table>
<p><strong>Question</strong>: Which one of these do you think is the <em>tidy</em> format?</p>
<p><strong>Answer</strong>: The first dataframe (the “wide” one) would not be considered <em>tidy</em> because values (i.e., heart rate) are spread across multiple columns.</p>
<p>We often refer to these different structures as “long” vs. “wide” formats. In the “long” format, you usually have 1 column for the observed variable and the other columns are ID variables.</p>
<p>For the “wide” format each row is often a site/subject/patient and you have multiple observation variables containing the same type of data. These can be either repeated observations over time, or observation of multiple variables (or a mix of both). In the above case, we had the same kind of data (heart rate) entered across 3 different columns, corresponding to three different time periods.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">knitr<span class="op">::</span><span class="kw">include_graphics</span>(<span class="dt">path =</span> <span class="st">&quot;img/tidyr-fig1.png&quot;</span>)</code></pre></div>
<p><img src="img/tidyr-fig1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>You may find data input in the “wide” format to be simpler, and some other applications may prefer “wide” format data. However, many of R’s functions have been designed assuming you have “long” format data.</p>
</div>
<div id="tidying-the-gapminder-data" class="section level2">
<h2><span class="header-section-number">10.2</span> Tidying the Gapminder Data</h2>
<p>Let’s look at the structure of our original gapminder dataframe:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gap &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/gapminder-FiveYearData.csv&quot;</span>, <span class="dt">stringsAsFactors =</span> <span class="ot">TRUE</span>)
<span class="kw">kable</span>(<span class="kw">head</span>(gap))</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:left;">
country
</th>
<th style="text-align:right;">
year
</th>
<th style="text-align:right;">
pop
</th>
<th style="text-align:left;">
continent
</th>
<th style="text-align:right;">
lifeExp
</th>
<th style="text-align:right;">
gdpPercap
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:right;">
1952
</td>
<td style="text-align:right;">
8425333
</td>
<td style="text-align:left;">
Asia
</td>
<td style="text-align:right;">
28.8
</td>
<td style="text-align:right;">
779
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:right;">
1957
</td>
<td style="text-align:right;">
9240934
</td>
<td style="text-align:left;">
Asia
</td>
<td style="text-align:right;">
30.3
</td>
<td style="text-align:right;">
821
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:right;">
1962
</td>
<td style="text-align:right;">
10267083
</td>
<td style="text-align:left;">
Asia
</td>
<td style="text-align:right;">
32.0
</td>
<td style="text-align:right;">
853
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:right;">
1967
</td>
<td style="text-align:right;">
11537966
</td>
<td style="text-align:left;">
Asia
</td>
<td style="text-align:right;">
34.0
</td>
<td style="text-align:right;">
836
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:right;">
1972
</td>
<td style="text-align:right;">
13079460
</td>
<td style="text-align:left;">
Asia
</td>
<td style="text-align:right;">
36.1
</td>
<td style="text-align:right;">
740
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:right;">
1977
</td>
<td style="text-align:right;">
14880372
</td>
<td style="text-align:left;">
Asia
</td>
<td style="text-align:right;">
38.4
</td>
<td style="text-align:right;">
786
</td>
</tr>
</tbody>
</table>
<p><strong>Question</strong>: Is this data frame <strong>wide</strong> or <strong>long</strong>?</p>
<p><strong>Answer</strong>: This data frame is somewhere in between the purely ‘long’ and ‘wide’ formats. We have 3 “ID variables” (<code>continent</code>, <code>country</code>, <code>year</code>) and 3 “Observation variables” (<code>pop</code>, <code>lifeExp</code>, <code>gdpPercap</code>).</p>
<p>Despite not having ALL observations in 1 column, this intermediate format makes sense given that all 3 observation variables have different units. As we have seen, many of the functions in R are often vector based, and you usually do not want to do mathematical operations on values with different units.</p>
<p>On the other hand, there are some instances in which a purely long or wide format is ideal (e.g. plotting). Likewise, sometimes you’ll get data on your desk that is poorly organized, and you’ll need to <strong>reshape</strong> it.</p>
</div>
<div id="tidyr-functions" class="section level2">
<h2><span class="header-section-number">10.3</span> <code>tidyr</code> Functions</h2>
<p>Thankfully, the <code>tidyr</code> package will help you efficiently transform your data regardless of original format.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Install the &quot;tidyr&quot; package (only necessary one time)</span>
<span class="co"># install.packages(&quot;tidyr&quot;) # Not Run</span>

<span class="co"># Load the &quot;tidyr&quot; package (necessary every new R session)</span>
<span class="kw">library</span>(tidyr)</code></pre></div>
<div id="gather" class="section level3">
<h3><span class="header-section-number">10.3.1</span> <code>gather</code></h3>
<p>Until now, we’ve been using the nicely formatted original gapminder dataset. This dataset is not quite wide and not quite long – it’s something in the middle, but ‘real’ data (i.e. our own research data) will never be so well organized. Here let’s start with the wide format version of the gapminder dataset.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gap_wide &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/gapminder_wide.csv&quot;</span>, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)
<span class="kw">kable</span>(<span class="kw">head</span>(gap_wide))</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:left;">
continent
</th>
<th style="text-align:left;">
country
</th>
<th style="text-align:right;">
gdpPercap_1952
</th>
<th style="text-align:right;">
gdpPercap_1957
</th>
<th style="text-align:right;">
gdpPercap_1962
</th>
<th style="text-align:right;">
gdpPercap_1967
</th>
<th style="text-align:right;">
gdpPercap_1972
</th>
<th style="text-align:right;">
gdpPercap_1977
</th>
<th style="text-align:right;">
gdpPercap_1982
</th>
<th style="text-align:right;">
gdpPercap_1987
</th>
<th style="text-align:right;">
gdpPercap_1992
</th>
<th style="text-align:right;">
gdpPercap_1997
</th>
<th style="text-align:right;">
gdpPercap_2002
</th>
<th style="text-align:right;">
gdpPercap_2007
</th>
<th style="text-align:right;">
lifeExp_1952
</th>
<th style="text-align:right;">
lifeExp_1957
</th>
<th style="text-align:right;">
lifeExp_1962
</th>
<th style="text-align:right;">
lifeExp_1967
</th>
<th style="text-align:right;">
lifeExp_1972
</th>
<th style="text-align:right;">
lifeExp_1977
</th>
<th style="text-align:right;">
lifeExp_1982
</th>
<th style="text-align:right;">
lifeExp_1987
</th>
<th style="text-align:right;">
lifeExp_1992
</th>
<th style="text-align:right;">
lifeExp_1997
</th>
<th style="text-align:right;">
lifeExp_2002
</th>
<th style="text-align:right;">
lifeExp_2007
</th>
<th style="text-align:right;">
pop_1952
</th>
<th style="text-align:right;">
pop_1957
</th>
<th style="text-align:right;">
pop_1962
</th>
<th style="text-align:right;">
pop_1967
</th>
<th style="text-align:right;">
pop_1972
</th>
<th style="text-align:right;">
pop_1977
</th>
<th style="text-align:right;">
pop_1982
</th>
<th style="text-align:right;">
pop_1987
</th>
<th style="text-align:right;">
pop_1992
</th>
<th style="text-align:right;">
pop_1997
</th>
<th style="text-align:right;">
pop_2002
</th>
<th style="text-align:right;">
pop_2007
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Africa
</td>
<td style="text-align:left;">
Algeria
</td>
<td style="text-align:right;">
2449
</td>
<td style="text-align:right;">
3014
</td>
<td style="text-align:right;">
2551
</td>
<td style="text-align:right;">
3247
</td>
<td style="text-align:right;">
4183
</td>
<td style="text-align:right;">
4910
</td>
<td style="text-align:right;">
5745
</td>
<td style="text-align:right;">
5681
</td>
<td style="text-align:right;">
5023
</td>
<td style="text-align:right;">
4797
</td>
<td style="text-align:right;">
5288
</td>
<td style="text-align:right;">
6223
</td>
<td style="text-align:right;">
43.1
</td>
<td style="text-align:right;">
45.7
</td>
<td style="text-align:right;">
48.3
</td>
<td style="text-align:right;">
51.4
</td>
<td style="text-align:right;">
54.5
</td>
<td style="text-align:right;">
58.0
</td>
<td style="text-align:right;">
61.4
</td>
<td style="text-align:right;">
65.8
</td>
<td style="text-align:right;">
67.7
</td>
<td style="text-align:right;">
69.2
</td>
<td style="text-align:right;">
71.0
</td>
<td style="text-align:right;">
72.3
</td>
<td style="text-align:right;">
9279525
</td>
<td style="text-align:right;">
10270856
</td>
<td style="text-align:right;">
11000948
</td>
<td style="text-align:right;">
12760499
</td>
<td style="text-align:right;">
14760787
</td>
<td style="text-align:right;">
17152804
</td>
<td style="text-align:right;">
20033753
</td>
<td style="text-align:right;">
23254956
</td>
<td style="text-align:right;">
26298373
</td>
<td style="text-align:right;">
29072015
</td>
<td style="text-align:right;">
31287142
</td>
<td style="text-align:right;">
33333216
</td>
</tr>
<tr>
<td style="text-align:left;">
Africa
</td>
<td style="text-align:left;">
Angola
</td>
<td style="text-align:right;">
3521
</td>
<td style="text-align:right;">
3828
</td>
<td style="text-align:right;">
4269
</td>
<td style="text-align:right;">
5523
</td>
<td style="text-align:right;">
5473
</td>
<td style="text-align:right;">
3009
</td>
<td style="text-align:right;">
2757
</td>
<td style="text-align:right;">
2430
</td>
<td style="text-align:right;">
2628
</td>
<td style="text-align:right;">
2277
</td>
<td style="text-align:right;">
2773
</td>
<td style="text-align:right;">
4797
</td>
<td style="text-align:right;">
30.0
</td>
<td style="text-align:right;">
32.0
</td>
<td style="text-align:right;">
34.0
</td>
<td style="text-align:right;">
36.0
</td>
<td style="text-align:right;">
37.9
</td>
<td style="text-align:right;">
39.5
</td>
<td style="text-align:right;">
39.9
</td>
<td style="text-align:right;">
39.9
</td>
<td style="text-align:right;">
40.6
</td>
<td style="text-align:right;">
41.0
</td>
<td style="text-align:right;">
41.0
</td>
<td style="text-align:right;">
42.7
</td>
<td style="text-align:right;">
4232095
</td>
<td style="text-align:right;">
4561361
</td>
<td style="text-align:right;">
4826015
</td>
<td style="text-align:right;">
5247469
</td>
<td style="text-align:right;">
5894858
</td>
<td style="text-align:right;">
6162675
</td>
<td style="text-align:right;">
7016384
</td>
<td style="text-align:right;">
7874230
</td>
<td style="text-align:right;">
8735988
</td>
<td style="text-align:right;">
9875024
</td>
<td style="text-align:right;">
10866106
</td>
<td style="text-align:right;">
12420476
</td>
</tr>
<tr>
<td style="text-align:left;">
Africa
</td>
<td style="text-align:left;">
Benin
</td>
<td style="text-align:right;">
1063
</td>
<td style="text-align:right;">
960
</td>
<td style="text-align:right;">
949
</td>
<td style="text-align:right;">
1036
</td>
<td style="text-align:right;">
1086
</td>
<td style="text-align:right;">
1029
</td>
<td style="text-align:right;">
1278
</td>
<td style="text-align:right;">
1226
</td>
<td style="text-align:right;">
1191
</td>
<td style="text-align:right;">
1233
</td>
<td style="text-align:right;">
1373
</td>
<td style="text-align:right;">
1441
</td>
<td style="text-align:right;">
38.2
</td>
<td style="text-align:right;">
40.4
</td>
<td style="text-align:right;">
42.6
</td>
<td style="text-align:right;">
44.9
</td>
<td style="text-align:right;">
47.0
</td>
<td style="text-align:right;">
49.2
</td>
<td style="text-align:right;">
50.9
</td>
<td style="text-align:right;">
52.3
</td>
<td style="text-align:right;">
53.9
</td>
<td style="text-align:right;">
54.8
</td>
<td style="text-align:right;">
54.4
</td>
<td style="text-align:right;">
56.7
</td>
<td style="text-align:right;">
1738315
</td>
<td style="text-align:right;">
1925173
</td>
<td style="text-align:right;">
2151895
</td>
<td style="text-align:right;">
2427334
</td>
<td style="text-align:right;">
2761407
</td>
<td style="text-align:right;">
3168267
</td>
<td style="text-align:right;">
3641603
</td>
<td style="text-align:right;">
4243788
</td>
<td style="text-align:right;">
4981671
</td>
<td style="text-align:right;">
6066080
</td>
<td style="text-align:right;">
7026113
</td>
<td style="text-align:right;">
8078314
</td>
</tr>
<tr>
<td style="text-align:left;">
Africa
</td>
<td style="text-align:left;">
Botswana
</td>
<td style="text-align:right;">
851
</td>
<td style="text-align:right;">
918
</td>
<td style="text-align:right;">
984
</td>
<td style="text-align:right;">
1215
</td>
<td style="text-align:right;">
2264
</td>
<td style="text-align:right;">
3215
</td>
<td style="text-align:right;">
4551
</td>
<td style="text-align:right;">
6206
</td>
<td style="text-align:right;">
7954
</td>
<td style="text-align:right;">
8647
</td>
<td style="text-align:right;">
11004
</td>
<td style="text-align:right;">
12570
</td>
<td style="text-align:right;">
47.6
</td>
<td style="text-align:right;">
49.6
</td>
<td style="text-align:right;">
51.5
</td>
<td style="text-align:right;">
53.3
</td>
<td style="text-align:right;">
56.0
</td>
<td style="text-align:right;">
59.3
</td>
<td style="text-align:right;">
61.5
</td>
<td style="text-align:right;">
63.6
</td>
<td style="text-align:right;">
62.7
</td>
<td style="text-align:right;">
52.6
</td>
<td style="text-align:right;">
46.6
</td>
<td style="text-align:right;">
50.7
</td>
<td style="text-align:right;">
442308
</td>
<td style="text-align:right;">
474639
</td>
<td style="text-align:right;">
512764
</td>
<td style="text-align:right;">
553541
</td>
<td style="text-align:right;">
619351
</td>
<td style="text-align:right;">
781472
</td>
<td style="text-align:right;">
970347
</td>
<td style="text-align:right;">
1151184
</td>
<td style="text-align:right;">
1342614
</td>
<td style="text-align:right;">
1536536
</td>
<td style="text-align:right;">
1630347
</td>
<td style="text-align:right;">
1639131
</td>
</tr>
<tr>
<td style="text-align:left;">
Africa
</td>
<td style="text-align:left;">
Burkina Faso
</td>
<td style="text-align:right;">
543
</td>
<td style="text-align:right;">
617
</td>
<td style="text-align:right;">
723
</td>
<td style="text-align:right;">
795
</td>
<td style="text-align:right;">
855
</td>
<td style="text-align:right;">
743
</td>
<td style="text-align:right;">
807
</td>
<td style="text-align:right;">
912
</td>
<td style="text-align:right;">
932
</td>
<td style="text-align:right;">
946
</td>
<td style="text-align:right;">
1038
</td>
<td style="text-align:right;">
1217
</td>
<td style="text-align:right;">
32.0
</td>
<td style="text-align:right;">
34.9
</td>
<td style="text-align:right;">
37.8
</td>
<td style="text-align:right;">
40.7
</td>
<td style="text-align:right;">
43.6
</td>
<td style="text-align:right;">
46.1
</td>
<td style="text-align:right;">
48.1
</td>
<td style="text-align:right;">
49.6
</td>
<td style="text-align:right;">
50.3
</td>
<td style="text-align:right;">
50.3
</td>
<td style="text-align:right;">
50.6
</td>
<td style="text-align:right;">
52.3
</td>
<td style="text-align:right;">
4469979
</td>
<td style="text-align:right;">
4713416
</td>
<td style="text-align:right;">
4919632
</td>
<td style="text-align:right;">
5127935
</td>
<td style="text-align:right;">
5433886
</td>
<td style="text-align:right;">
5889574
</td>
<td style="text-align:right;">
6634596
</td>
<td style="text-align:right;">
7586551
</td>
<td style="text-align:right;">
8878303
</td>
<td style="text-align:right;">
10352843
</td>
<td style="text-align:right;">
12251209
</td>
<td style="text-align:right;">
14326203
</td>
</tr>
<tr>
<td style="text-align:left;">
Africa
</td>
<td style="text-align:left;">
Burundi
</td>
<td style="text-align:right;">
339
</td>
<td style="text-align:right;">
380
</td>
<td style="text-align:right;">
355
</td>
<td style="text-align:right;">
413
</td>
<td style="text-align:right;">
464
</td>
<td style="text-align:right;">
556
</td>
<td style="text-align:right;">
560
</td>
<td style="text-align:right;">
622
</td>
<td style="text-align:right;">
632
</td>
<td style="text-align:right;">
463
</td>
<td style="text-align:right;">
446
</td>
<td style="text-align:right;">
430
</td>
<td style="text-align:right;">
39.0
</td>
<td style="text-align:right;">
40.5
</td>
<td style="text-align:right;">
42.0
</td>
<td style="text-align:right;">
43.5
</td>
<td style="text-align:right;">
44.1
</td>
<td style="text-align:right;">
45.9
</td>
<td style="text-align:right;">
47.5
</td>
<td style="text-align:right;">
48.2
</td>
<td style="text-align:right;">
44.7
</td>
<td style="text-align:right;">
45.3
</td>
<td style="text-align:right;">
47.4
</td>
<td style="text-align:right;">
49.6
</td>
<td style="text-align:right;">
2445618
</td>
<td style="text-align:right;">
2667518
</td>
<td style="text-align:right;">
2961915
</td>
<td style="text-align:right;">
3330989
</td>
<td style="text-align:right;">
3529983
</td>
<td style="text-align:right;">
3834415
</td>
<td style="text-align:right;">
4580410
</td>
<td style="text-align:right;">
5126023
</td>
<td style="text-align:right;">
5809236
</td>
<td style="text-align:right;">
6121610
</td>
<td style="text-align:right;">
7021078
</td>
<td style="text-align:right;">
8390505
</td>
</tr>
</tbody>
</table>
<p>The first step towards getting our nice intermediate data format is to first convert from the wide to the long format.</p>
<p>The function <code>gather()</code> will ‘gather’ the observation variables into a single variable. This is sometimes called “melting” your data, because it melts the table from wide to long. Those data will be melted into two variables: one for the variable names, and the other for the variable values.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gap_long &lt;-<span class="st"> </span>gap_wide <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">gather</span>(obstype_year, obs_values, <span class="dv">3</span><span class="op">:</span><span class="dv">38</span>)
<span class="kw">kable</span>(<span class="kw">head</span>(gap_long))</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:left;">
continent
</th>
<th style="text-align:left;">
country
</th>
<th style="text-align:left;">
obstype_year
</th>
<th style="text-align:right;">
obs_values
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Africa
</td>
<td style="text-align:left;">
Algeria
</td>
<td style="text-align:left;">
gdpPercap_1952
</td>
<td style="text-align:right;">
2449
</td>
</tr>
<tr>
<td style="text-align:left;">
Africa
</td>
<td style="text-align:left;">
Angola
</td>
<td style="text-align:left;">
gdpPercap_1952
</td>
<td style="text-align:right;">
3521
</td>
</tr>
<tr>
<td style="text-align:left;">
Africa
</td>
<td style="text-align:left;">
Benin
</td>
<td style="text-align:left;">
gdpPercap_1952
</td>
<td style="text-align:right;">
1063
</td>
</tr>
<tr>
<td style="text-align:left;">
Africa
</td>
<td style="text-align:left;">
Botswana
</td>
<td style="text-align:left;">
gdpPercap_1952
</td>
<td style="text-align:right;">
851
</td>
</tr>
<tr>
<td style="text-align:left;">
Africa
</td>
<td style="text-align:left;">
Burkina Faso
</td>
<td style="text-align:left;">
gdpPercap_1952
</td>
<td style="text-align:right;">
543
</td>
</tr>
<tr>
<td style="text-align:left;">
Africa
</td>
<td style="text-align:left;">
Burundi
</td>
<td style="text-align:left;">
gdpPercap_1952
</td>
<td style="text-align:right;">
339
</td>
</tr>
</tbody>
</table>
<p>Notice that we put 3 arguments into the <code>gather()</code> function:</p>
<ol style="list-style-type: decimal">
<li>The name the new column for the new ID variable (<code>obstype_year</code>),</li>
<li>The name for the new amalgamated observation variable (<code>obs_value</code>),</li>
<li>The indices of the old observation variables (<code>3:38</code>, signalling columns 3 through 38) that we want to gather into one variable. Notice that we don’t want to melt down columns 1 and 2, as these are considered “ID” variables.</li>
</ol>
<p>We can also select observation variables using:</p>
<ul>
<li>variable indices</li>
<li>variable names (without quotes)</li>
<li><code>x:z</code> to select all variables between x and z</li>
<li><code>-y</code> to <em>exclude</em> y</li>
<li><code>starts_with(x, ignore.case = TRUE)</code>: all names that starts with <code>x</code></li>
<li><code>ends_with(x, ignore.case = TRUE)</code>: all names that ends with <code>x</code></li>
<li><code>contains(x, ignore.case = TRUE)</code>: all names that contain <code>x</code></li>
</ul>
<p>See the <code>select()</code> function in <code>dplyr</code> for more options.</p>
<p>For instance, here we do the same thing with (1) the <code>starts_with</code> function, and (2) the <code>-</code> operator:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 1. with the starts_with() function</span>
gap_long &lt;-<span class="st"> </span>gap_wide <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">gather</span>(obstype_year, obs_values, <span class="kw">starts_with</span>(<span class="st">&#39;pop&#39;</span>),
           <span class="kw">starts_with</span>(<span class="st">&#39;lifeExp&#39;</span>), <span class="kw">starts_with</span>(<span class="st">&#39;gdpPercap&#39;</span>))
<span class="kw">kable</span>(<span class="kw">head</span>(gap_long))</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:left;">
continent
</th>
<th style="text-align:left;">
country
</th>
<th style="text-align:left;">
obstype_year
</th>
<th style="text-align:right;">
obs_values
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Africa
</td>
<td style="text-align:left;">
Algeria
</td>
<td style="text-align:left;">
pop_1952
</td>
<td style="text-align:right;">
9279525
</td>
</tr>
<tr>
<td style="text-align:left;">
Africa
</td>
<td style="text-align:left;">
Angola
</td>
<td style="text-align:left;">
pop_1952
</td>
<td style="text-align:right;">
4232095
</td>
</tr>
<tr>
<td style="text-align:left;">
Africa
</td>
<td style="text-align:left;">
Benin
</td>
<td style="text-align:left;">
pop_1952
</td>
<td style="text-align:right;">
1738315
</td>
</tr>
<tr>
<td style="text-align:left;">
Africa
</td>
<td style="text-align:left;">
Botswana
</td>
<td style="text-align:left;">
pop_1952
</td>
<td style="text-align:right;">
442308
</td>
</tr>
<tr>
<td style="text-align:left;">
Africa
</td>
<td style="text-align:left;">
Burkina Faso
</td>
<td style="text-align:left;">
pop_1952
</td>
<td style="text-align:right;">
4469979
</td>
</tr>
<tr>
<td style="text-align:left;">
Africa
</td>
<td style="text-align:left;">
Burundi
</td>
<td style="text-align:left;">
pop_1952
</td>
<td style="text-align:right;">
2445618
</td>
</tr>
</tbody>
</table>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="co"># 2. with the - operator</span>
gap_long &lt;-<span class="st"> </span>gap_wide <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">gather</span>(obstype_year, obs_values, <span class="op">-</span>continent, <span class="op">-</span>country)
<span class="kw">kable</span>(<span class="kw">head</span>(gap_long))</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:left;">
continent
</th>
<th style="text-align:left;">
country
</th>
<th style="text-align:left;">
obstype_year
</th>
<th style="text-align:right;">
obs_values
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Africa
</td>
<td style="text-align:left;">
Algeria
</td>
<td style="text-align:left;">
gdpPercap_1952
</td>
<td style="text-align:right;">
2449
</td>
</tr>
<tr>
<td style="text-align:left;">
Africa
</td>
<td style="text-align:left;">
Angola
</td>
<td style="text-align:left;">
gdpPercap_1952
</td>
<td style="text-align:right;">
3521
</td>
</tr>
<tr>
<td style="text-align:left;">
Africa
</td>
<td style="text-align:left;">
Benin
</td>
<td style="text-align:left;">
gdpPercap_1952
</td>
<td style="text-align:right;">
1063
</td>
</tr>
<tr>
<td style="text-align:left;">
Africa
</td>
<td style="text-align:left;">
Botswana
</td>
<td style="text-align:left;">
gdpPercap_1952
</td>
<td style="text-align:right;">
851
</td>
</tr>
<tr>
<td style="text-align:left;">
Africa
</td>
<td style="text-align:left;">
Burkina Faso
</td>
<td style="text-align:left;">
gdpPercap_1952
</td>
<td style="text-align:right;">
543
</td>
</tr>
<tr>
<td style="text-align:left;">
Africa
</td>
<td style="text-align:left;">
Burundi
</td>
<td style="text-align:left;">
gdpPercap_1952
</td>
<td style="text-align:right;">
339
</td>
</tr>
</tbody>
</table>
<p>However you choose to do it, notice that the output collapses all of the measured variables into two columns: one containing the new ID variable, the other containing the observation value for that row.</p>
</div>
<div id="separate" class="section level3">
<h3><span class="header-section-number">10.3.2</span> <code>separate</code></h3>
<p>You’ll notice that in our long dataset, <code>obstype_year</code> actually contains 2 pieces of information, the observation type (<code>pop</code>, <code>lifeExp</code>, or <code>gdpPercap</code>) and the <code>year</code>.</p>
<p>We can use the <code>separate()</code> function to split the character strings into multiple variables:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gap_long_sep &lt;-<span class="st"> </span>gap_long <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">separate</span>(obstype_year, <span class="dt">into =</span> <span class="kw">c</span>(<span class="st">&#39;obs_type&#39;</span>,<span class="st">&#39;year&#39;</span>), <span class="dt">sep =</span> <span class="st">&quot;_&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">year =</span> <span class="kw">as.integer</span>(year))
<span class="kw">kable</span>(<span class="kw">head</span>(gap_long_sep))</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:left;">
continent
</th>
<th style="text-align:left;">
country
</th>
<th style="text-align:left;">
obs_type
</th>
<th style="text-align:right;">
year
</th>
<th style="text-align:right;">
obs_values
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Africa
</td>
<td style="text-align:left;">
Algeria
</td>
<td style="text-align:left;">
gdpPercap
</td>
<td style="text-align:right;">
1952
</td>
<td style="text-align:right;">
2449
</td>
</tr>
<tr>
<td style="text-align:left;">
Africa
</td>
<td style="text-align:left;">
Angola
</td>
<td style="text-align:left;">
gdpPercap
</td>
<td style="text-align:right;">
1952
</td>
<td style="text-align:right;">
3521
</td>
</tr>
<tr>
<td style="text-align:left;">
Africa
</td>
<td style="text-align:left;">
Benin
</td>
<td style="text-align:left;">
gdpPercap
</td>
<td style="text-align:right;">
1952
</td>
<td style="text-align:right;">
1063
</td>
</tr>
<tr>
<td style="text-align:left;">
Africa
</td>
<td style="text-align:left;">
Botswana
</td>
<td style="text-align:left;">
gdpPercap
</td>
<td style="text-align:right;">
1952
</td>
<td style="text-align:right;">
851
</td>
</tr>
<tr>
<td style="text-align:left;">
Africa
</td>
<td style="text-align:left;">
Burkina Faso
</td>
<td style="text-align:left;">
gdpPercap
</td>
<td style="text-align:right;">
1952
</td>
<td style="text-align:right;">
543
</td>
</tr>
<tr>
<td style="text-align:left;">
Africa
</td>
<td style="text-align:left;">
Burundi
</td>
<td style="text-align:left;">
gdpPercap
</td>
<td style="text-align:right;">
1952
</td>
<td style="text-align:right;">
339
</td>
</tr>
</tbody>
</table>
</div>
<div id="spread" class="section level3">
<h3><span class="header-section-number">10.3.3</span> <code>spread</code></h3>
<p>The opposite of <code>gather()</code> is <code>spread()</code>. It spreads our observation variables back out to make a wider table. We can use this function to spread our <code>gap_long()</code> to the original “medium” format.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gap_medium &lt;-<span class="st"> </span>gap_long_sep <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">spread</span>(obs_type, obs_values)
<span class="kw">kable</span>(<span class="kw">head</span>(gap_medium))</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:left;">
continent
</th>
<th style="text-align:left;">
country
</th>
<th style="text-align:right;">
year
</th>
<th style="text-align:right;">
gdpPercap
</th>
<th style="text-align:right;">
lifeExp
</th>
<th style="text-align:right;">
pop
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Africa
</td>
<td style="text-align:left;">
Algeria
</td>
<td style="text-align:right;">
1952
</td>
<td style="text-align:right;">
2449
</td>
<td style="text-align:right;">
43.1
</td>
<td style="text-align:right;">
9279525
</td>
</tr>
<tr>
<td style="text-align:left;">
Africa
</td>
<td style="text-align:left;">
Algeria
</td>
<td style="text-align:right;">
1957
</td>
<td style="text-align:right;">
3014
</td>
<td style="text-align:right;">
45.7
</td>
<td style="text-align:right;">
10270856
</td>
</tr>
<tr>
<td style="text-align:left;">
Africa
</td>
<td style="text-align:left;">
Algeria
</td>
<td style="text-align:right;">
1962
</td>
<td style="text-align:right;">
2551
</td>
<td style="text-align:right;">
48.3
</td>
<td style="text-align:right;">
11000948
</td>
</tr>
<tr>
<td style="text-align:left;">
Africa
</td>
<td style="text-align:left;">
Algeria
</td>
<td style="text-align:right;">
1967
</td>
<td style="text-align:right;">
3247
</td>
<td style="text-align:right;">
51.4
</td>
<td style="text-align:right;">
12760499
</td>
</tr>
<tr>
<td style="text-align:left;">
Africa
</td>
<td style="text-align:left;">
Algeria
</td>
<td style="text-align:right;">
1972
</td>
<td style="text-align:right;">
4183
</td>
<td style="text-align:right;">
54.5
</td>
<td style="text-align:right;">
14760787
</td>
</tr>
<tr>
<td style="text-align:left;">
Africa
</td>
<td style="text-align:left;">
Algeria
</td>
<td style="text-align:right;">
1977
</td>
<td style="text-align:right;">
4910
</td>
<td style="text-align:right;">
58.0
</td>
<td style="text-align:right;">
17152804
</td>
</tr>
</tbody>
</table>
<p>All we need is some quick fixes to make this dataset identical to the original <code>gapminder</code> dataset:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gap &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/gapminder-FiveYearData.csv&quot;</span>)
<span class="kw">kable</span>(<span class="kw">head</span>(gap))</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:left;">
country
</th>
<th style="text-align:right;">
year
</th>
<th style="text-align:right;">
pop
</th>
<th style="text-align:left;">
continent
</th>
<th style="text-align:right;">
lifeExp
</th>
<th style="text-align:right;">
gdpPercap
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:right;">
1952
</td>
<td style="text-align:right;">
8425333
</td>
<td style="text-align:left;">
Asia
</td>
<td style="text-align:right;">
28.8
</td>
<td style="text-align:right;">
779
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:right;">
1957
</td>
<td style="text-align:right;">
9240934
</td>
<td style="text-align:left;">
Asia
</td>
<td style="text-align:right;">
30.3
</td>
<td style="text-align:right;">
821
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:right;">
1962
</td>
<td style="text-align:right;">
10267083
</td>
<td style="text-align:left;">
Asia
</td>
<td style="text-align:right;">
32.0
</td>
<td style="text-align:right;">
853
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:right;">
1967
</td>
<td style="text-align:right;">
11537966
</td>
<td style="text-align:left;">
Asia
</td>
<td style="text-align:right;">
34.0
</td>
<td style="text-align:right;">
836
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:right;">
1972
</td>
<td style="text-align:right;">
13079460
</td>
<td style="text-align:left;">
Asia
</td>
<td style="text-align:right;">
36.1
</td>
<td style="text-align:right;">
740
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:right;">
1977
</td>
<td style="text-align:right;">
14880372
</td>
<td style="text-align:left;">
Asia
</td>
<td style="text-align:right;">
38.4
</td>
<td style="text-align:right;">
786
</td>
</tr>
</tbody>
</table>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># rearrange columns</span>
gap_medium &lt;-<span class="st"> </span>gap_medium[,<span class="kw">names</span>(gap)]
<span class="kw">kable</span>(<span class="kw">head</span>(gap_medium))</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:left;">
country
</th>
<th style="text-align:right;">
year
</th>
<th style="text-align:right;">
pop
</th>
<th style="text-align:left;">
continent
</th>
<th style="text-align:right;">
lifeExp
</th>
<th style="text-align:right;">
gdpPercap
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Algeria
</td>
<td style="text-align:right;">
1952
</td>
<td style="text-align:right;">
9279525
</td>
<td style="text-align:left;">
Africa
</td>
<td style="text-align:right;">
43.1
</td>
<td style="text-align:right;">
2449
</td>
</tr>
<tr>
<td style="text-align:left;">
Algeria
</td>
<td style="text-align:right;">
1957
</td>
<td style="text-align:right;">
10270856
</td>
<td style="text-align:left;">
Africa
</td>
<td style="text-align:right;">
45.7
</td>
<td style="text-align:right;">
3014
</td>
</tr>
<tr>
<td style="text-align:left;">
Algeria
</td>
<td style="text-align:right;">
1962
</td>
<td style="text-align:right;">
11000948
</td>
<td style="text-align:left;">
Africa
</td>
<td style="text-align:right;">
48.3
</td>
<td style="text-align:right;">
2551
</td>
</tr>
<tr>
<td style="text-align:left;">
Algeria
</td>
<td style="text-align:right;">
1967
</td>
<td style="text-align:right;">
12760499
</td>
<td style="text-align:left;">
Africa
</td>
<td style="text-align:right;">
51.4
</td>
<td style="text-align:right;">
3247
</td>
</tr>
<tr>
<td style="text-align:left;">
Algeria
</td>
<td style="text-align:right;">
1972
</td>
<td style="text-align:right;">
14760787
</td>
<td style="text-align:left;">
Africa
</td>
<td style="text-align:right;">
54.5
</td>
<td style="text-align:right;">
4183
</td>
</tr>
<tr>
<td style="text-align:left;">
Algeria
</td>
<td style="text-align:right;">
1977
</td>
<td style="text-align:right;">
17152804
</td>
<td style="text-align:left;">
Africa
</td>
<td style="text-align:right;">
58.0
</td>
<td style="text-align:right;">
4910
</td>
</tr>
</tbody>
</table>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># arrange by country, continent, and year</span>
gap_medium &lt;-<span class="st"> </span>gap_medium <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">arrange</span>(country,continent,year)
<span class="kw">kable</span>(<span class="kw">head</span>(gap_medium))</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:left;">
country
</th>
<th style="text-align:right;">
year
</th>
<th style="text-align:right;">
pop
</th>
<th style="text-align:left;">
continent
</th>
<th style="text-align:right;">
lifeExp
</th>
<th style="text-align:right;">
gdpPercap
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:right;">
1952
</td>
<td style="text-align:right;">
8425333
</td>
<td style="text-align:left;">
Asia
</td>
<td style="text-align:right;">
28.8
</td>
<td style="text-align:right;">
779
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:right;">
1957
</td>
<td style="text-align:right;">
9240934
</td>
<td style="text-align:left;">
Asia
</td>
<td style="text-align:right;">
30.3
</td>
<td style="text-align:right;">
821
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:right;">
1962
</td>
<td style="text-align:right;">
10267083
</td>
<td style="text-align:left;">
Asia
</td>
<td style="text-align:right;">
32.0
</td>
<td style="text-align:right;">
853
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:right;">
1967
</td>
<td style="text-align:right;">
11537966
</td>
<td style="text-align:left;">
Asia
</td>
<td style="text-align:right;">
34.0
</td>
<td style="text-align:right;">
836
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:right;">
1972
</td>
<td style="text-align:right;">
13079460
</td>
<td style="text-align:left;">
Asia
</td>
<td style="text-align:right;">
36.1
</td>
<td style="text-align:right;">
740
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:right;">
1977
</td>
<td style="text-align:right;">
14880372
</td>
<td style="text-align:left;">
Asia
</td>
<td style="text-align:right;">
38.4
</td>
<td style="text-align:right;">
786
</td>
</tr>
</tbody>
</table>
<p><strong>What we just told you will become obsolete…</strong></p>
<p><code>gather</code> and <code>spread</code> are being replaced by <code>pivot_longer</code> and <code>pivot_wider</code> in <code>tidyr 1.0.0</code>, which use ideas from the <code>cdata</code> package to make reshaping easier to think about. In future classes, we’ll migrate to those functions.</p>
</div>
</div>
<div id="more-tidyverse" class="section level2">
<h2><span class="header-section-number">10.4</span> More <code>tidyverse</code></h2>
<p><code>dplyr</code> and <code>tidyr</code> have many more functions to help you wrangle and manipulate your data. See the <a href="https://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf">Data Wrangling Cheat Sheet</a> for more.</p>
<p>There are some other useful packages in the <a href="http://www.tidyverse.org">tidyverse</a>:</p>
<ul>
<li><code>ggplot2</code> for plotting (we’ll cover this in the Visualization module.)</li>
<li><code>readr</code> and <code>haven</code> for reading in data</li>
<li><code>purrr</code> for working iterations.</li>
<li><code>stringr</code>, <code>lubridate</code>, <code>forcats</code> for manipulating strings, dates, and factors, respectively</li>
<li>many many more! Take a peak at the <a href="https://github.com/tidyverse">tidyverse github page</a>…</li>
</ul>
<p>**Pro <a href="Tip:**" class="uri">Tip:**</a> To install and load the core tidyverse packages (includes <code>tidyr</code>, <code>dplyr</code>, and <code>ggplot2</code>, among others), try:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## NOT run
<span class="co"># install.packages(&quot;tidyverse&quot;)</span>
<span class="kw">library</span>(tidyverse)</code></pre></div>
</div>
<div id="challenges-12" class="section level2">
<h2><span class="header-section-number">10.5</span> Challenges</h2>
<div id="challenge-1.-subset-the-results-from-challenge-3-above-to-select-only-the-country-year-and-gdppercap_diff-columns.-use-tidyr-put-it-in-wide-format-so-that-countries-are-rows-and-years-are-columns." class="section level4 unnumbered">
<h4>Challenge 1. Subset the results from challenge #3 (above) to select only the <code>country</code>, <code>year</code>, and <code>gdpPercap_diff</code> columns. Use <code>tidyr</code> put it in wide format so that countries are rows and years are columns.</h4>
</div>
<div id="challenge-2.-now-turn-the-dataframe-above-back-into-the-long-format-with-three-columns-country-year-and-gdppercap_diff." class="section level4 unnumbered">
<h4>Challenge 2. Now turn the dataframe above back into the long format with three columns: <code>country</code>, <code>year</code>, and <code>gdpPercap_diff</code>.</h4>
</div>
<div id="acknowledgments-4" class="section level4 unnumbered">
<h4>Acknowledgments</h4>
<p>Some of these materials in this module were adapted from:</p>
<ul>
<li><a href="http://swcarpentry.github.io/r-novice-gapminder/">Software Carpentry</a></li>
<li><a href="https://github.com/berkeley-scf/r-bootcamp-fall-2019">R bootcamp at UC Berkeley</a></li>
</ul>
<!--chapter:end:08-tidyr/08-1_tidyr.Rmd-->
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(kableExtra)</code></pre></div>
</div>
</div>
</div>
<div id="relational-data-1" class="section level1">
<h1><span class="header-section-number">11</span> Relational Data</h1>
<p>It’s rare that data analysis involves only a single table of data. Typically, you have many tables of data, and you must combine them to answer the questions that you’re interested in. Collectively, multiple tables of data are called <strong>relational data</strong> because it is the relations, not just the individual datasets, that are important.</p>
<p>Note that when we say relational database here, we are referring to how the data are structured, not to the use of any fancy software.</p>
<div id="why-relational-data" class="section level2">
<h2><span class="header-section-number">11.1</span> Why Relational Data</h2>
<p>As social scientists, we’re often working with data across different levels of analysis. The main principle of relational data is that each table is structured around the same observational unit.</p>
<p>Why is this important? Check out the following data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">messy &lt;-<span class="st"> </span><span class="kw">data.frame</span>(
  <span class="dt">county =</span> <span class="kw">c</span>(<span class="dv">36037</span>, <span class="dv">36038</span>, <span class="dv">36039</span>, <span class="dv">36040</span>, <span class="ot">NA</span> , <span class="dv">37001</span>, <span class="dv">37002</span>, <span class="dv">37003</span>),
  <span class="dt">state =</span> <span class="kw">c</span>(<span class="st">&#39;NY&#39;</span>, <span class="st">&#39;NY&#39;</span>, <span class="st">&#39;NY&#39;</span>, <span class="ot">NA</span>, <span class="ot">NA</span>, <span class="st">&#39;VA&#39;</span>, <span class="st">&#39;VA&#39;</span>, <span class="st">&#39;VA&#39;</span>),
  <span class="dt">cnty_pop =</span> <span class="kw">c</span>(<span class="dv">3817735</span>, <span class="dv">422999</span>, <span class="dv">324920</span>, <span class="dv">143432</span>, <span class="ot">NA</span>, <span class="dv">3228290</span>, <span class="dv">449499</span>, <span class="dv">383888</span>),
  <span class="dt">state_pop =</span> <span class="kw">c</span>(<span class="dv">43320903</span>, <span class="dv">43320903</span>, <span class="ot">NA</span>, <span class="dv">43320903</span>, <span class="dv">43320903</span>, <span class="dv">7173000</span>, <span class="dv">7173000</span>, <span class="dv">7173000</span>),
  <span class="dt">region =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">4</span>)
)

<span class="kw">kable</span>(messy)</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:right;">
county
</th>
<th style="text-align:left;">
state
</th>
<th style="text-align:right;">
cnty_pop
</th>
<th style="text-align:right;">
state_pop
</th>
<th style="text-align:right;">
region
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
36037
</td>
<td style="text-align:left;">
NY
</td>
<td style="text-align:right;">
3817735
</td>
<td style="text-align:right;">
43320903
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
36038
</td>
<td style="text-align:left;">
NY
</td>
<td style="text-align:right;">
422999
</td>
<td style="text-align:right;">
43320903
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
36039
</td>
<td style="text-align:left;">
NY
</td>
<td style="text-align:right;">
324920
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
36040
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
143432
</td>
<td style="text-align:right;">
43320903
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
43320903
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
37001
</td>
<td style="text-align:left;">
VA
</td>
<td style="text-align:right;">
3228290
</td>
<td style="text-align:right;">
7173000
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
37002
</td>
<td style="text-align:left;">
VA
</td>
<td style="text-align:right;">
449499
</td>
<td style="text-align:right;">
7173000
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
37003
</td>
<td style="text-align:left;">
VA
</td>
<td style="text-align:right;">
383888
</td>
<td style="text-align:right;">
7173000
</td>
<td style="text-align:right;">
4
</td>
</tr>
</tbody>
</table>
<p>What a mess! How can the population of the state of New York be 43 million for one county but “missing” for another? If this is a dataset of counties, what does it mean when the “county” field is missing? If region is something like Census region, how can two counties in the same state be in different regions? And why is it that all the counties whose codes start with 36 are in New York except for one, where the state is unknown?</p>
<p>If we follow the principles of relational data, each type of observational unit should form a table.</p>
<ul>
<li>counties contains data on counties.</li>
<li>states contains data on states</li>
</ul>
<p>So our data should look like:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">counties &lt;-<span class="st"> </span><span class="kw">data.frame</span>(
  <span class="dt">county =</span> <span class="kw">c</span>(<span class="dv">36037</span>, <span class="dv">36038</span>, <span class="dv">36039</span>, <span class="dv">36040</span>, <span class="dv">37001</span>, <span class="dv">37002</span>, <span class="dv">37003</span>),
  <span class="dt">state =</span> <span class="kw">c</span>(<span class="st">&#39;NY&#39;</span>, <span class="st">&#39;NY&#39;</span>, <span class="st">&#39;NY&#39;</span>, <span class="st">&#39;NY&#39;</span>, <span class="st">&#39;VA&#39;</span>, <span class="st">&#39;VA&#39;</span>, <span class="st">&#39;VA&#39;</span>),
  <span class="dt">county_pop =</span> <span class="kw">c</span>(<span class="dv">3817735</span>, <span class="dv">422999</span>, <span class="dv">324920</span>, <span class="dv">143432</span>, <span class="dv">3228290</span>, <span class="dv">449499</span>, <span class="dv">383888</span>), <span class="dt">stringsAsFactors =</span> F
)
<span class="kw">kable</span>(counties)</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:right;">
county
</th>
<th style="text-align:left;">
state
</th>
<th style="text-align:right;">
county_pop
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
36037
</td>
<td style="text-align:left;">
NY
</td>
<td style="text-align:right;">
3817735
</td>
</tr>
<tr>
<td style="text-align:right;">
36038
</td>
<td style="text-align:left;">
NY
</td>
<td style="text-align:right;">
422999
</td>
</tr>
<tr>
<td style="text-align:right;">
36039
</td>
<td style="text-align:left;">
NY
</td>
<td style="text-align:right;">
324920
</td>
</tr>
<tr>
<td style="text-align:right;">
36040
</td>
<td style="text-align:left;">
NY
</td>
<td style="text-align:right;">
143432
</td>
</tr>
<tr>
<td style="text-align:right;">
37001
</td>
<td style="text-align:left;">
VA
</td>
<td style="text-align:right;">
3228290
</td>
</tr>
<tr>
<td style="text-align:right;">
37002
</td>
<td style="text-align:left;">
VA
</td>
<td style="text-align:right;">
449499
</td>
</tr>
<tr>
<td style="text-align:right;">
37003
</td>
<td style="text-align:left;">
VA
</td>
<td style="text-align:right;">
383888
</td>
</tr>
</tbody>
</table>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
states &lt;-<span class="st"> </span><span class="kw">data.frame</span>(
  <span class="dt">state =</span> <span class="kw">c</span>(<span class="st">&quot;NY&quot;</span>, <span class="st">&quot;VA&quot;</span>),
  <span class="dt">state_pop =</span> <span class="kw">c</span>(<span class="dv">43320903</span>, <span class="dv">7173000</span>),
  <span class="dt">region =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>), <span class="dt">stringsAsFactors =</span> F
)
<span class="kw">kable</span>(states)</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:left;">
state
</th>
<th style="text-align:right;">
state_pop
</th>
<th style="text-align:right;">
region
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
NY
</td>
<td style="text-align:right;">
43320903
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
VA
</td>
<td style="text-align:right;">
7173000
</td>
<td style="text-align:right;">
3
</td>
</tr>
</tbody>
</table>
<p>County population is a property of a county, so it lives in the county table. State population is a property of a state, so it cannot live in the county table. If we had panel data on counties, we would need separate tables for things that vary at the county level (like state) and things that vary at the county-year level (like population).</p>
<p>Now the ambiguity is gone. Every county has a population and a state. Every state has a population and a region. There are no missing states, no missing counties, and no conflicting definitions. The database is self-documenting.</p>
</div>
<div id="keys-1" class="section level2">
<h2><span class="header-section-number">11.2</span> Keys</h2>
<p>The variables used to connect each pair of tables are called <strong>keys</strong>. A key is a variable (or set of variables) that uniquely identifies an observation. Also called a <em>unique identifier</em>.</p>
<ul>
<li>Keys are complete. They never take on missing values.</li>
<li>Keys are unique. They are neer duplicated across rows of a table.</li>
</ul>
<p>In simple cases, a single variable is sufficient to identify an observation. In the example above, each county is identified with <strong>county</strong> (a numeric identifier); each state is identified with <strong>state</strong> (a two-letter string).</p>
<p>There are two types of keys:</p>
<ul>
<li><p>A <strong>primary key</strong> uniquely identifies an observation in its own table. For example, <code>counties$county</code> is a primary key because it uniquely identifies each county in the counties table.</p></li>
<li><p>A <strong>foreign key</strong> uniquely identifies an observation in another table. For example, the counties$state is a foreign key because it appears in the counties table where it matches each county to a unique state.</p></li>
</ul>
<p>Sometimes a table doesn’t have an explicit primary key: each row is an observation, but no combination of variables reliably identifies it. If a table lacks a primary key, it’s useful to add one with <code>mutate()</code> and <code>row_number()</code>. This is called a <strong>surrogate key</strong>.</p>
<p>A primary key and the corresponding foreign key in another table form a <strong>relation</strong>.</p>
</div>
<div id="joins" class="section level2">
<h2><span class="header-section-number">11.3</span> Joins</h2>
<p>Data stored in the form we have outlined above is considered <em>normalized</em>. In general, we should try to keep data normalized as far into the code pipeline as we can. Storing normalized data means your data will be easier to understand and it will be harder to make costly mistakes.</p>
<p>At some point, however, we’re going to have to merge (or <strong>join</strong>) the tables together to produce a single dataframe, and conduct analysis on that dataframe.</p>
<p>Let’s say we wanted to merge tables <code>x</code> and <code>y</code>. A <strong>join</strong> allows you to combine variables from the two tables. It first matches observations by their keys, then copies across variables from one table to the other.</p>
<p>There are four join options:</p>
<ol style="list-style-type: decimal">
<li>An <strong>inner join</strong> keeps observations that appear in both tables.</li>
<li>A <strong>left join</strong> keeps all observations in <code>x</code>.</li>
<li>A <strong>right join</strong> keeps all observations in <code>y</code>.</li>
<li>A <strong>full join</strong> keeps all observations in <code>x</code> and all observations in <code>y</code>.</li>
</ol>
<p>The most commonly used join is the <code>left_join()</code>: you use this whenever you look up additional data from another table, because it preserves the original observations even when there isn’t a match. For example, a <code>left_join()</code> on <code>x</code> and <code>y</code> pulls in variables form <code>y</code> while preserving all the observations on <code>x</code>.</p>
<p>Let’s say we want to combine the <code>countries</code> and <code>states</code> tables we created earlier.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">counties_states &lt;-<span class="st"> </span>counties <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">left_join</span>(states, <span class="dt">by =</span> <span class="st">&quot;state&quot;</span>)

<span class="kw">kable</span>(counties_states)</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:right;">
county
</th>
<th style="text-align:left;">
state
</th>
<th style="text-align:right;">
county_pop
</th>
<th style="text-align:right;">
state_pop
</th>
<th style="text-align:right;">
region
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
36037
</td>
<td style="text-align:left;">
NY
</td>
<td style="text-align:right;">
3817735
</td>
<td style="text-align:right;">
43320903
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
36038
</td>
<td style="text-align:left;">
NY
</td>
<td style="text-align:right;">
422999
</td>
<td style="text-align:right;">
43320903
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
36039
</td>
<td style="text-align:left;">
NY
</td>
<td style="text-align:right;">
324920
</td>
<td style="text-align:right;">
43320903
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
36040
</td>
<td style="text-align:left;">
NY
</td>
<td style="text-align:right;">
143432
</td>
<td style="text-align:right;">
43320903
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
37001
</td>
<td style="text-align:left;">
VA
</td>
<td style="text-align:right;">
3228290
</td>
<td style="text-align:right;">
7173000
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
37002
</td>
<td style="text-align:left;">
VA
</td>
<td style="text-align:right;">
449499
</td>
<td style="text-align:right;">
7173000
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
37003
</td>
<td style="text-align:left;">
VA
</td>
<td style="text-align:right;">
383888
</td>
<td style="text-align:right;">
7173000
</td>
<td style="text-align:right;">
3
</td>
</tr>
</tbody>
</table>
<p>Notice there are two new columns: <code>state_pop</code> and <code>region</code>.</p>
<p>The left join should be your default join: use it unless you have a strong reason to prefer one of the others.</p>
</div>
<div id="defining-keys" class="section level2">
<h2><span class="header-section-number">11.4</span> Defining Keys</h2>
<p>In the example above, the two tables were joined by a single variable, and that variable has the same name in both tables. That constraint was encoded by <code>by = &quot;key&quot;</code>.</p>
<p>You can use other values for <code>by</code> to connect the tables in other ways:</p>
<ol style="list-style-type: decimal">
<li>The default, <strong><code>by = NULL</code></strong>, uses all variables that appear in both tables, what we might call a “natural join”.</li>
</ol>
<p>For example, let’s say we wanted to add a column to the <code>gapminder</code> dataset that encodes the regime type of each country-year observation. We’ll get that data from the <code>polityVI</code> dataset.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gapminder &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/gapminder.csv&quot;</span>, <span class="dt">stringsAsFactors =</span> F)
polity &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/polity_sub.csv&quot;</span>, <span class="dt">stringsAsFactors =</span> F)
<span class="kw">kable</span>(<span class="kw">head</span>(polity))</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:left;">
country
</th>
<th style="text-align:right;">
year
</th>
<th style="text-align:right;">
polity2
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:right;">
1800
</td>
<td style="text-align:right;">
-6
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:right;">
1801
</td>
<td style="text-align:right;">
-6
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:right;">
1802
</td>
<td style="text-align:right;">
-6
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:right;">
1803
</td>
<td style="text-align:right;">
-6
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:right;">
1804
</td>
<td style="text-align:right;">
-6
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:right;">
1805
</td>
<td style="text-align:right;">
-6
</td>
</tr>
</tbody>
</table>
<p>We’re now ready to join the tables. The common keys between them are <code>country</code> and <code>year</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gap1 &lt;-<span class="st"> </span>gapminder <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">left_join</span>(polity)
<span class="co">#&gt; Joining, by = c(&quot;country&quot;, &quot;year&quot;)</span>

<span class="kw">kable</span>(<span class="kw">head</span>(gap1))</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:left;">
country
</th>
<th style="text-align:right;">
year
</th>
<th style="text-align:right;">
pop
</th>
<th style="text-align:left;">
continent
</th>
<th style="text-align:right;">
lifeExp
</th>
<th style="text-align:right;">
gdpPercap
</th>
<th style="text-align:right;">
polity2
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:right;">
1952
</td>
<td style="text-align:right;">
8425333
</td>
<td style="text-align:left;">
Asia
</td>
<td style="text-align:right;">
28.8
</td>
<td style="text-align:right;">
779
</td>
<td style="text-align:right;">
-10
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:right;">
1957
</td>
<td style="text-align:right;">
9240934
</td>
<td style="text-align:left;">
Asia
</td>
<td style="text-align:right;">
30.3
</td>
<td style="text-align:right;">
821
</td>
<td style="text-align:right;">
-10
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:right;">
1962
</td>
<td style="text-align:right;">
10267083
</td>
<td style="text-align:left;">
Asia
</td>
<td style="text-align:right;">
32.0
</td>
<td style="text-align:right;">
853
</td>
<td style="text-align:right;">
-10
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:right;">
1967
</td>
<td style="text-align:right;">
11537966
</td>
<td style="text-align:left;">
Asia
</td>
<td style="text-align:right;">
34.0
</td>
<td style="text-align:right;">
836
</td>
<td style="text-align:right;">
-7
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:right;">
1972
</td>
<td style="text-align:right;">
13079460
</td>
<td style="text-align:left;">
Asia
</td>
<td style="text-align:right;">
36.1
</td>
<td style="text-align:right;">
740
</td>
<td style="text-align:right;">
-7
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:right;">
1977
</td>
<td style="text-align:right;">
14880372
</td>
<td style="text-align:left;">
Asia
</td>
<td style="text-align:right;">
38.4
</td>
<td style="text-align:right;">
786
</td>
<td style="text-align:right;">
-7
</td>
</tr>
</tbody>
</table>
<ol start="2" style="list-style-type: decimal">
<li><p>A character vector, <strong><code>by = c(&quot;x&quot;, &quot;y&quot;)</code></strong>. This is like a natural join, but uses only some of the common variables.</p></li>
<li><p>A named character vector: <strong><code>by = c(&quot;a&quot; = &quot;b&quot;)</code></strong>. This will match variable <code>a</code> in table <code>x</code> to variable <code>b</code> in table <code>y</code>. The variables from <code>x</code> will be used in the output.</p></li>
</ol>
<p>For example, let’s add another variable to our <code>gapminder</code> dataset – physical integrity rights – from the CIRI dataset.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ciri &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/ciri_sub.csv&quot;</span>, <span class="dt">stringsAsFactors =</span> F)
<span class="kw">kable</span>(<span class="kw">head</span>(ciri))</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:left;">
CTRY
</th>
<th style="text-align:right;">
YEAR
</th>
<th style="text-align:right;">
PHYSINT
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:right;">
1981
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:right;">
1982
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:right;">
1983
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:right;">
1984
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:right;">
1985
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:right;">
1986
</td>
<td style="text-align:right;">
0
</td>
</tr>
</tbody>
</table>
<p>Both datasets have country and year columns, but they are named differently.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gap2 &lt;-<span class="st"> </span>gap1 <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">left_join</span>(ciri, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;country&quot;</span> =<span class="st"> &quot;CTRY&quot;</span>, <span class="st">&quot;year&quot;</span> =<span class="st"> &quot;YEAR&quot;</span>))

<span class="kw">kable</span>(<span class="kw">head</span>(gap2))</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:left;">
country
</th>
<th style="text-align:right;">
year
</th>
<th style="text-align:right;">
pop
</th>
<th style="text-align:left;">
continent
</th>
<th style="text-align:right;">
lifeExp
</th>
<th style="text-align:right;">
gdpPercap
</th>
<th style="text-align:right;">
polity2
</th>
<th style="text-align:right;">
PHYSINT
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:right;">
1952
</td>
<td style="text-align:right;">
8425333
</td>
<td style="text-align:left;">
Asia
</td>
<td style="text-align:right;">
28.8
</td>
<td style="text-align:right;">
779
</td>
<td style="text-align:right;">
-10
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:right;">
1957
</td>
<td style="text-align:right;">
9240934
</td>
<td style="text-align:left;">
Asia
</td>
<td style="text-align:right;">
30.3
</td>
<td style="text-align:right;">
821
</td>
<td style="text-align:right;">
-10
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:right;">
1962
</td>
<td style="text-align:right;">
10267083
</td>
<td style="text-align:left;">
Asia
</td>
<td style="text-align:right;">
32.0
</td>
<td style="text-align:right;">
853
</td>
<td style="text-align:right;">
-10
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:right;">
1967
</td>
<td style="text-align:right;">
11537966
</td>
<td style="text-align:left;">
Asia
</td>
<td style="text-align:right;">
34.0
</td>
<td style="text-align:right;">
836
</td>
<td style="text-align:right;">
-7
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:right;">
1972
</td>
<td style="text-align:right;">
13079460
</td>
<td style="text-align:left;">
Asia
</td>
<td style="text-align:right;">
36.1
</td>
<td style="text-align:right;">
740
</td>
<td style="text-align:right;">
-7
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
Afghanistan
</td>
<td style="text-align:right;">
1977
</td>
<td style="text-align:right;">
14880372
</td>
<td style="text-align:left;">
Asia
</td>
<td style="text-align:right;">
38.4
</td>
<td style="text-align:right;">
786
</td>
<td style="text-align:right;">
-7
</td>
<td style="text-align:right;">
NA
</td>
</tr>
</tbody>
</table>
<p>Notice that <code>PHYSINT</code> is <code>NA</code> in the first 6 rows because the <code>ciri</code> dataset does not contain observations for Afghanistan in these years. But because we used <code>left_join()</code>, all observations in <code>gapminder</code> were preserved.</p>
<p>We can see some values for <code>PHYSINT</code> if we peak at the bottom of the dataset:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">kable</span>(<span class="kw">tail</span>(gap2))</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:left;">
country
</th>
<th style="text-align:right;">
year
</th>
<th style="text-align:right;">
pop
</th>
<th style="text-align:left;">
continent
</th>
<th style="text-align:right;">
lifeExp
</th>
<th style="text-align:right;">
gdpPercap
</th>
<th style="text-align:right;">
polity2
</th>
<th style="text-align:right;">
PHYSINT
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
1699
</td>
<td style="text-align:left;">
Zimbabwe
</td>
<td style="text-align:right;">
1982
</td>
<td style="text-align:right;">
7636524
</td>
<td style="text-align:left;">
Africa
</td>
<td style="text-align:right;">
60.4
</td>
<td style="text-align:right;">
789
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:left;">
1700
</td>
<td style="text-align:left;">
Zimbabwe
</td>
<td style="text-align:right;">
1987
</td>
<td style="text-align:right;">
9216418
</td>
<td style="text-align:left;">
Africa
</td>
<td style="text-align:right;">
62.4
</td>
<td style="text-align:right;">
706
</td>
<td style="text-align:right;">
-6
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:left;">
1701
</td>
<td style="text-align:left;">
Zimbabwe
</td>
<td style="text-align:right;">
1992
</td>
<td style="text-align:right;">
10704340
</td>
<td style="text-align:left;">
Africa
</td>
<td style="text-align:right;">
60.4
</td>
<td style="text-align:right;">
693
</td>
<td style="text-align:right;">
-6
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:left;">
1702
</td>
<td style="text-align:left;">
Zimbabwe
</td>
<td style="text-align:right;">
1997
</td>
<td style="text-align:right;">
11404948
</td>
<td style="text-align:left;">
Africa
</td>
<td style="text-align:right;">
46.8
</td>
<td style="text-align:right;">
792
</td>
<td style="text-align:right;">
-6
</td>
<td style="text-align:right;">
6
</td>
</tr>
<tr>
<td style="text-align:left;">
1703
</td>
<td style="text-align:left;">
Zimbabwe
</td>
<td style="text-align:right;">
2002
</td>
<td style="text-align:right;">
11926563
</td>
<td style="text-align:left;">
Africa
</td>
<td style="text-align:right;">
40.0
</td>
<td style="text-align:right;">
672
</td>
<td style="text-align:right;">
-4
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:left;">
1704
</td>
<td style="text-align:left;">
Zimbabwe
</td>
<td style="text-align:right;">
2007
</td>
<td style="text-align:right;">
12311143
</td>
<td style="text-align:left;">
Africa
</td>
<td style="text-align:right;">
43.5
</td>
<td style="text-align:right;">
470
</td>
<td style="text-align:right;">
-4
</td>
<td style="text-align:right;">
1
</td>
</tr>
</tbody>
</table>
</div>
<div id="duplicate-keys" class="section level2">
<h2><span class="header-section-number">11.5</span> Duplicate Keys</h2>
<p>So far we have assumed that the keys are unique. But that’s not always the case. For example,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">key =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>),
               <span class="dt">val_y =</span> <span class="kw">c</span>(<span class="st">&quot;x1&quot;</span>, <span class="st">&quot;x2&quot;</span>))

y &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">key =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>),
               <span class="dt">val_x =</span> <span class="kw">c</span>(<span class="st">&quot;y1&quot;</span>, <span class="st">&quot;y2&quot;</span>, <span class="st">&quot;y3&quot;</span>, <span class="st">&quot;y4&quot;</span>))

<span class="kw">left_join</span>(x, y, <span class="dt">by =</span> <span class="st">&quot;key&quot;</span>)
<span class="co">#&gt;   key val_y val_x</span>
<span class="co">#&gt; 1   1    x1    y1</span>
<span class="co">#&gt; 2   1    x1    y4</span>
<span class="co">#&gt; 3   2    x2    y2</span>
<span class="co">#&gt; 4   2    x2    y3</span></code></pre></div>
<p>Notice that this can sometimes cause unintended duplicates.</p>
<div id="acknowledgements-2" class="section level4 unnumbered">
<h4>Acknowledgements</h4>
<p>This page is in part derived from the following sources:</p>
<ol style="list-style-type: decimal">
<li><p><a href="https://r4ds.had.co.nz">R for Data Science</a> licensed under <a href="https://creativecommons.org/licenses/by-nc-nd/3.0/us/">Creative Commons Attribution-NonCommercial-NoDerivs 3.0</a></p></li>
<li><p><a href="https://web.stanford.edu/~gentzkow/research/CodeAndData.pdf">Gentzkow, Matthew and Jesse M. Shapiro. 2014. Code and Data for the Social Sciences: A Practitioner’s Guide.</a></p></li>
</ol>
<!--chapter:end:09_Merging/09-1_Relational.Rmd-->
<blockquote>
<p>“Make it informative, then make it pretty”</p>
</blockquote>
</div>
</div>
</div>
<div id="plotting" class="section level1">
<h1><span class="header-section-number">12</span> Plotting</h1>
<p>There are two major sets of tools for creating plots in R:</p>
<ul>
<li><ol style="list-style-type: decimal">
<li><a href="#1-r-base-graphics">base</a>, which come with all R installations.</li>
</ol></li>
<li><ol start="2" style="list-style-type: decimal">
<li><a href="#2-ggplot2">ggplot2</a>, a stand-alone package.</li>
</ol></li>
</ul>
<p>Note that other plotting facilities do exist (notably <strong>lattice</strong>), but base and <code>ggplot2</code> are by far the most popular.</p>
<div id="the-dataset" class="section level2">
<h2><span class="header-section-number">12.1</span> The Dataset</h2>
<p>For the following examples, we will be using the gapminder dataset we’ve used previously. Gapminder is a country-year dataset with information on life expectancy, among other things.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gap &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/gapminder-FiveYearData.csv&quot;</span>, <span class="dt">stringsAsFactors =</span> F)</code></pre></div>
</div>
<div id="r-base-graphics" class="section level2">
<h2><span class="header-section-number">12.2</span> R Base Graphics</h2>
<p>The <strong>basic</strong> call takes the following form:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(<span class="dt">x=</span>, <span class="dt">y=</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(<span class="dt">x =</span> gap<span class="op">$</span>gdpPercap, <span class="dt">y =</span> gap<span class="op">$</span>lifeExp)</code></pre></div>
<p><img src="site1_files/figure-html/unnamed-chunk-288-1.png" width="70%" style="display: block; margin: auto;" /></p>
<div id="scatter-and-line-plots" class="section level3">
<h3><span class="header-section-number">12.2.1</span> Scatter and Line Plots</h3>
<p>The “type” argument accepts the following character indicators.</p>
<ul>
<li>“p” – point/scatter plots (default plotting behavior)</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(<span class="dt">x =</span> gap<span class="op">$</span>gdpPercap, <span class="dt">y =</span> gap<span class="op">$</span>lifeExp, <span class="dt">type=</span><span class="st">&quot;p&quot;</span>)</code></pre></div>
<div class="figure" style="text-align: center">
<img src="site1_files/figure-html/unnamed-chunk-289-1.png" alt=" " width="70%" />
<p class="caption">
</p>
</div>
<ul>
<li>“l” – line graphs</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Note that &quot;line&quot; does not create a smoothing line, just connected points</span>
<span class="kw">plot</span>(<span class="dt">x =</span> gap<span class="op">$</span>gdpPercap, <span class="dt">y =</span> gap<span class="op">$</span>lifeExp, <span class="dt">type=</span><span class="st">&quot;l&quot;</span>) </code></pre></div>
<div class="figure" style="text-align: center">
<img src="site1_files/figure-html/unnamed-chunk-290-1.png" alt=" " width="70%" />
<p class="caption">
</p>
</div>
<ul>
<li>“b” – both line and point plots</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(<span class="dt">x =</span> gap<span class="op">$</span>gdpPercap, <span class="dt">y =</span> gap<span class="op">$</span>lifeExp, <span class="dt">type=</span><span class="st">&quot;b&quot;</span>) </code></pre></div>
<div class="figure" style="text-align: center">
<img src="site1_files/figure-html/unnamed-chunk-291-1.png" alt=" " width="70%" />
<p class="caption">
</p>
</div>
</div>
<div id="histograms-and-density-plots" class="section level3">
<h3><span class="header-section-number">12.2.2</span> Histograms and Density Plots</h3>
<p>Histograms display the frequency of different values of a variable.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">hist</span>(<span class="dt">x=</span>gap<span class="op">$</span>lifeExp)</code></pre></div>
<p><img src="site1_files/figure-html/unnamed-chunk-292-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>Histograms require a <code>breaks</code> argument, which determine the number of bins in the plot. Let’s play around with different <code>breaks</code> values.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">hist</span>(<span class="dt">x=</span>gap<span class="op">$</span>lifeExp, <span class="dt">breaks=</span><span class="dv">5</span>)
<span class="kw">hist</span>(<span class="dt">x=</span>gap<span class="op">$</span>lifeExp, <span class="dt">breaks=</span><span class="dv">10</span>)</code></pre></div>
<p><img src="site1_files/figure-html/unnamed-chunk-293-1.png" width="70%" style="display: block; margin: auto;" /><img src="site1_files/figure-html/unnamed-chunk-293-2.png" width="70%" style="display: block; margin: auto;" /></p>
<p>Density plots are similar, they visualize the distribution of data over a continuous interval.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Create a density object (</span><span class="al">NOTE</span><span class="co">: be sure to remove missing values)</span>
age.density &lt;-<span class="st"> </span><span class="kw">density</span>(<span class="dt">x=</span>gap<span class="op">$</span>lifeExp, <span class="dt">na.rm=</span>T)

<span class="co"># Plot the density object</span>
<span class="kw">plot</span>(<span class="dt">x=</span>age.density)</code></pre></div>
<div class="figure" style="text-align: center">
<img src="site1_files/figure-html/unnamed-chunk-294-1.png" alt=" " width="70%" />
<p class="caption">
</p>
</div>
<p>Density passes a <code>bw</code> parameter, which determins the plot’s “bandwidth”.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Plot the density object, bandwidth of 0.5</span>
<span class="kw">plot</span>(<span class="dt">x=</span><span class="kw">density</span>(<span class="dt">x=</span>gap<span class="op">$</span>lifeExp, <span class="dt">bw=</span>.<span class="dv">5</span>))
<span class="co"># Plot the density object, bandwidth of 2</span>
<span class="kw">plot</span>(<span class="dt">x=</span><span class="kw">density</span>(<span class="dt">x=</span>gap<span class="op">$</span>lifeExp, <span class="dt">bw=</span><span class="dv">2</span>))
<span class="co"># Plot the density object, bandwidth of 6</span>
<span class="kw">plot</span>(<span class="dt">x=</span><span class="kw">density</span>(<span class="dt">x=</span>gap<span class="op">$</span>lifeExp, <span class="dt">bw=</span><span class="dv">6</span>)) </code></pre></div>
<p><img src="site1_files/figure-html/unnamed-chunk-295-1.png" width="70%" style="display: block; margin: auto;" /><img src="site1_files/figure-html/unnamed-chunk-295-2.png" width="70%" style="display: block; margin: auto;" /><img src="site1_files/figure-html/unnamed-chunk-295-3.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<div id="labels" class="section level3">
<h3><span class="header-section-number">12.2.3</span> Labels</h3>
<p>Here’s the basic call with popular labeling arguments:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(<span class="dt">x=</span>, <span class="dt">y=</span>, <span class="dt">type=</span><span class="st">&quot;&quot;</span>, <span class="dt">xlab=</span><span class="st">&quot;&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;&quot;</span>, <span class="dt">main=</span><span class="st">&quot;&quot;</span>) </code></pre></div>
<p>From the previous example…</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(<span class="dt">x =</span> gap<span class="op">$</span>gdpPercap, <span class="dt">y =</span> gap<span class="op">$</span>lifeExp, <span class="dt">type=</span><span class="st">&quot;p&quot;</span>, <span class="dt">xlab=</span><span class="st">&quot;GDP per cap&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;Life Expectancy&quot;</span>, <span class="dt">main=</span><span class="st">&quot;Life Expectancy ~ GDP&quot;</span>) <span class="co"># Add labels for axes and overall plot</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="site1_files/figure-html/unnamed-chunk-297-1.png" alt=" " width="70%" />
<p class="caption">
</p>
</div>
</div>
<div id="axis-and-size-scaling" class="section level3">
<h3><span class="header-section-number">12.2.4</span> Axis and Size Scaling</h3>
<p>Currently it’s hard to see the relationship between the points due to some strong outliers in GDP per capita. We can change the scale of units on the x-axis using scaling arguments.</p>
<p>Here’s the basic call with popular scaling arguments</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(<span class="dt">x=</span>, <span class="dt">y=</span>, <span class="dt">type=</span><span class="st">&quot;&quot;</span>, <span class="dt">xlim=</span>, <span class="dt">ylim=</span>, <span class="dt">cex=</span>)</code></pre></div>
<p>From the previous example…</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Create a basic plot</span>
<span class="kw">plot</span>(<span class="dt">x =</span> gap<span class="op">$</span>gdpPercap, <span class="dt">y =</span> gap<span class="op">$</span>lifeExp, <span class="dt">type=</span><span class="st">&quot;p&quot;</span>)
<span class="co"># Limit gdp (x-axis) to between 1,000 and 20,000</span>
<span class="kw">plot</span>(<span class="dt">x =</span> gap<span class="op">$</span>gdpPercap, <span class="dt">y =</span> gap<span class="op">$</span>lifeExp, <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">1000</span>,<span class="dv">20000</span>)) 
<span class="co"># Limit gdp (x-axis) to between 1,000 and 20,000, increase point size to 2</span>
<span class="kw">plot</span>(<span class="dt">x =</span> gap<span class="op">$</span>gdpPercap, <span class="dt">y =</span> gap<span class="op">$</span>lifeExp, <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">1000</span>,<span class="dv">20000</span>), <span class="dt">cex=</span><span class="dv">2</span>) 
<span class="co"># Limit gdp (x-axis) to between 1,000 and 20,000, decrease point size to 0.5</span>
<span class="kw">plot</span>(<span class="dt">x =</span> gap<span class="op">$</span>gdpPercap, <span class="dt">y =</span> gap<span class="op">$</span>lifeExp, <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">1000</span>,<span class="dv">20000</span>), <span class="dt">cex=</span><span class="fl">0.5</span>)  </code></pre></div>
<div class="figure" style="text-align: center">
<img src="site1_files/figure-html/unnamed-chunk-299-1.png" alt=" " width="70%" /><img src="site1_files/figure-html/unnamed-chunk-299-2.png" alt=" " width="70%" /><img src="site1_files/figure-html/unnamed-chunk-299-3.png" alt=" " width="70%" /><img src="site1_files/figure-html/unnamed-chunk-299-4.png" alt=" " width="70%" />
<p class="caption">
</p>
</div>
</div>
<div id="graphical-parameters" class="section level3">
<h3><span class="header-section-number">12.2.5</span> Graphical Parameters</h3>
<p>We can change the points with a number of graphical options:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(<span class="dt">x=</span>, <span class="dt">y=</span>, <span class="dt">type=</span><span class="st">&quot;&quot;</span>, <span class="dt">col=</span><span class="st">&quot;&quot;</span>, <span class="dt">pch=</span>, <span class="dt">lty=</span>, <span class="dt">lwd=</span>)</code></pre></div>
<ul>
<li>Colors</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">colors</span>()[<span class="dv">1</span><span class="op">:</span><span class="dv">20</span>] <span class="co"># View first 20 elements of the color vector</span>
<span class="co">#&gt;  [1] &quot;white&quot;         &quot;aliceblue&quot;     &quot;antiquewhite&quot;  &quot;antiquewhite1&quot;</span>
<span class="co">#&gt;  [5] &quot;antiquewhite2&quot; &quot;antiquewhite3&quot; &quot;antiquewhite4&quot; &quot;aquamarine&quot;   </span>
<span class="co">#&gt;  [9] &quot;aquamarine1&quot;   &quot;aquamarine2&quot;   &quot;aquamarine3&quot;   &quot;aquamarine4&quot;  </span>
<span class="co">#&gt; [13] &quot;azure&quot;         &quot;azure1&quot;        &quot;azure2&quot;        &quot;azure3&quot;       </span>
<span class="co">#&gt; [17] &quot;azure4&quot;        &quot;beige&quot;         &quot;bisque&quot;        &quot;bisque1&quot;</span>
<span class="kw">colors</span>()[<span class="dv">179</span>] <span class="co"># View specific element of the color vector</span>
<span class="co">#&gt; [1] &quot;gray26&quot;</span></code></pre></div>
<p>Another option: <a href="http://research.stowers-institute.org/efg/R/Color/Chart/ColorsChart1.jpg">R Color Infographic</a></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(<span class="dt">x =</span> gap<span class="op">$</span>gdpPercap, <span class="dt">y =</span> gap<span class="op">$</span>lifeExp, <span class="dt">type=</span><span class="st">&quot;p&quot;</span>, <span class="dt">col=</span><span class="kw">colors</span>()[<span class="dv">145</span>]) <span class="co"># or col=&quot;gold3&quot;</span>
<span class="kw">plot</span>(<span class="dt">x =</span> gap<span class="op">$</span>gdpPercap, <span class="dt">y =</span> gap<span class="op">$</span>lifeExp, <span class="dt">type=</span><span class="st">&quot;p&quot;</span>, <span class="dt">col=</span><span class="st">&quot;seagreen4&quot;</span>) <span class="co"># or col=colors()[578]</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="site1_files/figure-html/unnamed-chunk-302-1.png" alt=" " width="70%" /><img src="site1_files/figure-html/unnamed-chunk-302-2.png" alt=" " width="70%" />
<p class="caption">
</p>
</div>
<ul>
<li>Point Styles and Widths</li>
</ul>
<p><a href="http://www.endmemo.com/program/R/pic/pchsymbols.png">A Good Reference</a></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Change point style to crosses</span>
<span class="kw">plot</span>(<span class="dt">x =</span> gap<span class="op">$</span>gdpPercap, <span class="dt">y =</span> gap<span class="op">$</span>lifeExp, <span class="dt">type=</span><span class="st">&quot;p&quot;</span>, <span class="dt">pch=</span><span class="dv">3</span>) 
<span class="co"># Change point style to filled squares</span>
<span class="kw">plot</span>(<span class="dt">x =</span> gap<span class="op">$</span>gdpPercap, <span class="dt">y =</span> gap<span class="op">$</span>lifeExp, <span class="dt">type=</span><span class="st">&quot;p&quot;</span>,<span class="dt">pch=</span><span class="dv">15</span>) 
<span class="co"># Change point style to filled squares and increase point size to 3</span>
<span class="kw">plot</span>(<span class="dt">x =</span> gap<span class="op">$</span>gdpPercap, <span class="dt">y =</span> gap<span class="op">$</span>lifeExp, <span class="dt">type=</span><span class="st">&quot;p&quot;</span>,<span class="dt">pch=</span><span class="dv">15</span>, <span class="dt">cex=</span><span class="dv">3</span>) 
<span class="co"># Change point style to &quot;w&quot;</span>
<span class="kw">plot</span>(<span class="dt">x =</span> gap<span class="op">$</span>gdpPercap, <span class="dt">y =</span> gap<span class="op">$</span>lifeExp, <span class="dt">type=</span><span class="st">&quot;p&quot;</span>, <span class="dt">pch=</span><span class="st">&quot;w&quot;</span>)
<span class="co"># Change point style to &quot;$&quot; and increase point size to 2</span>
<span class="kw">plot</span>(<span class="dt">x =</span> gap<span class="op">$</span>gdpPercap, <span class="dt">y =</span> gap<span class="op">$</span>lifeExp, <span class="dt">type=</span><span class="st">&quot;p&quot;</span>,<span class="dt">pch=</span><span class="st">&quot;$&quot;</span>, <span class="dt">cex=</span><span class="dv">2</span>) </code></pre></div>
<div class="figure" style="text-align: center">
<img src="site1_files/figure-html/unnamed-chunk-303-1.png" alt=" " width="70%" /><img src="site1_files/figure-html/unnamed-chunk-303-2.png" alt=" " width="70%" /><img src="site1_files/figure-html/unnamed-chunk-303-3.png" alt=" " width="70%" /><img src="site1_files/figure-html/unnamed-chunk-303-4.png" alt=" " width="70%" /><img src="site1_files/figure-html/unnamed-chunk-303-5.png" alt=" " width="70%" />
<p class="caption">
</p>
</div>
<ul>
<li>Line Styles and Widths</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Line plot with solid line</span>
<span class="kw">plot</span>(<span class="dt">x =</span> gap<span class="op">$</span>gdpPercap, <span class="dt">y =</span> gap<span class="op">$</span>lifeExp, <span class="dt">type=</span><span class="st">&quot;l&quot;</span>, <span class="dt">lty=</span><span class="dv">1</span>)
<span class="co"># Line plot with medium dashed line</span>
<span class="kw">plot</span>(<span class="dt">x =</span> gap<span class="op">$</span>gdpPercap, <span class="dt">y =</span> gap<span class="op">$</span>lifeExp, <span class="dt">type=</span><span class="st">&quot;l&quot;</span>, <span class="dt">lty=</span><span class="dv">2</span>)
<span class="co"># Line plot with short dashed line</span>
<span class="kw">plot</span>(<span class="dt">x =</span> gap<span class="op">$</span>gdpPercap, <span class="dt">y =</span> gap<span class="op">$</span>lifeExp, <span class="dt">type=</span><span class="st">&quot;l&quot;</span>, <span class="dt">lty=</span><span class="dv">3</span>)
<span class="co"># Change line width to 2</span>
<span class="kw">plot</span>(<span class="dt">x =</span> gap<span class="op">$</span>gdpPercap, <span class="dt">y =</span> gap<span class="op">$</span>lifeExp, <span class="dt">type=</span><span class="st">&quot;l&quot;</span>, <span class="dt">lty=</span><span class="dv">3</span>, <span class="dt">lwd=</span><span class="dv">2</span>)
<span class="co"># Change line width to 5</span>
<span class="kw">plot</span>(<span class="dt">x =</span> gap<span class="op">$</span>gdpPercap, <span class="dt">y =</span> gap<span class="op">$</span>lifeExp, <span class="dt">type=</span><span class="st">&quot;l&quot;</span>,  <span class="dt">lwd=</span><span class="dv">5</span>)
<span class="co"># Change line width to 10 and use dash-dot</span>
<span class="kw">plot</span>(<span class="dt">x =</span> gap<span class="op">$</span>gdpPercap, <span class="dt">y =</span> gap<span class="op">$</span>lifeExp, <span class="dt">type=</span><span class="st">&quot;l&quot;</span>,  <span class="dt">lty=</span><span class="dv">4</span>, <span class="dt">lwd=</span><span class="dv">10</span>)</code></pre></div>
<div class="figure" style="text-align: center">
<img src="site1_files/figure-html/unnamed-chunk-304-1.png" alt=" " width="70%" /><img src="site1_files/figure-html/unnamed-chunk-304-2.png" alt=" " width="70%" /><img src="site1_files/figure-html/unnamed-chunk-304-3.png" alt=" " width="70%" /><img src="site1_files/figure-html/unnamed-chunk-304-4.png" alt=" " width="70%" /><img src="site1_files/figure-html/unnamed-chunk-304-5.png" alt=" " width="70%" /><img src="site1_files/figure-html/unnamed-chunk-304-6.png" alt=" " width="70%" />
<p class="caption">
</p>
</div>
</div>
<div id="annotations-reference-lines-and-legends" class="section level3">
<h3><span class="header-section-number">12.2.6</span> Annotations, Reference Lines, and Legends</h3>
<ul>
<li>Text</li>
</ul>
<p>We can add text to an arbitrary point on the graph like this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># plot the line first</span>
<span class="kw">plot</span>(<span class="dt">x =</span> gap<span class="op">$</span>gdpPercap, <span class="dt">y =</span> gap<span class="op">$</span>lifeExp, <span class="dt">type=</span><span class="st">&quot;p&quot;</span>)
<span class="co"># now add the label</span>
<span class="kw">text</span>(<span class="dt">x=</span><span class="dv">40000</span>, <span class="dt">y=</span><span class="dv">50</span>, <span class="dt">labels=</span><span class="st">&quot;Evens Out&quot;</span>, <span class="dt">cex =</span> .<span class="dv">75</span>)</code></pre></div>
<div class="figure" style="text-align: center">
<img src="site1_files/figure-html/unnamed-chunk-305-1.png" alt=" " width="70%" />
<p class="caption">
</p>
</div>
<p>We can also add labels for every point by passing in a vector of text:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># first randomly select rows for a smaller gapaset</span>
<span class="kw">library</span>(dplyr)
small &lt;-<span class="st"> </span>gap <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">sample_n</span>(<span class="dv">100</span>)

<span class="co"># plot the line first</span>
<span class="kw">plot</span>(<span class="dt">x =</span> small<span class="op">$</span>gdpPercap, <span class="dt">y =</span> small<span class="op">$</span>lifeExp, <span class="dt">type=</span><span class="st">&quot;p&quot;</span>)
<span class="co"># now add the label</span>
<span class="kw">text</span>(<span class="dt">x =</span> small<span class="op">$</span>gdpPercap, <span class="dt">y =</span> small<span class="op">$</span>lifeExp, <span class="dt">labels =</span> small<span class="op">$</span>country)</code></pre></div>
<div class="figure" style="text-align: center">
<img src="site1_files/figure-html/unnamed-chunk-306-1.png" alt=" " width="70%" />
<p class="caption">
</p>
</div>
<ul>
<li>Reference Lines</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># plot the line</span>
<span class="kw">plot</span>(<span class="dt">x =</span> gap<span class="op">$</span>gdpPercap, <span class="dt">y =</span> gap<span class="op">$</span>lifeExp, <span class="dt">type=</span><span class="st">&quot;p&quot;</span>)
<span class="co"># now the guides</span>
<span class="kw">abline</span>(<span class="dt">v=</span><span class="dv">40000</span>, <span class="dt">h=</span><span class="dv">75</span>, <span class="dt">lty=</span><span class="dv">2</span>)</code></pre></div>
<div class="figure" style="text-align: center">
<img src="site1_files/figure-html/unnamed-chunk-307-1.png" alt=" " width="70%" />
<p class="caption">
</p>
</div>
<!--chapter:end:10-Visualization/10-1-Base.Rmd-->
</div>
</div>
<div id="ggplot2" class="section level2">
<h2><span class="header-section-number">12.3</span> ggplot2</h2>
<p>Setup:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggplot2)
gap &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/gapminder-FiveYearData.csv&quot;</span>, <span class="dt">stringsAsFactors =</span> F)</code></pre></div>
<div id="why-ggplot" class="section level4 unnumbered">
<h4>Why <code>ggplot</code>?</h4>
<ul>
<li>More elegant &amp; compact code than R base graphics</li>
<li>More aesthetically pleasing defaults than lattice</li>
<li>Very powerful for exploratory data analysis</li>
<li>Follows a grammar, just like any language.</li>
<li>It defines basic components that make up a sentence. In this case, the grammar defines components in a plot.</li>
<li><em>G</em>rammar of <em>g</em>raphics originally coined by Lee Wilkinson</li>
</ul>
</div>
<div id="grammar" class="section level3">
<h3><span class="header-section-number">12.3.1</span> Grammar</h3>
<p>The general call for <code>ggplot2</code> looks like this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data=</span>, <span class="kw">aes</span>(<span class="dt">x=</span>, <span class="dt">y=</span>), <span class="dt">color=</span>, <span class="dt">size=</span>,) <span class="op">+</span><span class="st"> </span><span class="kw">geom_xxxx</span>()<span class="op">+</span><span class="kw">geom_yyyy</span>()</code></pre></div>
<p>The <em>grammar</em> involves some basic components:</p>
<ol style="list-style-type: decimal">
<li><strong>Data</strong>: a data.frame</li>
<li><strong>Aes</strong>thetics: How your data are represented visually, aka its “mapping”. Which variables are shown on x, y axes, as well as color, size, shape, etc.</li>
<li><strong>Geom</strong>etry: The geometric objects in a plot – points, lines, polygons, etc.</li>
</ol>
<p>The key to understanding <code>ggplot2</code> is thinking about a figure in layers: just like you might do in an image editing program like Photoshop, Illustrator, or Inkscape.</p>
<p>Let’s look at an example:</p>
<pre><code>ggplot(data = gap, aes(x = gdpPercap, y = lifeExp)) +
  geom_point()</code></pre>
<p>So the first thing we do is call the <code>ggplot</code> function. This function lets R know that we’re creating a new plot, and any of the arguments we give the <code>ggplot</code> function are the global options for the plot: they apply to all layers on the plot.</p>
<p>We’ve passed in two arguments to <code>ggplot</code>. First, we tell <code>ggplot</code> what <strong><code>data</code></strong> we want to show on our figure, in this example the <code>gapminder</code> data we read in earlier.</p>
<p>For the second argument we passed in the <strong><code>aes</code></strong> function, which tells <code>ggplot</code> how variables in the data map to aesthetic properties of the figure, in this case the x and y locations. Here we told <code>ggplot</code> we want to plot the <code>lifeExp</code> column of the gapminder data frame on the x-axis, and the <code>gdpPercap</code> column on the y-axis.</p>
<p>Notice that we didn’t need to explicitly pass <code>aes</code> these columns (e.g. <code>x = gapminder[, &quot;lifeExp&quot;&quot;])</code>, this is because <code>ggplot</code> is smart enough to know to look in the data for that column!</p>
<p>By itself, the call to <code>ggplot</code> isn’t enough to draw a figure:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> gap, <span class="kw">aes</span>(<span class="dt">x =</span> gdpPercap, <span class="dt">y =</span> lifeExp))</code></pre></div>
<p>We need to tell <code>ggplot</code> how we want to visually represent the data, which we do by adding a new <strong><code>geom</code></strong> layer. In our example, we used <code>geom_point</code>, which tells <code>ggplot</code> we want to visually represent the relationship between x and y as a scatterplot of points:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> gap, <span class="kw">aes</span>(<span class="dt">x =</span> gdpPercap, <span class="dt">y =</span> lifeExp)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>()

<span class="co"># same as</span>
<span class="co"># my_plot &lt;- ggplot(data = gap, aes(x = gdpPercap, y = lifeExp))</span>
<span class="co"># my_plot + geom_point()</span></code></pre></div>
<p><img src="site1_files/figure-html/unnamed-chunk-312-1.png" width="70%" style="display: block; margin: auto;" /></p>
<div id="challenge-1-1" class="section level4 unnumbered">
<h4>Challenge 1</h4>
<p>Modify the example so that the figure visualises how life expectancy has changed over time:</p>
<p>Hint: the gapminder dataset has a column called <code>year</code>, which should appear on the x-axis.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># YOUR CODE HERE</span>

<span class="kw">ggplot</span>(<span class="dt">data =</span> gap, <span class="kw">aes</span>(<span class="dt">x =</span> year, <span class="dt">y =</span> lifeExp)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>()</code></pre></div>
<p><img src="site1_files/figure-html/unnamed-chunk-313-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="anatomy-of-aes" class="section level3">
<h3><span class="header-section-number">12.3.2</span> Anatomy of <code>aes</code></h3>
<p>In the previous examples and challenge we’ve used the <code>aes</code> function to tell the scatterplot <code>geom</code> about the <strong>x</strong> and <strong>y</strong> locations of each point. Another aesthetic property we can modify is the point <strong>color</strong>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> gap, <span class="kw">aes</span>(<span class="dt">x =</span> gdpPercap, <span class="dt">y =</span> lifeExp, <span class="dt">color=</span>continent)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>()</code></pre></div>
<p><img src="site1_files/figure-html/unnamed-chunk-314-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>Normally, specifying options like <code>color=&quot;red&quot;</code> or <code>size=10</code> for a given layer results in its contents being red and quite large. Inside the <code>aes()</code> function, however, these arguments are given entire variables whose values will then be displayed using different realizations of that aesthetic.</p>
<p><strong>Color</strong> isn’t the only aesthetic argument we can set to display variation in the data. We can also vary by shape, size, etc.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data=</span>, <span class="kw">aes</span>(<span class="dt">x=</span>, <span class="dt">y=</span>, <span class="dt">by =</span>, <span class="dt">color=</span>, <span class="dt">linetype=</span>, <span class="dt">shape=</span>, <span class="dt">size=</span>))</code></pre></div>
</div>
<div id="layers" class="section level3">
<h3><span class="header-section-number">12.3.3</span> Layers</h3>
<p>In the previous challenge, you plotted <code>lifExp</code> over time. Using a scatterplot probably isn’t the best for visualising change over time. Instead, let’s tell <code>ggplot</code> to visualise the data as a line plot:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> gap, <span class="kw">aes</span>(<span class="dt">x=</span>year, <span class="dt">y=</span>lifeExp, <span class="dt">by=</span>country, <span class="dt">color=</span>continent)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_line</span>()</code></pre></div>
<p><img src="site1_files/figure-html/unnamed-chunk-316-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>Instead of adding a <code>geom_point</code> layer, we’ve added a <code>geom_line</code> layer. We’ve also added the <strong>by</strong> aesthetic, which tells <code>ggplot</code> to draw a line for each country.</p>
<p>But what if we want to visualise both lines and points on the plot? We can simply add another layer to the plot:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> gap, <span class="kw">aes</span>(<span class="dt">x=</span>year, <span class="dt">y=</span>lifeExp, <span class="dt">by=</span>country, <span class="dt">color=</span>continent)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>()</code></pre></div>
<p><img src="site1_files/figure-html/unnamed-chunk-317-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>It’s important to note that each layer is drawn on top of the previous layer. In this example, the points have been drawn on top of the lines. Here’s a demonstration:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> gap, <span class="kw">aes</span>(<span class="dt">x=</span>year, <span class="dt">y=</span>lifeExp, <span class="dt">by=</span>country)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">color=</span>continent)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>()</code></pre></div>
<p><img src="site1_files/figure-html/unnamed-chunk-318-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>In this example, the aesthetic mapping of <strong>color</strong> has been moved from the global plot options in <code>ggplot</code> to the <code>geom_line</code> layer so it no longer applies to the points. Now we can clearly see that the points are drawn on top of the lines.</p>
<div id="challenge-2-1" class="section level4 unnumbered">
<h4>Challenge 2</h4>
<p>Switch the order of the point and line layers from the previous example. What happened?</p>
</div>
</div>
<div id="labels-1" class="section level3">
<h3><span class="header-section-number">12.3.4</span> Labels</h3>
<p>Labels are considered to be their own layers in <code>ggplot</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># add x and y axis labels</span>
<span class="kw">ggplot</span>(<span class="dt">data =</span> gap, <span class="kw">aes</span>(<span class="dt">x =</span> gdpPercap, <span class="dt">y =</span> lifeExp, <span class="dt">color=</span>continent)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;GDP per capita&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Life Expectancy&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;My fancy graph&quot;</span>)</code></pre></div>
<p><img src="site1_files/figure-html/unnamed-chunk-319-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>So are scales:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># limit x-axis from 1,000 to 20,000</span>
<span class="kw">ggplot</span>(<span class="dt">data =</span> gap, <span class="kw">aes</span>(<span class="dt">x =</span> gdpPercap, <span class="dt">y =</span> lifeExp, <span class="dt">color=</span>continent)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;GDP per capita&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Life Expectancy&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;My fancy graph&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">xlim</span>(<span class="dv">1000</span>, <span class="dv">20000</span>)
<span class="co">#&gt; Warning: Removed 515 rows containing missing values (geom_point).</span></code></pre></div>
<p><img src="site1_files/figure-html/unnamed-chunk-320-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<div id="transformations-and-stats" class="section level3">
<h3><span class="header-section-number">12.3.5</span> Transformations and Stats</h3>
<p><code>ggplot</code> also makes it easy to overlay statistical models over the data. To demonstrate we’ll go back to an earlier example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> gap, <span class="kw">aes</span>(<span class="dt">x =</span> gdpPercap, <span class="dt">y =</span> lifeExp, <span class="dt">color=</span>continent)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>()</code></pre></div>
<p><img src="site1_files/figure-html/unnamed-chunk-321-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>We can change the scale of units on the x-axis using the <code>scale</code> functions. These control the mapping between the data values and visual values of an aesthetic.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> gap, <span class="kw">aes</span>(<span class="dt">x =</span> gdpPercap, <span class="dt">y =</span> lifeExp, <span class="dt">color=</span>continent)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">scale_x_log10</span>()</code></pre></div>
<p><img src="site1_files/figure-html/unnamed-chunk-322-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>The <code>log10</code> function applied a transformation to the values of the <code>gdpPercap</code> column before rendering them on the plot, so that each multiple of 10 now only corresponds to an increase in 1 on the transformed scale, e.g. a GDP per capita of 1,000 is now 3 on the y axis, a value of 10,000 corresponds to 4 on the x-axis and so on. This makes it easier to visualise the spread of data on the x-axis.</p>
<p>We can fit a simple relationship to the data by adding another layer, <code>geom_smooth</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> gap, <span class="kw">aes</span>(<span class="dt">x =</span> gdpPercap, <span class="dt">y =</span> lifeExp, <span class="dt">color=</span>continent)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">scale_x_log10</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method=</span><span class="st">&quot;lm&quot;</span>)</code></pre></div>
<p><img src="site1_files/figure-html/unnamed-chunk-323-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>Note that we have 5 lines, one for each region, because of the <strong>color</strong> option is the global <code>aes</code> function. But if we move it, we get different restuls:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> gap, <span class="kw">aes</span>(<span class="dt">x =</span> gdpPercap, <span class="dt">y =</span> lifeExp)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">color=</span>continent)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">scale_x_log10</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method=</span><span class="st">&quot;lm&quot;</span>)</code></pre></div>
<p><img src="site1_files/figure-html/unnamed-chunk-324-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>So, there are two ways an aesthetic can be specified. Here, we set the <strong>color</strong> aesthetic by passing it as an argument to <code>geom_point</code>. Previously in the lesson, we used the <code>aes</code> function to define a <em>mapping</em> between data variables and their visual representation.</p>
<p>We can make the line thicker by setting the <strong>size</strong> aesthetic in the geom_smooth layer:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> gap, <span class="kw">aes</span>(<span class="dt">x =</span> gdpPercap, <span class="dt">y =</span> lifeExp)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">color=</span>continent)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">scale_x_log10</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method=</span><span class="st">&quot;lm&quot;</span>, <span class="dt">size =</span> <span class="fl">1.5</span>)</code></pre></div>
<p><img src="site1_files/figure-html/unnamed-chunk-325-1.png" width="70%" style="display: block; margin: auto;" /></p>
<div id="challenge-3" class="section level4 unnumbered">
<h4>Challenge 3</h4>
<p>Modify the color and size of the points on the point layer in the previous example so that they are fixed (i.e. not reflective of continent).</p>
<p>Hint: do not use the <code>aes</code> function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># YOUR CODE HERE</span>

<span class="kw">ggplot</span>(<span class="dt">data =</span> gap, <span class="kw">aes</span>(<span class="dt">x =</span> gdpPercap, <span class="dt">y =</span> lifeExp)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">color =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">size =</span> <span class="dv">1</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">scale_x_log10</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method=</span><span class="st">&quot;lm&quot;</span>, <span class="dt">size =</span> <span class="fl">1.5</span>)</code></pre></div>
<p><img src="site1_files/figure-html/unnamed-chunk-326-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="facets" class="section level3">
<h3><span class="header-section-number">12.3.6</span> Facets</h3>
<p>Earlier, we visualised the change in life expectancy over time across all countries in one plot. Alternatively, we can split this out over multiple panels by adding a layer of <strong>facet</strong> panels:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> gap, <span class="kw">aes</span>(<span class="dt">x =</span> year, <span class="dt">y =</span> lifeExp, <span class="dt">color=</span>continent)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">facet_wrap</span>( <span class="op">~</span><span class="st"> </span>country)</code></pre></div>
<p><img src="site1_files/figure-html/unnamed-chunk-327-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<div id="putting-everything-together" class="section level3">
<h3><span class="header-section-number">12.3.7</span> Putting Everything Together</h3>
<p>Here are some other common <code>geom</code> layers:</p>
<p><strong>bar plots</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># count of lifeExp bins</span>
<span class="kw">ggplot</span>(<span class="dt">data =</span> gap, <span class="kw">aes</span>(<span class="dt">x =</span> lifeExp)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat=</span><span class="st">&quot;bin&quot;</span>)
<span class="co">#&gt; `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</span>

<span class="co"># with color representing regions</span>
<span class="kw">ggplot</span>(<span class="dt">data =</span> gap, <span class="kw">aes</span>(<span class="dt">x =</span> lifeExp, <span class="dt">fill =</span> continent)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat=</span><span class="st">&quot;bin&quot;</span>)
<span class="co">#&gt; `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</span></code></pre></div>
<p><img src="site1_files/figure-html/unnamed-chunk-328-1.png" width="70%" style="display: block; margin: auto;" /><img src="site1_files/figure-html/unnamed-chunk-328-2.png" width="70%" style="display: block; margin: auto;" /></p>
<p><strong>box plots</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> gap, <span class="kw">aes</span>(<span class="dt">x =</span> continent, <span class="dt">y =</span> lifeExp)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_boxplot</span>()</code></pre></div>
<p><img src="site1_files/figure-html/unnamed-chunk-329-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>This is just a taste of what you can do with <code>ggplot2</code>.</p>
<p>RStudio provides a really useful <a href="https://www.rstudio.com/wp-content/uploads/2015/03/ggplot2-cheatsheet.pdf">cheat sheet</a> of the different layers available, and more extensive documentation is available on the <a href="http://docs.ggplot2.org/current/">ggplot2 website</a>.</p>
<p>Finally, if you have no idea how to change something, a quick Google search will usually send you to a relevant question and answer on Stack Overflow with reusable code to modify!</p>
<div id="challenge-4" class="section level4 unnumbered">
<h4>Challenge 4</h4>
<p>Create a density plot of GDP per capita, filled by continent.</p>
<p>Advanced: - Transform the x-axis to better visualise the data spread. - Add a facet layer to panel the density plots by year.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># YOUR CODE HERE.</span>

<span class="kw">ggplot</span>(gap, <span class="kw">aes</span>(<span class="dt">x =</span> gdpPercap)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_density</span>(<span class="kw">aes</span>(<span class="dt">color =</span> continent))

##Advanced
<span class="co"># Transform the x-axis to better visualise the data spread</span>
<span class="kw">ggplot</span>(gap, <span class="kw">aes</span>(<span class="dt">x =</span> gdpPercap)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_density</span>(<span class="kw">aes</span>(<span class="dt">color =</span> continent)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_log10</span>()

<span class="co">#Add a facet layer to panel the density plots by year</span>
<span class="kw">ggplot</span>(gap, <span class="kw">aes</span>(<span class="dt">x =</span> gdpPercap)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_density</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>continent) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_log10</span>()</code></pre></div>
<p><img src="site1_files/figure-html/unnamed-chunk-330-1.png" width="70%" style="display: block; margin: auto;" /><img src="site1_files/figure-html/unnamed-chunk-330-2.png" width="70%" style="display: block; margin: auto;" /><img src="site1_files/figure-html/unnamed-chunk-330-3.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
</div>
</div>
<div id="saving-plots" class="section level2">
<h2><span class="header-section-number">12.4</span> Saving plots</h2>
<p>There are two basic image types:</p>
<ol style="list-style-type: decimal">
<li><strong>Raster/Bitmap</strong> (.png, .jpeg)</li>
</ol>
<p>Every pixel of a plot contains its own separate coding; not so great if you want to resize the image.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">jpeg</span>(<span class="dt">filename=</span><span class="st">&quot;example.png&quot;</span>, <span class="dt">width=</span>, <span class="dt">height=</span>)
<span class="kw">plot</span>(x,y)
<span class="kw">dev.off</span>()</code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li><strong>Vector</strong> (.pdf, .ps)</li>
</ol>
<p>Every element of a plot is encoded with a function that gives its coding conditional on several factors; this is great for resizing.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">pdf</span>(<span class="dt">filename=</span><span class="st">&quot;example.pdf&quot;</span>, <span class="dt">width=</span>, <span class="dt">height=</span>)
<span class="kw">plot</span>(x,y)
<span class="kw">dev.off</span>()</code></pre></div>
<p><strong>Exporting with ggplot</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Assume we saved our plot is an object called example.plot</span>
<span class="kw">ggsave</span>(<span class="dt">filename=</span><span class="st">&quot;example.pdf&quot;</span>, <span class="dt">plot=</span>example.plot, <span class="dt">scale=</span>, <span class="dt">width=</span>, <span class="dt">height=</span>)</code></pre></div>
<!--chapter:end:10-Visualization/10-2-ggplot.Rmd-->
</div>
</div>
<div id="statistical-inferences" class="section level1">
<h1><span class="header-section-number">13</span> Statistical Inferences</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># setup</span>
gap &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/gapminder-FiveYearData.csv&quot;</span>, <span class="dt">stringsAsFactors =</span> <span class="ot">TRUE</span>)</code></pre></div>
<div id="statistical-distributions" class="section level2">
<h2><span class="header-section-number">13.1</span> Statistical Distributions</h2>
<p>Since R was developed by statisticians, it handles distributions and simulation seamlessly.</p>
<p>All commonly-used distributions have functions in R. Each distribution has a family of functions:</p>
<ul>
<li><code>d</code> - probability density/mass function, e.g. <code>dnorm()</code></li>
<li><code>r</code> - generate a random value, e.g., <code>rnorm()</code></li>
<li><code>p</code> - cumulative distribution function, e.g., <code>pnorm()</code></li>
<li><code>q</code> - quantile function (inverse CDF), e.g., <code>qnorm()</code></li>
</ul>
<p>Let’s see some of these functions in action with the normal distribution (mean 0, standard deviation 1)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dnorm</span>(<span class="fl">1.96</span>) <span class="co"># probability density of 1.96 from normal distribution</span>
<span class="co">#&gt; [1] 0.0584</span>
<span class="kw">rnorm</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>) <span class="co"># get 10 random values from the normal distribution</span>
<span class="co">#&gt;  [1] -1.40004  0.25532 -2.43726 -0.00557  0.62155  1.14841 -1.82182</span>
<span class="co">#&gt;  [8] -0.24733 -0.24420 -0.28271</span>
<span class="kw">pnorm</span>(<span class="fl">1.96</span>) <span class="co"># cumultative distribution function</span>
<span class="co">#&gt; [1] 0.975</span>
<span class="kw">qnorm</span>(.<span class="dv">975</span>) <span class="co"># inverse cumulative distribution function</span>
<span class="co">#&gt; [1] 1.96</span></code></pre></div>
<p>We can also use these functions on other distributions: * <code>rnorm()</code> # normal distribution * <code>runif()</code> # uniform distribution * <code>rbinom()</code> # binomial distribution * <code>rpois()</code> # poisson distribtion * <code>rbeta()</code> # beta distribution * <code>rgamma()</code> # gamma distribution * <code>rt()</code> # student t distribution * <code>rchisq()</code>. # chi-squared distribution</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">rbinom</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">size =</span> <span class="dv">10</span>, <span class="dt">prob =</span> <span class="fl">0.3</span>)
<span class="co">#&gt;  [1] 2 4 4 2 6 4 1 3 4 4 1</span>
<span class="kw">dt</span>(<span class="dv">5</span>, <span class="dt">df =</span> <span class="dv">1</span>)
<span class="co">#&gt; [1] 0.0122</span>

x &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="op">-</span><span class="dv">5</span>, <span class="dv">5</span>, <span class="dt">length =</span> <span class="dv">100</span>)
<span class="kw">plot</span>(x, <span class="kw">dnorm</span>(x), <span class="dt">type =</span> <span class="st">&#39;l&#39;</span>)</code></pre></div>
<p><img src="site1_files/figure-html/unnamed-chunk-337-1.png" width="70%" style="display: block; margin: auto;" /></p>
<div id="sampling-and-simulation" class="section level3">
<h3><span class="header-section-number">13.1.1</span> Sampling and Simulation</h3>
<p>We can draw a sample with or without replacement with <code>sample</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(gap), <span class="dv">20</span>, <span class="dt">replace =</span> <span class="ot">FALSE</span>)
<span class="co">#&gt;  [1]  385  513 1084  815  735 1201 1611  307  368 1153  846 1087 1118  163</span>
<span class="co">#&gt; [15] 1294 1300 1673 1638  657  778</span></code></pre></div>
<p><code>dplyr</code> has a helpful <code>select_n</code> function that samples rows of a dataframe.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">small &lt;-<span class="st"> </span><span class="kw">sample_n</span>(gap, <span class="dv">20</span>)
<span class="kw">nrow</span>(small)
<span class="co">#&gt; [1] 20</span></code></pre></div>
<p>Here’s an example of some code that would be part of a bootstrap.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gap &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/gapminder-FiveYearData.csv&quot;</span>, <span class="dt">stringsAsFactors =</span> F)

<span class="co"># actual mean</span>
<span class="kw">mean</span>(gap<span class="op">$</span>lifeExp, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)
<span class="co">#&gt; [1] 59.5</span>

<span class="co"># here&#39;s a bootstrap sample:</span>
smp &lt;-<span class="st"> </span><span class="kw">sample_n</span>(gap, <span class="dt">size =</span> <span class="kw">nrow</span>(gap), <span class="dt">replace =</span> <span class="ot">TRUE</span>) 
<span class="kw">mean</span>(smp<span class="op">$</span>lifeExp, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)
<span class="co">#&gt; [1] 59.2</span></code></pre></div>
</div>
<div id="random-seeds" class="section level3">
<h3><span class="header-section-number">13.1.2</span> Random Seeds</h3>
<p>A few key facts about generating random numbers:</p>
<ul>
<li>Random numbers on a computer are <em>pseudo-random</em>; they are generated deterministically from a very, very, very long sequence that repeats</li>
<li>The <em>seed</em> determines where you are in that sequence</li>
</ul>
<p>To replicate any work involving random numbers, make sure to set the seed first. The seed can be arbitrary – pick your favorite number.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">1</span>)
vals &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(gap), <span class="dv">10</span>)
vals
<span class="co">#&gt;  [1]  453  634  975 1545  343 1527 1605 1122 1067  105</span>

vals &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(gap), <span class="dv">10</span>)
vals
<span class="co">#&gt;  [1]  351  301 1170  654 1309  846 1219 1684  645 1318</span>

<span class="kw">set.seed</span>(<span class="dv">1</span>)
vals &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(gap), <span class="dv">10</span>)
vals
<span class="co">#&gt;  [1]  453  634  975 1545  343 1527 1605 1122 1067  105</span></code></pre></div>
</div>
<div id="challenges-13" class="section level3">
<h3><span class="header-section-number">13.1.3</span> Challenges</h3>
<div id="challenge-1.-generate-100-random-poisson-values-with-a-population-mean-of-5.-how-close-is-the-mean-of-those-100-values-to-the-value-of-5" class="section level4 unnumbered">
<h4>Challenge 1. Generate 100 random Poisson values with a population mean of 5. How close is the mean of those 100 values to the value of 5?</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">poisson &lt;-<span class="st"> </span><span class="kw">rpois</span>(<span class="dv">100</span>, <span class="dv">5</span>)
<span class="kw">mean</span>(poisson)
<span class="co">#&gt; [1] 5.1</span></code></pre></div>
</div>
<div id="challenge-2.-what-is-the-95th-percentile-of-a-chi-square-distribution-with-1-degree-of-freedom" class="section level4 unnumbered">
<h4>Challenge 2. What is the 95th percentile of a chi-square distribution with 1 degree of freedom?</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">qchisq</span>(.<span class="dv">95</span>, <span class="dt">df =</span> <span class="dv">1</span>)
<span class="co">#&gt; [1] 3.84</span></code></pre></div>
</div>
<div id="challenge-3.-whats-the-probability-of-getting-a-value-greater-than-5-if-you-draw-from-a-standard-normal-distribution-what-about-a-t-distribution-with-1-degree-of-freedom" class="section level4 unnumbered">
<h4>Challenge 3. What’s the probability of getting a value greater than 5 if you draw from a standard normal distribution? What about a t distribution with 1 degree of freedom?</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">pnorm</span>(<span class="dv">5</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="ot">FALSE</span>)
<span class="co">#&gt; [1] 2.87e-07</span>

<span class="kw">pt</span>(<span class="dv">5</span>, <span class="dt">df =</span> <span class="dv">1</span>, <span class="dt">lower.tail =</span> <span class="ot">FALSE</span>)
<span class="co">#&gt; [1] 0.0628</span></code></pre></div>
<!--chapter:end:11-Modeling/11_1_Stats.Rmd-->
</div>
</div>
</div>
<div id="inferences-and-regressions" class="section level2">
<h2><span class="header-section-number">13.2</span> Inferences and regressions</h2>
<p>Once we’ve imported our data, summarized it, carried out group-wise operations, and perhaps reshaped it, we may also like to attempt causal inference.</p>
<p>This often requires doing the following: 1) Carrying out Classical Hypothesis Tests 2) Estimating Regressions</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># setup</span>
gap &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/gapminder-FiveYearData.csv&quot;</span>, <span class="dt">stringsAsFactors =</span> F)</code></pre></div>
<div id="statistical-tests" class="section level3">
<h3><span class="header-section-number">13.2.1</span> Statistical Tests</h3>
<p>Let’s say we’re interested in whether the life expectency in 1967 is differently than in 1977.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># pull out life expectency by different years</span>
life.exp.<span class="dv">1967</span> &lt;-<span class="st"> </span>gap<span class="op">$</span>lifeExp[gap<span class="op">$</span>year<span class="op">==</span><span class="dv">1967</span>]
life.exp.<span class="dv">1977</span> &lt;-<span class="st"> </span>gap<span class="op">$</span>lifeExp[gap<span class="op">$</span>year<span class="op">==</span><span class="dv">1977</span>]</code></pre></div>
<p>One can test for differences in distributions in either:</p>
<ol style="list-style-type: decimal">
<li>their means using t-tests:</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># t test of means</span>
<span class="kw">t.test</span>(<span class="dt">x =</span> life.exp.<span class="dv">1967</span>, <span class="dt">y =</span> life.exp.<span class="dv">1977</span>)
<span class="co">#&gt; </span>
<span class="co">#&gt;  Welch Two Sample t-test</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; data:  life.exp.1967 and life.exp.1977</span>
<span class="co">#&gt; t = -3, df = 300, p-value = 0.005</span>
<span class="co">#&gt; alternative hypothesis: true difference in means is not equal to 0</span>
<span class="co">#&gt; 95 percent confidence interval:</span>
<span class="co">#&gt;  -6.57 -1.21</span>
<span class="co">#&gt; sample estimates:</span>
<span class="co">#&gt; mean of x mean of y </span>
<span class="co">#&gt;      55.7      59.6</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>their entire distributions using ks-tests</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># ks tests of distributions</span>
<span class="kw">ks.test</span>(<span class="dt">x =</span> life.exp.<span class="dv">1967</span>, <span class="dt">y =</span> life.exp.<span class="dv">1977</span>)
<span class="co">#&gt; Warning in ks.test(x = life.exp.1967, y = life.exp.1977): p-value will be</span>
<span class="co">#&gt; approximate in the presence of ties</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Two-sample Kolmogorov-Smirnov test</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; data:  life.exp.1967 and life.exp.1977</span>
<span class="co">#&gt; D = 0.2, p-value = 0.008</span>
<span class="co">#&gt; alternative hypothesis: two-sided</span></code></pre></div>
</div>
<div id="regressions-and-linear-models" class="section level3">
<h3><span class="header-section-number">13.2.2</span> Regressions and Linear Models</h3>
<ul>
<li><p>Running regressions in R is generally straightforward. There are two basic, catch-all regression functions in R:</p></li>
<li><p><em>glm</em> fits a generalized linear model with your choice of family/link function (gaussian, logit, poisson, etc.)</p></li>
<li><p><em>lm</em> is just a standard linear regression (equivalent to glm with family = gaussian(link = “identity”))</p></li>
<li><p>The basic <code>glm</code> call looks something like this:</p></li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">glm</span>(<span class="dt">formula =</span> y <span class="op">~</span><span class="st"> </span>x1 <span class="op">+</span><span class="st"> </span>x2 <span class="op">+</span><span class="st"> </span>x3 <span class="op">+</span><span class="st"> </span>..., <span class="dt">family =</span> <span class="kw">familyname</span>(<span class="dt">link =</span> <span class="st">&quot;linkname&quot;</span>), <span class="dt">data =</span> )</code></pre></div>
<ul>
<li>There are a bunch of families and links to use (<code>?family</code> for a full list), but some essentials are: <strong>binomial(link = “logit”)</strong>, <strong>gaussian(link = “identity”)</strong>, and <strong>poisson(link = “log”)</strong></li>
</ul>
<p>If you’re using <code>lm</code>, the call looks the same but without the <code>family</code> argument.</p>
<ul>
<li>Example: suppose we want to regress the life expectency on the GDP per capita and the population, as well as the continent and year. The lm call would be something like this:</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">reg &lt;-<span class="st"> </span><span class="kw">lm</span>(<span class="dt">formula =</span> lifeExp <span class="op">~</span><span class="st"> </span><span class="kw">log</span>(gdpPercap) <span class="op">+</span><span class="st"> </span><span class="kw">log</span>(pop) <span class="op">+</span><span class="st"> </span>continent <span class="op">+</span><span class="st"> </span>year, <span class="dt">data =</span> gap)</code></pre></div>
<div id="missing-values" class="section level4 unnumbered">
<h4>Missing values</h4>
<p>Missing values obviously can not convey any information about the relationship between the variables. Most modelling functions will drop any rows that contain missing values.</p>
</div>
</div>
<div id="regression-output" class="section level3">
<h3><span class="header-section-number">13.2.3</span> Regression output</h3>
<p>When we store this regression in an object, we get access to several items of interest.</p>
<ol style="list-style-type: decimal">
<li>All components contained in the regression output:</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span>(reg)
<span class="co">#&gt;  [1] &quot;coefficients&quot;  &quot;residuals&quot;     &quot;effects&quot;       &quot;rank&quot;         </span>
<span class="co">#&gt;  [5] &quot;fitted.values&quot; &quot;assign&quot;        &quot;qr&quot;            &quot;df.residual&quot;  </span>
<span class="co">#&gt;  [9] &quot;contrasts&quot;     &quot;xlevels&quot;       &quot;call&quot;          &quot;terms&quot;        </span>
<span class="co">#&gt; [13] &quot;model&quot;</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Regression coefficients</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">reg<span class="op">$</span>coefficients
<span class="co">#&gt;       (Intercept)    log(gdpPercap)          log(pop) continentAmericas </span>
<span class="co">#&gt;          -460.813             5.076             0.153             8.745 </span>
<span class="co">#&gt;     continentAsia   continentEurope  continentOceania              year </span>
<span class="co">#&gt;             6.825            12.281            12.540             0.238</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Regression degrees of freedom</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">reg<span class="op">$</span>df.residual
<span class="co">#&gt; [1] 1696</span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>Standard (diagnostic) plots for a regression</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(reg)</code></pre></div>
<p><img src="site1_files/figure-html/unnamed-chunk-355-1.png" width="70%" style="display: block; margin: auto;" /><img src="site1_files/figure-html/unnamed-chunk-355-2.png" width="70%" style="display: block; margin: auto;" /><img src="site1_files/figure-html/unnamed-chunk-355-3.png" width="70%" style="display: block; margin: auto;" /><img src="site1_files/figure-html/unnamed-chunk-355-4.png" width="70%" style="display: block; margin: auto;" /></p>
<p>R also has a helpful <code>summary</code> method for regression objects.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(reg)
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; lm(formula = lifeExp ~ log(gdpPercap) + log(pop) + continent + </span>
<span class="co">#&gt;     year, data = gap)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Residuals:</span>
<span class="co">#&gt;     Min      1Q  Median      3Q     Max </span>
<span class="co">#&gt; -25.057  -3.286   0.329   3.706  15.065 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients:</span>
<span class="co">#&gt;                    Estimate Std. Error t value Pr(&gt;|t|)    </span>
<span class="co">#&gt; (Intercept)       -4.61e+02   1.70e+01  -27.15   &lt;2e-16 ***</span>
<span class="co">#&gt; log(gdpPercap)     5.08e+00   1.63e-01   31.19   &lt;2e-16 ***</span>
<span class="co">#&gt; log(pop)           1.53e-01   9.67e-02    1.58     0.11    </span>
<span class="co">#&gt; continentAmericas  8.75e+00   4.77e-01   18.35   &lt;2e-16 ***</span>
<span class="co">#&gt; continentAsia      6.83e+00   4.23e-01   16.13   &lt;2e-16 ***</span>
<span class="co">#&gt; continentEurope    1.23e+01   5.29e-01   23.20   &lt;2e-16 ***</span>
<span class="co">#&gt; continentOceania   1.25e+01   1.28e+00    9.79   &lt;2e-16 ***</span>
<span class="co">#&gt; year               2.38e-01   8.93e-03   26.61   &lt;2e-16 ***</span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Residual standard error: 5.81 on 1696 degrees of freedom</span>
<span class="co">#&gt; Multiple R-squared:  0.798,  Adjusted R-squared:  0.798 </span>
<span class="co">#&gt; F-statistic:  960 on 7 and 1696 DF,  p-value: &lt;2e-16</span></code></pre></div>
<p>We can also extract useful things from the summary object:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Store summary method results</span>
summ_reg &lt;-<span class="st"> </span><span class="kw">summary</span>(reg)

<span class="co"># View summary method results objects</span>
<span class="kw">objects</span>(summ_reg)
<span class="co">#&gt;  [1] &quot;adj.r.squared&quot; &quot;aliased&quot;       &quot;call&quot;          &quot;coefficients&quot; </span>
<span class="co">#&gt;  [5] &quot;cov.unscaled&quot;  &quot;df&quot;            &quot;fstatistic&quot;    &quot;r.squared&quot;    </span>
<span class="co">#&gt;  [9] &quot;residuals&quot;     &quot;sigma&quot;         &quot;terms&quot;</span>

<span class="co"># View table of coefficients</span>
summ_reg<span class="op">$</span>coefficients
<span class="co">#&gt;                   Estimate Std. Error t value  Pr(&gt;|t|)</span>
<span class="co">#&gt; (Intercept)       -460.813   16.97028  -27.15 3.96e-135</span>
<span class="co">#&gt; log(gdpPercap)       5.076    0.16272   31.19 3.37e-169</span>
<span class="co">#&gt; log(pop)             0.153    0.09668    1.58  1.14e-01</span>
<span class="co">#&gt; continentAmericas    8.745    0.47660   18.35  9.61e-69</span>
<span class="co">#&gt; continentAsia        6.825    0.42320   16.13  1.49e-54</span>
<span class="co">#&gt; continentEurope     12.281    0.52924   23.20 1.12e-103</span>
<span class="co">#&gt; continentOceania    12.540    1.28114    9.79  4.80e-22</span>
<span class="co">#&gt; year                 0.238    0.00893   26.61 1.06e-130</span></code></pre></div>
</div>
<div id="interactions" class="section level3">
<h3><span class="header-section-number">13.2.4</span> Interactions</h3>
<p>There are also some useful shortcuts for regressing on interaction terms:</p>
<ol style="list-style-type: decimal">
<li><code>x1:x2</code> interacts all terms in x1 with all terms in x2</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mod.<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw">lm</span>(lifeExp <span class="op">~</span><span class="st"> </span><span class="kw">log</span>(gdpPercap) <span class="op">+</span><span class="st"> </span><span class="kw">log</span>(pop) <span class="op">+</span><span class="st"> </span>continent<span class="op">:</span><span class="kw">factor</span>(year), <span class="dt">data =</span> gap)
<span class="kw">summary</span>(mod.<span class="dv">1</span>)
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; lm(formula = lifeExp ~ log(gdpPercap) + log(pop) + continent:factor(year), </span>
<span class="co">#&gt;     data = gap)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Residuals:</span>
<span class="co">#&gt;     Min      1Q  Median      3Q     Max </span>
<span class="co">#&gt; -26.568  -2.553   0.004   2.915  15.567 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients: (1 not defined because of singularities)</span>
<span class="co">#&gt;                                    Estimate Std. Error t value Pr(&gt;|t|)</span>
<span class="co">#&gt; (Intercept)                         27.1838     4.6849    5.80  7.8e-09</span>
<span class="co">#&gt; log(gdpPercap)                       5.0795     0.1605   31.65  &lt; 2e-16</span>
<span class="co">#&gt; log(pop)                             0.0789     0.0943    0.84  0.40251</span>
<span class="co">#&gt; continentAfrica:factor(year)1952   -24.1425     4.1125   -5.87  5.2e-09</span>
<span class="co">#&gt; continentAmericas:factor(year)1952 -16.4465     4.1663   -3.95  8.2e-05</span>
<span class="co">#&gt; continentAsia:factor(year)1952     -19.3347     4.1408   -4.67  3.3e-06</span>
<span class="co">#&gt; continentEurope:factor(year)1952    -7.0918     4.1352   -1.71  0.08654</span>
<span class="co">#&gt; continentOceania:factor(year)1952   -6.0635     5.6511   -1.07  0.28344</span>
<span class="co">#&gt; continentAfrica:factor(year)1957   -22.4964     4.1098   -5.47  5.1e-08</span>
<span class="co">#&gt; continentAmericas:factor(year)1957 -14.3673     4.1643   -3.45  0.00057</span>
<span class="co">#&gt; continentAsia:factor(year)1957     -17.1743     4.1375   -4.15  3.5e-05</span>
<span class="co">#&gt; continentEurope:factor(year)1957    -5.9094     4.1327   -1.43  0.15293</span>
<span class="co">#&gt; continentOceania:factor(year)1957   -5.6300     5.6503   -1.00  0.31921</span>
<span class="co">#&gt; continentAfrica:factor(year)1962   -21.0139     4.1069   -5.12  3.5e-07</span>
<span class="co">#&gt; continentAmericas:factor(year)1962 -12.3135     4.1630   -2.96  0.00314</span>
<span class="co">#&gt; continentAsia:factor(year)1962     -15.5626     4.1351   -3.76  0.00017</span>
<span class="co">#&gt; continentEurope:factor(year)1962    -5.0542     4.1308   -1.22  0.22130</span>
<span class="co">#&gt; continentOceania:factor(year)1962   -5.3122     5.6498   -0.94  0.34723</span>
<span class="co">#&gt; continentAfrica:factor(year)1967   -19.7034     4.1035   -4.80  1.7e-06</span>
<span class="co">#&gt; continentAmericas:factor(year)1967 -10.9324     4.1613   -2.63  0.00869</span>
<span class="co">#&gt; continentAsia:factor(year)1967     -13.1569     4.1327   -3.18  0.00148</span>
<span class="co">#&gt; continentEurope:factor(year)1967    -4.9134     4.1291   -1.19  0.23423</span>
<span class="co">#&gt; continentOceania:factor(year)1967   -5.7712     5.6492   -1.02  0.30712</span>
<span class="co">#&gt; continentAfrica:factor(year)1972   -18.1469     4.1007   -4.43  1.0e-05</span>
<span class="co">#&gt; continentAmericas:factor(year)1972  -9.6537     4.1595   -2.32  0.02042</span>
<span class="co">#&gt; continentAsia:factor(year)1972     -11.6014     4.1293   -2.81  0.00502</span>
<span class="co">#&gt; continentEurope:factor(year)1972    -4.9763     4.1275   -1.21  0.22813</span>
<span class="co">#&gt; continentOceania:factor(year)1972   -5.8094     5.6487   -1.03  0.30389</span>
<span class="co">#&gt; continentAfrica:factor(year)1977   -16.1848     4.0996   -3.95  8.2e-05</span>
<span class="co">#&gt; continentAmericas:factor(year)1977  -8.3382     4.1580   -2.01  0.04509</span>
<span class="co">#&gt; continentAsia:factor(year)1977     -10.1220     4.1270   -2.45  0.01428</span>
<span class="co">#&gt; continentEurope:factor(year)1977    -4.5523     4.1267   -1.10  0.27013</span>
<span class="co">#&gt; continentOceania:factor(year)1977   -5.1232     5.6485   -0.91  0.36454</span>
<span class="co">#&gt; continentAfrica:factor(year)1982   -14.1933     4.0990   -3.46  0.00055</span>
<span class="co">#&gt; continentAmericas:factor(year)1982  -6.5921     4.1577   -1.59  0.11304</span>
<span class="co">#&gt; continentAsia:factor(year)1982      -7.6001     4.1257   -1.84  0.06564</span>
<span class="co">#&gt; continentEurope:factor(year)1982    -4.1185     4.1262   -1.00  0.31837</span>
<span class="co">#&gt; continentOceania:factor(year)1982   -4.0553     5.6483   -0.72  0.47288</span>
<span class="co">#&gt; continentAfrica:factor(year)1987   -12.1850     4.0995   -2.97  0.00300</span>
<span class="co">#&gt; continentAmericas:factor(year)1987  -4.7157     4.1577   -1.13  0.25687</span>
<span class="co">#&gt; continentAsia:factor(year)1987      -5.6914     4.1249   -1.38  0.16785</span>
<span class="co">#&gt; continentEurope:factor(year)1987    -3.7298     4.1258   -0.90  0.36613</span>
<span class="co">#&gt; continentOceania:factor(year)1987   -3.5164     5.6480   -0.62  0.53364</span>
<span class="co">#&gt; continentAfrica:factor(year)1992   -11.8028     4.0994   -2.88  0.00404</span>
<span class="co">#&gt; continentAmericas:factor(year)1992  -3.2855     4.1575   -0.79  0.42949</span>
<span class="co">#&gt; continentAsia:factor(year)1992      -4.3823     4.1241   -1.06  0.28811</span>
<span class="co">#&gt; continentEurope:factor(year)1992    -2.5151     4.1262   -0.61  0.54225</span>
<span class="co">#&gt; continentOceania:factor(year)1992   -1.9804     5.6480   -0.35  0.72590</span>
<span class="co">#&gt; continentAfrica:factor(year)1997   -11.9577     4.0986   -2.92  0.00358</span>
<span class="co">#&gt; continentAmericas:factor(year)1997  -2.1611     4.1566   -0.52  0.60319</span>
<span class="co">#&gt; continentAsia:factor(year)1997      -3.5016     4.1228   -0.85  0.39583</span>
<span class="co">#&gt; continentEurope:factor(year)1997    -2.0843     4.1256   -0.51  0.61348</span>
<span class="co">#&gt; continentOceania:factor(year)1997   -1.4478     5.6478   -0.26  0.79771</span>
<span class="co">#&gt; continentAfrica:factor(year)2002   -12.5237     4.0972   -3.06  0.00227</span>
<span class="co">#&gt; continentAmericas:factor(year)2002  -0.9898     4.1564   -0.24  0.81180</span>
<span class="co">#&gt; continentAsia:factor(year)2002      -2.6798     4.1221   -0.65  0.51571</span>
<span class="co">#&gt; continentEurope:factor(year)2002    -1.5734     4.1252   -0.38  0.70294</span>
<span class="co">#&gt; continentOceania:factor(year)2002   -0.4735     5.6477   -0.08  0.93320</span>
<span class="co">#&gt; continentAfrica:factor(year)2007   -11.6568     4.0948   -2.85  0.00447</span>
<span class="co">#&gt; continentAmericas:factor(year)2007  -0.6931     4.1550   -0.17  0.86754</span>
<span class="co">#&gt; continentAsia:factor(year)2007      -2.2008     4.1202   -0.53  0.59332</span>
<span class="co">#&gt; continentEurope:factor(year)2007    -1.5284     4.1247   -0.37  0.71102</span>
<span class="co">#&gt; continentOceania:factor(year)2007        NA         NA      NA       NA</span>
<span class="co">#&gt;                                       </span>
<span class="co">#&gt; (Intercept)                        ***</span>
<span class="co">#&gt; log(gdpPercap)                     ***</span>
<span class="co">#&gt; log(pop)                              </span>
<span class="co">#&gt; continentAfrica:factor(year)1952   ***</span>
<span class="co">#&gt; continentAmericas:factor(year)1952 ***</span>
<span class="co">#&gt; continentAsia:factor(year)1952     ***</span>
<span class="co">#&gt; continentEurope:factor(year)1952   .  </span>
<span class="co">#&gt; continentOceania:factor(year)1952     </span>
<span class="co">#&gt; continentAfrica:factor(year)1957   ***</span>
<span class="co">#&gt; continentAmericas:factor(year)1957 ***</span>
<span class="co">#&gt; continentAsia:factor(year)1957     ***</span>
<span class="co">#&gt; continentEurope:factor(year)1957      </span>
<span class="co">#&gt; continentOceania:factor(year)1957     </span>
<span class="co">#&gt; continentAfrica:factor(year)1962   ***</span>
<span class="co">#&gt; continentAmericas:factor(year)1962 ** </span>
<span class="co">#&gt; continentAsia:factor(year)1962     ***</span>
<span class="co">#&gt; continentEurope:factor(year)1962      </span>
<span class="co">#&gt; continentOceania:factor(year)1962     </span>
<span class="co">#&gt; continentAfrica:factor(year)1967   ***</span>
<span class="co">#&gt; continentAmericas:factor(year)1967 ** </span>
<span class="co">#&gt; continentAsia:factor(year)1967     ** </span>
<span class="co">#&gt; continentEurope:factor(year)1967      </span>
<span class="co">#&gt; continentOceania:factor(year)1967     </span>
<span class="co">#&gt; continentAfrica:factor(year)1972   ***</span>
<span class="co">#&gt; continentAmericas:factor(year)1972 *  </span>
<span class="co">#&gt; continentAsia:factor(year)1972     ** </span>
<span class="co">#&gt; continentEurope:factor(year)1972      </span>
<span class="co">#&gt; continentOceania:factor(year)1972     </span>
<span class="co">#&gt; continentAfrica:factor(year)1977   ***</span>
<span class="co">#&gt; continentAmericas:factor(year)1977 *  </span>
<span class="co">#&gt; continentAsia:factor(year)1977     *  </span>
<span class="co">#&gt; continentEurope:factor(year)1977      </span>
<span class="co">#&gt; continentOceania:factor(year)1977     </span>
<span class="co">#&gt; continentAfrica:factor(year)1982   ***</span>
<span class="co">#&gt; continentAmericas:factor(year)1982    </span>
<span class="co">#&gt; continentAsia:factor(year)1982     .  </span>
<span class="co">#&gt; continentEurope:factor(year)1982      </span>
<span class="co">#&gt; continentOceania:factor(year)1982     </span>
<span class="co">#&gt; continentAfrica:factor(year)1987   ** </span>
<span class="co">#&gt; continentAmericas:factor(year)1987    </span>
<span class="co">#&gt; continentAsia:factor(year)1987        </span>
<span class="co">#&gt; continentEurope:factor(year)1987      </span>
<span class="co">#&gt; continentOceania:factor(year)1987     </span>
<span class="co">#&gt; continentAfrica:factor(year)1992   ** </span>
<span class="co">#&gt; continentAmericas:factor(year)1992    </span>
<span class="co">#&gt; continentAsia:factor(year)1992        </span>
<span class="co">#&gt; continentEurope:factor(year)1992      </span>
<span class="co">#&gt; continentOceania:factor(year)1992     </span>
<span class="co">#&gt; continentAfrica:factor(year)1997   ** </span>
<span class="co">#&gt; continentAmericas:factor(year)1997    </span>
<span class="co">#&gt; continentAsia:factor(year)1997        </span>
<span class="co">#&gt; continentEurope:factor(year)1997      </span>
<span class="co">#&gt; continentOceania:factor(year)1997     </span>
<span class="co">#&gt; continentAfrica:factor(year)2002   ** </span>
<span class="co">#&gt; continentAmericas:factor(year)2002    </span>
<span class="co">#&gt; continentAsia:factor(year)2002        </span>
<span class="co">#&gt; continentEurope:factor(year)2002      </span>
<span class="co">#&gt; continentOceania:factor(year)2002     </span>
<span class="co">#&gt; continentAfrica:factor(year)2007   ** </span>
<span class="co">#&gt; continentAmericas:factor(year)2007    </span>
<span class="co">#&gt; continentAsia:factor(year)2007        </span>
<span class="co">#&gt; continentEurope:factor(year)2007      </span>
<span class="co">#&gt; continentOceania:factor(year)2007     </span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Residual standard error: 5.65 on 1642 degrees of freedom</span>
<span class="co">#&gt; Multiple R-squared:  0.816,  Adjusted R-squared:  0.809 </span>
<span class="co">#&gt; F-statistic:  119 on 61 and 1642 DF,  p-value: &lt;2e-16</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li><code>x1*x2</code> produces the cross of x1 and x2, or x1+x2+x1:x2</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mod.<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">lm</span>(lifeExp <span class="op">~</span><span class="st"> </span><span class="kw">log</span>(gdpPercap) <span class="op">+</span><span class="st"> </span><span class="kw">log</span>(pop) <span class="op">+</span><span class="st"> </span>continent<span class="op">*</span><span class="kw">factor</span>(year), <span class="dt">data =</span> gap)
<span class="kw">summary</span>(mod.<span class="dv">2</span>)
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; lm(formula = lifeExp ~ log(gdpPercap) + log(pop) + continent * </span>
<span class="co">#&gt;     factor(year), data = gap)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Residuals:</span>
<span class="co">#&gt;     Min      1Q  Median      3Q     Max </span>
<span class="co">#&gt; -26.568  -2.553   0.004   2.915  15.567 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients:</span>
<span class="co">#&gt;                                    Estimate Std. Error t value Pr(&gt;|t|)</span>
<span class="co">#&gt; (Intercept)                          3.0413     2.0741    1.47  0.14275</span>
<span class="co">#&gt; log(gdpPercap)                       5.0795     0.1605   31.65  &lt; 2e-16</span>
<span class="co">#&gt; log(pop)                             0.0789     0.0943    0.84  0.40251</span>
<span class="co">#&gt; continentAmericas                    7.6960     1.3932    5.52  3.9e-08</span>
<span class="co">#&gt; continentAsia                        4.8078     1.2657    3.80  0.00015</span>
<span class="co">#&gt; continentEurope                     17.0508     1.3295   12.83  &lt; 2e-16</span>
<span class="co">#&gt; continentOceania                    18.0790     4.0890    4.42  1.0e-05</span>
<span class="co">#&gt; factor(year)1957                     1.6461     1.1078    1.49  0.13747</span>
<span class="co">#&gt; factor(year)1962                     3.1286     1.1084    2.82  0.00482</span>
<span class="co">#&gt; factor(year)1967                     4.4392     1.1097    4.00  6.6e-05</span>
<span class="co">#&gt; factor(year)1972                     5.9956     1.1113    5.39  7.9e-08</span>
<span class="co">#&gt; factor(year)1977                     7.9578     1.1124    7.15  1.3e-12</span>
<span class="co">#&gt; factor(year)1982                     9.9492     1.1134    8.94  &lt; 2e-16</span>
<span class="co">#&gt; factor(year)1987                    11.9575     1.1138   10.74  &lt; 2e-16</span>
<span class="co">#&gt; factor(year)1992                    12.3398     1.1146   11.07  &lt; 2e-16</span>
<span class="co">#&gt; factor(year)1997                    12.1848     1.1161   10.92  &lt; 2e-16</span>
<span class="co">#&gt; factor(year)2002                    11.6188     1.1181   10.39  &lt; 2e-16</span>
<span class="co">#&gt; factor(year)2007                    12.4857     1.1212   11.14  &lt; 2e-16</span>
<span class="co">#&gt; continentAmericas:factor(year)1957   0.4330     1.9438    0.22  0.82375</span>
<span class="co">#&gt; continentAsia:factor(year)1957       0.5142     1.7776    0.29  0.77241</span>
<span class="co">#&gt; continentEurope:factor(year)1957    -0.4638     1.8313   -0.25  0.80010</span>
<span class="co">#&gt; continentOceania:factor(year)1957   -1.2126     5.7552   -0.21  0.83315</span>
<span class="co">#&gt; continentAmericas:factor(year)1962   1.0043     1.9438    0.52  0.60546</span>
<span class="co">#&gt; continentAsia:factor(year)1962       0.6435     1.7777    0.36  0.71741</span>
<span class="co">#&gt; continentEurope:factor(year)1962    -1.0911     1.8315   -0.60  0.55142</span>
<span class="co">#&gt; continentOceania:factor(year)1962   -2.3774     5.7552   -0.41  0.67960</span>
<span class="co">#&gt; continentAmericas:factor(year)1967   1.0750     1.9438    0.55  0.58033</span>
<span class="co">#&gt; continentAsia:factor(year)1967       1.7387     1.7777    0.98  0.32819</span>
<span class="co">#&gt; continentEurope:factor(year)1967    -2.2608     1.8317   -1.23  0.21728</span>
<span class="co">#&gt; continentOceania:factor(year)1967   -4.1468     5.7552   -0.72  0.47130</span>
<span class="co">#&gt; continentAmericas:factor(year)1972   0.7972     1.9438    0.41  0.68176</span>
<span class="co">#&gt; continentAsia:factor(year)1972       1.7377     1.7779    0.98  0.32851</span>
<span class="co">#&gt; continentEurope:factor(year)1972    -3.8801     1.8322   -2.12  0.03435</span>
<span class="co">#&gt; continentOceania:factor(year)1972   -5.7415     5.7552   -1.00  0.31862</span>
<span class="co">#&gt; continentAmericas:factor(year)1977   0.1505     1.9439    0.08  0.93828</span>
<span class="co">#&gt; continentAsia:factor(year)1977       1.2549     1.7784    0.71  0.48050</span>
<span class="co">#&gt; continentEurope:factor(year)1977    -5.4183     1.8329   -2.96  0.00316</span>
<span class="co">#&gt; continentOceania:factor(year)1977   -7.0175     5.7553   -1.22  0.22290</span>
<span class="co">#&gt; continentAmericas:factor(year)1982  -0.0948     1.9439   -0.05  0.96110</span>
<span class="co">#&gt; continentAsia:factor(year)1982       1.7854     1.7788    1.00  0.31567</span>
<span class="co">#&gt; continentEurope:factor(year)1982    -6.9759     1.8336   -3.80  0.00015</span>
<span class="co">#&gt; continentOceania:factor(year)1982   -7.9409     5.7553   -1.38  0.16785</span>
<span class="co">#&gt; continentAmericas:factor(year)1987  -0.2267     1.9440   -0.12  0.90720</span>
<span class="co">#&gt; continentAsia:factor(year)1987       1.6858     1.7796    0.95  0.34363</span>
<span class="co">#&gt; continentEurope:factor(year)1987    -8.5955     1.8350   -4.68  3.0e-06</span>
<span class="co">#&gt; continentOceania:factor(year)1987   -9.4104     5.7554   -1.64  0.10223</span>
<span class="co">#&gt; continentAmericas:factor(year)1992   0.8213     1.9441    0.42  0.67276</span>
<span class="co">#&gt; continentAsia:factor(year)1992       2.6127     1.7803    1.47  0.14243</span>
<span class="co">#&gt; continentEurope:factor(year)1992    -7.7631     1.8346   -4.23  2.5e-05</span>
<span class="co">#&gt; continentOceania:factor(year)1992   -8.2567     5.7555   -1.43  0.15160</span>
<span class="co">#&gt; continentAmericas:factor(year)1997   2.1006     1.9443    1.08  0.28012</span>
<span class="co">#&gt; continentAsia:factor(year)1997       3.6483     1.7812    2.05  0.04070</span>
<span class="co">#&gt; continentEurope:factor(year)1997    -7.1773     1.8358   -3.91  9.6e-05</span>
<span class="co">#&gt; continentOceania:factor(year)1997   -7.5691     5.7557   -1.32  0.18867</span>
<span class="co">#&gt; continentAmericas:factor(year)2002   3.8379     1.9442    1.97  0.04854</span>
<span class="co">#&gt; continentAsia:factor(year)2002       5.0361     1.7814    2.83  0.00476</span>
<span class="co">#&gt; continentEurope:factor(year)2002    -6.1005     1.8369   -3.32  0.00092</span>
<span class="co">#&gt; continentOceania:factor(year)2002   -6.0287     5.7558   -1.05  0.29506</span>
<span class="co">#&gt; continentAmericas:factor(year)2007   3.2677     1.9444    1.68  0.09303</span>
<span class="co">#&gt; continentAsia:factor(year)2007       4.6483     1.7823    2.61  0.00919</span>
<span class="co">#&gt; continentEurope:factor(year)2007    -6.9223     1.8378   -3.77  0.00017</span>
<span class="co">#&gt; continentOceania:factor(year)2007   -6.4222     5.7558   -1.12  0.26468</span>
<span class="co">#&gt;                                       </span>
<span class="co">#&gt; (Intercept)                           </span>
<span class="co">#&gt; log(gdpPercap)                     ***</span>
<span class="co">#&gt; log(pop)                              </span>
<span class="co">#&gt; continentAmericas                  ***</span>
<span class="co">#&gt; continentAsia                      ***</span>
<span class="co">#&gt; continentEurope                    ***</span>
<span class="co">#&gt; continentOceania                   ***</span>
<span class="co">#&gt; factor(year)1957                      </span>
<span class="co">#&gt; factor(year)1962                   ** </span>
<span class="co">#&gt; factor(year)1967                   ***</span>
<span class="co">#&gt; factor(year)1972                   ***</span>
<span class="co">#&gt; factor(year)1977                   ***</span>
<span class="co">#&gt; factor(year)1982                   ***</span>
<span class="co">#&gt; factor(year)1987                   ***</span>
<span class="co">#&gt; factor(year)1992                   ***</span>
<span class="co">#&gt; factor(year)1997                   ***</span>
<span class="co">#&gt; factor(year)2002                   ***</span>
<span class="co">#&gt; factor(year)2007                   ***</span>
<span class="co">#&gt; continentAmericas:factor(year)1957    </span>
<span class="co">#&gt; continentAsia:factor(year)1957        </span>
<span class="co">#&gt; continentEurope:factor(year)1957      </span>
<span class="co">#&gt; continentOceania:factor(year)1957     </span>
<span class="co">#&gt; continentAmericas:factor(year)1962    </span>
<span class="co">#&gt; continentAsia:factor(year)1962        </span>
<span class="co">#&gt; continentEurope:factor(year)1962      </span>
<span class="co">#&gt; continentOceania:factor(year)1962     </span>
<span class="co">#&gt; continentAmericas:factor(year)1967    </span>
<span class="co">#&gt; continentAsia:factor(year)1967        </span>
<span class="co">#&gt; continentEurope:factor(year)1967      </span>
<span class="co">#&gt; continentOceania:factor(year)1967     </span>
<span class="co">#&gt; continentAmericas:factor(year)1972    </span>
<span class="co">#&gt; continentAsia:factor(year)1972        </span>
<span class="co">#&gt; continentEurope:factor(year)1972   *  </span>
<span class="co">#&gt; continentOceania:factor(year)1972     </span>
<span class="co">#&gt; continentAmericas:factor(year)1977    </span>
<span class="co">#&gt; continentAsia:factor(year)1977        </span>
<span class="co">#&gt; continentEurope:factor(year)1977   ** </span>
<span class="co">#&gt; continentOceania:factor(year)1977     </span>
<span class="co">#&gt; continentAmericas:factor(year)1982    </span>
<span class="co">#&gt; continentAsia:factor(year)1982        </span>
<span class="co">#&gt; continentEurope:factor(year)1982   ***</span>
<span class="co">#&gt; continentOceania:factor(year)1982     </span>
<span class="co">#&gt; continentAmericas:factor(year)1987    </span>
<span class="co">#&gt; continentAsia:factor(year)1987        </span>
<span class="co">#&gt; continentEurope:factor(year)1987   ***</span>
<span class="co">#&gt; continentOceania:factor(year)1987     </span>
<span class="co">#&gt; continentAmericas:factor(year)1992    </span>
<span class="co">#&gt; continentAsia:factor(year)1992        </span>
<span class="co">#&gt; continentEurope:factor(year)1992   ***</span>
<span class="co">#&gt; continentOceania:factor(year)1992     </span>
<span class="co">#&gt; continentAmericas:factor(year)1997    </span>
<span class="co">#&gt; continentAsia:factor(year)1997     *  </span>
<span class="co">#&gt; continentEurope:factor(year)1997   ***</span>
<span class="co">#&gt; continentOceania:factor(year)1997     </span>
<span class="co">#&gt; continentAmericas:factor(year)2002 *  </span>
<span class="co">#&gt; continentAsia:factor(year)2002     ** </span>
<span class="co">#&gt; continentEurope:factor(year)2002   ***</span>
<span class="co">#&gt; continentOceania:factor(year)2002     </span>
<span class="co">#&gt; continentAmericas:factor(year)2007 .  </span>
<span class="co">#&gt; continentAsia:factor(year)2007     ** </span>
<span class="co">#&gt; continentEurope:factor(year)2007   ***</span>
<span class="co">#&gt; continentOceania:factor(year)2007     </span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Residual standard error: 5.65 on 1642 degrees of freedom</span>
<span class="co">#&gt; Multiple R-squared:  0.816,  Adjusted R-squared:  0.809 </span>
<span class="co">#&gt; F-statistic:  119 on 61 and 1642 DF,  p-value: &lt;2e-16</span></code></pre></div>
<p>Note that we wrapped the <code>year</code> variables into a <code>factor()</code> function. By default, R breaks up our variables into their different factor levels (as it will do whenever your regressors have factor levels)</p>
<p>If your data aren’t factorized, you can tell <code>lm/glm</code> to factorize a variable (i.e. create dummy variables on the fly) by writing <code>factor()</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">glm</span>(<span class="dt">formula =</span> y <span class="op">~</span><span class="st"> </span>x1 <span class="op">+</span><span class="st"> </span>x2 <span class="op">+</span><span class="st"> </span><span class="kw">factor</span>(x3), <span class="dt">family =</span> <span class="kw">family</span>(<span class="dt">link =</span> <span class="st">&quot;link&quot;</span>),
            <span class="dt">data =</span> )</code></pre></div>
</div>
<div id="formatting-regression-tables" class="section level3">
<h3><span class="header-section-number">13.2.5</span> Formatting Regression Tables</h3>
<p>Most papers report the results of regression analysis in some kind of table. Typically, this table includes the values of coefficients, standard errors, and significance levels from one or more models.</p>
<p>The <code>stargazer</code> package provides excellent tools to make and format regression tables automatically. It can also output summary statistics from a dataframe:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(stargazer)
<span class="kw">stargazer</span>(gap, <span class="dt">type =</span> <span class="st">&quot;text&quot;</span>)
<span class="co">#&gt; </span>
<span class="co">#&gt; ===========================================================================================</span>
<span class="co">#&gt; Statistic   N        Mean         St. Dev.       Min   Pctl(25)    Pctl(75)        Max     </span>
<span class="co">#&gt; -------------------------------------------------------------------------------------------</span>
<span class="co">#&gt; year      1,704   1,980.000        17.300       1,952   1,966.0    1,993.0        2,007    </span>
<span class="co">#&gt; pop       1,704 29,601,212.000 106,157,897.000 60,011  2,793,664 19,585,222.0 1,318,683,096</span>
<span class="co">#&gt; lifeExp   1,704     59.500         12.900      23.600   48.200      70.800       82.600    </span>
<span class="co">#&gt; gdpPercap 1,704   7,215.000       9,857.000    241.000 1,202.000  9,325.000    113,523.000 </span>
<span class="co">#&gt; -------------------------------------------------------------------------------------------</span></code></pre></div>
<p>Let’s say we want to report the results from three different models:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mod.<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw">lm</span>(lifeExp <span class="op">~</span><span class="st"> </span><span class="kw">log</span>(gdpPercap) <span class="op">+</span><span class="st"> </span><span class="kw">log</span>(pop), <span class="dt">data =</span> gap)
mod.<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">lm</span>(lifeExp <span class="op">~</span><span class="st"> </span><span class="kw">log</span>(gdpPercap) <span class="op">+</span><span class="st"> </span><span class="kw">log</span>(pop) <span class="op">+</span><span class="st"> </span>continent, <span class="dt">data =</span> gap)
mod.<span class="dv">3</span> &lt;-<span class="st"> </span><span class="kw">lm</span>(lifeExp <span class="op">~</span><span class="st"> </span><span class="kw">log</span>(gdpPercap) <span class="op">+</span><span class="st"> </span><span class="kw">log</span>(pop) <span class="op">+</span><span class="st"> </span>continent <span class="op">+</span><span class="st"> </span>year, <span class="dt">data =</span> gap)</code></pre></div>
<p><code>stargazer</code> can produce well-formatted tables that hold regression analysis results from all these models side-by-side.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">stargazer</span>(mod.<span class="dv">1</span>, mod.<span class="dv">2</span>, mod.<span class="dv">3</span>, <span class="dt">title =</span> <span class="st">&quot;Regression Results&quot;</span>, <span class="dt">type =</span> <span class="st">&quot;text&quot;</span>)
<span class="co">#&gt; </span>
<span class="co">#&gt; Regression Results</span>
<span class="co">#&gt; ===================================================================================================</span>
<span class="co">#&gt;                                                   Dependent variable:                              </span>
<span class="co">#&gt;                     -------------------------------------------------------------------------------</span>
<span class="co">#&gt;                                                         lifeExp                                    </span>
<span class="co">#&gt;                                 (1)                        (2)                       (3)           </span>
<span class="co">#&gt; ---------------------------------------------------------------------------------------------------</span>
<span class="co">#&gt; log(gdpPercap)               8.340***                   6.590***                  5.080***         </span>
<span class="co">#&gt;                               (0.143)                    (0.182)                   (0.163)         </span>
<span class="co">#&gt;                                                                                                    </span>
<span class="co">#&gt; log(pop)                     1.280***                   0.866***                    0.153          </span>
<span class="co">#&gt;                               (0.111)                    (0.111)                   (0.097)         </span>
<span class="co">#&gt;                                                                                                    </span>
<span class="co">#&gt; continentAmericas                                       6.170***                  8.740***         </span>
<span class="co">#&gt;                                                          (0.555)                   (0.477)         </span>
<span class="co">#&gt;                                                                                                    </span>
<span class="co">#&gt; continentAsia                                           4.670***                  6.830***         </span>
<span class="co">#&gt;                                                          (0.494)                   (0.423)         </span>
<span class="co">#&gt;                                                                                                    </span>
<span class="co">#&gt; continentEurope                                         8.560***                  12.300***        </span>
<span class="co">#&gt;                                                          (0.608)                   (0.529)         </span>
<span class="co">#&gt;                                                                                                    </span>
<span class="co">#&gt; continentOceania                                        8.350***                  12.500***        </span>
<span class="co">#&gt;                                                          (1.510)                   (1.280)         </span>
<span class="co">#&gt;                                                                                                    </span>
<span class="co">#&gt; year                                                                              0.238***         </span>
<span class="co">#&gt;                                                                                    (0.009)         </span>
<span class="co">#&gt;                                                                                                    </span>
<span class="co">#&gt; Constant                    -28.800***                 -12.000***                -461.000***       </span>
<span class="co">#&gt;                               (2.080)                    (2.270)                  (17.000)         </span>
<span class="co">#&gt;                                                                                                    </span>
<span class="co">#&gt; ---------------------------------------------------------------------------------------------------</span>
<span class="co">#&gt; Observations                   1,704                      1,704                     1,704          </span>
<span class="co">#&gt; R2                             0.677                      0.714                     0.798          </span>
<span class="co">#&gt; Adjusted R2                    0.677                      0.713                     0.798          </span>
<span class="co">#&gt; Residual Std. Error      7.340 (df = 1701)          6.920 (df = 1697)         5.810 (df = 1696)    </span>
<span class="co">#&gt; F Statistic         1,786.000*** (df = 2; 1701) 707.000*** (df = 6; 1697) 960.000*** (df = 7; 1696)</span>
<span class="co">#&gt; ===================================================================================================</span>
<span class="co">#&gt; Note:                                                                   *p&lt;0.1; **p&lt;0.05; ***p&lt;0.01</span></code></pre></div>
<div id="customization" class="section level4 unnumbered">
<h4>Customization</h4>
<p><code>stargazer</code> is incredably customizable. Let’s say we wanted to: - re-name our explanatory variables; - remove information on the “Constant”;<br />
- only keep the number of observations from the summary statistics; and - style the table to look like those in American Journal of Political Science.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">stargazer</span>(mod.<span class="dv">1</span>, mod.<span class="dv">2</span>, mod.<span class="dv">3</span>, <span class="dt">title =</span> <span class="st">&quot;Regression Results&quot;</span>, <span class="dt">type =</span> <span class="st">&quot;text&quot;</span>, 
          <span class="dt">covariate.labels  =</span> <span class="kw">c</span>(<span class="st">&quot;GDP per capita, logged&quot;</span>, <span class="st">&quot;Population, logged&quot;</span>, <span class="st">&quot;Americas&quot;</span>, <span class="st">&quot;Asia&quot;</span>, <span class="st">&quot;Europe&quot;</span>, <span class="st">&quot;Oceania&quot;</span>, <span class="st">&quot;Year&quot;</span>, <span class="st">&quot;Constant&quot;</span>), 
          <span class="dt">omit =</span> <span class="st">&quot;Constant&quot;</span>, 
          <span class="dt">keep.stat=</span><span class="st">&quot;n&quot;</span>, <span class="dt">style =</span> <span class="st">&quot;ajps&quot;</span>)
<span class="co">#&gt; </span>
<span class="co">#&gt; Regression Results</span>
<span class="co">#&gt; --------------------------------------------------</span>
<span class="co">#&gt;                                  lifeExp          </span>
<span class="co">#&gt;                        Model 1  Model 2   Model 3 </span>
<span class="co">#&gt; --------------------------------------------------</span>
<span class="co">#&gt; GDP per capita, logged 8.340*** 6.590*** 5.080*** </span>
<span class="co">#&gt;                        (0.143)  (0.182)   (0.163) </span>
<span class="co">#&gt; Population, logged     1.280*** 0.866***   0.153  </span>
<span class="co">#&gt;                        (0.111)  (0.111)   (0.097) </span>
<span class="co">#&gt; Americas                        6.170*** 8.740*** </span>
<span class="co">#&gt;                                 (0.555)   (0.477) </span>
<span class="co">#&gt; Asia                            4.670*** 6.830*** </span>
<span class="co">#&gt;                                 (0.494)   (0.423) </span>
<span class="co">#&gt; Europe                          8.560*** 12.300***</span>
<span class="co">#&gt;                                 (0.608)   (0.529) </span>
<span class="co">#&gt; Oceania                         8.350*** 12.500***</span>
<span class="co">#&gt;                                 (1.510)   (1.280) </span>
<span class="co">#&gt; Year                                     0.238*** </span>
<span class="co">#&gt;                                           (0.009) </span>
<span class="co">#&gt; N                        1704     1704     1704   </span>
<span class="co">#&gt; --------------------------------------------------</span>
<span class="co">#&gt; ***p &lt; .01; **p &lt; .05; *p &lt; .1</span></code></pre></div>
<p>Check out <code>?stargazer</code> to see more options.</p>
</div>
<div id="output-types" class="section level4 unnumbered">
<h4>Output types</h4>
<p>Once we like the look of our table, we can output/export it in a number of ways. The <code>type</code> argument specifies what the outut the command should produce. Possible values are: - <code>&quot;latex&quot;</code> for LaTeX code, - <code>&quot;html&quot;</code> for HTML code, - <code>&quot;text&quot;</code> for ASCII text output (what we used above).</p>
<p>Let’s say we’re using LaTeX to typeset our paper. We can output our regression table in LaTeX:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">stargazer</span>(mod.<span class="dv">1</span>, mod.<span class="dv">2</span>, mod.<span class="dv">3</span>, <span class="dt">title =</span> <span class="st">&quot;Regression Results&quot;</span>, <span class="dt">type =</span> <span class="st">&quot;latex&quot;</span>, 
          <span class="dt">covariate.labels  =</span> <span class="kw">c</span>(<span class="st">&quot;GDP per capita, logged&quot;</span>, <span class="st">&quot;Population, logged&quot;</span>, <span class="st">&quot;Americas&quot;</span>, <span class="st">&quot;Asia&quot;</span>, <span class="st">&quot;Europe&quot;</span>, <span class="st">&quot;Oceania&quot;</span>, <span class="st">&quot;Year&quot;</span>, <span class="st">&quot;Constant&quot;</span>), 
          <span class="dt">omit =</span> <span class="st">&quot;Constant&quot;</span>, 
          <span class="dt">keep.stat=</span><span class="st">&quot;n&quot;</span>, <span class="dt">style =</span> <span class="st">&quot;ajps&quot;</span>)
<span class="co">#&gt; </span>
<span class="co">#&gt; % Table created by stargazer v.5.2.2 by Marek Hlavac, Harvard University. E-mail: hlavac at fas.harvard.edu</span>
<span class="co">#&gt; % Date and time: Sat, Sep 28, 2019 - 15:56:20</span>
<span class="co">#&gt; \begin{table}[!htbp] \centering </span>
<span class="co">#&gt;   \caption{Regression Results} </span>
<span class="co">#&gt;   \label{} </span>
<span class="co">#&gt; \begin{tabular}{@{\extracolsep{5pt}}lccc} </span>
<span class="co">#&gt; \\[-1.8ex]\hline \\[-1.8ex] </span>
<span class="co">#&gt; \\[-1.8ex] &amp; \multicolumn{3}{c}{\textbf{lifeExp}} \\ </span>
<span class="co">#&gt; \\[-1.8ex] &amp; \textbf{Model 1} &amp; \textbf{Model 2} &amp; \textbf{Model 3}\\ </span>
<span class="co">#&gt; \hline \\[-1.8ex] </span>
<span class="co">#&gt;  GDP per capita, logged &amp; 8.340$^{***}$ &amp; 6.590$^{***}$ &amp; 5.080$^{***}$ \\ </span>
<span class="co">#&gt;   &amp; (0.143) &amp; (0.182) &amp; (0.163) \\ </span>
<span class="co">#&gt;   Population, logged &amp; 1.280$^{***}$ &amp; 0.866$^{***}$ &amp; 0.153 \\ </span>
<span class="co">#&gt;   &amp; (0.111) &amp; (0.111) &amp; (0.097) \\ </span>
<span class="co">#&gt;   Americas &amp;  &amp; 6.170$^{***}$ &amp; 8.740$^{***}$ \\ </span>
<span class="co">#&gt;   &amp;  &amp; (0.555) &amp; (0.477) \\ </span>
<span class="co">#&gt;   Asia &amp;  &amp; 4.670$^{***}$ &amp; 6.830$^{***}$ \\ </span>
<span class="co">#&gt;   &amp;  &amp; (0.494) &amp; (0.423) \\ </span>
<span class="co">#&gt;   Europe &amp;  &amp; 8.560$^{***}$ &amp; 12.300$^{***}$ \\ </span>
<span class="co">#&gt;   &amp;  &amp; (0.608) &amp; (0.529) \\ </span>
<span class="co">#&gt;   Oceania &amp;  &amp; 8.350$^{***}$ &amp; 12.500$^{***}$ \\ </span>
<span class="co">#&gt;   &amp;  &amp; (1.510) &amp; (1.280) \\ </span>
<span class="co">#&gt;   Year &amp;  &amp;  &amp; 0.238$^{***}$ \\ </span>
<span class="co">#&gt;   &amp;  &amp;  &amp; (0.009) \\ </span>
<span class="co">#&gt;  N &amp; 1704 &amp; 1704 &amp; 1704 \\ </span>
<span class="co">#&gt; \hline \\[-1.8ex] </span>
<span class="co">#&gt; \multicolumn{4}{l}{$^{***}$p $&lt;$ .01; $^{**}$p $&lt;$ .05; $^{*}$p $&lt;$ .1} \\ </span>
<span class="co">#&gt; \end{tabular} </span>
<span class="co">#&gt; \end{table}</span></code></pre></div>
<p>To include the produced tables in our paper, we can simply insert this stargazer LaTeX output into the publication’s TeX source.</p>
<p>Alternatively, you can use the <code>out</code> argument to save the output in a .tex or .txt file:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">stargazer</span>(mod.<span class="dv">1</span>, mod.<span class="dv">2</span>, mod.<span class="dv">3</span>, <span class="dt">title =</span> <span class="st">&quot;Regression Results&quot;</span>, <span class="dt">type =</span> <span class="st">&quot;latex&quot;</span>, 
          <span class="dt">covariate.labels  =</span> <span class="kw">c</span>(<span class="st">&quot;GDP per capita, logged&quot;</span>, <span class="st">&quot;Population, logged&quot;</span>, <span class="st">&quot;Americas&quot;</span>, <span class="st">&quot;Asia&quot;</span>, <span class="st">&quot;Europe&quot;</span>, <span class="st">&quot;Oceania&quot;</span>, <span class="st">&quot;Year&quot;</span>, <span class="st">&quot;Constant&quot;</span>), 
          <span class="dt">omit =</span> <span class="st">&quot;Constant&quot;</span>, 
          <span class="dt">keep.stat=</span><span class="st">&quot;n&quot;</span>, <span class="dt">style =</span> <span class="st">&quot;ajps&quot;</span>,
          <span class="dt">out =</span> <span class="st">&quot;regression-table.txt&quot;</span>)</code></pre></div>
<p>To include stargazer tables in Microsoft Word documents (e.g., .doc or .docx), use the following procedure: - Use the <code>out</code> argument to save output into an <code>.html</code> file. - Open the resulting file in your web browser. - Copy and paste the table from the web browser to your Microsoft Word document.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">stargazer</span>(mod.<span class="dv">1</span>, mod.<span class="dv">2</span>, mod.<span class="dv">3</span>, <span class="dt">title =</span> <span class="st">&quot;Regression Results&quot;</span>, <span class="dt">type =</span> <span class="st">&quot;html&quot;</span>, 
          <span class="dt">covariate.labels  =</span> <span class="kw">c</span>(<span class="st">&quot;GDP per capita, logged&quot;</span>, <span class="st">&quot;Population, logged&quot;</span>, <span class="st">&quot;Americas&quot;</span>, <span class="st">&quot;Asia&quot;</span>, <span class="st">&quot;Europe&quot;</span>, <span class="st">&quot;Oceania&quot;</span>, <span class="st">&quot;Year&quot;</span>, <span class="st">&quot;Constant&quot;</span>), 
          <span class="dt">omit =</span> <span class="st">&quot;Constant&quot;</span>, 
          <span class="dt">keep.stat=</span><span class="st">&quot;n&quot;</span>, <span class="dt">style =</span> <span class="st">&quot;ajps&quot;</span>,
          <span class="dt">out =</span> <span class="st">&quot;regression-table.html&quot;</span>)</code></pre></div>
</div>
</div>
<div id="challenges-14" class="section level3">
<h3><span class="header-section-number">13.2.6</span> Challenges</h3>
<ol style="list-style-type: decimal">
<li><p>Fit two linear regression models from the gapminder data, where the outcome is <code>lifeExp</code> and the explanatory variables are <code>log(pop)</code>, <code>log(gdpPercap)</code>, and <code>year</code>. In one model, treat <code>year</code> as a numeric variable. In the other, factorize the <code>year</code> variable. How do you interpret each model?</p></li>
<li><p>Fit a logistic regression model where the outcome is whether <code>lifeExp</code> is greater than or less than 60 years, exploring the use of different predictors.</p></li>
<li><p>Using <code>stargazer</code>, format a table reporting the results from the three models you created above (two linear regressions and one logistic).</p></li>
</ol>
<!--chapter:end:11-Modeling/11_2_Models.Rmd-->
</div>
</div>
</div>
<div id="strings-and-regular-expressions" class="section level1">
<h1><span class="header-section-number">14</span> Strings and Regular Expressions</h1>
<p>This unit focuses on chracter (or “sting”) data. We’ll explore:</p>
<ol style="list-style-type: decimal">
<li><strong><a href="#common-string-operations">common string operations</a></strong>, like concatinating, subsetting, and replacing strings.</li>
<li><strong><a href="#regular-expressions">regular expressions</a></strong>, a powerful cross-language tool for working with string data.</li>
</ol>
<div id="common-string-operations" class="section level2">
<h2><span class="header-section-number">14.1</span> Common string operations</h2>
<div id="concatinating-strings-with-paste" class="section level3">
<h3><span class="header-section-number">14.1.1</span> Concatinating strings with <code>paste()</code></h3>
<p>Let’s say we wanted to concatenate the following two strings into one larger character string:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">firstName &lt;-<span class="st"> &quot;Johan&quot;</span>
lastName &lt;-<span class="st"> &quot;Gambolputty&quot;</span></code></pre></div>
<p>Using the usual combine operator <code>c()</code> on two or more character strings will not create a single character string, but rather a <strong>vector</strong> of character strings.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">firstName &lt;-<span class="st"> &quot;Johan&quot;</span>
lastName &lt;-<span class="st"> &quot;Gambolputty&quot;</span>

fullName &lt;-<span class="st"> </span><span class="kw">c</span>(firstName, lastName)
<span class="kw">print</span>(fullName)
<span class="co">#&gt; [1] &quot;Johan&quot;       &quot;Gambolputty&quot;</span>
<span class="kw">length</span>(fullName)
<span class="co">#&gt; [1] 2</span></code></pre></div>
<p>In order to combine two or more character strings into one larger character string requires using the <code>paste()</code> function. This function takes character strings or vectors and collapses their values into a single character string, with each value separated by a character string selected by the user.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">firstName &lt;-<span class="st"> &quot;Johan&quot;</span>
lastName &lt;-<span class="st"> &quot;Gambolputty&quot;</span>

fullName &lt;-<span class="st"> </span><span class="kw">paste</span>(firstName, lastName)
<span class="kw">print</span>(fullName)
<span class="co">#&gt; [1] &quot;Johan Gambolputty&quot;</span>

fullName &lt;-<span class="st"> </span><span class="kw">paste</span>(firstName, lastName, <span class="dt">sep =</span> <span class="st">&quot;+&quot;</span>)
<span class="kw">print</span>(fullName)
<span class="co">#&gt; [1] &quot;Johan+Gambolputty&quot;</span>

fullName &lt;-<span class="st"> </span><span class="kw">paste</span>(firstName, lastName, <span class="dt">sep =</span> <span class="st">&quot;___&quot;</span>)
<span class="kw">print</span>(fullName)
<span class="co">#&gt; [1] &quot;Johan___Gambolputty&quot;</span></code></pre></div>
</div>
<div id="extracting-substrings" class="section level3">
<h3><span class="header-section-number">14.1.2</span> Extracting substrings</h3>
<p>R can also extract substrings based on the index position of its characters. Some things to note:</p>
<ol style="list-style-type: decimal">
<li><p>Index positions in R start at 1. This is in contrast to Python, where indexation starts at 0.</p></li>
<li><p>Object subsets using index positions in R contain all the elements in the specified range. If some object called <code>data</code> contains five elements, <code>data[2:4]</code> will return the elements at the second, third, and fourth positions. By contrast, the same subset in Python would return the objects at the third and fourth positions (or second and third positions, depending upon whether your index starts at 0 or 1).</p></li>
<li><p>R does not allow index-based character string subsetting using the object name, as this functionality is generally reserved for vector subsetting.</p></li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">firstName &lt;-<span class="st"> &quot;Johan&quot;</span>
lastName &lt;-<span class="st"> &quot;Gambolputty&quot;</span>
fullName &lt;-<span class="st"> </span><span class="kw">paste</span>(firstName, lastName)

<span class="co"># This won&#39;t work</span>
fullName[<span class="dv">0</span>]
<span class="co">#&gt; character(0)</span>
fullName[<span class="dv">1</span>]
<span class="co">#&gt; [1] &quot;Johan Gambolputty&quot;</span>
fullName[<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>]
<span class="co">#&gt; [1] &quot;Johan Gambolputty&quot; NA                  NA                 </span>
<span class="co">#&gt; [4] NA</span></code></pre></div>
<p>Instead, you must use the <code>substr()</code> function. Note that this function must receive both the <code>start</code> and <code>stop</code> arguments. So if you want to get all the characters between some index and the end of the string, you must make use of the <code>nchar()</code> function, which will tell you the length of a character string.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">substr</span>(<span class="dt">x =</span> fullName, <span class="dt">start =</span> <span class="dv">1</span>, <span class="dt">stop =</span> <span class="dv">1</span>)
<span class="co">#&gt; [1] &quot;J&quot;</span>
<span class="kw">substr</span>(<span class="dt">x =</span> fullName, <span class="dt">start =</span> <span class="dv">5</span>, <span class="dt">stop =</span> <span class="dv">5</span>)
<span class="co">#&gt; [1] &quot;n&quot;</span>
<span class="kw">substr</span>(<span class="dt">x =</span> fullName, <span class="dt">start =</span> <span class="dv">1</span>, <span class="dt">stop =</span> <span class="dv">5</span>)
<span class="co">#&gt; [1] &quot;Johan&quot;</span>
<span class="kw">substr</span>(<span class="dt">x =</span> fullName, <span class="dt">start =</span> <span class="dv">6</span>, <span class="dt">stop =</span> <span class="kw">nchar</span>(fullName))
<span class="co">#&gt; [1] &quot; Gambolputty&quot;</span>
<span class="kw">substr</span>(<span class="dt">x =</span> fullName, <span class="dt">start =</span> <span class="dv">6</span>, <span class="dt">stop =</span> <span class="kw">nchar</span>(fullName)<span class="op">-</span><span class="dv">2</span>)
<span class="co">#&gt; [1] &quot; Gambolput&quot;</span></code></pre></div>
</div>
<div id="replace-substrings-with-gsub" class="section level3">
<h3><span class="header-section-number">14.1.3</span> Replace substrings with <code>gsub()</code></h3>
<p>The function <code>gsub()</code> replaces substrings in a larger string using a specified pattern.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">firstName &lt;-<span class="st"> &quot;Johan&quot;</span>
lastName &lt;-<span class="st"> &quot;Gambolputty&quot;</span>
fullName &lt;-<span class="st"> </span><span class="kw">paste</span>(firstName, lastName)

<span class="kw">gsub</span>(<span class="dt">pattern =</span> <span class="st">&quot;G&quot;</span>, <span class="dt">replacement =</span> <span class="st">&quot;B&quot;</span>, <span class="dt">x =</span> fullName)
<span class="co">#&gt; [1] &quot;Johan Bambolputty&quot;</span>
<span class="kw">gsub</span>(<span class="dt">pattern =</span> <span class="st">&quot;Johan&quot;</span>, <span class="dt">replacement =</span> <span class="st">&quot;Mike&quot;</span>, <span class="dt">x =</span> fullName)
<span class="co">#&gt; [1] &quot;Mike Gambolputty&quot;</span>
<span class="kw">gsub</span>(<span class="dt">pattern =</span> <span class="st">&quot;johan&quot;</span>, <span class="dt">replacement =</span> <span class="st">&quot;Mike&quot;</span>, <span class="dt">x =</span> fullName) <span class="co"># Note the importance of cases!</span>
<span class="co">#&gt; [1] &quot;Johan Gambolputty&quot;</span></code></pre></div>
<p>The same function is used for replacements and stripping:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">gsub</span>(<span class="dt">pattern =</span> <span class="st">&quot; &quot;</span>, <span class="dt">replacement =</span> <span class="st">&quot;&quot;</span>, <span class="dt">x =</span> fullName) 
<span class="co">#&gt; [1] &quot;JohanGambolputty&quot;</span></code></pre></div>
<!--chapter:end:12-Strings/12-1_Strings.Rmd-->
</div>
</div>
<div id="regular-expressions" class="section level2">
<h2><span class="header-section-number">14.2</span> Regular Expressions</h2>
<p><code>gsub()</code> is part of a suite of functions to search and substitute substrings using <strong>regular expressions</strong> (or “regex” for short). For more information on regular expressions, see:</p>
<ol style="list-style-type: decimal">
<li><a href="https://regexr.com/">regexr.com</a></li>
<li><a href="https://medium.com/factory-mind/regex-tutorial-a-simple-cheatsheet-by-examples-649dc1c3f285">this cheatsheet</a></li>
</ol>
<p>MORE HERE</p>
<!--chapter:end:12-Strings/12-2_Regex.Rmd-->
</div>
</div>
<div id="programming-in-r" class="section level1">
<h1><span class="header-section-number">15</span> Programming in R</h1>
<p>This unit covers some more advanced programming in R - namely:</p>
<ol style="list-style-type: decimal">
<li><a href="#conditional-flow">Conditional Flow</a></li>
<li><a href="#functions-1">Functions</a></li>
<li><a href="#iteration">Iteration</a></li>
</ol>
<p>Mastering these skills will make you virtually invinsible in R!</p>
<p>Note that these concepts are <strong>not specific to R</strong>. While the syntax might vary, the basic idea of flow, functions, and iteration are common across all scripting languages. So if you ever think of picking up Python or something else, it’s critical to familiarize yourself with these concepts.</p>
<div id="conditional-flow" class="section level2">
<h2><span class="header-section-number">15.1</span> Conditional Flow</h2>
<p>Sometimes you only want to execute code if a condition is met. To do that, we use an <strong>if-else statement.</strong> It looks like this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="cf">if</span> (condition) {
  <span class="co"># code executed when condition is TRUE</span>
} <span class="cf">else</span> {
  <span class="co"># code executed when condition is FALSE</span>
}</code></pre></div>
<p><code>condition</code> is a statement that must always evaluate to either <code>TRUE</code> or <code>FALSE</code>. This is similar to <code>filter()</code>, except condition can only be a single value (i.e. a vector of length 1), whereas <code>filter()</code> works for entire vectors (or columns).</p>
<p>Let’s look at a simple example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">age =<span class="st"> </span><span class="dv">84</span>
<span class="cf">if</span> (age <span class="op">&gt;</span><span class="st"> </span><span class="dv">60</span>) {
    <span class="kw">print</span>(<span class="kw">paste</span>(age, <span class="st">&quot;is old&quot;</span>))
} <span class="cf">else</span> {
    <span class="kw">print</span>(<span class="st">&quot;But you don&#39;t look like a professor!&quot;</span>)
}
<span class="co">#&gt; [1] &quot;84 is old&quot;</span></code></pre></div>
<p>We refer to the first <code>print</code> command as the first <em>branch</em>.</p>
<p>Let’s change the <code>age</code> variable to execute the second branch:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">age =<span class="st"> </span><span class="dv">20</span>
<span class="cf">if</span> (age <span class="op">&gt;</span><span class="st"> </span><span class="dv">60</span>) {
    <span class="kw">print</span>(<span class="kw">paste</span>(age, <span class="st">&quot;is old&quot;</span>))
} <span class="cf">else</span> {
    <span class="kw">print</span>(<span class="st">&quot;But you don&#39;t look like a professor!&quot;</span>)
}
<span class="co">#&gt; [1] &quot;But you don&#39;t look like a professor!&quot;</span></code></pre></div>
<div id="multiple-conditions" class="section level3">
<h3><span class="header-section-number">15.1.1</span> Multiple conditions</h3>
<p>You can chain conditional statements together:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="cf">if</span> (this) {
  <span class="co"># do that</span>
} <span class="cf">else</span> <span class="cf">if</span> (that) {
  <span class="co"># do something else</span>
} <span class="cf">else</span> {
  <span class="co"># do something completely different</span>
}</code></pre></div>
</div>
<div id="complex-statements" class="section level3">
<h3><span class="header-section-number">15.1.2</span> Complex statements</h3>
<p>We can generate more complex conditional statements with boolean operators like <code>&amp;</code> and <code>||</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">age =<span class="st"> </span><span class="dv">45</span> 

<span class="cf">if</span> (age <span class="op">&gt;</span><span class="st"> </span><span class="dv">60</span>) {
    <span class="kw">print</span>(<span class="kw">paste</span>(age, <span class="st">&quot;is old&quot;</span>))
} <span class="cf">else</span> <span class="cf">if</span> (age <span class="op">&lt;</span><span class="st"> </span><span class="dv">60</span> <span class="op">&amp;</span><span class="st"> </span>age <span class="op">&gt;</span><span class="st"> </span><span class="dv">40</span>) {
    <span class="kw">print</span>(<span class="st">&quot;How&#39;s the midlife crisis?&quot;</span>)
} <span class="cf">else</span> {
    <span class="kw">print</span>(<span class="st">&quot;But you don&#39;t look like a professor!&quot;</span>)
}
<span class="co">#&gt; [1] &quot;How&#39;s the midlife crisis?&quot;</span></code></pre></div>
</div>
<div id="code-style" class="section level3">
<h3><span class="header-section-number">15.1.3</span> Code style</h3>
<p>Both <code>if</code> and <code>function</code> should (almost) always be followed by squiggly brackets (<code>{}</code>), and the contents should be indented. This makes it easier to see the hierarchy in your code by skimming the left-hand margin.</p>
<p>An opening curly brace should never go on its own line and should always be followed by a new line. A closing curly brace should always go on its own line, unless it’s followed by else. Always indent the code inside curly braces.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Bad</span>
<span class="cf">if</span> (y <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;&amp;</span><span class="st"> </span>debug)
<span class="kw">message</span>(<span class="st">&quot;Y is negative&quot;</span>)

<span class="cf">if</span> (y <span class="op">==</span><span class="st"> </span><span class="dv">0</span>) {
  <span class="kw">log</span>(x)
} 
<span class="cf">else</span> {
  y <span class="op">^</span><span class="st"> </span>x
}

<span class="co"># Good</span>
<span class="cf">if</span> (y <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;&amp;</span><span class="st"> </span>debug) {
  <span class="kw">message</span>(<span class="st">&quot;Y is negative&quot;</span>)
}

<span class="cf">if</span> (y <span class="op">==</span><span class="st"> </span><span class="dv">0</span>) {
  <span class="kw">log</span>(x)
} <span class="cf">else</span> {
  y <span class="op">^</span><span class="st"> </span>x
}</code></pre></div>
</div>
<div id="if-vs.-if_else" class="section level3">
<h3><span class="header-section-number">15.1.4</span> <code>if</code> vs. <code>if_else</code></h3>
<p>Because if-else conditional statements like the ones outlined above must always resolve to a single <code>TRUE</code> or <code>FALSE</code>, they cannot be used for vector operations. Vector operations are where you make multiple comparisons simultaneously for each value stored inside a vector.</p>
<p>Consider the <code>gapminder</code> data and imagine you wanted to create a new column identifying whether or not a country-year observation has a life expectancy of at least 35.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gap &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;Data/gapminder-FiveYearData.csv&quot;</span>)
<span class="kw">head</span>(gap)
<span class="co">#&gt;       country year      pop continent lifeExp gdpPercap</span>
<span class="co">#&gt; 1 Afghanistan 1952  8425333      Asia    28.8       779</span>
<span class="co">#&gt; 2 Afghanistan 1957  9240934      Asia    30.3       821</span>
<span class="co">#&gt; 3 Afghanistan 1962 10267083      Asia    32.0       853</span>
<span class="co">#&gt; 4 Afghanistan 1967 11537966      Asia    34.0       836</span>
<span class="co">#&gt; 5 Afghanistan 1972 13079460      Asia    36.1       740</span>
<span class="co">#&gt; 6 Afghanistan 1977 14880372      Asia    38.4       786</span></code></pre></div>
<p>This sounds like a classic if-else operation. For each observation, if <code>lifeExp</code> is greater than or equal to <code>35</code>, then the value in the new column should be <code>1</code>. Otherwise, it should be <code>0</code>. But what happens if we try to implement this using an if-else operation like above?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gap_if &lt;-<span class="st"> </span>gap <span class="op">%&gt;%</span>
<span class="st">   </span><span class="kw">mutate</span>(<span class="dt">life.35 =</span> <span class="cf">if</span>(lifeExp <span class="op">&gt;=</span><span class="st"> </span><span class="dv">35</span>){
     <span class="dv">1</span>
   } <span class="cf">else</span> {
     <span class="dv">0</span>
   })
<span class="co">#&gt; Warning in if (lifeExp &gt;= 35) {: the condition has length &gt; 1 and only the</span>
<span class="co">#&gt; first element will be used</span>

<span class="kw">head</span>(gap_if)
<span class="co">#&gt;       country year      pop continent lifeExp gdpPercap life.35</span>
<span class="co">#&gt; 1 Afghanistan 1952  8425333      Asia    28.8       779       0</span>
<span class="co">#&gt; 2 Afghanistan 1957  9240934      Asia    30.3       821       0</span>
<span class="co">#&gt; 3 Afghanistan 1962 10267083      Asia    32.0       853       0</span>
<span class="co">#&gt; 4 Afghanistan 1967 11537966      Asia    34.0       836       0</span>
<span class="co">#&gt; 5 Afghanistan 1972 13079460      Asia    36.1       740       0</span>
<span class="co">#&gt; 6 Afghanistan 1977 14880372      Asia    38.4       786       0</span></code></pre></div>
<p>This did not work correctly. Because <code>if()</code> can only handle a single <code>TRUE/FALSE</code> value, it only checked the first row of the data frame. That row contained <code>28.801</code>, so it generated a vector of length 1704 with each value being <code>0</code>.</p>
<p>Because we in fact want to make this if-else comparison 1704 times, we should instead use <strong><code>if_else()</code></strong>. This <strong>vectorizes</strong> the if-else comparison and makes a separate comparison for each row of the data frame. This allows us to correctly generate this new column.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gap_ifelse &lt;-<span class="st"> </span>gap <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">life.35 =</span> <span class="kw">if_else</span>(lifeExp <span class="op">&gt;=</span><span class="st"> </span><span class="dv">35</span>, <span class="dv">1</span>, <span class="dv">0</span>))

<span class="kw">head</span>(gap_ifelse)
<span class="co">#&gt;       country year      pop continent lifeExp gdpPercap life.35</span>
<span class="co">#&gt; 1 Afghanistan 1952  8425333      Asia    28.8       779       0</span>
<span class="co">#&gt; 2 Afghanistan 1957  9240934      Asia    30.3       821       0</span>
<span class="co">#&gt; 3 Afghanistan 1962 10267083      Asia    32.0       853       0</span>
<span class="co">#&gt; 4 Afghanistan 1967 11537966      Asia    34.0       836       0</span>
<span class="co">#&gt; 5 Afghanistan 1972 13079460      Asia    36.1       740       1</span>
<span class="co">#&gt; 6 Afghanistan 1977 14880372      Asia    38.4       786       1</span></code></pre></div>
<!--chapter:end:13-Programming/13-1_Conditional-Flow.Rmd-->
</div>
</div>
<div id="functions-1" class="section level2">
<h2><span class="header-section-number">15.2</span> Functions</h2>
<p>Functions are the basic building blocks of programs. Think of them “mini-scripts” or “tiny commands.” We’ve already used dozens of functions created by others (e.g. <code>filter()</code>, <code>mean()</code>.)</p>
<p>This lesson teaches you how to write you own functions, and why you would want to do so.The details are pretty simple, but this is one of those ideas where it’s good to get lots of practice!</p>
<div id="why-write-functions" class="section level3">
<h3><span class="header-section-number">15.2.1</span> Why write functions?</h3>
<p>Functions allow you to automate common tasks in a more powerful and general way than copy-and-pasting. For example, take a look at the following code:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(
  <span class="dt">a =</span> <span class="kw">rnorm</span>(<span class="dv">10</span>),
  <span class="dt">b =</span> <span class="kw">rnorm</span>(<span class="dv">10</span>),
  <span class="dt">c =</span> <span class="kw">rnorm</span>(<span class="dv">10</span>),
  <span class="dt">d =</span> <span class="kw">rnorm</span>(<span class="dv">10</span>)
)

df<span class="op">$</span>a &lt;-<span class="st"> </span>(df<span class="op">$</span>a <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(df<span class="op">$</span>a)) <span class="op">/</span><span class="st"> </span>(<span class="kw">max</span>(df<span class="op">$</span>a) <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(df<span class="op">$</span>a))
df<span class="op">$</span>b &lt;-<span class="st"> </span>(df<span class="op">$</span>b <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(df<span class="op">$</span>b)) <span class="op">/</span><span class="st"> </span>(<span class="kw">max</span>(df<span class="op">$</span>b) <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(df<span class="op">$</span>a))
df<span class="op">$</span>c &lt;-<span class="st"> </span>(df<span class="op">$</span>c <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(df<span class="op">$</span>c)) <span class="op">/</span><span class="st"> </span>(<span class="kw">max</span>(df<span class="op">$</span>c) <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(df<span class="op">$</span>c))
df<span class="op">$</span>d &lt;-<span class="st"> </span>(df<span class="op">$</span>d <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(df<span class="op">$</span>d)) <span class="op">/</span><span class="st"> </span>(<span class="kw">max</span>(df<span class="op">$</span>d) <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(df<span class="op">$</span>d))</code></pre></div>
<p>You might be able to puzzle out that this rescales each column to have a range from 0 to 1. But did you spot the mistake? I made an error when copying-and-pasting the code for <code>df$b</code>: I forgot to change an <code>a</code> to a <code>b</code>.</p>
<p>Functions have a number of advantages over this “copy-and-paste” approach:</p>
<ul>
<li><p><strong>They are easy to reuse.</strong> If you need to change things, you only have to update code in one place, instead of many.</p></li>
<li><p><strong>They are self-documenting.</strong> Functions name pieces of code the way variables name strings and numbers. Give your function a good name and you will easily remember the function and its purpose.</p></li>
<li><p><strong>They are easier to debug.</strong> There are fewer chances to make mistakes because the code only exists in one location (i.e. updating a variable name in one place, but not in another).</p></li>
</ul>
</div>
<div id="anatomy-of-a-function" class="section level3">
<h3><span class="header-section-number">15.2.2</span> Anatomy of a function</h3>
<p>Functions have three key components:</p>
<ol style="list-style-type: decimal">
<li>A <strong>name</strong>. This should be informative and describe what the function does.</li>
<li>The <strong>arguments</strong>, or list of inputs, to the function. They go inside the parentheses in <code>function()</code>.</li>
<li>The <strong>body</strong>. This is the block of code within <code>{}</code> that immediately follows <code>function(...)</code>, and is the code that you developed to perform the action described in the name using the arguments you provide.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_function &lt;-<span class="st"> </span><span class="cf">function</span>(x, y){
  <span class="co"># do</span>
  <span class="co"># something</span>
  <span class="co"># here</span>
  <span class="kw">return</span>(result)
}</code></pre></div>
<p>In this example, <code>my_function</code> is the <strong>name</strong> of the function, <code>x</code> and <code>y</code> are the <strong>arguments</strong>, and the stuff inside the <code>{}</code> is the <strong>body</strong>.</p>
</div>
<div id="writing-a-function" class="section level3">
<h3><span class="header-section-number">15.2.3</span> Writing a function</h3>
<p>Let’s re-write the scaling code above as a function. To write a function you need to first analyse the code. How many inputs does it have?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(
  <span class="dt">a =</span> <span class="kw">rnorm</span>(<span class="dv">10</span>),
  <span class="dt">b =</span> <span class="kw">rnorm</span>(<span class="dv">10</span>),
  <span class="dt">c =</span> <span class="kw">rnorm</span>(<span class="dv">10</span>),
  <span class="dt">d =</span> <span class="kw">rnorm</span>(<span class="dv">10</span>)
)

(df<span class="op">$</span>a <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(df<span class="op">$</span>a)) <span class="op">/</span><span class="st"> </span>(<span class="kw">max</span>(df<span class="op">$</span>a) <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(df<span class="op">$</span>a))
<span class="co">#&gt;  [1] 0.289 0.751 0.000 0.678 0.853 1.000 0.172 0.611 0.612 0.601</span></code></pre></div>
<p>This code only has one input: <code>df$a</code>. To make the inputs more clear, it’s a good idea to rewrite the code using temporary variables with general names. Here this code only requires a single numeric vector, which I’ll call <code>x</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span>df<span class="op">$</span>a
(x <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(x)) <span class="op">/</span><span class="st"> </span>(<span class="kw">max</span>(x) <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(x))
<span class="co">#&gt;  [1] 0.289 0.751 0.000 0.678 0.853 1.000 0.172 0.611 0.612 0.601</span></code></pre></div>
<p>There is some duplication in this code. We’re computing the range of the data three times, so it makes sense to do it in one step:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rng &lt;-<span class="st"> </span><span class="kw">range</span>(x)
rng
<span class="co">#&gt; [1] -2.44  1.15</span>

(x <span class="op">-</span><span class="st"> </span>rng[<span class="dv">1</span>]) <span class="op">/</span><span class="st"> </span>(rng[<span class="dv">2</span>] <span class="op">-</span><span class="st"> </span>rng[<span class="dv">1</span>])
<span class="co">#&gt;  [1] 0.289 0.751 0.000 0.678 0.853 1.000 0.172 0.611 0.612 0.601</span></code></pre></div>
<p>Pulling out intermediate calculations into named variables is a good practice because it makes it more clear what the code is doing. Now that I’ve simplified the code, and checked that it still works, I can turn it into a function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rescale01 &lt;-<span class="st"> </span><span class="cf">function</span>(x) {
  rng &lt;-<span class="st"> </span><span class="kw">range</span>(x)
  scaled &lt;-<span class="st"> </span>(x <span class="op">-</span><span class="st"> </span>rng[<span class="dv">1</span>]) <span class="op">/</span><span class="st"> </span>(rng[<span class="dv">2</span>] <span class="op">-</span><span class="st"> </span>rng[<span class="dv">1</span>])
  <span class="kw">return</span>(scaled)
}</code></pre></div>
<p>Note the overall process: I only made the function after I’d figured out how to make it work with a simple input. It’s easier to start with working code and turn it into a function; it’s harder to create a function and then try to make it work.</p>
<p>At this point it’s a good idea to check your function with a few different inputs:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">rescale01</span>(<span class="kw">c</span>(<span class="op">-</span><span class="dv">10</span>, <span class="dv">0</span>, <span class="dv">10</span>))
<span class="co">#&gt; [1] 0.0 0.5 1.0</span>

<span class="kw">rescale01</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">5</span>))
<span class="co">#&gt; [1] 0.00 0.25 0.50 1.00</span></code></pre></div>
</div>
<div id="using-a-function" class="section level3">
<h3><span class="header-section-number">15.2.4</span> Using a function</h3>
<p>Two important points about using (or *calling**) functions:</p>
<ol style="list-style-type: decimal">
<li><p>Notice that when we <strong>call</strong> a function, we’re passing a value into it that is assigned to the parameter we defined when writing the function. In this case, the parameter <code>x</code> is automatically assigned to <code>c(-10, 0, 10)</code>.</p></li>
<li><p>When using functions, by default the returned object is merely printed to the screen. If you want it saved, you need to assign it to an object.</p></li>
</ol>
<p>Let’s see if we can simplify the original example with our brand new function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df<span class="op">$</span>a &lt;-<span class="st"> </span><span class="kw">rescale01</span>(df<span class="op">$</span>a)
df<span class="op">$</span>b &lt;-<span class="st"> </span><span class="kw">rescale01</span>(df<span class="op">$</span>b)
df<span class="op">$</span>c &lt;-<span class="st"> </span><span class="kw">rescale01</span>(df<span class="op">$</span>c)
df<span class="op">$</span>d &lt;-<span class="st"> </span><span class="kw">rescale01</span>(df<span class="op">$</span>d)</code></pre></div>
<p>Compared to the original, this code is easier to understand and we’ve eliminated one class of copy-and-paste errors. There is still quite a bit of duplication since we’re doing the same thing to multiple columns. We’ll learn how to eliminate that duplication in the lesson on iteration.</p>
<p>Another advantage of functions is that if our requirements change, we only need to make the change in one place. For example, we might discover that some of our variables include <code>NA</code> values, and <code>rescale01()</code> fails:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">rescale01</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="ot">NA</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>))
<span class="co">#&gt; [1] NA NA NA NA NA NA</span></code></pre></div>
<p>Because we’ve extracted the code into a function, we only need to make the fix in one place:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rescale01 &lt;-<span class="st"> </span><span class="cf">function</span>(x) {
  rng &lt;-<span class="st"> </span><span class="kw">range</span>(x, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)
  (x <span class="op">-</span><span class="st"> </span>rng[<span class="dv">1</span>]) <span class="op">/</span><span class="st"> </span>(rng[<span class="dv">2</span>] <span class="op">-</span><span class="st"> </span>rng[<span class="dv">1</span>])
}
<span class="kw">rescale01</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="ot">NA</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>))
<span class="co">#&gt; [1] 0.00 0.25   NA 0.50 0.75 1.00</span></code></pre></div>
</div>
<div id="variable-scope" class="section level3">
<h3><span class="header-section-number">15.2.5</span> Variable Scope</h3>
<p>Analyze the following function:</p>
<ol style="list-style-type: decimal">
<li>Identify the name, arguments, and body</li>
<li>What does it do?</li>
<li>If <code>a = 3</code> and <code>b = 4</code>, what should we expect the output to be?</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pythagorean &lt;-<span class="st"> </span><span class="cf">function</span>(a, b){
  hypotenuse &lt;-<span class="st"> </span><span class="kw">sqrt</span>(a<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>b<span class="op">^</span><span class="dv">2</span>)
  <span class="kw">return</span>(hypotenuse)
}</code></pre></div>
<p>Now take a look at the following code:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">pythagorean</span>(<span class="dt">a =</span> <span class="dv">3</span>, <span class="dt">b =</span> <span class="dv">4</span>)
<span class="co">#&gt; [1] 5</span>

hypotenuse
<span class="co">#&gt; Error in eval(expr, envir, enclos): object &#39;hypotenuse&#39; not found</span></code></pre></div>
<p>Why does this generate an error? Why can we not see the results of <code>hypotenuse</code>? After all, it was generated by <code>pythagorean</code>, right?</p>
<p>When you call a function, a temporary workspace is set up that will be destroyed when the function returns by:</p>
<ol style="list-style-type: decimal">
<li>getting to the end, or</li>
<li>explicity by a return statement</li>
</ol>
<p>So think of functions as an alternative reality, where objects are created and destroyed in a function call.</p>
<p>This is why you do not see hypotenuse listed in the environment - it has already been destroyed.</p>
<div id="global-vs.local-environments" class="section level4 unnumbered">
<h4>Global vs. Local Environments</h4>
<p>Things can get confusing when you use the same names for variables both inside and outside a function. Check out this example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pressure =<span class="st"> </span><span class="fl">103.9</span>
adjust &lt;-<span class="st"> </span><span class="cf">function</span>(t){
    temperature =<span class="st"> </span>t <span class="op">*</span><span class="st"> </span><span class="fl">1.43</span> <span class="op">/</span><span class="st"> </span>pressure
    <span class="kw">return</span>(temperature)
}
pressure
<span class="co">#&gt; [1] 104</span>
temperature
<span class="co">#&gt; Error in eval(expr, envir, enclos): object &#39;temperature&#39; not found</span></code></pre></div>
<p><code>t</code> and <code>temperature</code> are <strong>local</strong> variables in <code>adjust</code>.</p>
<ul>
<li>Defined in the function.</li>
<li>Not visible in the main program.</li>
<li>Remember: a function parameter is a variable that is automatically assigned a value when the function is called.</li>
</ul>
<p><code>pressure</code> is a <strong>global</strong> variable.</p>
<ul>
<li>Defined outside any particular function.</li>
<li>Visible everywhere.</li>
</ul>
<p>This difference is referred to as <strong>scope</strong>. The <strong>scope</strong> of a variable is the part of a program that can ‘see’ that variable.</p>
</div>
</div>
<div id="arguments-1" class="section level3">
<h3><span class="header-section-number">15.2.6</span> Arguments</h3>
<p>Functions do not need to take input.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">print_hello &lt;-<span class="st"> </span><span class="cf">function</span>(){
    <span class="kw">print</span>(<span class="st">&quot;hello&quot;</span>)
}
<span class="kw">print_hello</span>()
<span class="co">#&gt; [1] &quot;hello&quot;</span></code></pre></div>
<p>But if a function takes input, arguments can be passed to functions in different ways.</p>
<ol style="list-style-type: decimal">
<li><strong>Positional arguments</strong> are mandatory and have no default values.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">send &lt;-<span class="st"> </span><span class="cf">function</span>(message, recipient){
  message &lt;-<span class="st"> </span><span class="kw">paste</span>(message, recipient)
  <span class="kw">return</span>(message)
}
<span class="kw">send</span>(<span class="st">&quot;Hello&quot;</span>, <span class="st">&quot;world&quot;</span>)
<span class="co">#&gt; [1] &quot;Hello world&quot;</span></code></pre></div>
<p>In the case above, it is possible to use argument <strong>names</strong> when calling the functions and, doing so, it is possible to switch the order of arguments. Tor instance:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">send</span>(<span class="dt">recipient=</span><span class="st">&#39;World&#39;</span>, <span class="dt">message=</span><span class="st">&#39;Hello&#39;</span>)
<span class="co">#&gt; [1] &quot;Hello World&quot;</span></code></pre></div>
<p>However, positional arguments (<code>send('Hello', 'World')</code>) are greatly perfered over names (<code>send(recipient='World', message='Hello')</code>), as it is very easy to accidentally specifying incorrect argument values.</p>
<ol start="2" style="list-style-type: decimal">
<li><strong>Keyword arguments</strong> are not mandatory and have default values. They are often used for optional parameters sent to the function.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">send &lt;-<span class="st"> </span><span class="cf">function</span>(message, recipient, <span class="dt">cc=</span><span class="ot">NULL</span>){
  message &lt;-<span class="st"> </span><span class="kw">paste</span>(message, recipient, <span class="st">&quot;cc:&quot;</span>, cc)
  <span class="kw">return</span>(message)
}
<span class="kw">send</span>(<span class="st">&quot;Hello&quot;</span>, <span class="st">&quot;world&quot;</span>) 
<span class="co">#&gt; [1] &quot;Hello world cc: &quot;</span>
<span class="kw">send</span>(<span class="st">&quot;Hello&quot;</span>, <span class="st">&quot;world&quot;</span>, <span class="st">&quot;rochelle&quot;</span>)
<span class="co">#&gt; [1] &quot;Hello world cc: rochelle&quot;</span></code></pre></div>
<p>Here <code>cc</code> and bcc are <code>optional</code>, and evaluate to <code>NULL</code> when they are not passed another value.</p>
</div>
<div id="challenges-15" class="section level3">
<h3><span class="header-section-number">15.2.7</span> Challenges</h3>
<div id="challenge-1-2" class="section level4 unnumbered">
<h4>Challenge 1</h4>
<p>Write a function that calculates the sum of the squared value of two numbers. For instance, it should generate the following output:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">my_function</span>(<span class="dv">3</span>, <span class="dv">4</span>)
<span class="co"># [1] 25</span></code></pre></div>
</div>
<div id="challenge-2-2" class="section level4 unnumbered">
<h4>Challenge 2</h4>
<p>Write <code>both_na()</code>, a function that takes two vectors of the same length and returns the number of positions that have an NA in both vectors.</p>
</div>
<div id="challenge-3-1" class="section level4 unnumbered">
<h4>Challenge 3</h4>
<p>Fill in the blanks to create a function that takes a name like “Rochelle Terman” and returns that name in uppercase and reversed, like “TERMAN, ROCHELLE”</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">standard_names &lt;-<span class="st"> </span><span class="cf">function</span>(name){
    upper_case =<span class="st"> </span><span class="kw">toupper</span>(____) <span class="co"># make upper</span>
    upper_case_vec =<span class="st"> </span><span class="kw">strsplit</span>(_____, <span class="dt">split =</span> <span class="st">&#39; &#39;</span>)[[<span class="dv">1</span>]] <span class="co"># turn into a vector</span>
    first_name =<span class="st"> </span>______ <span class="co"># take first name</span>
    last_name =<span class="st"> </span>_______ <span class="co"># take last name</span>
    reversed_name =<span class="st"> </span><span class="kw">paste</span>(______, _______, <span class="dt">sep =</span> <span class="st">&quot;, &quot;</span>) <span class="co"># reverse and separate by a comma and space</span>
    <span class="kw">return</span>(reversed_name)
}

<span class="co">#Solution -- HIDE ME</span>
standard_names &lt;-<span class="st"> </span><span class="cf">function</span>(name){
    upper_case =<span class="st"> </span><span class="kw">toupper</span>(name) <span class="co"># make upper</span>
    upper_case_vec =<span class="st"> </span><span class="kw">strsplit</span>(upper_case, <span class="dt">split =</span> <span class="st">&#39; &#39;</span>)[[<span class="dv">1</span>]]  <span class="co"># turn into a list</span>
    first_name =<span class="st"> </span>upper_case_vec[<span class="dv">1</span>]<span class="co"># take first name</span>
    last_name =<span class="st"> </span>upper_case_vec[<span class="dv">2</span>] <span class="co"># take last name</span>
    reversed_name =<span class="st"> </span><span class="kw">paste</span>(last_name, first_name, <span class="dt">sep =</span> <span class="st">&quot;, &quot;</span>) <span class="co"># reverse and separate by a comma and space</span>
    <span class="kw">return</span>(reversed_name)
}
<span class="kw">standard_names</span>(<span class="st">&#39;Rochelle Terman&#39;</span>)</code></pre></div>
</div>
<div id="challenge-4-1" class="section level4 unnumbered">
<h4>Challenge 4</h4>
<p>Look at the following function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">print_date &lt;-<span class="st"> </span><span class="cf">function</span>(year, month, day){
    joined =<span class="st"> </span><span class="kw">paste</span>(<span class="kw">as.character</span>(year), <span class="kw">as.character</span>(month), <span class="kw">as.character</span>(day), <span class="dt">sep =</span> <span class="st">&quot;/&quot;</span>)
    <span class="kw">return</span>(joined)
}</code></pre></div>
<p>What does this short program print?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print_date</span>(<span class="dt">day=</span><span class="dv">1</span>, <span class="dt">month=</span><span class="dv">2</span>, <span class="dt">year=</span><span class="dv">2003</span>)</code></pre></div>
</div>
<div id="acknowledgements-and-resources" class="section level4 unnumbered">
<h4>Acknowledgements and Resources</h4>
<ul>
<li><a href="https://r4ds.had.co.nz/functions.html">R for Data Science</a>.</li>
<li><a href="https://cfss.uchicago.edu/notes/functions">Computing for Social Sciences</a></li>
</ul>
<!--chapter:end:13-Programming/13-2_Functions.Rmd-->
</div>
</div>
</div>
<div id="iteration" class="section level2">
<h2><span class="header-section-number">15.3</span> Iteration</h2>
<p>In the last unit, we talked about how important it is to reduce duplication in your code by creating functions instead of copying-and-pasting. Avoiding duplication allows for more readible, more flexible, and less error-prone code.</p>
<p>Functions are one method of reducing duplication in your code. Another tool for reducing duplication is <strong>iteration</strong>, which lets you do the same task to multiple inputs.</p>
<p>In this chapter you’ll learn about four approaches to iteratation:</p>
<ol style="list-style-type: decimal">
<li>Vectorized functions</li>
<li>For-loops</li>
<li><code>map</code> and functional programming</li>
<li>Scoped verbs in <code>dplyr</code></li>
</ol>
<div id="vectorized-functions" class="section level3">
<h3><span class="header-section-number">15.3.1</span> Vectorized functions</h3>
<p>Most of R’s built-in functions are <strong>vectorized</strong>, meaning that the function will operate on all elements of a vector without needing to loop through and act on each element at a time.</p>
<p>That means you should never need to perform explicit iteration when performing simple mathematical computations.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">4</span>
x <span class="op">*</span><span class="st"> </span><span class="dv">2</span>
<span class="co">#&gt; [1] 2 4 6 8</span></code></pre></div>
<p>Notice that the multiplication happened to each element of the vector. Most built-in functions also operate element-wise on vectors:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">4</span>
<span class="kw">log</span>(x)
<span class="co">#&gt; [1] 0.000 0.693 1.099 1.386</span></code></pre></div>
<p>We can also add two vectors together:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">4</span>
y &lt;-<span class="st"> </span><span class="dv">6</span><span class="op">:</span><span class="dv">9</span>
x <span class="op">+</span><span class="st"> </span>y
<span class="co">#&gt; [1]  7  9 11 13</span></code></pre></div>
<p>Notice that each element of x was added to its corresponding element of y:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x<span class="op">:</span><span class="st">  </span><span class="dv">1</span>  <span class="dv">2</span>  <span class="dv">3</span>  <span class="dv">4</span>
    <span class="op">+</span><span class="st">  </span><span class="op">+</span><span class="st">  </span><span class="op">+</span><span class="st">  </span><span class="op">+</span>
y<span class="op">:</span><span class="st">  </span><span class="dv">6</span>  <span class="dv">7</span>  <span class="dv">8</span>  <span class="dv">9</span>
<span class="op">---------------</span>
<span class="st">    </span><span class="dv">7</span>  <span class="dv">9</span> <span class="dv">11</span> <span class="dv">13</span></code></pre></div>
<p>What happens if you add two vectors of different lengths?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="dv">1</span><span class="op">:</span><span class="dv">10</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">2</span>
<span class="co">#&gt;  [1]  2  4  4  6  6  8  8 10 10 12</span></code></pre></div>
<p>Here, R will expand the shortest vector to the same length as the longest. This is called <strong>recycling</strong>. This usually (but not always) happens silently, meaning R will not warn you. Beware!</p>
</div>
<div id="for-loops" class="section level3">
<h3><span class="header-section-number">15.3.2</span> For-loops</h3>
<p>You will frequently need to iterate over vectors or data frames, perform an operation on each element, and save the results somewhere.</p>
<p>For example, imagine we have this simple dataframe:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(
  <span class="dt">a =</span> <span class="kw">rnorm</span>(<span class="dv">10</span>),
  <span class="dt">b =</span> <span class="kw">rnorm</span>(<span class="dv">10</span>),
  <span class="dt">c =</span> <span class="kw">rnorm</span>(<span class="dv">10</span>),
  <span class="dt">d =</span> <span class="kw">rnorm</span>(<span class="dv">10</span>)
)</code></pre></div>
<p>We want to compute the median of each column. You <em>could</em> do with copy-and-paste:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">median</span>(df<span class="op">$</span>a)
<span class="co">#&gt; [1] -0.246</span>
<span class="kw">median</span>(df<span class="op">$</span>b)
<span class="co">#&gt; [1] -0.287</span>
<span class="kw">median</span>(df<span class="op">$</span>c)
<span class="co">#&gt; [1] -0.0567</span>
<span class="kw">median</span>(df<span class="op">$</span>d)
<span class="co">#&gt; [1] 0.144</span></code></pre></div>
<p>But that breaks our rule of thumb: never copy and paste more than twice. Instead, we could use a <code>for</code> loop:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">output &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;double&quot;</span>, <span class="kw">ncol</span>(df))  <span class="co"># 1. output</span>
<span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_along</span>(df)) {            <span class="co"># 2. sequence</span>
  output[i] &lt;-<span class="st"> </span><span class="kw">median</span>(df[[i]])        <span class="co"># 3. body</span>
}
output
<span class="co">#&gt; [1] -0.2458 -0.2873 -0.0567  0.1443</span></code></pre></div>
<div id="components-of-a-for-loop" class="section level4 unnumbered">
<h4>Components of a <code>for</code> loop</h4>
<p>Every <code>for</code> loop has three components:</p>
<ol style="list-style-type: decimal">
<li>The <strong>output</strong>: <code>output &lt;- vector(&quot;double&quot;, length(x))</code>.</li>
</ol>
<p>Before you start a loop, you need to create an empty vector to store the output of the loop. Notice that the object is created <strong>outside</strong> the loop!</p>
<p>Preallocating space for your output is very important for efficiency: if you grow the <code>for</code> loop at each iteration using <code>c()</code> (for example), your <code>for</code> loop will be very slow.</p>
<ol start="2" style="list-style-type: decimal">
<li>The <strong>sequence</strong>: <code>i in seq_along(df)</code>.</li>
</ol>
<p>This determines what to loop over.In this case, the sequence is <code>seq_along(df)</code>, which creates a numeric vector for a sequence of numbers beginning at 1 and continuing until it reaches the length of <code>df</code> (the length here is the number of columns in <code>df</code>).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">seq_along</span>(df)
<span class="co">#&gt; [1] 1 2 3 4</span></code></pre></div>
<p>It’s useful to think of <code>i</code> as a pronoun, like “it”. Each iteration of the <code>for</code> loop will assign <code>i</code> to a new value from based on the designed sequence:</p>
<div class="sourceCode"><pre class="sourceCode md"><code class="sourceCode markdown">| Iteration | i =  |
|-----------|------|
| 1         | 1    | 
| 2         | 2    | 
| 3         | 3    | 
| 4         | 4    | 
=</code></pre></div>
<p><strong>NB:</strong> <code>seq_along</code> is a safe version of the more familiar <code>1:length(l)</code>, with an important difference: if you have a zero-length vector, <code>seq_along()</code> does the right thing:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">y &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;double&quot;</span>, <span class="dv">0</span>)
<span class="kw">seq_along</span>(y)
<span class="co">#&gt; integer(0)</span>
<span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(y)
<span class="co">#&gt; [1] 1 0</span></code></pre></div>
<p>You probably won’t create a zero-length vector deliberately, but it’s easy to create them accidentally. If you use <code>1:length(x)</code> instead of <code>seq_along(x)</code>, you’re likely to get a confusing error message.</p>
<ol start="3" style="list-style-type: decimal">
<li>The <strong>body</strong>: <code>output[[i]] &lt;- median(df[[i]])</code>.</li>
</ol>
<p>This is the code that does the work. It’s run repeatedly, each time with a different value for <code>i</code>:</p>
<div class="sourceCode"><pre class="sourceCode md"><code class="sourceCode markdown">| Iteration | i =  | body                           |
|-----------|------|--------------------------------|
| 1         | 1    | output[[1]] &lt;- median(df[[1]]) |
| 2         | 2    | output[[2]] &lt;- median(df[[2]]) |
| 3         | 3    | output[[3]] &lt;- median(df[[3]]) |
| 4         | 4    | output[[4]] &lt;- median(df[[4]]) |</code></pre></div>
<p><strong>NB:</strong>: We use <code>[[</code> notation to reference each column of <code>df</code> using indices of columns, instead of <code>$</code> and column names.</p>
</div>
<div id="challenges-16" class="section level4 unnumbered">
<h4>Challenges</h4>
<ol style="list-style-type: decimal">
<li>Fill in the blanks to write a <code>for</code> loop that calculates the arithmetic mean for every column in <code>mtcars</code>.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mtcars.means &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;double&quot;</span>, ______)
<span class="cf">for</span>(i <span class="cf">in</span> ______){
  ______[i] &lt;-<span class="st"> </span><span class="kw">mean</span>(______[[i]])
}

<span class="co"># SOLUTION - HIDE ME</span>
mtcars.means &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;double&quot;</span>, <span class="kw">ncol</span>(mtcars))
<span class="cf">for</span>(i <span class="cf">in</span> <span class="kw">seq_along</span>(mtcars)){
  mtcars.means[i] &lt;-<span class="st"> </span><span class="kw">mean</span>(mtcars[[i]])
}
mtcars.means</code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Check out the <code>iris</code> dataset:</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">kable</span>(<span class="kw">head</span>(iris))</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:right;">
Sepal.Length
</th>
<th style="text-align:right;">
Sepal.Width
</th>
<th style="text-align:right;">
Petal.Length
</th>
<th style="text-align:right;">
Petal.Width
</th>
<th style="text-align:left;">
Species
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
5.1
</td>
<td style="text-align:right;">
3.5
</td>
<td style="text-align:right;">
1.4
</td>
<td style="text-align:right;">
0.2
</td>
<td style="text-align:left;">
setosa
</td>
</tr>
<tr>
<td style="text-align:right;">
4.9
</td>
<td style="text-align:right;">
3.0
</td>
<td style="text-align:right;">
1.4
</td>
<td style="text-align:right;">
0.2
</td>
<td style="text-align:left;">
setosa
</td>
</tr>
<tr>
<td style="text-align:right;">
4.7
</td>
<td style="text-align:right;">
3.2
</td>
<td style="text-align:right;">
1.3
</td>
<td style="text-align:right;">
0.2
</td>
<td style="text-align:left;">
setosa
</td>
</tr>
<tr>
<td style="text-align:right;">
4.6
</td>
<td style="text-align:right;">
3.1
</td>
<td style="text-align:right;">
1.5
</td>
<td style="text-align:right;">
0.2
</td>
<td style="text-align:left;">
setosa
</td>
</tr>
<tr>
<td style="text-align:right;">
5.0
</td>
<td style="text-align:right;">
3.6
</td>
<td style="text-align:right;">
1.4
</td>
<td style="text-align:right;">
0.2
</td>
<td style="text-align:left;">
setosa
</td>
</tr>
<tr>
<td style="text-align:right;">
5.4
</td>
<td style="text-align:right;">
3.9
</td>
<td style="text-align:right;">
1.7
</td>
<td style="text-align:right;">
0.4
</td>
<td style="text-align:left;">
setosa
</td>
</tr>
</tbody>
</table>
<p>Write a <code>for</code> loop that calculates the number of unique values in each column of <code>iris</code>. Before you write the <code>for</code> loop, identify the three components you need:</p>
<ol style="list-style-type: decimal">
<li>Output</li>
<li>Sequence</li>
<li>Body</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># SOLUTION - HIDE ME</span>
out &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;double&quot;</span>, <span class="kw">ncol</span>(iris))
<span class="cf">for</span>(i <span class="cf">in</span> <span class="kw">seq_along</span>(iris)){
  out[i] &lt;-<span class="st"> </span><span class="kw">length</span>(<span class="kw">unique</span>(iris[[i]]))
}
out
<span class="co">#&gt; [1] 35 23 43 22  3</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Generate 10 random normals for each of <span class="math inline">\(\mu = -10\)</span>, <span class="math inline">\(0\)</span>, <span class="math inline">\(10\)</span>, and <span class="math inline">\(100\)</span>. Store them in a list.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># SOLUTION - HIDE ME</span>
mus &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="op">-</span><span class="dv">10</span>, <span class="dv">0</span>, <span class="dv">10</span>, <span class="dv">100</span>)

out &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;list&quot;</span>, <span class="dv">4</span>)
<span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_along</span>(mus)){
  out[[i]] &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">10</span>, <span class="dt">mean =</span> mus[i])
}</code></pre></div>
</div>
</div>
<div id="functional-programming-and-map" class="section level3">
<h3><span class="header-section-number">15.3.3</span> Functional Programming and <code>map</code></h3>
<p>Loops are not as important in R as they are in other languages because R is a <strong>functional</strong> programming language. This means that it’s possible to wrap up <code>for</code> loops in a function, and call that function instead of using the for loop directly.</p>
<p>The pattern of looping over a vector, doing something to each element and saving the results is so common that the <code>purrr</code> package provides a family of functions to do it for you. Thus they eliminate the need for many common <code>for</code> loops.</p>
<p>There is one function for each type of output:</p>
<ol style="list-style-type: decimal">
<li><code>map()</code> makes a list.</li>
<li><code>map_lgl()</code> makes a logical vector.</li>
<li><code>map_int()</code> makes an integer vector.</li>
<li><code>map_dbl()</code> makes a double vector.</li>
<li><code>map_chr()</code> makes a character vector.</li>
</ol>
<p>Each function takes a vector as input, applies a function to each piece, and then returns a new vector that’s the same length (and has the same names) as the input. The</p>
<p><strong>NB</strong>: Some people will tell you to avoid <code>for</code> loops because they are slow. They’re wrong! (Well at least they’re rather out of date, as for loops haven’t been slow for many years). The chief benefits of using functions like <code>map()</code> is not speed, but clarity: they make your code easier to write and to read.</p>
<p>To see how <code>map</code> works, consider (again) this simple data frame:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df &lt;-<span class="st"> </span><span class="kw">tibble</span>(
  <span class="dt">a =</span> <span class="kw">rnorm</span>(<span class="dv">10</span>),
  <span class="dt">b =</span> <span class="kw">rnorm</span>(<span class="dv">10</span>),
  <span class="dt">c =</span> <span class="kw">rnorm</span>(<span class="dv">10</span>),
  <span class="dt">d =</span> <span class="kw">rnorm</span>(<span class="dv">10</span>)
)</code></pre></div>
<p>What if we wanted to calculate the mean, median, and standard deviation of each column?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">map_dbl</span>(df, mean)
<span class="co">#&gt;      a      b      c      d </span>
<span class="co">#&gt;  0.116  0.127 -0.089  0.281</span>
<span class="kw">map_dbl</span>(df, median)
<span class="co">#&gt;       a       b       c       d </span>
<span class="co">#&gt;  0.0583  0.0244 -0.0571  0.2604</span>
<span class="kw">map_dbl</span>(df, sd)
<span class="co">#&gt;     a     b     c     d </span>
<span class="co">#&gt; 1.161 1.226 1.024 0.798</span></code></pre></div>
<p>Compared to using a for loop, this approach is much easier to read, and less error-prone.</p>
<p>The data can even be piped!</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map_dbl</span>(mean)
<span class="co">#&gt;      a      b      c      d </span>
<span class="co">#&gt;  0.116  0.127 -0.089  0.281</span>
df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map_dbl</span>(median)
<span class="co">#&gt;       a       b       c       d </span>
<span class="co">#&gt;  0.0583  0.0244 -0.0571  0.2604</span>
df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map_dbl</span>(sd)
<span class="co">#&gt;     a     b     c     d </span>
<span class="co">#&gt; 1.161 1.226 1.024 0.798</span></code></pre></div>
<p>We can also pass additional arguments. For example, the function <code>mean</code> passes an optional argument <code>trim</code>. Them the help file: “the fraction (0 to 0.5) of observations to be trimmed from each end of <code>x</code> before the <code>mean</code>is computed.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">map_dbl</span>(df, mean, <span class="dt">trim =</span> <span class="fl">0.5</span>)
<span class="co">#&gt;       a       b       c       d </span>
<span class="co">#&gt;  0.0583  0.0244 -0.0571  0.2604</span></code></pre></div>
<p>Check out other fun applications of <code>map</code> functions <a href="https://r4ds.had.co.nz/iteration.html#the-map-functions">here</a></p>
<div id="challenges-17" class="section level4 unnumbered">
<h4>Challenges</h4>
<p>Write code that uses one of the map functions to:</p>
<ol style="list-style-type: decimal">
<li>Calculates the arithmetic mean for every column in <code>mtcars</code>.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># SOLUTION - HIDE ME</span>
<span class="kw">map</span>(mtcars, mean)</code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Calculates the number of unique values in each column of <code>iris</code>.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># SOLUTION - HIDE ME</span>
iris <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map</span>(unique) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map_dbl</span>(length)
<span class="co">#&gt; Sepal.Length  Sepal.Width Petal.Length  Petal.Width      Species </span>
<span class="co">#&gt;           35           23           43           22            3</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Generate 10 random normals for each of <span class="math inline">\(\mu = -10\)</span>, <span class="math inline">\(0\)</span>, <span class="math inline">\(10\)</span>, and <span class="math inline">\(100\)</span>.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># SOLUTION - HIDE ME</span>
<span class="kw">map</span>(<span class="kw">c</span>(<span class="op">-</span><span class="dv">10</span>, <span class="dv">0</span>, <span class="dv">10</span>, <span class="dv">100</span>), <span class="op">~</span><span class="kw">rnorm</span>(<span class="dt">n =</span> <span class="dv">10</span>, <span class="dt">mean =</span> .))
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt;  [1]  -8.08  -8.70  -9.25  -9.44 -10.55  -8.89 -12.61 -10.16  -9.57 -10.38</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[2]]</span>
<span class="co">#&gt;  [1]  0.4242  1.0631  1.0487 -0.0381  0.4861  1.6729 -0.3544  0.9463</span>
<span class="co">#&gt;  [9]  1.3168 -0.2966</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[3]]</span>
<span class="co">#&gt;  [1]  9.61  9.21  8.94  9.20  8.24  9.31  9.44  9.46 10.23 10.98</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[4]]</span>
<span class="co">#&gt;  [1]  99.8  98.6 100.3  99.6 100.6 102.1 100.4  98.3 100.2 101.1</span></code></pre></div>
</div>
</div>
<div id="scoped-verbs" class="section level3">
<h3><span class="header-section-number">15.3.4</span> Scoped verbs</h3>
<p>The last iteration technique we’ll discuss is scoped verbs in <code>dplyr</code>.</p>
<p>Frequently when working with dataframes, we want to apply a function to multiple columns. For example, let’s say we want to calculate the mean value of each column in <code>mtcars</code>.</p>
<p>If we wanted to calculate the average of a single column, it would be pretty simple using just regular <code>dplyr</code> functions:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mtcars <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">mpg =</span> <span class="kw">mean</span>(mpg))
<span class="co">#&gt;    mpg</span>
<span class="co">#&gt; 1 20.1</span></code></pre></div>
<p>But if we want to calculate the mean for all of them, we’d have to duplicate this code many times over:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mtcars <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">mpg =</span> <span class="kw">mean</span>(mpg),
            <span class="dt">cyl =</span> <span class="kw">mean</span>(cyl),
            <span class="dt">disp =</span> <span class="kw">mean</span>(disp),
            <span class="dt">hp =</span> <span class="kw">mean</span>(hp),
            <span class="dt">drat =</span> <span class="kw">mean</span>(drat),
            <span class="dt">wt =</span> <span class="kw">mean</span>(wt),
            <span class="dt">qsec =</span> <span class="kw">mean</span>(qsec),
            <span class="dt">vs =</span> <span class="kw">mean</span>(vs),
            <span class="dt">am =</span> <span class="kw">mean</span>(am),
            <span class="dt">gear =</span> <span class="kw">mean</span>(gear),
            <span class="dt">carb =</span> <span class="kw">mean</span>(carb))
<span class="co">#&gt;    mpg  cyl disp  hp drat   wt qsec    vs    am gear carb</span>
<span class="co">#&gt; 1 20.1 6.19  231 147  3.6 3.22 17.8 0.438 0.406 3.69 2.81</span></code></pre></div>
<p>But this is very repetitive and prone to mistakes!</p>
<p>We just saw one approach to solve this problem: <code>map</code>. Another approach is <strong>scoped verbs</strong>.</p>
<p>Scoped verbs allow you to use standard verbs (or functions) in <code>dplyr</code> that affect multiple variables at once.</p>
<ul>
<li><code>_if</code> allows you to pick variables based on a predicate function like <code>is.numeric()</code> or <code>is.character()</code></li>
<li><code>_at</code> allows you to pick variables using the same syntax as <code>select()</code></li>
<li><code>_all</code> operates on all variables</li>
</ul>
<p>These verbs can apply to <code>summarize</code>, <code>filter</code>, or <code>mutate</code>. Let’s go over <code>summarize</code>:</p>
<div id="summarize_all" class="section level4 unnumbered">
<h4><code>summarize_all()</code></h4>
<p><code>summarize_all()</code> takes a dataframe and a function and applies that function to each column:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mtcars <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarize_all</span>(<span class="dt">.funs =</span> mean)
<span class="co">#&gt;    mpg  cyl disp  hp drat   wt qsec    vs    am gear carb</span>
<span class="co">#&gt; 1 20.1 6.19  231 147  3.6 3.22 17.8 0.438 0.406 3.69 2.81</span></code></pre></div>
</div>
<div id="summarize_at" class="section level4 unnumbered">
<h4><code>summarize_at()</code></h4>
<p><code>summarize_at()</code> allows you to pick columns in the same way as <code>select()</code>, that is, based on their names. There is one small difference: you need to wrap the complete selection with the <code>vars()</code> helper (this avoids ambiguity).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mtcars <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarize_at</span>(<span class="dt">.vars =</span> <span class="kw">vars</span>(mpg, wt), <span class="dt">.funs =</span> mean)
<span class="co">#&gt;    mpg   wt</span>
<span class="co">#&gt; 1 20.1 3.22</span></code></pre></div>
</div>
<div id="summarize_if" class="section level4 unnumbered">
<h4><code>summarize_if()</code></h4>
<p><code>summarize_if()</code> allows you to pick variables to summarize based on some property of the column. For example, what if we want to apply a numeric summary function only to numeric columns:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">iris <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarize_if</span>(<span class="dt">.predicate =</span> is.numeric, <span class="dt">.funs =</span> mean)
<span class="co">#&gt;   Sepal.Length Sepal.Width Petal.Length Petal.Width</span>
<span class="co">#&gt; 1         5.84        3.06         3.76         1.2</span></code></pre></div>
<p><code>mutate</code> and <code>filter</code> work in a similar way. To see more, check out <a href="https://dcl-2017-04.github.io/curriculum/manip-scoped.html">Scoped verbs by the Data Challenge Lab</a></p>
</div>
<div id="acknowledgments-5" class="section level4 unnumbered">
<h4>Acknowledgments</h4>
<p>A good portion of this lesson is based on:</p>
<ul>
<li><a href="https://r4ds.had.co.nz/iteration.html">R for Data Science</a></li>
<li><a href="https://cfss.uchicago.edu/notes/iteration/">Computing for Social Sciences</a></li>
</ul>
<!--chapter:end:13-Programming/13-3_Iteration.Rmd-->
</div>
</div>
</div>
</div>
<div id="collecting-data-from-the-web" class="section level1">
<h1><span class="header-section-number">16</span> Collecting Data from the Web</h1>
<div id="introduction-2" class="section level2">
<h2><span class="header-section-number">16.1</span> Introduction</h2>
<p>There’s a ton of web data useful for social scientists, including:</p>
<ul>
<li>social media</li>
<li>news media</li>
<li>government publications</li>
<li>organizational records</li>
</ul>
<p>There are two ways to get data off the web:</p>
<ol style="list-style-type: decimal">
<li><strong><a href="#web-apis">Web APIs</a></strong> - i.e. application-facing, for computers</li>
<li><strong><a href="#webscraping">Webscraping</a></strong> - i.e. user-facing websites for humans</li>
</ol>
<p><strong>Rule of Thumb</strong>: Check for API first. If not available, scrape.</p>
</div>
<div id="web-apis" class="section level2">
<h2><span class="header-section-number">16.2</span> Web APIs</h2>
<p>API stands for <strong>Application Programming Interface</strong>. Broadly defined, an API a set of rules and procedures that facilitate interactions between computers and their applications.</p>
<p>A very common type of API is the <strong>Web API</strong>, which (among other things) allows users to query a remote database over the internet.</p>
<p>Web APIs take on a variety of formats, but the vast majority adhere to a particular style known as <strong>Reperesentational State Transfer</strong> or <strong>REST</strong>. What makes these “RESTful” APIs so convenient is that we can use them to query databases using URLs.</p>
<div id="restful-web-apis-are-all-around-you" class="section level4 unnumbered">
<h4>RESTful Web APIs are All Around You…</h4>
<p>Consider a simple Google search:</p>
<p><img src="img/google_search.png" width="70%" style="display: block; margin: auto;" /></p>
<p>Ever wonder what all that extra stuff in the address bar was all about? In this case, the full address is Google’s way of sending a query to its databases asking requesting information related to the search term “golden state warriors”.</p>
<p><img src="img/google_link.png" width="70%" style="display: block; margin: auto;" /></p>
<p>In fact, it looks like Google makes its query by taking the search terms, separating each of them with a “+”, and appending them to the link “<a href="https://www.google.com/#q" class="uri">https://www.google.com/#q</a>=”. Therefore, we should be able to actually change our Google search by adding some terms to the URL and following the general format…</p>
<p><img src="img/google_link_change.png" width="70%" style="display: block; margin: auto;" /></p>
<p>Learning how to use RESTful APIs is all about learning how to format these URLs so that you can get the response you want.</p>
</div>
<div id="some-basic-terminology" class="section level3">
<h3><span class="header-section-number">16.2.1</span> Some Basic Terminology</h3>
<p>Let’s get on the same page with some basic terminology:</p>
<ul>
<li><p><strong>Uniform Resource Location (URL)</strong>: a string of characters that, when interpreted via the Hypertext Transfer Protocol (HTTP), points to a data resource, notably files written in Hypertext Markup Language (HTML) or a subset of a database. This is often referred to as a “call”.</p></li>
<li><p><strong>HTTP Methods/Verbs</strong>:</p>
<ul>
<li><p><em>GET</em>: requests a representation of a data resource corresponding to a particular URL. The process of executing the GET method is often referred to as a “GET request” and is the main method used for querying RESTful databases.</p></li>
<li><p><em>HEAD</em>, <em>POST</em>, <em>PUT</em>, <em>DELETE</em>: other common methods, though mostly never used for database querying.</p></li>
</ul></li>
</ul>
</div>
<div id="how-do-get-requests-work" class="section level3">
<h3><span class="header-section-number">16.2.2</span> How Do GET Requests Work?</h3>
<div id="a-web-browsing-example" class="section level4 unnumbered">
<h4>A Web Browsing Example</h4>
<p>As you might suspect from the example above, surfing the web is basically equivalent to sending a bunch of <code>GET</code> requests to different servers and asking for different files written in HTML.</p>
<p>Suppose, for instance, I wanted to look something up on Wikipedia. My first step would be to open my web browser and type in <a href="http://www.wikipedia.org" class="uri">http://www.wikipedia.org</a>. Once I hit return, I’d see the page below.</p>
<p><img src="img/wikipedia.png" width="70%" style="display: block; margin: auto;" /></p>
<p>Several different processes occured, however, between me hitting “return” and the page finally being rendered. In order:</p>
<ol style="list-style-type: decimal">
<li><p>The web browser took the entered character string and used the command-line tool “Curl” to write a properly formatted HTTP GET request and submitted it to the server that hosts the Wikipedia homepage.</p></li>
<li><p>After receiving this request, the server sent an HTTP response, from which Curl extracted the HTML code for the page (partially shown below).</p></li>
<li><p>The raw HTML code was parsed and then executed by the web browser, rendering the page as seen in the window.</p></li>
</ol>
<pre><code>#&gt; No encoding supplied: defaulting to UTF-8.
#&gt; [1] &quot;&lt;!DOCTYPE html&gt;\n&lt;html lang=\&quot;mul\&quot; class=\&quot;no-js\&quot;&gt;\n&lt;head&gt;\n&lt;meta charset=\&quot;utf-8\&quot;&gt;\n&lt;title&gt;Wikipedia&lt;/title&gt;\n&lt;meta name=\&quot;description\&quot; content=\&quot;Wikipedia is a free online encyclopedia, created and edited by volunteers around the world and hosted by the Wikimedia Foundation.\&quot;&gt;\n&lt;![if gt IE 7]&gt;\n&lt;script&gt;\ndocument.documentElement.className = document.documentElement.className.replace( /(^|\\s)no-js(\\s|$)/, \&quot;$1js-enabled$2\&quot; );\n&lt;/script&gt;\n&lt;![endif]&gt;\n&lt;!--[if lt IE 7]&gt;&lt;meta http-equiv=\&quot;imagetoolbar\&quot; content=\&quot;no\&quot;&gt;&lt;![endif]--&gt;\n&lt;meta name=\&quot;viewport\&quot; content=\&quot;initial-scale=1,user-scalable=yes\&quot;&gt;\n&lt;link rel=\&quot;apple-touch-icon\&quot; href=\&quot;/static/apple-touch/wikipedia.png\&quot;&gt;\n&lt;link rel=\&quot;shortcut icon\&quot; href=\&quot;/static/favicon/wikipedia.ico\&quot;&gt;\n&lt;link rel=\&quot;license\&quot; href=\&quot;//creativecommons.org/licenses/by-sa/3.0/\&quot;&gt;\n&lt;style&gt;\n.sprite{background-image:url(portal/wikipedia.org/assets/img/sprite-81a290a5.png);background-image:linear-gradient(transparent,transparent),url(portal/wikipedia.org/assets/img/sprite-81a290a5.svg);background&quot;</code></pre>
</div>
<div id="web-browsing-as-a-template-for-restful-database-querying" class="section level4 unnumbered">
<h4>Web Browsing as a Template for RESTful Database Querying</h4>
<p>The process of web browsing described above is a close analogue for the process of database querying via RESTful APIs, with only a few adjustments:</p>
<ol style="list-style-type: decimal">
<li><p>While the Curl tool will still be used to send HTML GET requests to the servers hosting our databases of interest, the character string that we supply to Curl must be constructed so that the resulting request can be interpreted and succesfully acted upon by the server. In particular, it is likely that the character string must encode <strong>search terms and/or filtering parameters</strong>, as well as one or more <strong>authentication codes</strong>. While the terms are often similar across APIs, most are API-specific.</p></li>
<li><p>Unlike with web browsing, the content of the server’s response that is extracted by Curl is unlikely to be HTML code. Rather, it will likely be <strong>raw text response that can be parsed into one of a few file formats commonly used for data storage</strong>. The usual suspects include .csv, .xml, and .json files.</p></li>
<li><p>Whereas the web browser capably parsed and executed the HTML code, <strong>one or more facilities in R, Python, or other programming languages will be necessary for parsing the server response and converting it into a format for local storage</strong> (e.g. matrices, dataframes, databases, lists, etc.).</p></li>
</ol>
</div>
</div>
<div id="finding-apis" class="section level3">
<h3><span class="header-section-number">16.2.3</span> Finding APIs</h3>
<p>More and more APIs pop up every day. <a href="https://www.programmableweb.com/apis/directory">Programmable Web</a> offers a running list of APIs. <a href="https://ucsd.libguides.com/c.php?g=90743&amp;p=3202435">This list</a> provides a list of APIs that may be useful to Political Scientists.</p>
<p>Here are some APIs that may be useful to you:</p>
<ul>
<li><a href="http://developer.nytimes.com/">NYT Article API</a>: Provides metdata (title, summaries, dates, etc) from all New York Times articles in their archive.</li>
<li><a href="https://www.geonames.org/">GeoNames geographical database</a>: Provides lots of geographical information for all countries and other locations. The <code>geonames</code> package provides a wrapper for R.</li>
<li><a href="https://manifesto-project.wzb.eu/.">The Manifesto Project</a>: Provides text and other information on political party manifestos from around the world. It currently covers over 1000 parties from 1945 until today in over 50 countries on five continents. The <code>manifestoR</code> package provides a wrapper for R.</li>
<li><a href="https://www.census.gov/developers/">The Census Bureau</a>: Provides datasets from US Census Bureau. The <code>tidycensus</code> package allows users to interface with the US Census Bureau’s decennial Census and five-year American Community APIs.</li>
</ul>
</div>
<div id="getting-api-access" class="section level3">
<h3><span class="header-section-number">16.2.4</span> Getting API Access</h3>
<p>Most APIs requires a key or other user credentials before you can query their database.</p>
<p>Getting credentialized with a API requires that you register with the organization. Most APIs are set up for developers, so you’ll likely be asked to register an “application”. All this really entails is coming up with a name for your app/bot/project, and providing your real name, organization, and email. Note that some more popular APIs (e.g. Twitter, Facebook) will require additional information, such as a web address or mobile number.</p>
<p>Once you’ve successfully registered, you will be assigned one or more keys, tokens, or other credentials that must be supplied to the server as part of any API call you make. To make sure that users aren’t abusing their data access privileges (e.g. by making many rapid queries), each set of keys will be given <strong>rate limits</strong> governing the total number of calls that can be made over certain intervals of time.</p>
<p>For example, the NYT Article API has relatively generous rate limits — 4,000 requests per day and 10 requests per minute. So we need to “sleep”&quot; 6 seconds between calls to avoid hitting the per minute rate limit.</p>
<p><img src="img/nytimes_key.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<div id="using-apis-in-r" class="section level3">
<h3><span class="header-section-number">16.2.5</span> Using APIs in R</h3>
<p>There are two ways to collect data through APIs in R.</p>
<ol style="list-style-type: decimal">
<li><a href="#collecting-twitter-data-with-rtweet"><strong>Plug-n-play packages</strong></a></li>
</ol>
<p>Many common APIs are available through user-written R Packages. These packages offer functions that “wrap” API queries and format the response. These packages are usually much more convenient than writing our own query, so it’s worth searching around for a package that works with the API we need.</p>
<ol start="2" style="list-style-type: decimal">
<li><a href="#writing-api-queries"><strong>Writing our own API request</strong></a></li>
</ol>
<p>If no wrapper function is available, we have to write our own API request, and format the response ourslves using R. This is trickier, but definitely do-able.</p>
<!--chapter:end:14_Web/14-1_APIs.Rmd-->
</div>
</div>
<div id="collecting-twitter-data-with-rtweet" class="section level2">
<h2><span class="header-section-number">16.3</span> Collecting Twitter Data with RTweet</h2>
<p>Twitter actually has two separate APIs:</p>
<ol style="list-style-type: decimal">
<li>The <strong>REST API</strong> allows you to read and write Twitter data. For research purposes, this allows you to search the recent history of tweets and look up specific users.</li>
<li>The <strong>Streaming API</strong> allows you to access public data flowing through Twitter in real-time. It requires your R session to be running continuously, but allows you to capture a much larger sample of tweets while avoiding rate limits for the REST API.</li>
</ol>
<p>There are several packages for R for accessing and searching Twitter. In this unit, we’ll practice using the <code>RTweet</code> library, which allows us to easily collect data from Twitter’s REST and stream APIs.</p>
<div id="setting-up-rtweet" class="section level3">
<h3><span class="header-section-number">16.3.1</span> Setting up <code>RTweet</code></h3>
<p>To use <code>RTweet</code>, follow these steps:</p>
<ol style="list-style-type: decimal">
<li>If you don’t have a Twitter account, create one <a href="https://twitter.com/i/flow/signup">here</a>.</li>
<li>Install the <code>RTweet</code> package from CRAN.</li>
<li>Load the package into R.</li>
<li>Send a request to Twitter’s API by calling any of the package’s functions, like <code>search_tweets</code> or<code>get_timeline</code>.</li>
<li>Approve the browser popup (to authorize the <code>rstats2twitter</code> app).</li>
<li>Now, you’re ready to use RTweet!</li>
</ol>
<p>Let’s go ahead and load <code>RTweet</code> along with some other helpful functions:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(rtweet)
<span class="kw">library</span>(lubridate)
<span class="kw">library</span>(kableExtra)</code></pre></div>
</div>
<div id="uchicago-political-science-prof-tweets" class="section level3">
<h3><span class="header-section-number">16.3.2</span> UChicago Political Science Prof Tweets</h3>
<p>Let’s explore the <code>RTweet</code> package to see what we can learn about the tweeting habits of UChicago Political Science faculty.</p>
<p>The function <code>get_timeline</code> will pull the most recent <code>n</code> number of tweets from a given handle(s). To pull tweets from multiple handles, write out a vector of the handles in the <code>user</code> argument.</p>
<p>Let’s pull tweets from five faculty members in the department.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">profs &lt;-<span class="st"> </span><span class="kw">get_timeline</span>(
  <span class="dt">user =</span> <span class="kw">c</span>(<span class="st">&quot;carsonaust&quot;</span>, <span class="st">&quot;profpaulpoast&quot;</span>, <span class="st">&quot;pstanpolitics&quot;</span>, <span class="st">&quot;rochelleterman&quot;</span>, <span class="st">&quot;bobbygulotty&quot;</span>),
  <span class="dt">n =</span> <span class="dv">1000</span>
)
<span class="kw">kable</span>(<span class="kw">head</span>(profs))</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:left;">
user_id
</th>
<th style="text-align:left;">
status_id
</th>
<th style="text-align:left;">
created_at
</th>
<th style="text-align:left;">
screen_name
</th>
<th style="text-align:left;">
text
</th>
<th style="text-align:left;">
source
</th>
<th style="text-align:right;">
display_text_width
</th>
<th style="text-align:left;">
reply_to_status_id
</th>
<th style="text-align:left;">
reply_to_user_id
</th>
<th style="text-align:left;">
reply_to_screen_name
</th>
<th style="text-align:left;">
is_quote
</th>
<th style="text-align:left;">
is_retweet
</th>
<th style="text-align:right;">
favorite_count
</th>
<th style="text-align:right;">
retweet_count
</th>
<th style="text-align:right;">
quote_count
</th>
<th style="text-align:right;">
reply_count
</th>
<th style="text-align:left;">
hashtags
</th>
<th style="text-align:left;">
symbols
</th>
<th style="text-align:left;">
urls_url
</th>
<th style="text-align:left;">
urls_t.co
</th>
<th style="text-align:left;">
urls_expanded_url
</th>
<th style="text-align:left;">
media_url
</th>
<th style="text-align:left;">
media_t.co
</th>
<th style="text-align:left;">
media_expanded_url
</th>
<th style="text-align:left;">
media_type
</th>
<th style="text-align:left;">
ext_media_url
</th>
<th style="text-align:left;">
ext_media_t.co
</th>
<th style="text-align:left;">
ext_media_expanded_url
</th>
<th style="text-align:left;">
ext_media_type
</th>
<th style="text-align:left;">
mentions_user_id
</th>
<th style="text-align:left;">
mentions_screen_name
</th>
<th style="text-align:left;">
lang
</th>
<th style="text-align:left;">
quoted_status_id
</th>
<th style="text-align:left;">
quoted_text
</th>
<th style="text-align:left;">
quoted_created_at
</th>
<th style="text-align:left;">
quoted_source
</th>
<th style="text-align:right;">
quoted_favorite_count
</th>
<th style="text-align:right;">
quoted_retweet_count
</th>
<th style="text-align:left;">
quoted_user_id
</th>
<th style="text-align:left;">
quoted_screen_name
</th>
<th style="text-align:left;">
quoted_name
</th>
<th style="text-align:right;">
quoted_followers_count
</th>
<th style="text-align:right;">
quoted_friends_count
</th>
<th style="text-align:right;">
quoted_statuses_count
</th>
<th style="text-align:left;">
quoted_location
</th>
<th style="text-align:left;">
quoted_description
</th>
<th style="text-align:left;">
quoted_verified
</th>
<th style="text-align:left;">
retweet_status_id
</th>
<th style="text-align:left;">
retweet_text
</th>
<th style="text-align:left;">
retweet_created_at
</th>
<th style="text-align:left;">
retweet_source
</th>
<th style="text-align:right;">
retweet_favorite_count
</th>
<th style="text-align:right;">
retweet_retweet_count
</th>
<th style="text-align:left;">
retweet_user_id
</th>
<th style="text-align:left;">
retweet_screen_name
</th>
<th style="text-align:left;">
retweet_name
</th>
<th style="text-align:right;">
retweet_followers_count
</th>
<th style="text-align:right;">
retweet_friends_count
</th>
<th style="text-align:right;">
retweet_statuses_count
</th>
<th style="text-align:left;">
retweet_location
</th>
<th style="text-align:left;">
retweet_description
</th>
<th style="text-align:left;">
retweet_verified
</th>
<th style="text-align:left;">
place_url
</th>
<th style="text-align:left;">
place_name
</th>
<th style="text-align:left;">
place_full_name
</th>
<th style="text-align:left;">
place_type
</th>
<th style="text-align:left;">
country
</th>
<th style="text-align:left;">
country_code
</th>
<th style="text-align:left;">
geo_coords
</th>
<th style="text-align:left;">
coords_coords
</th>
<th style="text-align:left;">
bbox_coords
</th>
<th style="text-align:left;">
status_url
</th>
<th style="text-align:left;">
name
</th>
<th style="text-align:left;">
location
</th>
<th style="text-align:left;">
description
</th>
<th style="text-align:left;">
url
</th>
<th style="text-align:left;">
protected
</th>
<th style="text-align:right;">
followers_count
</th>
<th style="text-align:right;">
friends_count
</th>
<th style="text-align:right;">
listed_count
</th>
<th style="text-align:right;">
statuses_count
</th>
<th style="text-align:right;">
favourites_count
</th>
<th style="text-align:left;">
account_created_at
</th>
<th style="text-align:left;">
verified
</th>
<th style="text-align:left;">
profile_url
</th>
<th style="text-align:left;">
profile_expanded_url
</th>
<th style="text-align:left;">
account_lang
</th>
<th style="text-align:left;">
profile_banner_url
</th>
<th style="text-align:left;">
profile_background_url
</th>
<th style="text-align:left;">
profile_image_url
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
805833715
</td>
<td style="text-align:left;">
1178009054695870464
</td>
<td style="text-align:left;">
1569694219
</td>
<td style="text-align:left;">
carsonaust
</td>
<td style="text-align:left;">
“I have never seen a more buttoned-up set of whistleblower allegations than these.” <a href="https://t.co/0kttzYrDlg" class="uri">https://t.co/0kttzYrDlg</a>
</td>
<td style="text-align:left;">
Twitter for iPhone
</td>
<td style="text-align:right;">
124
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
thehill.com/opinion/white-…
</td>
<td style="text-align:left;">
<a href="https://t.co/0kttzYrDlg" class="uri">https://t.co/0kttzYrDlg</a>
</td>
<td style="text-align:left;">
<a href="https://thehill.com/opinion/white-house/463396-the-intelligence-community-strikes-back-an-impeachment-game-changer?amp&amp;__twitter_impression=true" class="uri">https://thehill.com/opinion/white-house/463396-the-intelligence-community-strikes-back-an-impeachment-game-changer?amp&amp;__twitter_impression=true</a>
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
26591796
</td>
<td style="text-align:left;">
jonrlindsay
</td>
<td style="text-align:left;">
en
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
1177994523953291265
</td>
<td style="text-align:left;">
“I have never seen a more buttoned-up set of whistleblower allegations than these.” <a href="https://t.co/0kttzYrDlg" class="uri">https://t.co/0kttzYrDlg</a>
</td>
<td style="text-align:left;">
1569690755
</td>
<td style="text-align:left;">
Twitter for Android
</td>
<td style="text-align:right;">
47
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:left;">
26591796
</td>
<td style="text-align:left;">
jonrlindsay
</td>
<td style="text-align:left;">
Jon Lindsay
</td>
<td style="text-align:right;">
676
</td>
<td style="text-align:right;">
507
</td>
<td style="text-align:right;">
748
</td>
<td style="text-align:left;">
Toronto, Ontario
</td>
<td style="text-align:left;">
Assistant Professor of Digital Media and Global Affairs at the University of Toronto, Munk School of Global Affairs
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
c(NA, NA)
</td>
<td style="text-align:left;">
c(NA, NA)
</td>
<td style="text-align:left;">
c(NA, NA, NA, NA, NA, NA, NA, NA)
</td>
<td style="text-align:left;">
<a href="https://twitter.com/carsonaust/status/1178009054695870464" class="uri">https://twitter.com/carsonaust/status/1178009054695870464</a>
</td>
<td style="text-align:left;">
Austin Carson
</td>
<td style="text-align:left;">
Chicago, IL
</td>
<td style="text-align:left;">
Assistant Professor @ University of Chicago, author of <em>Secret Wars: Covert Conflict in International Politics</em>. Dad &amp; NBA / Pistons enthusiast
</td>
<td style="text-align:left;">
<a href="https://t.co/kApIyoe7RG" class="uri">https://t.co/kApIyoe7RG</a>
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:right;">
1887
</td>
<td style="text-align:right;">
1007
</td>
<td style="text-align:right;">
23
</td>
<td style="text-align:right;">
1516
</td>
<td style="text-align:right;">
2623
</td>
<td style="text-align:left;">
1346896669
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
<a href="https://t.co/kApIyoe7RG" class="uri">https://t.co/kApIyoe7RG</a>
</td>
<td style="text-align:left;">
<a href="https://austinmcarson.com/" class="uri">https://austinmcarson.com/</a>
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
<a href="https://pbs.twimg.com/profile_banners/805833715/1533067436" class="uri">https://pbs.twimg.com/profile_banners/805833715/1533067436</a>
</td>
<td style="text-align:left;">
<a href="http://abs.twimg.com/images/themes/theme1/bg.png" class="uri">http://abs.twimg.com/images/themes/theme1/bg.png</a>
</td>
<td style="text-align:left;">
<a href="http://pbs.twimg.com/profile_images/1024384740181336064/ROqTG_uN_normal.jpg" class="uri">http://pbs.twimg.com/profile_images/1024384740181336064/ROqTG_uN_normal.jpg</a>
</td>
</tr>
<tr>
<td style="text-align:left;">
805833715
</td>
<td style="text-align:left;">
1177755874061893632
</td>
<td style="text-align:left;">
1569633856
</td>
<td style="text-align:left;">
carsonaust
</td>
<td style="text-align:left;">
<p>Open the super secret safe and ya never know what might pop out!</p>
<a href="https://t.co/EOTm6UuUlP" class="uri">https://t.co/EOTm6UuUlP</a>
</td>
<td style="text-align:left;">
Twitter for iPhone
</td>
<td style="text-align:right;">
89
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
washingtonpost.com/national-secur…
</td>
<td style="text-align:left;">
<a href="https://t.co/EOTm6UuUlP" class="uri">https://t.co/EOTm6UuUlP</a>
</td>
<td style="text-align:left;">
<a href="https://www.washingtonpost.com/national-security/trump-told-russian-officials-in-2017-he-wasnt-concerned-about-moscows-interference-in-us-election/2019/09/27/b20a8bc8-e159-11e9-b199-f638bf2c340f_story.html" class="uri">https://www.washingtonpost.com/national-security/trump-told-russian-officials-in-2017-he-wasnt-concerned-about-moscows-interference-in-us-election/2019/09/27/b20a8bc8-e159-11e9-b199-f638bf2c340f_story.html</a>
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
en
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
c(NA, NA)
</td>
<td style="text-align:left;">
c(NA, NA)
</td>
<td style="text-align:left;">
c(NA, NA, NA, NA, NA, NA, NA, NA)
</td>
<td style="text-align:left;">
<a href="https://twitter.com/carsonaust/status/1177755874061893632" class="uri">https://twitter.com/carsonaust/status/1177755874061893632</a>
</td>
<td style="text-align:left;">
Austin Carson
</td>
<td style="text-align:left;">
Chicago, IL
</td>
<td style="text-align:left;">
Assistant Professor @ University of Chicago, author of <em>Secret Wars: Covert Conflict in International Politics</em>. Dad &amp; NBA / Pistons enthusiast
</td>
<td style="text-align:left;">
<a href="https://t.co/kApIyoe7RG" class="uri">https://t.co/kApIyoe7RG</a>
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:right;">
1887
</td>
<td style="text-align:right;">
1007
</td>
<td style="text-align:right;">
23
</td>
<td style="text-align:right;">
1516
</td>
<td style="text-align:right;">
2623
</td>
<td style="text-align:left;">
1346896669
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
<a href="https://t.co/kApIyoe7RG" class="uri">https://t.co/kApIyoe7RG</a>
</td>
<td style="text-align:left;">
<a href="https://austinmcarson.com/" class="uri">https://austinmcarson.com/</a>
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
<a href="https://pbs.twimg.com/profile_banners/805833715/1533067436" class="uri">https://pbs.twimg.com/profile_banners/805833715/1533067436</a>
</td>
<td style="text-align:left;">
<a href="http://abs.twimg.com/images/themes/theme1/bg.png" class="uri">http://abs.twimg.com/images/themes/theme1/bg.png</a>
</td>
<td style="text-align:left;">
<a href="http://pbs.twimg.com/profile_images/1024384740181336064/ROqTG_uN_normal.jpg" class="uri">http://pbs.twimg.com/profile_images/1024384740181336064/ROqTG_uN_normal.jpg</a>
</td>
</tr>
<tr>
<td style="text-align:left;">
805833715
</td>
<td style="text-align:left;">
1177748049587789825
</td>
<td style="text-align:left;">
1569631991
</td>
<td style="text-align:left;">
carsonaust
</td>
<td style="text-align:left;">
<span class="citation">(<span class="citeproc-not-found" data-reference-id="AudieKlotz"><strong>???</strong></span>)</span> Yes and an age pattern, too
</td>
<td style="text-align:left;">
Twitter for iPhone
</td>
<td style="text-align:right;">
27
</td>
<td style="text-align:left;">
1177726535073193984
</td>
<td style="text-align:left;">
769622588
</td>
<td style="text-align:left;">
AudieKlotz
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
769622588
</td>
<td style="text-align:left;">
AudieKlotz
</td>
<td style="text-align:left;">
en
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
c(NA, NA)
</td>
<td style="text-align:left;">
c(NA, NA)
</td>
<td style="text-align:left;">
c(NA, NA, NA, NA, NA, NA, NA, NA)
</td>
<td style="text-align:left;">
<a href="https://twitter.com/carsonaust/status/1177748049587789825" class="uri">https://twitter.com/carsonaust/status/1177748049587789825</a>
</td>
<td style="text-align:left;">
Austin Carson
</td>
<td style="text-align:left;">
Chicago, IL
</td>
<td style="text-align:left;">
Assistant Professor @ University of Chicago, author of <em>Secret Wars: Covert Conflict in International Politics</em>. Dad &amp; NBA / Pistons enthusiast
</td>
<td style="text-align:left;">
<a href="https://t.co/kApIyoe7RG" class="uri">https://t.co/kApIyoe7RG</a>
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:right;">
1887
</td>
<td style="text-align:right;">
1007
</td>
<td style="text-align:right;">
23
</td>
<td style="text-align:right;">
1516
</td>
<td style="text-align:right;">
2623
</td>
<td style="text-align:left;">
1346896669
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
<a href="https://t.co/kApIyoe7RG" class="uri">https://t.co/kApIyoe7RG</a>
</td>
<td style="text-align:left;">
<a href="https://austinmcarson.com/" class="uri">https://austinmcarson.com/</a>
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
<a href="https://pbs.twimg.com/profile_banners/805833715/1533067436" class="uri">https://pbs.twimg.com/profile_banners/805833715/1533067436</a>
</td>
<td style="text-align:left;">
<a href="http://abs.twimg.com/images/themes/theme1/bg.png" class="uri">http://abs.twimg.com/images/themes/theme1/bg.png</a>
</td>
<td style="text-align:left;">
<a href="http://pbs.twimg.com/profile_images/1024384740181336064/ROqTG_uN_normal.jpg" class="uri">http://pbs.twimg.com/profile_images/1024384740181336064/ROqTG_uN_normal.jpg</a>
</td>
</tr>
<tr>
<td style="text-align:left;">
805833715
</td>
<td style="text-align:left;">
1177646359903645698
</td>
<td style="text-align:left;">
1569607746
</td>
<td style="text-align:left;">
carsonaust
</td>
<td style="text-align:left;">
<span class="citation">(<span class="citeproc-not-found" data-reference-id="anthlittle"><strong>???</strong></span>)</span> <span class="citation">(<span class="citeproc-not-found" data-reference-id="dhnexon"><strong>???</strong></span>)</span> So defensive, <span class="citation">(<span class="citeproc-not-found" data-reference-id="anthlittle"><strong>???</strong></span>)</span>
</td>
<td style="text-align:left;">
Twitter Web App
</td>
<td style="text-align:right;">
25
</td>
<td style="text-align:left;">
1177630296876797953
</td>
<td style="text-align:left;">
522685909
</td>
<td style="text-align:left;">
anthlittle
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
c(“522685909”, “55015468”, “522685909”)
</td>
<td style="text-align:left;">
c(“anthlittle”, “dhnexon”, “anthlittle”)
</td>
<td style="text-align:left;">
en
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
c(NA, NA)
</td>
<td style="text-align:left;">
c(NA, NA)
</td>
<td style="text-align:left;">
c(NA, NA, NA, NA, NA, NA, NA, NA)
</td>
<td style="text-align:left;">
<a href="https://twitter.com/carsonaust/status/1177646359903645698" class="uri">https://twitter.com/carsonaust/status/1177646359903645698</a>
</td>
<td style="text-align:left;">
Austin Carson
</td>
<td style="text-align:left;">
Chicago, IL
</td>
<td style="text-align:left;">
Assistant Professor @ University of Chicago, author of <em>Secret Wars: Covert Conflict in International Politics</em>. Dad &amp; NBA / Pistons enthusiast
</td>
<td style="text-align:left;">
<a href="https://t.co/kApIyoe7RG" class="uri">https://t.co/kApIyoe7RG</a>
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:right;">
1887
</td>
<td style="text-align:right;">
1007
</td>
<td style="text-align:right;">
23
</td>
<td style="text-align:right;">
1516
</td>
<td style="text-align:right;">
2623
</td>
<td style="text-align:left;">
1346896669
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
<a href="https://t.co/kApIyoe7RG" class="uri">https://t.co/kApIyoe7RG</a>
</td>
<td style="text-align:left;">
<a href="https://austinmcarson.com/" class="uri">https://austinmcarson.com/</a>
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
<a href="https://pbs.twimg.com/profile_banners/805833715/1533067436" class="uri">https://pbs.twimg.com/profile_banners/805833715/1533067436</a>
</td>
<td style="text-align:left;">
<a href="http://abs.twimg.com/images/themes/theme1/bg.png" class="uri">http://abs.twimg.com/images/themes/theme1/bg.png</a>
</td>
<td style="text-align:left;">
<a href="http://pbs.twimg.com/profile_images/1024384740181336064/ROqTG_uN_normal.jpg" class="uri">http://pbs.twimg.com/profile_images/1024384740181336064/ROqTG_uN_normal.jpg</a>
</td>
</tr>
<tr>
<td style="text-align:left;">
805833715
</td>
<td style="text-align:left;">
1177626170583584773
</td>
<td style="text-align:left;">
1569602932
</td>
<td style="text-align:left;">
carsonaust
</td>
<td style="text-align:left;">
Secret Wars, by <span class="citation">(<span class="citeproc-not-found" data-reference-id="UChicago"><strong>???</strong></span>)</span>’s own <span class="citation">(<span class="citeproc-not-found" data-reference-id="carsonaust"><strong>???</strong></span>)</span>, recently won the 2018 Lepgold Book Prize in international affairs. Dr. Carson and <span class="citation">(<span class="citeproc-not-found" data-reference-id="pstanpolitics"><strong>???</strong></span>)</span> (a previous winner) join <span class="citation">(<span class="citeproc-not-found" data-reference-id="tyfys_podcast"><strong>???</strong></span>)</span> to discuss the book and other topics in #civmil relations <span class="citation">(<span class="citeproc-not-found" data-reference-id="HarrisPolicy"><strong>???</strong></span>)</span> <a href="https://t.co/eiFGyuCyHZ" class="uri">https://t.co/eiFGyuCyHZ</a>
</td>
<td style="text-align:left;">
Twitter Web App
</td>
<td style="text-align:right;">
140
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
c(“1055833950403334145”, “131144285”, “805833715”)
</td>
<td style="text-align:left;">
c(“tyfys_podcast”, “UChicago”, “carsonaust”)
</td>
<td style="text-align:left;">
en
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
1177618081616560128
</td>
<td style="text-align:left;">
Secret Wars, by <span class="citation">(<span class="citeproc-not-found" data-reference-id="UChicago"><strong>???</strong></span>)</span>’s own <span class="citation">(<span class="citeproc-not-found" data-reference-id="carsonaust"><strong>???</strong></span>)</span>, recently won the 2018 Lepgold Book Prize in international affairs. Dr. Carson and <span class="citation">(<span class="citeproc-not-found" data-reference-id="pstanpolitics"><strong>???</strong></span>)</span> (a previous winner) join <span class="citation">(<span class="citeproc-not-found" data-reference-id="tyfys_podcast"><strong>???</strong></span>)</span> to discuss the book and other topics in #civmil relations <span class="citation">(<span class="citeproc-not-found" data-reference-id="HarrisPolicy"><strong>???</strong></span>)</span> <a href="https://t.co/eiFGyuCyHZ" class="uri">https://t.co/eiFGyuCyHZ</a>
</td>
<td style="text-align:left;">
1569601004
</td>
<td style="text-align:left;">
Twitter Web App
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
1055833950403334145
</td>
<td style="text-align:left;">
tyfys_podcast
</td>
<td style="text-align:left;">
“Thank You For Your Service” Podcast
</td>
<td style="text-align:right;">
363
</td>
<td style="text-align:right;">
153
</td>
<td style="text-align:right;">
255
</td>
<td style="text-align:left;">
University of Chicago
</td>
<td style="text-align:left;">
A Hard Look at American Civil-Military Affairs from <span class="citation">(<span class="citeproc-not-found" data-reference-id="TheUC3P"><strong>???</strong></span>)</span> <span class="citation">(<span class="citeproc-not-found" data-reference-id="HarrisPolicy"><strong>???</strong></span>)</span> | Hosted by <span class="citation">(<span class="citeproc-not-found" data-reference-id="krasnican_"><strong>???</strong></span>)</span> &amp; <span class="citation">(<span class="citeproc-not-found" data-reference-id="na_paraiso"><strong>???</strong></span>)</span> | New episodes coming soon!
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
c(NA, NA)
</td>
<td style="text-align:left;">
c(NA, NA)
</td>
<td style="text-align:left;">
c(NA, NA, NA, NA, NA, NA, NA, NA)
</td>
<td style="text-align:left;">
<a href="https://twitter.com/carsonaust/status/1177626170583584773" class="uri">https://twitter.com/carsonaust/status/1177626170583584773</a>
</td>
<td style="text-align:left;">
Austin Carson
</td>
<td style="text-align:left;">
Chicago, IL
</td>
<td style="text-align:left;">
Assistant Professor @ University of Chicago, author of <em>Secret Wars: Covert Conflict in International Politics</em>. Dad &amp; NBA / Pistons enthusiast
</td>
<td style="text-align:left;">
<a href="https://t.co/kApIyoe7RG" class="uri">https://t.co/kApIyoe7RG</a>
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:right;">
1887
</td>
<td style="text-align:right;">
1007
</td>
<td style="text-align:right;">
23
</td>
<td style="text-align:right;">
1516
</td>
<td style="text-align:right;">
2623
</td>
<td style="text-align:left;">
1346896669
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
<a href="https://t.co/kApIyoe7RG" class="uri">https://t.co/kApIyoe7RG</a>
</td>
<td style="text-align:left;">
<a href="https://austinmcarson.com/" class="uri">https://austinmcarson.com/</a>
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
<a href="https://pbs.twimg.com/profile_banners/805833715/1533067436" class="uri">https://pbs.twimg.com/profile_banners/805833715/1533067436</a>
</td>
<td style="text-align:left;">
<a href="http://abs.twimg.com/images/themes/theme1/bg.png" class="uri">http://abs.twimg.com/images/themes/theme1/bg.png</a>
</td>
<td style="text-align:left;">
<a href="http://pbs.twimg.com/profile_images/1024384740181336064/ROqTG_uN_normal.jpg" class="uri">http://pbs.twimg.com/profile_images/1024384740181336064/ROqTG_uN_normal.jpg</a>
</td>
</tr>
<tr>
<td style="text-align:left;">
805833715
</td>
<td style="text-align:left;">
1177618566625058816
</td>
<td style="text-align:left;">
1569601120
</td>
<td style="text-align:left;">
carsonaust
</td>
<td style="text-align:left;">
<span class="citation">(<span class="citeproc-not-found" data-reference-id="dhnexon"><strong>???</strong></span>)</span> Gasp! It can’t be true!
</td>
<td style="text-align:left;">
Twitter Web App
</td>
<td style="text-align:right;">
23
</td>
<td style="text-align:left;">
1177617758756003840
</td>
<td style="text-align:left;">
55015468
</td>
<td style="text-align:left;">
dhnexon
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
55015468
</td>
<td style="text-align:left;">
dhnexon
</td>
<td style="text-align:left;">
en
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
c(NA, NA)
</td>
<td style="text-align:left;">
c(NA, NA)
</td>
<td style="text-align:left;">
c(NA, NA, NA, NA, NA, NA, NA, NA)
</td>
<td style="text-align:left;">
<a href="https://twitter.com/carsonaust/status/1177618566625058816" class="uri">https://twitter.com/carsonaust/status/1177618566625058816</a>
</td>
<td style="text-align:left;">
Austin Carson
</td>
<td style="text-align:left;">
Chicago, IL
</td>
<td style="text-align:left;">
Assistant Professor @ University of Chicago, author of <em>Secret Wars: Covert Conflict in International Politics</em>. Dad &amp; NBA / Pistons enthusiast
</td>
<td style="text-align:left;">
<a href="https://t.co/kApIyoe7RG" class="uri">https://t.co/kApIyoe7RG</a>
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:right;">
1887
</td>
<td style="text-align:right;">
1007
</td>
<td style="text-align:right;">
23
</td>
<td style="text-align:right;">
1516
</td>
<td style="text-align:right;">
2623
</td>
<td style="text-align:left;">
1346896669
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
<a href="https://t.co/kApIyoe7RG" class="uri">https://t.co/kApIyoe7RG</a>
</td>
<td style="text-align:left;">
<a href="https://austinmcarson.com/" class="uri">https://austinmcarson.com/</a>
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
<a href="https://pbs.twimg.com/profile_banners/805833715/1533067436" class="uri">https://pbs.twimg.com/profile_banners/805833715/1533067436</a>
</td>
<td style="text-align:left;">
<a href="http://abs.twimg.com/images/themes/theme1/bg.png" class="uri">http://abs.twimg.com/images/themes/theme1/bg.png</a>
</td>
<td style="text-align:left;">
<a href="http://pbs.twimg.com/profile_images/1024384740181336064/ROqTG_uN_normal.jpg" class="uri">http://pbs.twimg.com/profile_images/1024384740181336064/ROqTG_uN_normal.jpg</a>
</td>
</tr>
</tbody>
</table>
<p>Now, let’s visualize which professors are tweeting the most, by week.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">profs <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(screen_name) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">created_at =</span> <span class="kw">as.Date</span>(created_at)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(created_at <span class="op">&gt;=</span><span class="st"> &quot;2019-06-15&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ts_plot</span>(<span class="dt">by =</span> <span class="st">&quot;week&quot;</span>)</code></pre></div>
<p><img src="site1_files/figure-html/unnamed-chunk-451-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<div id="hashtags-and-text-strings" class="section level3">
<h3><span class="header-section-number">16.3.3</span> Hashtags and Text Strings</h3>
<p>We can also use <code>RTweet</code> to explore certain hashtags or text strings.</p>
<p>Let’s take Duke Ellington again – we can use <code>search_tweets</code> to pull the most recent n number of tweets that include the hashtag <code>#DukeEllington</code> or the string <code>&quot;Duke Ellington&quot;</code>.</p>
<div id="hashtag-challenge" class="section level4 unnumbered">
<h4>Hashtag Challenge</h4>
<p>Using the documentation for <code>search_tweets</code> as a guide, try pulling the 2,000 most recent tweets that include <code>#DukeEllington</code> or <code>&quot;Duke Ellington&quot;</code> – be sure to exclude retweets from the query.</p>
<ol style="list-style-type: decimal">
<li><p>Why didn’t your query return 2,000 results?</p></li>
<li><p>Identify the user that has used either the hashtag or the string in the greatest number of tweets – where is this user from?</p></li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">duke &lt;-<span class="st"> </span><span class="kw">search_tweets</span>(
  <span class="dt">q =</span> <span class="st">&#39;#DukeEllington OR &quot;Duke Ellington&quot;&#39;</span>,
  <span class="dt">n =</span> <span class="dv">2000</span>,
  <span class="dt">include_rts =</span> <span class="ot">FALSE</span>
)

duke <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(user_id, location) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">n =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(n))
<span class="co">#&gt; # A tibble: 657 x 3</span>
<span class="co">#&gt; # Groups:   user_id [657]</span>
<span class="co">#&gt;   user_id             location                           n</span>
<span class="co">#&gt;   &lt;chr&gt;               &lt;chr&gt;                          &lt;int&gt;</span>
<span class="co">#&gt; 1 2561373848          Florida, USA                      91</span>
<span class="co">#&gt; 2 764290456599396353  Rochester, New York               51</span>
<span class="co">#&gt; 3 1030069194539368448 &quot;&quot;                                34</span>
<span class="co">#&gt; 4 1022122568004894720 &quot;&quot;                                33</span>
<span class="co">#&gt; 5 714738130557992960  Chiclana de la Frontera, Spain    28</span>
<span class="co">#&gt; 6 826869114           Paris, Ile-de-France              27</span>
<span class="co">#&gt; # … with 651 more rows</span></code></pre></div>
<!--chapter:end:14_Web/14-2_RTweet.Rmd-->
</div>
</div>
</div>
<div id="writing-api-queries" class="section level2">
<h2><span class="header-section-number">16.4</span> Writing API Queries</h2>
<p>If no wrapper package is available, we have to write our own API query, and format the response ourslves using R. This is trickier, but definitely do-able.</p>
<p>In this unit, we’ll practice constructing our own API queries using the New York Time’s <code>Article API</code>. This API provides metadata (title, date, summary, etc) on all of New York Times articles.</p>
<p>Fortunately, this API is <a href="https://developer.nytimes.com/docs/articlesearch-product/1/overview">very well documented</a>!</p>
<p>You can even try it out <a href="http://developer.nytimes.com/io-docs">here</a>.</p>
<p>Load the following packages to get started:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(httr)
<span class="kw">library</span>(jsonlite)
<span class="kw">library</span>(lubridate)</code></pre></div>
<div id="constructing-the-api-get-request" class="section level3">
<h3><span class="header-section-number">16.4.1</span> Constructing the API GET Request</h3>
<p>Likely the most challenging part of using web APIs is learning how to format your GET request URLs. While there are common architectures for such URLs, each API has its own unique quirks. For this reason, carefully reviewing the API documentation is critical.</p>
<p>Most GET request URLs for API querying have three or four components:</p>
<ol style="list-style-type: decimal">
<li><p><em>Authenication Key/Token</em>: a user-specific character string appended to a base URL telling the server who is making the query; allows servers to efficiently manage database access</p></li>
<li><p><em>Base URL</em>: a link stub that will be at the beginning of all calls to a given API; points the server to the location of an entire database</p></li>
<li><p><em>Search Parameters</em>: a character string appended to a base URL that tells the server what to extract from the database; basically a series of filters used to point to specific parts of a database</p></li>
<li><p><em>Response Format</em>: a character string indicating how the response should be formatted; usually one of .csv, .json, or .xml</p></li>
</ol>
<p>Let’s go ahead and store the these values as variables:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">key &lt;-<span class="st"> &quot;Onz0BobMTn2IRJ7krcT5RXHknkGLqiaI&quot;</span>
base.url &lt;-<span class="st"> &quot;http://api.nytimes.com/svc/search/v2/articlesearch.json&quot;</span>
search_term &lt;-<span class="st"> &quot;Beyonce&quot;</span></code></pre></div>
<p>How did I know the <code>base.url</code>? I read the <a href="https://developer.nytimes.com/docs/articlesearch-product/1/routes/articlesearch.json/get">documentation.</a>. Notice that this <code>base.url</code> also includes the <em>response format</em>(<code>.jston</code>), so we don’t need to configure that directly.</p>
<p>We’re ready to make the request. We can use the <code>GET</code> function from the <code>httr</code> package (another <code>tidyverse</code> package) to make an HTTP GET Request.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">r &lt;-<span class="st"> </span><span class="kw">GET</span>(base.url, <span class="dt">query =</span> <span class="kw">list</span>(<span class="st">`</span><span class="dt">q</span><span class="st">`</span> =<span class="st"> </span>search_term,
                                <span class="st">`</span><span class="dt">api-key</span><span class="st">`</span> =<span class="st"> </span>key))</code></pre></div>
<p>Now, we have an object called <code>r</code>. We can get all the information we need from this object. For instance, we can see that the URL has been correctly encoded by printing the URL. Click on the link to see what happens.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">r<span class="op">$</span>url
<span class="co">#&gt; [1] &quot;http://api.nytimes.com/svc/search/v2/articlesearch.json?q=Beyonce&amp;api-key=Onz0BobMTn2IRJ7krcT5RXHknkGLqiaI&quot;</span></code></pre></div>
<div id="challenge-1-adding-a-date-range" class="section level4 unnumbered">
<h4>Challenge 1: Adding a date range</h4>
<p>What if we only want to search within a particular date range? The NYT Article Api allows us to specify start and end dates.</p>
<p>Alter the <code>get.request</code> code above so that the request only searches for articles in the year 2005.</p>
<p>You’re gonna need to look at the documentation here to see how to do this.</p>
</div>
<div id="challenge-2-specifying-a-results-page" class="section level4 unnumbered">
<h4>Challenge 2: Specifying a results page</h4>
<p>The above will return the first 10 results. To get the next ten, you need to add a “page” parameter. Change the search parameters above to get the second 10 resuls.</p>
</div>
</div>
<div id="parsing-the-response" class="section level3">
<h3><span class="header-section-number">16.4.2</span> Parsing the response</h3>
<p>We can read the content of the server’s response using the <code>content()</code> function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">response &lt;-<span class="st"> </span><span class="kw">content</span>(r, <span class="st">&quot;text&quot;</span>)
<span class="kw">substr</span>(response, <span class="dt">start =</span> <span class="dv">1</span>, <span class="dt">stop =</span> <span class="dv">1000</span>)
<span class="co">#&gt; [1] &quot;{\&quot;status\&quot;:\&quot;OK\&quot;,\&quot;copyright\&quot;:\&quot;Copyright (c) 2019 The New York Times Company. All Rights Reserved.\&quot;,\&quot;response\&quot;:{\&quot;docs\&quot;:[{\&quot;web_url\&quot;:\&quot;https://www.nytimes.com/2019/07/19/movies/beyonce-lion-king.html\&quot;,\&quot;snippet\&quot;:\&quot;The superstar is all over the 2019 remake’s promotional tour. But how much of her will you hear in the actual film? We counted her lines.\&quot;,\&quot;lead_paragraph\&quot;:\&quot;To hear Beyoncé speak is such a rare occurrence that any new instance of it, no matter how fleeting, feels special, like catching a glimpse of a shooting star. So naturally, her involvement with Disney’s remake of “The Lion King”— she voices the adult Nala and created a companion album featuring new music inspired by the movie — has dominated the film’s promotional tour, complete with a meeting between Queen Bey and Meghan, Duchess of Sussex,  at the British premiere.\&quot;,\&quot;abstract\&quot;:\&quot;The superstar is all over the 2019 remake’s promotional tour. But how much of her will you hear in the actual film? We counted her lines.\&quot;,\&quot;print_page\&quot;&quot;</span></code></pre></div>
<p>What you see here is JSON text, encoded as plain text. JSON stands for “Javascript object notation.” Think of JASON like a nested array built on key/value pairs.</p>
<p>We want to convert the results from JSON format to something easier to work with – notably a data.frame.</p>
<p>The <strong>jsonlite</strong> package provides several easy conversion functions for moving between JSON and vectors, data.frames, and lists. Let’s use the function <code>fromJSON</code> to convert this response into something we can work with:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Convert JSON response to a dataframe</span>
response_df &lt;-<span class="st"> </span><span class="kw">fromJSON</span>(response, <span class="dt">simplifyDataFrame =</span> <span class="ot">TRUE</span>, <span class="dt">flatten =</span> <span class="ot">TRUE</span>)

<span class="co"># Inspect the dataframe</span>
<span class="kw">str</span>(response_df, <span class="dt">max.level =</span> <span class="dv">2</span>)
<span class="co">#&gt; List of 3</span>
<span class="co">#&gt;  $ status   : chr &quot;OK&quot;</span>
<span class="co">#&gt;  $ copyright: chr &quot;Copyright (c) 2019 The New York Times Company. All Rights Reserved.&quot;</span>
<span class="co">#&gt;  $ response :List of 2</span>
<span class="co">#&gt;   ..$ docs:&#39;data.frame&#39;: 10 obs. of  27 variables:</span>
<span class="co">#&gt;   ..$ meta:List of 3</span></code></pre></div>
<p>That looks intimidating! But it’s really just a big, nested list. Let’s see what we got in there.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span>(response_df)
<span class="co">#&gt; [1] &quot;status&quot;    &quot;copyright&quot; &quot;response&quot;</span>

<span class="co"># This is boring</span>
response_df<span class="op">$</span>status
<span class="co">#&gt; [1] &quot;OK&quot;</span>

<span class="co"># So is this</span>
response_df<span class="op">$</span>copyright
<span class="co">#&gt; [1] &quot;Copyright (c) 2019 The New York Times Company. All Rights Reserved.&quot;</span>

<span class="co"># This is what we want!</span>
<span class="kw">names</span>(response_df<span class="op">$</span>response)
<span class="co">#&gt; [1] &quot;docs&quot; &quot;meta&quot;</span></code></pre></div>
<p>Within <code>response_df$response</code>, we can extract a number of interesting results, including the number of total hits, as well as information on the first ten documents:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># What&#39;s in &#39;meta&#39;?</span>
response_df<span class="op">$</span>response<span class="op">$</span>meta
<span class="co">#&gt; $hits</span>
<span class="co">#&gt; [1] 3885</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $offset</span>
<span class="co">#&gt; [1] 0</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $time</span>
<span class="co">#&gt; [1] 13</span>

<span class="co"># pull out number of hits</span>
response_df<span class="op">$</span>response<span class="op">$</span>meta<span class="op">$</span>hits
<span class="co">#&gt; [1] 3885</span>

<span class="co"># Check out docs</span>
<span class="kw">names</span>(response_df<span class="op">$</span>response<span class="op">$</span>docs)
<span class="co">#&gt;  [1] &quot;web_url&quot;                 &quot;snippet&quot;                </span>
<span class="co">#&gt;  [3] &quot;lead_paragraph&quot;          &quot;abstract&quot;               </span>
<span class="co">#&gt;  [5] &quot;print_page&quot;              &quot;source&quot;                 </span>
<span class="co">#&gt;  [7] &quot;multimedia&quot;              &quot;keywords&quot;               </span>
<span class="co">#&gt;  [9] &quot;pub_date&quot;                &quot;document_type&quot;          </span>
<span class="co">#&gt; [11] &quot;news_desk&quot;               &quot;section_name&quot;           </span>
<span class="co">#&gt; [13] &quot;type_of_material&quot;        &quot;_id&quot;                    </span>
<span class="co">#&gt; [15] &quot;word_count&quot;              &quot;uri&quot;                    </span>
<span class="co">#&gt; [17] &quot;subsection_name&quot;         &quot;headline.main&quot;          </span>
<span class="co">#&gt; [19] &quot;headline.kicker&quot;         &quot;headline.content_kicker&quot;</span>
<span class="co">#&gt; [21] &quot;headline.print_headline&quot; &quot;headline.name&quot;          </span>
<span class="co">#&gt; [23] &quot;headline.seo&quot;            &quot;headline.sub&quot;           </span>
<span class="co">#&gt; [25] &quot;byline.original&quot;         &quot;byline.person&quot;          </span>
<span class="co">#&gt; [27] &quot;byline.organization&quot;</span>

<span class="co"># put it in another variable</span>
docs &lt;-<span class="st"> </span>response_df<span class="op">$</span>response<span class="op">$</span>docs</code></pre></div>
</div>
<div id="iteration-through-results-pager" class="section level3">
<h3><span class="header-section-number">16.4.3</span> Iteration through results pager</h3>
<p>That’s great. But we only have 10 items. The original response said we had 3,876 hits! Which means we have to make 3876 /10, or 18 requests to get them all. Sounds like a job for iteration!</p>
<p>First, let’s write a function that passes a search term and a page number, and returns a dataframe of articles.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nytapi &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">term =</span> <span class="ot">NULL</span>, n){
    base.url =<span class="st"> &quot;http://api.nytimes.com/svc/search/v2/articlesearch.json&quot;</span> 
    key =<span class="st"> &quot;Onz0BobMTn2IRJ7krcT5RXHknkGLqiaI&quot;</span>
    
    <span class="co"># Send GET request</span>
    r &lt;-<span class="st"> </span><span class="kw">GET</span>(base.url, <span class="dt">query =</span> <span class="kw">list</span>(<span class="st">`</span><span class="dt">q</span><span class="st">`</span> =<span class="st"> </span>term,
                                  <span class="st">`</span><span class="dt">api-key</span><span class="st">`</span> =<span class="st"> </span>key,
                                  <span class="st">`</span><span class="dt">page</span><span class="st">`</span> =<span class="st"> </span>n))
    
    <span class="co"># Parse response to JSON</span>
    response &lt;-<span class="st"> </span><span class="kw">content</span>(r, <span class="st">&quot;text&quot;</span>)  
    response_df &lt;-<span class="st"> </span><span class="kw">fromJSON</span>(response, <span class="dt">simplifyDataFrame =</span> T, <span class="dt">flatten =</span> T)
    
    <span class="kw">return</span>(response_df<span class="op">$</span>response<span class="op">$</span>docs)
}

docs &lt;-<span class="st"> </span><span class="kw">nytapi</span>(<span class="st">&quot;Duke Ellington&quot;</span>, <span class="dv">2</span>)</code></pre></div>
<p>Now, we’re ready to iterate over each page. First, let’s review what’ve done so far:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># set key and base</span>
base.url =<span class="st"> &quot;http://api.nytimes.com/svc/search/v2/articlesearch.json&quot;</span> 
key =<span class="st"> &quot;Onz0BobMTn2IRJ7krcT5RXHknkGLqiaI&quot;</span>
search_term =<span class="st"> &quot;fleek&quot;</span>
  
<span class="co"># Send GET request</span>
r &lt;-<span class="st"> </span><span class="kw">GET</span>(base.url, <span class="dt">query =</span> <span class="kw">list</span>(<span class="st">`</span><span class="dt">q</span><span class="st">`</span> =<span class="st"> </span>search_term,
                                <span class="st">`</span><span class="dt">api-key</span><span class="st">`</span> =<span class="st"> </span>key))
  
<span class="co"># Parse response to JSON</span>
response &lt;-<span class="st"> </span><span class="kw">content</span>(r, <span class="st">&quot;text&quot;</span>)  
response_df &lt;-<span class="st"> </span><span class="kw">fromJSON</span>(response, <span class="dt">simplifyDataFrame =</span> T, <span class="dt">flatten =</span> T)

<span class="co"># extract hits</span>
hits =<span class="st"> </span>response_df<span class="op">$</span>response<span class="op">$</span>meta<span class="op">$</span>hits

<span class="co"># get number of pages</span>
pages =<span class="st"> </span><span class="kw">ceiling</span>(hits<span class="op">/</span><span class="dv">10</span>)

<span class="co"># iterate over pages, getting all docs</span>
docs_list &lt;-<span class="st"> </span><span class="kw">map</span>((<span class="dv">1</span><span class="op">:</span>pages), <span class="op">~</span><span class="kw">nytapi</span>(<span class="dt">term =</span> search_term, <span class="dt">n =</span> .))

<span class="co"># flatten to create one bit dataframe</span>
docs_df &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(docs_list)</code></pre></div>
</div>
<div id="visualizing-results" class="section level3">
<h3><span class="header-section-number">16.4.4</span> Visualizing Results</h3>
<p>To figure out how Adam Rippon’s’s popularity is changing over time, all we need to do is add an indicator for the year and month each article was published in.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Format pub_date using lubridate</span>
docs_df<span class="op">$</span>date &lt;-<span class="st"> </span><span class="kw">ymd_hms</span>(docs_df<span class="op">$</span>pub_date)

by_month &lt;-<span class="st"> </span>docs_df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(<span class="kw">floor_date</span>(date, <span class="st">&quot;month&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">count  =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">rename</span>(<span class="dt">month =</span> <span class="dv">1</span>)

by_month <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> month, <span class="dt">y =</span> count)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">xlab</span>(<span class="dt">label =</span> <span class="st">&quot;Date&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">ylab</span>(<span class="dt">label =</span> <span class="st">&quot;Article Count&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="dt">label =</span> <span class="st">&quot;Coverage of X&quot;</span>)</code></pre></div>
<p><img src="site1_files/figure-html/unnamed-chunk-464-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<div id="more-resources-1" class="section level3">
<h3><span class="header-section-number">16.4.5</span> More resources</h3>
<p>The documentation for httr includes two useful vignettes:</p>
<ol style="list-style-type: decimal">
<li><a href="https://cran.r-project.org/web/packages/httr/vignettes/quickstart.html">httr quickstart guide</a> - summarizes all the basic httr functions like above</li>
<li><a href="https://cran.r-project.org/web/packages/httr/vignettes/api-packages.html">Best practices for writing an API package</a> - document outlining the key issues involved in writing API wrappers in R</li>
</ol>
<!--chapter:end:14_Web/14-3_Queries.Rmd-->
</div>
</div>
<div id="webscraping" class="section level2">
<h2><span class="header-section-number">16.5</span> Webscraping</h2>
<p>If no API is available, we can scrape a website directory. Webscraping has a number of benefits and challenges compared to APIs:</p>
<p><strong>Webscraping Benefits</strong></p>
<ul>
<li>Any content that can be viewed on a webpage can be scraped. <a href="https://blog.hartleybrody.com/web-scraping/">Period</a></li>
<li>No API needed</li>
<li>No rate-limiting or authentication (usually)</li>
</ul>
<p><strong>Webscraping Challenges</strong></p>
<ul>
<li>Rarely tailored for researchers</li>
<li>Messy, unstructured, inconsistent</li>
<li>Entirely site-dependent</li>
</ul>
<div id="some-disclaimers" class="section level4 unnumbered">
<h4>Some Disclaimers</h4>
<ul>
<li>Check a site’s terms and conditions before scraping.</li>
<li>Be nice - don’t hammer the site’s server.</li>
<li>Sites change their layout all the time. Your scraper will break.</li>
</ul>
</div>
<div id="whats-a-website" class="section level3">
<h3><span class="header-section-number">16.5.1</span> What’s a website?</h3>
<p>A website is some combination of codebase and database. The “front end” product is HTML + CSS stylesheets + javascript, looking something like this:</p>
<p><img src="img/html.png" width="70%" style="display: block; margin: auto;" /></p>
<p>Your browser turns that into a nice layout. <img src="img/layout.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<div id="html" class="section level3">
<h3><span class="header-section-number">16.5.2</span> HTML</h3>
<p>The core of a website is <strong>HTML</strong> (Hyper Text Markup Language.) HTML is composed of a tree of HTML _nodes<strong>elements</strong>, such as headers, paragraphs, etc.</p>
<div class="sourceCode"><pre class="sourceCode html"><code class="sourceCode html"><span class="dt">&lt;!DOCTYPE </span>html<span class="dt">&gt;</span>
<span class="kw">&lt;html&gt;</span>
    <span class="kw">&lt;head&gt;</span>
        <span class="kw">&lt;title&gt;</span>Page title<span class="kw">&lt;/title&gt;</span>
    <span class="kw">&lt;/head&gt;</span>
    <span class="kw">&lt;body&gt;</span>
        <span class="kw">&lt;p&gt;</span>Hello world!<span class="kw">&lt;/p&gt;</span>
    <span class="kw">&lt;/body&gt;</span>
<span class="kw">&lt;/html&gt;</span></code></pre></div>
<p>HTML elements can contain other elements:</p>
<p><img src="img/HTMLDOMTree.png" width="70%" style="display: block; margin: auto;" /></p>
<p>Generally speaking, an HTML element has three components:</p>
<ol style="list-style-type: decimal">
<li>Tags (starting and ending the element)</li>
<li>Atributes (giving information about the element)</li>
<li>Text, or Content (the text inside the element)</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">knitr<span class="op">::</span><span class="kw">include_graphics</span>(<span class="dt">path =</span> <span class="st">&quot;img/html-element.png&quot;</span>)</code></pre></div>
<p><img src="img/html-element.png" width="70%" style="display: block; margin: auto;" /></p>
<div id="html-tags" class="section level4 unnumbered">
<h4>HTML: Tags</h4>
<p><img src="img/html-tags.png" width="70%" style="display: block; margin: auto;" /></p>
<p><strong>Common HTML tags</strong></p>
<table>
<thead>
<tr class="header">
<th>Tag</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>&lt;head&gt;</code></td>
<td>page header (metadata, etc</td>
</tr>
<tr class="even">
<td><code>&lt;body&gt;</code></td>
<td>holds all of the content</td>
</tr>
<tr class="odd">
<td><code>&lt;p&gt;</code></td>
<td>regular text (paragraph)</td>
</tr>
<tr class="even">
<td><code>&lt;h1&gt;</code>,<code>&lt;h2&gt;</code>,<code>&lt;h3&gt;</code></td>
<td>header text, levels 1, 2, 3</td>
</tr>
<tr class="odd">
<td><code>ol,</code>,<code>&lt;ul&gt;</code>,<code>&lt;li&gt;</code></td>
<td>ordered list, unordered list, list item</td>
</tr>
<tr class="even">
<td><code>&lt;a href=&quot;page.html&quot;&gt;</code></td>
<td>link to “page.html”</td>
</tr>
<tr class="odd">
<td><code>&lt;table&gt;</code>,<code>&lt;tr&gt;</code>,<code>&lt;td&gt;</code></td>
<td>table, table row, table item</td>
</tr>
<tr class="even">
<td><code>&lt;div&gt;</code>,<code>&lt;span</code></td>
<td>general containers</td>
</tr>
</tbody>
</table>
</div>
<div id="html-attributes" class="section level4 unnumbered">
<h4>HTML Attributes</h4>
<ul>
<li>HTML elements can have attributes.</li>
<li>Attributes provide additional information about an element.</li>
<li>Attributes are always specified in the start tag.</li>
<li>Attributes come in name/value pairs like: name=“value”</li>
</ul>
<p><img src="img/html-attributes.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="css" class="section level3">
<h3><span class="header-section-number">16.5.3</span> CSS</h3>
<p>CSS stands for <strong>Cascading Style Sheet</strong>. CSS defines how HTML elements are to be displayed.</p>
<p>HTML came first. But it was only meant to define content, not format it. While HTML contains tags like <code>&lt;font&gt;</code> and <code>&lt;color&gt;</code>, this is a very inefficient way to develop a website.</p>
<p>To solve this problem, CSS was created specifically to display content on a webpage. Now, one can change the look of an entire website just by changing one file.</p>
<p>Most web designers litter the HTML markup with tons of <code>class</code>es and <code>id</code>s to provide “hooks” for their CSS.</p>
<p>You can piggyback on these to jump to the parts of the markup that contain the data you need.</p>
<div id="css-anatomy" class="section level4 unnumbered">
<h4>CSS Anatomy</h4>
<ul>
<li>Selectors
<ul>
<li>Element selector: <code>p</code>)</li>
<li>Class selector: <code>p class=&quot;blue&quot;</code></li>
<li>I.D. selector: <code>p id=&quot;blue&quot;</code></li>
</ul></li>
<li>Declarations
<ul>
<li>Selector: <code>p</code></li>
<li>Property: <code>background-color</code></li>
<li>Value: <code>yellow</code></li>
</ul></li>
<li>Hooks</li>
</ul>
<p><img src="img/css-rule-2.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<div id="css-html" class="section level4">
<h4><span class="header-section-number">16.5.3.1</span> CSS + HTML</h4>
<div class="sourceCode"><pre class="sourceCode html"><code class="sourceCode html"><span class="kw">&lt;body&gt;</span>
    <span class="kw">&lt;table</span><span class="ot"> id=</span><span class="st">&quot;content&quot;</span><span class="kw">&gt;</span>
        <span class="kw">&lt;tr</span><span class="ot"> class=</span><span class="st">&#39;name&#39;</span><span class="kw">&gt;</span>
            <span class="kw">&lt;td</span><span class="ot"> class=</span><span class="st">&#39;firstname&#39;</span><span class="kw">&gt;</span>
                Kurtis
            <span class="kw">&lt;/td&gt;</span>
            <span class="kw">&lt;td</span><span class="ot"> class=</span><span class="st">&#39;lastname&#39;</span><span class="kw">&gt;</span>
                McCoy
            <span class="kw">&lt;/td&gt;</span>
        <span class="kw">&lt;/tr&gt;</span>
        <span class="kw">&lt;tr</span><span class="ot"> class=</span><span class="st">&#39;name&#39;</span><span class="kw">&gt;</span>
            <span class="kw">&lt;td</span><span class="ot"> class=</span><span class="st">&#39;firstname&#39;</span><span class="kw">&gt;</span>
                Leah
            <span class="kw">&lt;/td&gt;</span>
            <span class="kw">&lt;td</span><span class="ot"> class=</span><span class="st">&#39;lastname&#39;</span><span class="kw">&gt;</span>
                Guerrero
            <span class="kw">&lt;/td&gt;</span>
        <span class="kw">&lt;/tr&gt;</span>
    <span class="kw">&lt;/table&gt;</span>
<span class="kw">&lt;/body&gt;</span></code></pre></div>
</div>
<div id="challenge-1-3" class="section level4 unnumbered">
<h4>Challenge 1</h4>
<p>Find the CSS selectors for the following elements in the HTML above.</p>
<p>(Hint: There will be multiple solutions for each)</p>
<ol style="list-style-type: decimal">
<li>The entire table</li>
<li>The row containing “Kurtis McCoy”</li>
<li>Just the element containing first names</li>
</ol>
</div>
</div>
<div id="finding-elements-with-selector-gadget" class="section level3">
<h3><span class="header-section-number">16.5.4</span> Finding Elements with Selector Gadget</h3>
<p>Selector Gadget is a browser plugin to help you find HTML elements. Install Selector Gadget on your browser by following [these instructions(<a href="https://selectorgadget.com/" class="uri">https://selectorgadget.com/</a>).</p>
<p>Once installed, run Selector Gadget and simply click on the type of information you want to select from the webpage. Once this is selected, you can then click the pieces of information you <strong>don’t</strong> want to keep. Do this until only the pieces you want to keep remain highlighted, then copy the selector from the bottom pane.</p>
<p>Here’s the basic strategy of webscraping:</p>
<ol style="list-style-type: decimal">
<li>Use Selector Gadget to see how your data is structured</li>
<li>Pay attention to HTML tags and CSS selectors</li>
<li>Pray that there is some kind of pattern</li>
<li>Use R and add-on modules like <code>RVest</code> to extract just that data.</li>
</ol>
<div id="challenge-2-3" class="section level4 unnumbered">
<h4>Challenge 2</h4>
<p>Go to <a href="http://rochelleterman.github.io/" class="uri">http://rochelleterman.github.io/</a>. Using Selector Gadget,</p>
<ol style="list-style-type: decimal">
<li>Find the CSS selector capturing all rows in the table.</li>
<li>Find the image source URL.</li>
<li>Find the HREF attribute of the link.</li>
</ol>
<!--chapter:end:14_Web/14-4_Webscraping.Rmd-->
</div>
</div>
</div>
<div id="scraping-presidential-statements" class="section level2">
<h2><span class="header-section-number">16.6</span> Scraping Presidential Statements</h2>
<p>To demonstrate webscraping in R, we’re going to collect records on presidential statements here: <a href="https://www.presidency.ucsb.edu/" class="uri">https://www.presidency.ucsb.edu/</a></p>
<p>Let’s say we’re interested in how presidents speak about “space exploration”. On the website, we punch in this search term, and we get the <a href="https://www.presidency.ucsb.edu/advanced-search?field-keywords=%22space+exploration%22&amp;field-keywords2=&amp;field-keywords3=&amp;from%5Bdate%5D=&amp;to%5Bdate%5D=&amp;person2=&amp;items_per_page=100">following 295 results</a>.</p>
<p>Our goal is to scrape these records, and store pertenant information in a dataframe.</p>
<p>Load the following packages to get started:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(rvest)
<span class="kw">library</span>(stringr)
<span class="kw">library</span>(purrr)
<span class="kw">library</span>(knitr)</code></pre></div>
<div id="using-rvest-to-read-html" class="section level3">
<h3><span class="header-section-number">16.6.1</span> Using <code>RVest</code> to Read HTML</h3>
<p>The package <code>RVest</code> allows us to:</p>
<ol style="list-style-type: decimal">
<li>Collect the HTML source code of a webpage</li>
<li>Read the HTML of the page</li>
<li>Select and keep certain elements of the page that are of interest</li>
</ol>
<p>Let’s start with step one. We use the <code>read_html</code> function to call the results URL and grab the HTML response. Store this result as an object.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">space &lt;-<span class="st"> </span><span class="kw">read_html</span>(<span class="st">&quot;https://www.presidency.ucsb.edu/advanced-search?field-keywords=%22space+exploration%22&amp;field-keywords2=&amp;field-keywords3=&amp;from%5Bdate%5D=&amp;to%5Bdate%5D=&amp;person2=&amp;items_per_page=100&quot;</span>)

<span class="co">#Let&#39;s take a look at the object we just created</span>
space
<span class="co">#&gt; {xml_document}</span>
<span class="co">#&gt; &lt;html lang=&quot;en&quot; dir=&quot;ltr&quot; prefix=&quot;content: http://purl.org/rss/1.0/modules/content/ dc: http://purl.org/dc/terms/ foaf: http://xmlns.com/foaf/0.1/ og: http://ogp.me/ns# rdfs: http://www.w3.org/2000/01/rdf-schema# sioc: http://rdfs.org/sioc/ns# sioct: http://rdfs.org/sioc/types# skos: http://www.w3.org/2004/02/skos/core# xsd: http://www.w3.org/2001/XMLSchema#&quot;&gt;</span>
<span class="co">#&gt; [1] &lt;head profile=&quot;http://www.w3.org/1999/xhtml/vocab&quot;&gt;\n&lt;meta charset=&quot; ...</span>
<span class="co">#&gt; [2] &lt;body class=&quot;html not-front not-logged-in one-sidebar sidebar-first  ...</span></code></pre></div>
<p>This is pretty messy. We need to use <code>RVest</code> to make this information more useable.</p>
</div>
<div id="find-page-elements" class="section level3">
<h3><span class="header-section-number">16.6.2</span> Find Page Elements</h3>
<p><code>RVest</code> has a number of functions to find information on a page. Like other webscraping tools, RVest lets you find elements by their:</p>
<ol style="list-style-type: decimal">
<li>HTML tags</li>
<li>HTML Attributes</li>
<li>CSS Selectors</li>
</ol>
<p>Let’s search first for HTML tags.</p>
<p>The function <code>html_nodes</code> searches a parsed HTML object to find all the elements with a particular HTML tag, and returns all of those elements.</p>
<p>What does the example below do?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">html_nodes</span>(space, <span class="st">&quot;a&quot;</span>)
<span class="co">#&gt; {xml_nodeset (227)}</span>
<span class="co">#&gt;  [1] &lt;a href=&quot;#main-content&quot; class=&quot;element-invisible element-focusable&quot; ...</span>
<span class="co">#&gt;  [2] &lt;a href=&quot;https://www.presidency.ucsb.edu/&quot;&gt;The American Presidency  ...</span>
<span class="co">#&gt;  [3] &lt;a class=&quot;btn btn-default&quot; href=&quot;https://www.presidency.ucsb.edu/ab ...</span>
<span class="co">#&gt;  [4] &lt;a class=&quot;btn btn-default&quot; href=&quot;/advanced-search&quot;&gt;&lt;span class=&quot;gly ...</span>
<span class="co">#&gt;  [5] &lt;a href=&quot;https://www.ucsb.edu/&quot; target=&quot;_blank&quot;&gt;&lt;img alt=&quot;ucsb word ...</span>
<span class="co">#&gt;  [6] &lt;a href=&quot;/documents&quot; class=&quot;dropdown-toggle&quot; data-toggle=&quot;dropdown&quot; ...</span>
<span class="co">#&gt;  [7] &lt;a href=&quot;/documents/presidential-documents-archive-guidebook&quot;&gt;Guide ...</span>
<span class="co">#&gt;  [8] &lt;a href=&quot;/documents/category-attributes&quot;&gt;Category Attributes&lt;/a&gt;</span>
<span class="co">#&gt;  [9] &lt;a href=&quot;/statistics&quot;&gt;Statistics&lt;/a&gt;</span>
<span class="co">#&gt; [10] &lt;a href=&quot;/media&quot; title=&quot;&quot;&gt;Media Archive&lt;/a&gt;</span>
<span class="co">#&gt; [11] &lt;a href=&quot;/presidents&quot; title=&quot;&quot;&gt;Presidents&lt;/a&gt;</span>
<span class="co">#&gt; [12] &lt;a href=&quot;/analyses&quot; title=&quot;&quot;&gt;Analyses&lt;/a&gt;</span>
<span class="co">#&gt; [13] &lt;a href=&quot;https://giving.ucsb.edu/Funds/Give?id=185&quot; title=&quot;&quot;&gt;Suppor ...</span>
<span class="co">#&gt; [14] &lt;a href=&quot;https://www.presidency.ucsb.edu/how-to-search&quot;&gt;MORE TIPS&lt;/a&gt;</span>
<span class="co">#&gt; [15] &lt;a id=&quot;main-content&quot;&gt;&lt;/a&gt;</span>
<span class="co">#&gt; [16] &lt;a href=&quot;/advanced-search?field-keywords=%22space%20exploration%22&amp; ...</span>
<span class="co">#&gt; [17] &lt;a href=&quot;/advanced-search?field-keywords=%22space%20exploration%22&amp; ...</span>
<span class="co">#&gt; [18] &lt;a href=&quot;/people/president/dwight-d-eisenhower&quot;&gt;Dwight D. Eisenhowe ...</span>
<span class="co">#&gt; [19] &lt;a href=&quot;/documents/special-message-the-congress-relative-space-sci ...</span>
<span class="co">#&gt; [20] &lt;a href=&quot;/people/president/dwight-d-eisenhower&quot;&gt;Dwight D. Eisenhowe ...</span>
<span class="co">#&gt; ...</span></code></pre></div>
<p>That’s a lot of results! Many elements on a page will have the same HTML tag. For instance, if you search for everything with the <code>a</code> tag, you’re likely to get a lot of stuff, much of which you don’t want.</p>
<p>In our case, we only want the links of Document Titles:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">knitr<span class="op">::</span><span class="kw">include_graphics</span>(<span class="dt">path =</span> <span class="st">&quot;img/scraping_links.png&quot;</span>)</code></pre></div>
<p><img src="img/scraping_links.png" width="70%" style="display: block; margin: auto;" /></p>
<p>What if we wanted to search for HTML tags <strong>only</strong> with certain attributes, like particular CSS classes?</p>
<p>We can do this by modifying our argument in <code>html_nodes</code> to look for a more specific CSS tag.</p>
<div id="selector-gadget" class="section level4 unnumbered">
<h4>Selector Gadget</h4>
<p>In order to easily identify these more specific tags, we can use <strong>Selector Gadget</strong>.</p>
<p>Install Selector Gadget in your browser. Once installed, run Selector Gadget and simply click on the type of information you want to select from the webpage. Once this is selected, you can then click the pieces of information you <strong>don’t</strong> want to keep. Do this until only the pieces you want to keep remain highlighted, then copy the selector from the bottom pane.</p>
<p>You can use this new tag in <code>html_nodes</code>.</p>
</div>
</div>
<div id="get-attributes-and-text-of-elements" class="section level3">
<h3><span class="header-section-number">16.6.3</span> Get Attributes and Text of Elements</h3>
<p>Once we identify elements, we want to access information in that element. Oftentimes this means two things:</p>
<ol style="list-style-type: decimal">
<li>Text</li>
<li>Attributes</li>
</ol>
<p>Getting the text inside an element is pretty straightforward. We can use the <code>html_text()</code> command inside of <code>RVest</code> to get the text of an element:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Scrape individual document page</span>
document1 &lt;-<span class="st"> </span><span class="kw">read_html</span>(<span class="st">&quot;https://www.presidency.ucsb.edu/documents/special-message-the-congress-relative-space-science-and-exploration&quot;</span>)

<span class="co">#identify element with Speaker name</span>
speaker &lt;-<span class="st"> </span><span class="kw">html_nodes</span>(document1, <span class="st">&quot;.diet-title a&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">html_text</span>() <span class="co">#select text of element</span>

speaker
<span class="co">#&gt; [1] &quot;Dwight D. Eisenhower&quot;</span></code></pre></div>
<p>You can access a tag’s attributes using <code>html_attr</code>. For example, we often want to get a URL from an <code>a</code> (link) element. This is the URL is the link “points” to. It’s contained in the attribut <code>href</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">speaker_link &lt;-<span class="st"> </span><span class="kw">html_nodes</span>(document1, <span class="st">&quot;.diet-title a&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">html_attr</span>(<span class="st">&quot;href&quot;</span>)
speaker_link
<span class="co">#&gt; [1] &quot;/people/president/dwight-d-eisenhower&quot;</span></code></pre></div>
</div>
<div id="lets-do-this." class="section level3">
<h3><span class="header-section-number">16.6.4</span> Let’s DO this.</h3>
<p>Believe it or not, that’s all you need to scrape a website. Let’s apply these skills to scrape a sample document from the UCSB website – the <a href="%22http://www.presidency.ucsb.edu/documents/letter-t-keith-glennan-administrator-national-aeronautics-and-space-administration%22">first item in our search results</a>.</p>
<p>We’ll collect the document’s date, speaker, title, and full text.</p>
<ol style="list-style-type: decimal">
<li>Date</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">document1 &lt;-<span class="st"> </span><span class="kw">read_html</span>(<span class="st">&quot;https://www.presidency.ucsb.edu/documents/special-message-the-congress-relative-space-science-and-exploration&quot;</span>)

date &lt;-<span class="st"> </span><span class="kw">html_nodes</span>(document1, <span class="st">&quot;.date-display-single&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">html_text</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># grab element text</span>
<span class="st">  </span><span class="kw">mdy</span>() <span class="co">#format using lubridate</span>
date
<span class="co">#&gt; [1] &quot;1958-04-02&quot;</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Speaker</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Speaker</span>
speaker &lt;-<span class="st"> </span><span class="kw">html_nodes</span>(document1, <span class="st">&quot;.diet-title a&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">html_text</span>()
speaker
<span class="co">#&gt; [1] &quot;Dwight D. Eisenhower&quot;</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Title</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Title</span>
title &lt;-<span class="st"> </span><span class="kw">html_nodes</span>(document1, <span class="st">&quot;h1&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">html_text</span>()
title
<span class="co">#&gt; [1] &quot;Special Message to the Congress Relative to Space Science and Exploration.&quot;</span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>Text</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Text</span>
text &lt;-<span class="st"> </span><span class="kw">html_nodes</span>(document1, <span class="st">&quot;div.field-docs-content&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">          </span><span class="kw">html_text</span>()

<span class="co">#this is a long document, so let&#39;s just display the first 1000 characters</span>
text <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">substr</span>(<span class="dv">1</span>, <span class="dv">1000</span>) 
<span class="co">#&gt; [1] &quot;\n    To the Congress of the United States:\nRecent developments in long-range rockets for military purposes have for the first time provided man with new machinery so powerful that it can put satellites into orbit, and eventually provide the means for space exploration. The United States of America and the Union of Soviet Socialist Republics have already successfully placed in orbit a number of earth satellites. In fact, it is now within the means of any technologically advanced nation to embark upon practicable programs for exploring outer space. The early enactment of appropriate legislation will help assure that the United States takes full advantage of the knowledge of its scientists, the skill of its engineers and technicians, and the resourcefulness of its industry in meeting the challenges of the space age.\nDuring the past several months my Special Assistant for Science and Technology and the President&#39;s Science Advisory Committee, of which he is the Chairman, have been conductin&quot;</span></code></pre></div>
</div>
<div id="challenge-1-make-a-function" class="section level3">
<h3><span class="header-section-number">16.6.5</span> Challenge 1: Make a function</h3>
<p>Make a function called <code>scrape_docs</code> that accepts a URL of an individual document, scrapes the page, and returns a list containing the document’s date, speaker, title, and full text.</p>
<p>This involves:</p>
<ul>
<li>Requesting the HTML of the webpage using the full URL and RVest.</li>
<li>Using RVest to locate all elements on the page we want to save.</li>
<li>Saving each of these items into a list.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">scrape_doc &lt;-<span class="st"> </span><span class="cf">function</span>(URL){
  doc &lt;-<span class="st"> </span><span class="kw">read_html</span>(URL)
  
  speaker &lt;-<span class="st"> </span><span class="kw">html_nodes</span>(doc, <span class="st">&quot;.diet-title a&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">                                        </span><span class="kw">html_text</span>()
  
  date &lt;-<span class="st"> </span><span class="kw">html_nodes</span>(doc, <span class="st">&quot;.date-display-single&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">                                        </span><span class="kw">html_text</span>() <span class="op">%&gt;%</span>
<span class="st">                                        </span><span class="kw">mdy</span>()
  
  title &lt;-<span class="st"> </span><span class="kw">html_nodes</span>(doc, <span class="st">&quot;h1&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">                                        </span><span class="kw">html_text</span>()
  
  text &lt;-<span class="st"> </span><span class="kw">html_nodes</span>(doc, <span class="st">&quot;div.field-docs-content&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">                                        </span><span class="kw">html_text</span>()
  
  <span class="kw">return</span>(<span class="kw">list</span>(<span class="dt">speaker =</span> speaker, <span class="dt">date =</span> date, <span class="dt">title =</span> title, <span class="dt">text =</span> text))
  
}

<span class="co"># uncomment to test</span>
<span class="co"># scrape_doc(&quot;https://www.presidency.ucsb.edu/documents/letter-t-keith-glennan-administrator-national-aeronautics-and-space-administration&quot;)</span></code></pre></div>
<!--chapter:end:14_Web/14-5_Webscraping_Demo.Rmd-->
</div>
</div>
</div>
<div id="part-assignments-and-projects" class="section level1 unnumbered">
<h1>(PART) Assignments and Projects</h1>
</div>
<div id="assignments-1" class="section level1">
<h1><span class="header-section-number">17</span> Assignments</h1>
<!--chapter:end:98_Assignments/98_0-Preamble.Rmd-->
<div id="assignment-1" class="section level2">
<h2><span class="header-section-number">17.1</span> Assignment 1</h2>
<ul>
<li><strong>Assigned</strong>: Oct 3, 2019.</li>
<li><strong>Due</strong>: Oct 10, 2019 at 12:29pm.</li>
</ul>
<p>For this assignment, you will confirm that everything is installed and setup correctly, and you understand how to interact with R Studio and R Markdown.</p>
<p>Your answers (to this assignment only) will be posted on our <a href="https://github.com/rochelleterman/plsc-31101">course website</a>.</p>
<div id="using-r-markdown" class="section level4 unnumbered">
<h4>1. Using R Markdown</h4>
<p>In the space below, insert a picture of yourself, and complete the following information:</p>
<p><code>[your picture here]</code></p>
<ol style="list-style-type: decimal">
<li><strong>Name</strong>:</li>
<li><strong>Department and degree program:</strong></li>
<li><strong>Year in the program:</strong></li>
<li><strong>One-sentence description of academic interests:</strong></li>
<li><strong>Some non-academic interests:</strong></li>
<li><strong>R version installed on your computer:</strong><a href="#fn2" class="footnoteRef" id="fnref2"><sup>2</sup></a></li>
<li><strong>R Studio version installed on your computer:</strong><a href="#fn3" class="footnoteRef" id="fnref3"><sup>3</sup></a></li>
</ol>
</div>
<div id="checking-packages" class="section level4 unnumbered">
<h4>2. Checking packages</h4>
<p>Create an R chunk below, where you load the <code>tidyverse</code> library.</p>
</div>
<div id="knit-and-submit." class="section level4 unnumbered">
<h4>3. Knit and submit.</h4>
<p>Knit the R Markdown file to HTML. Submit the HTML file to Canvas.</p>
<p>If you get an error trying to knit, read the error and make sure that your R code is correct. If that doesn’t work, confirm you’ve correctly installed the requisite packages (<code>knit</code>, <code>rmarkdown</code>). If you still can’t get it to work, paste the error on Canvas.</p>
<p>[hint1]: To find this information, open a command line window (‘terminal’ or, on windows, ‘git bash’), and enter the following command <code>R --version</code></p>
<!--chapter:end:98_Assignments/98_1-Setup.Rmd-->
</div>
</div>
<div id="assignment-2" class="section level2">
<h2><span class="header-section-number">17.2</span> Assignment 2</h2>
<ul>
<li><strong>Assigned</strong>:</li>
<li><strong>Due</strong>:</li>
</ul>
<p>For this assignment, you’ll use what you know about R syntax and data structures to perform some common data operations.</p>
<div id="basics" class="section level4 unnumbered">
<h4>1. Basics</h4>
<p><strong>1.1 Fix the following syntax errors. Enter your corrected code in the second chunk.</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 1</span>
states &lt;-<span class="st"> </span>(<span class="st">&quot;California&quot;</span>, <span class="st">&quot;Illinois&quot;</span>, <span class="st">&quot;Ohio&quot;</span>)

<span class="co"># 2</span>
countries &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Iran&quot;</span>, <span class="st">&quot;Indonesia,&quot;</span> <span class="st">&quot;India&quot;</span>, <span class="st">&quot;Italy&quot;</span>)

<span class="co"># 3</span>
df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">age =</span> <span class="kw">c</span>(<span class="dv">21</span>, <span class="dv">66</span>, <span class="dv">35</span>)
                 <span class="dt">party =</span> <span class="kw">c</span>(<span class="st">&#39;rep&#39;</span>, <span class="st">&#39;dem&#39;</span>, <span class="st">&#39;rep&#39;</span>))

<span class="co"># 4</span>
my<span class="op">-</span>vector &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;apples&quot;</span>, <span class="st">&quot;oranges&quot;</span>, <span class="st">&quot;kiwis&quot;</span>)

<span class="co"># 5</span>
artists &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">names =</span> <span class="kw">c</span>(<span class="st">&quot;Picasso&quot;</span>, <span class="st">&quot;Kahlo&quot;</span>,
                <span class="dt">genre =</span> <span class="kw">c</span>(<span class="st">&quot;cubist&quot;</span>, <span class="st">&quot;surrealist&quot;</span>))</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># PUT YOUR CORRECTED CODE HERE</span></code></pre></div>
<p><strong>1.2 How many arguments does the <code>order()</code> function pass? What are they?</strong></p>
</div>
<div id="vectors-and-lists" class="section level4 unnumbered">
<h4>2. Vectors and Lists</h4>
<p><strong>2.1 Create three vectors:</strong></p>
<ul>
<li><p>a character vector, <code>titles</code>, that contain the names of 3 of your favorite movies</p></li>
<li><p>a numeric vector, <code>year</code>, that contains the years in which those movies were produced</p></li>
<li><p>a boolean vector <code>bechdel</code> that TRUE/FALSE according to whether those movies pass the <a href="http://bechdeltest.com/">bechdel test</a></p></li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># YOUR CODE HERE</span></code></pre></div>
<p><strong>2.2 Put those three vectors in a list, called <code>movies</code>.</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># YOUR CODE HERE</span></code></pre></div>
<p><strong>2.3 Print the structure of the list <code>movies</code>.</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># YOUR CODE HERE</span></code></pre></div>
</div>
<div id="factors-1" class="section level4 unnumbered">
<h4>3. Factors</h4>
<p><strong>3.1 Here’s some code that prints a simple barplot:</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">f &lt;-<span class="st"> </span><span class="kw">factor</span>(<span class="kw">c</span>(<span class="st">&quot;low&quot;</span>,<span class="st">&quot;medium&quot;</span>,<span class="st">&quot;high&quot;</span>,<span class="st">&quot;medium&quot;</span>,<span class="st">&quot;high&quot;</span>,<span class="st">&quot;medium&quot;</span>))
<span class="kw">table</span>(f)
<span class="co">#&gt; f</span>
<span class="co">#&gt;   high    low medium </span>
<span class="co">#&gt;      2      1      3</span>
<span class="kw">barplot</span>(<span class="kw">table</span>(f))</code></pre></div>
<p><img src="site1_files/figure-html/unnamed-chunk-493-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p><strong>How would you relevel <code>f</code> to be in the correct order?</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># YOUR CODE HERE</span></code></pre></div>
</div>
<div id="dataframes-1" class="section level4 unnumbered">
<h4>4. Dataframes</h4>
<p><strong>4.1 Coerce the <code>movies</code> object you made above from a list to a dataframe. Call it <code>movies_df</code>.</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># YOUR CODE HERE</span></code></pre></div>
<p><strong>4.2 Add appropriate column names to <code>movies_df</code>.</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># YOUR CODE HERE</span></code></pre></div>
<!--chapter:end:98_Assignments/98_2-Syntax-Structures.Rmd-->
</div>
<div id="assignment-2-solutions" class="section level3">
<h3><span class="header-section-number">17.2.1</span> Assignment 2 Solutions</h3>
<ul>
<li><strong>Assigned</strong>:</li>
<li><strong>Due</strong>:</li>
</ul>
<p>For this assignment, you’ll use what you know about R syntax and data structures to perform some common data operations.</p>
<div id="basics-1" class="section level4 unnumbered">
<h4>1. Basics</h4>
<p><strong>1.1 Fix the following syntax errors. Enter your corrected code in the second chunk.</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 1</span>
states &lt;-<span class="st"> </span>(<span class="st">&quot;California&quot;</span>, <span class="st">&quot;Illinois&quot;</span>, <span class="st">&quot;Ohio&quot;</span>)

<span class="co"># 2</span>
countries &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Iran&quot;</span>, <span class="st">&quot;Indonesia,&quot;</span> <span class="st">&quot;India&quot;</span>, <span class="st">&quot;Italy&quot;</span>)

<span class="co"># 3</span>
df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">age =</span> <span class="kw">c</span>(<span class="dv">21</span>, <span class="dv">66</span>, <span class="dv">35</span>)
                 <span class="dt">party =</span> <span class="kw">c</span>(<span class="st">&#39;rep&#39;</span>, <span class="st">&#39;dem&#39;</span>, <span class="st">&#39;rep&#39;</span>))

<span class="co"># 4</span>
my<span class="op">-</span>vector &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;apples&quot;</span>, <span class="st">&quot;oranges&quot;</span>, <span class="st">&quot;kiwis&quot;</span>)

<span class="co"># 5</span>
artists &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">names =</span> <span class="kw">c</span>(<span class="st">&quot;Picasso&quot;</span>, <span class="st">&quot;Kahlo&quot;</span>,
                <span class="dt">genre =</span> <span class="kw">c</span>(<span class="st">&quot;cubist&quot;</span>, <span class="st">&quot;surrealist&quot;</span>))</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># PUT YOUR CORRECTED CODE HERE</span>

<span class="co"># 1</span>
states &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;California&quot;</span>, <span class="st">&quot;Illinois&quot;</span>, <span class="st">&quot;Ohio&quot;</span>)

<span class="co"># 2</span>
countries &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Iran&quot;</span>, <span class="st">&quot;Indonesia&quot;</span>, <span class="st">&quot;India&quot;</span>, <span class="st">&quot;Italy&quot;</span>)

<span class="co"># 3</span>
df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">age =</span> <span class="kw">c</span>(<span class="dv">21</span>, <span class="dv">66</span>, <span class="dv">35</span>),
                 <span class="dt">party =</span> <span class="kw">c</span>(<span class="st">&#39;rep&#39;</span>, <span class="st">&#39;dem&#39;</span>, <span class="st">&#39;rep&#39;</span>))

<span class="co"># 4</span>
my_vector &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;apples&quot;</span>, <span class="st">&quot;oranges&quot;</span>, <span class="st">&quot;kiwis&quot;</span>)

<span class="co"># 5</span>
artists &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">names =</span> <span class="kw">c</span>(<span class="st">&quot;Picasso&quot;</span>, <span class="st">&quot;Kahlo&quot;</span>),
                <span class="dt">genre =</span> <span class="kw">c</span>(<span class="st">&quot;cubist&quot;</span>, <span class="st">&quot;surrealist&quot;</span>))</code></pre></div>
<p><strong>1.2 How many arguments does the <code>order()</code> function pass? What are they?</strong></p>
</div>
<div id="vectors-and-lists-1" class="section level4 unnumbered">
<h4>2. Vectors and Lists</h4>
<p><strong>2.1 Create three vectors:</strong></p>
<ul>
<li><p>a character vector, <code>titles</code>, that contain the names of 3 of your favorite movies</p></li>
<li><p>a numeric vector, <code>year</code>, that contains the years in which those movies were produced</p></li>
<li><p>a boolean vector <code>bechdel</code> that TRUE/FALSE according to whether those movies pass the <a href="http://bechdeltest.com/">bechdel test</a></p></li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">titles &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Dog Day Afternoon&quot;</span>, <span class="st">&quot;The Graduate&quot;</span>, <span class="st">&quot;Breakfast Club&quot;</span>)
year &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1975</span>, <span class="dv">1967</span>, <span class="dv">1985</span>)
bechdel &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="ot">TRUE</span>, <span class="ot">FALSE</span>, <span class="ot">TRUE</span>)</code></pre></div>
<p><strong>2.2 Put those three vectors in a list, called <code>movies</code>.</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">movies &lt;-<span class="st"> </span><span class="kw">list</span>(titles, year, bechdel)</code></pre></div>
<p><strong>2.3 Print the structure of the list <code>movies</code>.</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(movies)
<span class="co">#&gt; List of 3</span>
<span class="co">#&gt;  $ : chr [1:3] &quot;Dog Day Afternoon&quot; &quot;The Graduate&quot; &quot;Breakfast Club&quot;</span>
<span class="co">#&gt;  $ : num [1:3] 1975 1967 1985</span>
<span class="co">#&gt;  $ : logi [1:3] TRUE FALSE TRUE</span></code></pre></div>
</div>
<div id="factors-2" class="section level4 unnumbered">
<h4>3. Factors</h4>
<p><strong>3.1 Here’s some code that prints a simple barplot:</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">f &lt;-<span class="st"> </span><span class="kw">factor</span>(<span class="kw">c</span>(<span class="st">&quot;low&quot;</span>,<span class="st">&quot;medium&quot;</span>,<span class="st">&quot;high&quot;</span>,<span class="st">&quot;medium&quot;</span>,<span class="st">&quot;high&quot;</span>,<span class="st">&quot;medium&quot;</span>))
<span class="kw">table</span>(f)
<span class="co">#&gt; f</span>
<span class="co">#&gt;   high    low medium </span>
<span class="co">#&gt;      2      1      3</span>
<span class="kw">barplot</span>(<span class="kw">table</span>(f))</code></pre></div>
<p><img src="site1_files/figure-html/unnamed-chunk-503-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p><strong>How would you relevel <code>f</code> to be in the correct order?</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">f &lt;-<span class="st"> </span><span class="kw">factor</span>(f, <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;low&quot;</span>, <span class="st">&quot;medium&quot;</span>, <span class="st">&quot;high&quot;</span>))

<span class="co"># Test your code</span>
<span class="kw">barplot</span>(<span class="kw">table</span>(f))</code></pre></div>
<p><img src="site1_files/figure-html/unnamed-chunk-504-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<div id="dataframes-2" class="section level4 unnumbered">
<h4>4. Dataframes</h4>
<p><strong>4.1 Coerce the <code>movies</code> object you made above from a list to a dataframe. Call it <code>movies_df</code>.</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">movies_df &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(movies)</code></pre></div>
<p><strong>4.2 Add appropriate column names to <code>movies_df</code>.</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span>(movies) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;film&quot;</span>, <span class="st">&quot;year&quot;</span>, <span class="st">&quot;bechtel&quot;</span>)</code></pre></div>
<!--chapter:end:98_Assignments/98_2A-Syntax-Structures-SOLUTIONS.Rmd-->
</div>
</div>
</div>
<div id="assignment-3" class="section level2">
<h2><span class="header-section-number">17.3</span> Assignment 3</h2>
<p>For this assignment, you’ll be working on some real life data! I’ve prepared for your a basic country-year dataset, with the following variables:</p>
<ul>
<li>Country name</li>
<li>Country numerical code</li>
<li>Year</li>
<li>UN Ideal point</li>
<li>Polity2 score of regime type (from Polity VI)</li>
<li>Physical Integrity Rights score (from CIRI dataset)</li>
<li>Speech Rights score (from CIRI)</li>
<li>GDP per capita (from World Bank)</li>
<li>Population (from World Bank)</li>
<li>Political Terror Scale using Amnesty International reports (from Political Terror Scale project)</li>
<li>Composite Index of Military Capabilities (Correlates of War)</li>
<li>Region</li>
</ul>
<div id="r-projects-and-importing" class="section level4 unnumbered">
<h4>1. R Projects and Importing</h4>
<p><strong>1.1 Initialize a project where you store this <code>.Rmd</code> file. Using <code>getwd()</code>, print your working directory below.</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#YOUR CODE HERE</span></code></pre></div>
<p><strong>1.2 Download the <code>country-year.csv</code> file and store it in a subdirectory of your project called <code>data</code>.</strong></p>
<p><strong>Read <code>country-year.csv</code> into R, using a relative path. Store it in an object called <code>dat</code>.</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#YOUR CODE HERE</span></code></pre></div>
</div>
<div id="dimensions-and-names" class="section level4 unnumbered">
<h4>2. Dimensions and Names</h4>
<p><strong>2.1 How many rows and columns are in the dataset?</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#YOUR CODE HERE</span></code></pre></div>
<p><strong>2.2 Print the column names.</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#YOUR CODE HERE</span></code></pre></div>
<p><strong>2.3 Remove the <code>X</code> column from the dataset.</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#YOUR CODE HERE</span></code></pre></div>
<p><strong>2.4 One of the variables is called “gdp.pc.wdi”. This stands for “Gross Domestic Product Per Capita, from the World Bank Development Indicators”. Change this variable name in the dataset from &quot; “gdp.pc.wdi” to “GDP”</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#YOUR CODE HERE</span></code></pre></div>
</div>
<div id="summarizing" class="section level4 unnumbered">
<h4>3. Summarizing</h4>
<p><strong>3.1 How many years are covered in the dataset?</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#YOUR CODE HERE</span></code></pre></div>
<p><strong>3.2 How many unique countries are covered in the dataset?</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#YOUR CODE HERE</span></code></pre></div>
<p><strong>3.3 What is the range of <code>polity2</code>? How many NAs are in this column?</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#YOUR CODE HERE</span></code></pre></div>
</div>
<div id="subsetting-1" class="section level4 unnumbered">
<h4>4. Subsetting</h4>
<p><strong>4.1 Subset the data so that it returns the third column AS ITS OWN A DATAFRAME.</strong> (Do not print the object; store it in a variable.)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#YOUR CODE HERE</span></code></pre></div>
<p><strong>4.2 Subset gapminder so that it returns the third column AS A VECTOR</strong> (Do not print the object; store it in a variable.)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#YOUR CODE HERE</span></code></pre></div>
<p><strong>4.3 Fix each of the following common data frame subsetting errors</strong>:</p>
<ol style="list-style-type: decimal">
<li>Extract observations collected for the year 1980</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat[dat<span class="op">$</span>year =<span class="st"> </span><span class="dv">1980</span>,]

<span class="co"># Corrected</span>
<span class="co"># YOUR CODE HERE</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Extract all columns except 1 through to 4</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat[,<span class="op">-</span><span class="dv">1</span><span class="op">:</span><span class="dv">4</span>]

<span class="co"># Corrected</span>
<span class="co"># YOUR CODE HERE</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Extract the rows where the polity2 score is greater than 5</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat[dat<span class="op">$</span>polity2 <span class="op">&gt;</span><span class="st"> </span><span class="dv">5</span>]

<span class="co"># corrected</span>
<span class="co"># YOUR CODE HERE</span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>Extract the first row, and the third and fourth columns (<code>country</code> and <code>idealpoint</code>).</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat[<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">4</span>]

<span class="co"># Corrected</span>
<span class="co"># YOUR CODE HERE</span></code></pre></div>
<ol start="5" style="list-style-type: decimal">
<li>Extract rows that contain information for the years 2002 and 2007</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat[dat<span class="op">$</span>year <span class="op">==</span><span class="st"> </span><span class="dv">2002</span> <span class="op">|</span><span class="st"> </span><span class="dv">2007</span>,]

<span class="co"># Corrected</span>
<span class="co"># YOUR CODE HERE</span></code></pre></div>
<p><strong>4.4 What does <code>summary(dat$polity2[dat$region ==&quot;Africa&quot;])</code> do? Explain below in your own words.</strong></p>
<p><strong>4.5 Subset the data to include only observations from years 1990-2000 (inclusive). Put the subsetted data in a new variable called <code>dat.1990.2000</code></strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># YOUR CODE HERE</span></code></pre></div>
<p><strong>4.6 Using <code>mean()</code> function, tell me the average GDP of observations from 1990 to 2000.</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># YOUR CODE HERE</span></code></pre></div>
<p><strong>4.7 You just calculated the average GDP for years 1990-2000. Now calculate the average GDP from 2001 onwards. Tell me how much larger it is (in percentage).</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># YOUR CODE HERE</span></code></pre></div>
<p><strong>4.8 Look up the helpfile for the function <code>is.na()</code>. Using this function, replace all the NA values in the <code>polity2</code> column of <code>dat</code> with 0.</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># YOUR CODE HERE</span></code></pre></div>
<!--chapter:end:98_Assignments/98_3_Data-Basics.Rmd-->
</div>
<div id="assignment-3-solutions" class="section level3">
<h3><span class="header-section-number">17.3.1</span> Assignment 3 Solutions</h3>
<p>For this assignment, you’ll be working on some real life data! I’ve prepared for your a basic country-year dataset, with the following variables:</p>
<ul>
<li>Country name</li>
<li>Country numerical code</li>
<li>Year</li>
<li>UN Ideal point</li>
<li>Polity2 score of regime type (from Polity VI)</li>
<li>Physical Integrity Rights score (from CIRI dataset)</li>
<li>Speech Rights score (from CIRI)</li>
<li>GDP per capita (from World Bank)</li>
<li>Population (from World Bank)</li>
<li>Political Terror Scale using Amnesty International reports (from Political Terror Scale project)</li>
<li>Composite Index of Military Capabilities (Correlates of War)</li>
<li>Region</li>
</ul>
<div id="r-projects-and-importing-1" class="section level4 unnumbered">
<h4>1. R Projects and Importing</h4>
<p><strong>1.1 Initialize a project where you store this <code>.Rmd</code> file. Using <code>getwd()</code>, print your working directory below.</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">getwd</span>()
<span class="co">#&gt; [1] &quot;/Users/rochelleterman/Desktop/plsc-31101&quot;</span></code></pre></div>
<p><strong>1.2 Download the <code>country-year.csv</code> file and store it in a subdirectory of your project called <code>data</code>.</strong></p>
<p><strong>Read <code>country-year.csv</code> into R, using a relative path. Store it in an object called <code>dat</code>.</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/country-year.csv&quot;</span>)</code></pre></div>
</div>
<div id="dimensions-and-names-1" class="section level4 unnumbered">
<h4>2. Dimensions and Names</h4>
<p><strong>2.1 How many rows and columns are in the dataset?</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dim</span>(dat)
<span class="co">#&gt; [1] 6416   13</span></code></pre></div>
<p><strong>2.2 Print the column names.</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span>(dat)
<span class="co">#&gt;  [1] &quot;X&quot;          &quot;year&quot;       &quot;ccode&quot;      &quot;country&quot;    &quot;idealpoint&quot;</span>
<span class="co">#&gt;  [6] &quot;polity2&quot;    &quot;physint&quot;    &quot;speech&quot;     &quot;gdp.pc.wdi&quot; &quot;pop.wdi&quot;   </span>
<span class="co">#&gt; [11] &quot;amnesty&quot;    &quot;cinc&quot;       &quot;region&quot;</span></code></pre></div>
<p><strong>2.3 Remove the <code>X</code> column from the dataset.</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat<span class="op">$</span>X &lt;-<span class="st"> </span><span class="ot">NULL</span></code></pre></div>
<p><strong>2.4 One of the variables is called “gdp.pc.wdi”. This stands for “Gross Domestic Product Per Capita, from the World Bank Development Indicators”. Change this variable name in the dataset from &quot; “gdp.pc.wdi” to “GDP”</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span>(dat)[<span class="dv">8</span>] &lt;-<span class="st"> &quot;GDP&quot;</span></code></pre></div>
</div>
<div id="summarizing-1" class="section level4 unnumbered">
<h4>3. Summarizing</h4>
<p><strong>3.1 How many years are covered in the dataset?</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">length</span>(<span class="kw">unique</span>(dat<span class="op">$</span>year))
<span class="co">#&gt; [1] 36</span></code></pre></div>
<p><strong>3.2 How many unique countries are covered in the dataset?</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">length</span>(<span class="kw">unique</span>(dat<span class="op">$</span>country))
<span class="co">#&gt; [1] 196</span></code></pre></div>
<p><strong>3.3 What is the range of <code>polity2</code>? How many NAs are in this column?</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(dat<span class="op">$</span>polity2)
<span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA&#39;s </span>
<span class="co">#&gt;     -10      -6       5       2       9      10    1214</span></code></pre></div>
</div>
<div id="subsetting-2" class="section level4 unnumbered">
<h4>4. Subsetting</h4>
<p><strong>4.1 Subset the data so that it returns the third column AS ITS OWN A DATAFRAME.</strong> (Do not print the object; store it in a variable.)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sub &lt;-<span class="st"> </span>dat[<span class="dv">3</span>]</code></pre></div>
<p><strong>4.2 Subset gapminder so that it returns the third column AS A VECTOR</strong> (Do not print the object; store it in a variable.)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sub &lt;-<span class="st"> </span>dat[[<span class="dv">3</span>]]
<span class="co">#OR</span>
sub &lt;-<span class="st"> </span>dat[,<span class="dv">3</span>]</code></pre></div>
<p><strong>4.3 Fix each of the following common data frame subsetting errors</strong>:</p>
<ol style="list-style-type: decimal">
<li>Extract observations collected for the year 1980</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat[dat<span class="op">$</span>year =<span class="st"> </span><span class="dv">1980</span>,]

<span class="co"># Corrected</span>
dat[dat<span class="op">$</span>year <span class="op">==</span><span class="st"> </span><span class="dv">1980</span>,]</code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Extract all columns except 1 through to 4</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat[,<span class="op">-</span><span class="dv">1</span><span class="op">:</span><span class="dv">4</span>]

<span class="co"># Corrected</span>
dat[,<span class="op">-</span><span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>)]</code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Extract the rows where the polity2 score is greater than 5</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat[dat<span class="op">$</span>polity2 <span class="op">&gt;</span><span class="st"> </span><span class="dv">5</span>]

<span class="co"># corrected</span>
dat[dat<span class="op">$</span>polity2 <span class="op">&gt;</span><span class="st"> </span><span class="dv">5</span>, ]</code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>Extract the first row, and the third and fourth columns (<code>country</code> and <code>idealpoint</code>).</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat[<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">4</span>]

<span class="co"># Corrected</span>
dat[<span class="dv">1</span>, <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">4</span>)]</code></pre></div>
<ol start="5" style="list-style-type: decimal">
<li>Extract rows that contain information for the years 2002 and 2007</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat[dat<span class="op">$</span>year <span class="op">==</span><span class="st"> </span><span class="dv">2002</span> <span class="op">|</span><span class="st"> </span><span class="dv">2007</span>,]

<span class="co"># Corrected</span>
dat[dat<span class="op">$</span>year <span class="op">==</span><span class="st"> </span><span class="dv">2002</span> <span class="op">|</span><span class="st"> </span>dat<span class="op">$</span>year <span class="op">==</span><span class="st"> </span><span class="dv">2007</span>,]</code></pre></div>
<p><strong>4.4 What does <code>summary(dat$polity2[dat$region ==&quot;Africa&quot;])</code> do? Explain below in your own words.</strong></p>
<p>It calculates some summary statistics for <code>polity2</code> scores from observations in Africa.</p>
<p><strong>4.5 Subset the data to include only observations from years 1990-2000 (inclusive). Put the subsetted data in a new variable called <code>dat.1990.2000</code></strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat.<span class="fl">1990.2000</span> &lt;-<span class="st"> </span>dat[dat<span class="op">$</span>year <span class="op">&gt;=</span><span class="st"> </span><span class="dv">1990</span> <span class="op">&amp;</span><span class="st"> </span>dat<span class="op">$</span>year<span class="op">&lt;=</span><span class="dv">2000</span>,]</code></pre></div>
<p><strong>4.6 Using <code>mean()</code> function, tell me the average GDP of observations from 1990 to 2000.</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mean</span>(dat.<span class="fl">1990.2000</span><span class="op">$</span>GDP, <span class="dt">na.rm =</span> T)
<span class="co">#&gt; [1] 6611</span></code></pre></div>
<p><strong>4.7 You just calculated the average GDP for years 1990-2000. Now calculate the average GDP from 2001 onwards. Tell me how much larger it is (in percentage).</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat.<span class="fl">2001.</span>plus &lt;-<span class="st"> </span>dat[dat<span class="op">$</span>year <span class="op">&gt;</span><span class="st"> </span><span class="dv">2000</span>,]
mean1 &lt;-<span class="st"> </span><span class="kw">mean</span>(dat.<span class="fl">1990.2000</span><span class="op">$</span>GDP, <span class="dt">na.rm =</span> T)
mean2 &lt;-<span class="st"> </span><span class="kw">mean</span>(dat.<span class="fl">2001.</span>plus<span class="op">$</span>GDP, <span class="dt">na.rm =</span> T)
(mean2 <span class="op">-</span><span class="st"> </span>mean1) <span class="op">/</span><span class="st"> </span>mean1
<span class="co">#&gt; [1] 0.825</span></code></pre></div>
<p><strong>4.8 Look up the helpfile for the function <code>is.na()</code>. Using this function, replace all the NA values in the <code>polity2</code> column of <code>dat</code> with 0.</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">?is.na
dat<span class="op">$</span>polity2[<span class="kw">is.na</span>(dat<span class="op">$</span>polity2)] &lt;-<span class="st"> </span><span class="dv">0</span>
<span class="kw">summary</span>(dat<span class="op">$</span>polity2)
<span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span>
<span class="co">#&gt;  -10.00   -5.00    0.00    1.46    8.00   10.00</span></code></pre></div>
<!--chapter:end:98_Assignments/98_3A_Data-SOLUTIONS.Rmd-->
</div>
</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>Technically, objects and variables are different things, but we’ll use the two interchangeably for now.<a href="#fnref1">↩</a></p></li>
<li id="fn2"><p>To find this information, open a command line window (‘terminal’ or, on windows, ‘git bash’), and enter the following command <code>R --version</code><a href="#fnref2">↩</a></p></li>
<li id="fn3"><p>To find the version, open RStudio and, in the navigation menu, click on RStudio –&gt; About RStudio.<a href="#fnref3">↩</a></p></li>
</ol>
</div>
<!--bookdown:body:end-->
            </section>

          </div>
        </div>
      </div>
<!--bookdown:link_prev-->
<!--bookdown:link_next-->
    </div>
  </div>
<!--bookdown:config-->

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
